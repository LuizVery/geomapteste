(function(){var e={"esri/geometry/projection":1413,"esri/geometry/pe":1439,"esri/geometry/support/GeographicTransformation":1440,"esri/geometry/support/GeographicTransformationStep":1441,"esri/layers/support/rasterFunctions/rasterProjectionHelper":1491,"esri/layers/support/RasterFunction":1495,"esri/layers/ImageryTileLayer":1554,"esri/layers/support/DimensionalDefinition":1592,"esri/layers/support/imageryRendererUtils":1593,"esri/layers/support/RasterStorageInfo":1594,"esri/layers/support/rasterDatasets/BaseRaster":1595,"esri/layers/support/rasterDatasets/RawBlockCache":1665,"esri/layers/support/rasterDatasets/EphemeralBlockCache":1666,"esri/layers/support/RasterJobHandler":1691,"esri/layers/support/rasterDatasets/RasterFactory":2031,"esri/layers/support/rasterDatasets/CloudRaster":2032,"esri/layers/support/rasterDatasets/DBFParser":2033,"esri/layers/support/rasterDatasets/ImageServerRaster":2034,"esri/layers/support/rasterDatasets/MRFRaster":2035,"esri/layers/support/rasterDatasets/xmlUtilities":2036,"esri/layers/support/rasterDatasets/TIFFRaster":2037},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1413:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(1439),r(1440),r(14)],void 0===(i=function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=null,s=null;t.isLoaded=function(){return!!a&&i.isLoaded()},t.isSupported=function(){return i.isSupported()};var l=null;t.load=function(){return l||(l=n.all([i.load(),new Promise((function(e,t){r.e(8).then(function(){var t=[r(1458)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})),new Promise((function(e,t){r.e(106).then(function(){var t=[r(1483)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]).then((function(e){var t=e[1],r=e[2].hydratedAdapter;s=r,(a=t)._enableProjection(i)})))},t.project=function(e,t,r){return void 0===r&&(r=null),e instanceof Array?0===e.length?[]:p(s,e,e[0].spatialReference,t,r):p(s,[e],e.spatialReference,t,r)[0]};var u={};function p(e,t,r,n,i){if(void 0===i&&(i=null),null===i){var s=o.cacheKey(r,n);void 0!==u[s]?i=u[s]:(null===(i=c(r,n,null))&&(i=new o),u[s]=i)}return a._project(e,t,r,n,i)}function c(e,t,r){void 0===r&&(r=null);var n=a._getTransformation(s,e,t,r,null==r?void 0:r.spatialReference);return null!==n?o.fromGE(n):null}t.projectMany=p,t.getTransformation=c,t.getTransformations=function(e,t,r){void 0===r&&(r=null);var n=a._getTransformationBySuitability(s,e,t,r,null==r?void 0:r.spatialReference);if(null!==n){for(var i=[],l=0,u=n;l<u.length;l++){var p=u[l];i.push(o.fromGE(p))}return i}return[]}}.apply(null,n))||(e.exports=i)},1439:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(128),r(25),r(4),r(14)],void 0===(i=function(e,t,n,i,o,a){var s,l,u,p,c,f;function d(e){function r(e,t,r){e[t]=r(e[t])}t._pe=e,l.init(),u.init(),p.init(),c.init(),f.init(),t.PeGCSExtent=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(r,e),r.prototype.destroy=function(){t._pe.destroy(this)},r}(t._pe.PeGCSExtent);for(var i=0,o=[t._pe.PeDatum,t._pe.PeGeogcs,t._pe.PeGeogtran,t._pe.PeObject,t._pe.PeParameter,t._pe.PePrimem,t._pe.PeProjcs,t._pe.PeSpheroid,t._pe.PeUnit];i<o.length;i++)r(o[i].prototype,"getName",(function(e){return function(){return e.call(this,new Array(l.PE_NAME_MAX))}}));for(var a=0,s=[t._pe.PeGeogtran,t._pe.PeProjcs];a<s.length;a++)r(s[a].prototype,"getParameters",(function(e){return function(){for(var r=new Array(l.PE_PARM_MAX),n=e.call(this),i=0;i<r.length;i++){var o=t._pe.getValue(n,"*");r[i]=o?t._pe.wrapPointer(o,t._pe.PeParameter):null,n+=Int32Array.BYTES_PER_ELEMENT}return r}}));r(t._pe.PeHorizon.prototype,"getCoord",(function(e){return function(){var t=this.getSize();if(!t)return null;var r=[];return y(r,t,e.call(this)),r}})),r(t._pe.PeGTlistExtendedEntry.prototype,"getEntries",(function(e){var r=t._pe._pe_getPeGTlistExtendedGTsSize();return function(){var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=this.getSteps();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+r*s,t._pe.PeGTlistExtendedGTs))}return n}}));var d=t._pe._pe_getPeHorizonSize(),h=function(e){return function(){var r=this._cache;if(r||(r=new Map,this._cache=r),r.has(e))return r.get(e);var n=null,i=e.call(this);if(!t._pe.compare(i,t._pe.NULL)){n=[i];var o=i.getNump();if(o>1)for(var a=t._pe.getPointer(i),s=1;s<o;s++)n.push(t._pe.wrapPointer(a+d*s,t._pe.PeHorizon))}return r.set(e,n),n}};r(t._pe.PeProjcs.prototype,"horizonGcsGenerate",h),r(t._pe.PeProjcs.prototype,"horizonPcsGenerate",h),t._pe.PeObject.prototype.toString=function(e){void 0===e&&(e=l.PE_STR_OPTS_NONE),t._pe.ensureCache.prepare();var r=t._pe.getPointer(this),n=t._pe.ensureInt8(new Array(l.PE_BUFFER_MAX));return t._pe.UTF8ToString(t._pe._pe_object_to_string_ext(r,e,n))}}function h(e){if(e){var r=t._pe.getClass(e);if(r){var n=t._pe.getCache(r);if(n){var i=t._pe.getPointer(e);i&&delete n[i]}}}}function _(e,r){for(var n=[],i=new Array(r),o=0;o<e;o++)n.push(t._pe.ensureInt8(i));return n}function m(e){var t;return Array.isArray(e[0])?(t=[],e.forEach((function(e){t.push(e[0],e[1])}))):t=e,t}function y(e,r,n,i){if(void 0===i&&(i=!1),i)for(var o=0;o<2*r;o++)e[o]=t._pe.getValue(n+o*Float64Array.BYTES_PER_ELEMENT,"double");else{var a=0===e.length;for(o=0;o<r;o++)a&&(e[o]=new Array(2)),e[o][0]=t._pe.getValue(n,"double"),e[o][1]=t._pe.getValue(n+Float64Array.BYTES_PER_ELEMENT,"double"),n+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(t,"__esModule",{value:!0}),t._pe=null,t.isLoaded=function(){return!!t._pe},t.isSupported=function(){return!!o("esri-wasm")},t.load=function(){return s||(s=a.create((function(e,t){new Promise((function(e,t){r.e(89).then(function(){var t=[r(1567)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})).then((function(r){r({locateFile:function(e){return i.getAssetUrl("esri/geometry/support/"+e)},onAbort:function(e){t(new Error(e))}}).then((function(t){d(t),e()}))}))})))},function(e){function r(e,r,n){t._pe.ensureCache.prepare();var i=m(n),o=n===i,a=t._pe.ensureFloat64(i),s=t._pe._pe_geog_to_proj(t._pe.getPointer(e),r,a);return s&&y(n,r,a,o),s}function n(e,t,r){return i(e,t,r,0)}function i(e,r,n,i){t._pe.ensureCache.prepare();var o=m(n),a=n===o,s=t._pe.ensureFloat64(o),l=t._pe._pe_proj_to_geog_center(t._pe.getPointer(e),r,s,i);return l&&y(n,r,s,a),l}e.geogToProj=r,e.projGeog=function(e,t,i,o){switch(o){case l.PE_TRANSFORM_P_TO_G:return n(e,t,i);case l.PE_TRANSFORM_G_TO_P:return r(e,t,i)}return 0},e.projToGeog=n,e.projToGeogCenter=i}(t.PeCSTransformations||(t.PeCSTransformations={})),function(e){e.init=function(){e.PE_BUFFER_MAX=t._pe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=t._pe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=t._pe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=t._pe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=t._pe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=t._pe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=t._pe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=t._pe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=t._pe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=t._pe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=t._pe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=t._pe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=t._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=t._pe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=t._pe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_STR_OPTS_NONE=t._pe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=t._pe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=t._pe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=t._pe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=t._pe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=t._pe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=t._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=t._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=t._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=t._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=t._pe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=t._pe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=t._pe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=t._pe.PeDefs.prototype.PE_HORIZON_DELTA}}(l=t.PeDefs||(t.PeDefs={})),function(e){var r={},n={};function i(e,n){var i=null,a=r[e];if(a||(a={},r[e]=a),a.hasOwnProperty(String(n)))i=a[n];else{var s=t._pe.PeFactory.prototype.factoryByType(e,n);t._pe.compare(s,t._pe.NULL)||(i=s,a[n]=i)}return o(i)}function o(e){if(e){var r=e.getType();switch(r){case l.PE_TYPE_GEOGCS:e=t._pe.castObject(e,t._pe.PeGeogcs);break;case l.PE_TYPE_PROJCS:e=t._pe.castObject(e,t._pe.PeProjcs);break;case l.PE_TYPE_GEOGTRAN:e=t._pe.castObject(e,t._pe.PeGeogtran);break;default:r&l.PE_TYPE_UNIT&&(e=t._pe.castObject(e,t._pe.PeUnit))}}return e}e.initialize=function(){t._pe.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return i(l.PE_TYPE_COORDSYS,e)},e.factoryByType=i,e.fromString=function(e,r){var i=null,a=n[e];if(a||(a={},n[e]=a),a.hasOwnProperty(r))i=a[r];else{var s=t._pe.PeFactory.prototype.fromString(e,r);t._pe.compare(s,t._pe.NULL)||(i=s,a[r]=i)}return o(i)},e.geogcs=function(e){return i(l.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return i(l.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return t._pe.PeFactory.prototype.getCode(e)},e.projcs=function(e){return i(l.PE_TYPE_PROJCS,e)},e.unit=function(e){return i(l.PE_TYPE_UNIT,e)}}(t.PeFactory||(t.PeFactory={})),t.PeGCSExtent=null,function(e){var r;e.init=function(){e.PE_GTLIST_OPTS_COMMON=t._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,r=t._pe._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,n,i,o,a,s){var l=null,u=new t._pe.PeInteger(s);try{var p=t._pe.PeGTlistExtended.prototype.getGTlist(e,n,i,o,a,u);if((s=u.val)&&(l=[p],s>1))for(var c=t._pe.getPointer(p),f=1;f<s;f++)l.push(t._pe.wrapPointer(c+r*f,t._pe.PeGTlistExtendedEntry))}finally{t._pe.destroy(u)}return l}}(u=t.PeGTlistExtended||(t.PeGTlistExtended={})),function(e){e.destroy=function(e){if(e&&e.length){for(var r=0,n=e;r<n.length;r++){var i=n[r];h(i),i.getEntries().forEach((function(e){h(e);var t=e.getGeogtran();h(t),t.getParameters().forEach(h),[t.getGeogcs1(),t.getGeogcs2()].forEach((function(e){h(e);var t=e.getDatum();h(t),h(t.getSpheroid()),h(e.getPrimem()),h(e.getUnit())}))}))}t._pe.PeGTlistExtendedEntry.prototype.Delete(e[0])}}}(t.PeGTlistExtendedEntry||(t.PeGTlistExtendedEntry={})),function(e){e.geogToGeog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=m(n),s=n===a,l=t._pe.ensureFloat64(a),u=0;i&&(u=t._pe.ensureFloat64(i));var p=t._pe._pe_geog_to_geog(t._pe.getPointer(e),r,l,u,o);return p&&y(n,r,l,s),p}}(t.PeGTTransformations||(t.PeGTTransformations={})),function(e){function r(e,r,n,i,o,a){var s,u;switch(t._pe.ensureCache.prepare(),e){case"dd":s=t._pe._pe_geog_to_dd,u=l.PE_DD_MAX;break;case"ddm":s=t._pe._pe_geog_to_ddm,u=l.PE_DDM_MAX;break;case"dms":s=t._pe._pe_geog_to_dms,u=l.PE_DMS_MAX}var p=0;r&&(p=t._pe.getPointer(r));var c=m(i),f=t._pe.ensureFloat64(c),d=_(n,u),h=s(p,n,f,o,t._pe.ensureInt32(d));if(h)for(var y=0;y<n;y++)a[y]=t._pe.UTF8ToString(d[y]);return h}function n(e,r,n,i,o){var a;switch(t._pe.ensureCache.prepare(),e){case"dd":a=t._pe._pe_dd_to_geog;break;case"ddm":a=t._pe._pe_ddm_to_geog;break;case"dms":a=t._pe._pe_dms_to_geog}var s=0;r&&(s=t._pe.getPointer(r));var l=i.map((function(e){return t._pe.ensureString(e)})),u=t._pe.ensureInt32(l),p=t._pe.ensureFloat64(new Array(2*n)),c=a(s,n,u,p);return c&&y(o,n,p),c}e.geog_to_dms=function(e,t,n,i,o){return r("dms",e,t,n,i,o)},e.dms_to_geog=function(e,t,r,i){return n("dms",e,t,r,i)},e.geog_to_ddm=function(e,t,n,i,o){return r("ddm",e,t,n,i,o)},e.ddm_to_geog=function(e,t,r,i){return n("ddm",e,t,r,i)},e.geog_to_dd=function(e,t,n,i,o){return r("dd",e,t,n,i,o)},e.dd_to_geog=function(e,t,r,i){return n("dd",e,t,r,i)}}(t.PeNotationDms||(t.PeNotationDms={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=t._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=t._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=t._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,r,n,i,o,a,s){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=_(r,l.PE_MGRS_MAX),d=t._pe.ensureInt32(f),h=t._pe._pe_geog_to_mgrs_extended(u,r,c,i,o,a,d);if(h)for(var y=0;y<r;y++)s[y]=t._pe.UTF8ToString(f[y]);return h},e.mgrs_to_geog_extended=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_mgrs_to_geog_extended(a,r,l,i,u);return p&&y(o,r,u),p}}(p=t.PeNotationMgrs||(t.PeNotationMgrs={})),function(e){e.geog_to_usng=function(e,r,n,i,o,a,s){t._pe.ensureCache.prepare();var u=0;e&&(u=t._pe.getPointer(e));var p=m(n),c=t._pe.ensureFloat64(p),f=_(r,l.PE_MGRS_MAX),d=t._pe.ensureInt32(f),h=t._pe._pe_geog_to_usng(u,r,c,i,o,a,d);if(h)for(var y=0;y<r;y++)s[y]=t._pe.UTF8ToString(f[y]);return h},e.usng_to_geog=function(e,r,n,i){t._pe.ensureCache.prepare();var o=0;e&&(o=t._pe.getPointer(e));var a=n.map((function(e){return t._pe.ensureString(e)})),s=t._pe.ensureInt32(a),l=t._pe.ensureFloat64(new Array(2*r)),u=t._pe._pe_usng_to_geog(o,r,s,l);return u&&y(i,r,l),u}}(t.PeNotationUsng||(t.PeNotationUsng={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=t._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=m(n),u=t._pe.ensureFloat64(s),p=_(r,l.PE_UTM_MAX),c=t._pe.ensureInt32(p),f=t._pe._pe_geog_to_utm(a,r,u,i,c);if(f)for(var d=0;d<r;d++)o[d]=t._pe.UTF8ToString(p[d]);return f},e.utm_to_geog=function(e,r,n,i,o){t._pe.ensureCache.prepare();var a=0;e&&(a=t._pe.getPointer(e));var s=n.map((function(e){return t._pe.ensureString(e)})),l=t._pe.ensureInt32(s),u=t._pe.ensureFloat64(new Array(2*r)),p=t._pe._pe_utm_to_geog(a,r,l,i,u);return p&&y(o,r,u),p}}(c=t.PeNotationUtm||(t.PeNotationUtm={})),function(e){var r=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=t._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=t._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=t._pe.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(n,i){var o,a;return void 0===i&&(i=e.PE_PCSINFO_OPTION_DOMAIN),r.has(n)&&(a=r.get(n))[i]&&(o=a[i]),o||(o=t._pe.PePCSInfo.prototype.generate(n,i),a||(a=[],r.set(n,a)),a[i]=o),o}}(f=t.PePCSInfo||(t.PePCSInfo={})),function(e){e.version_string=function(){return t._pe.PeVersion.prototype.version_string()}}(t.PeVersion||(t.PeVersion={})),t._init=d}.apply(null,n))||(e.exports=i)},1440:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1441)],void 0===(i=function(e,t,r){return function(){function e(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(var t=0,n=e.steps;t<n.length;t++){var i=n[t];i instanceof r?this.steps.push(i):this.steps.push(new r({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}}return e.cacheKey=function(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")},e.fromGE=function(t){for(var n=new e,i="",o=0,a=t.steps;o<a.length;o++){var s=a[o],l=r.fromGE(s);n.steps.push(l),i+=l.uid.toString()+","}return n._cached_projection={},n._gtlistentry=null,n._chain=i,n},e.prototype.getInverse=function(){var t=new e;t.steps=[];for(var r=this.steps.length-1;r>=0;r--){var n=this.steps[r];t.steps.push(n.getInverse())}return t},e.prototype.getGTListEntry=function(){for(var e="",t=0,r=this.steps;t<r.length;t++)e+=r[t].uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry},e.prototype.assignCachedGe=function(t,r,n){this._cached_projection[e.cacheKey(t,r)]=n},e.prototype.getCachedGeTransformation=function(t,r){for(var n="",i=0,o=this.steps;i<o.length;i++)n+=o[i].uid.toString()+",";n!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=n);var a=this._cached_projection[e.cacheKey(t,r)];return void 0===a?null:a},e}()}.apply(null,n))||(e.exports=i)},1441:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=0;return function(){function e(e){void 0===e&&(e=null),this.uid=r++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}return e.fromGE=function(t){var r=new e;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r},Object.defineProperty(e.prototype,"wkt",{get:function(){return this._wkt},set:function(e){this._wkt=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wkid",{get:function(){return this._wkid},set:function(e){this._wkid=e,this.uid=r++},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInverse",{get:function(){return this._isInverse},set:function(e){this._isInverse=e,this.uid=r++},enumerable:!0,configurable:!0}),e.prototype.getInverse=function(){var t=new e;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t},e}()}.apply(null,n))||(e.exports=i)},1491:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(11),r(1413),r(76),r(46)],void 0===(i=function(e,t,r,n,i,o,a,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)};t.defaultGridSpacing=32,t.load=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return o.isLoaded()||!o.isSupported()?[2,null]:[4,o.load()];case 1:return e.sent(),[2]}}))}))},t.projectResolution=function(e,t,r,a){if(void 0===a&&(a=null),e.spatialReference.equals(t))return e;var u=l(e.spatialReference,t);if(u&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");var p=r.center,c=new n.Extent({xmin:p.x-e.x/2,xmax:p.x+e.x/2,ymin:p.y-e.y/2,ymax:p.y+e.y/2,spatialReference:e.spatialReference}),f=u?o.project(c,t,a):s.project(c,t);return null==f?null:new n.Point(f.xmax-f.xmin,f.ymax-f.ymin,t)},t.projectPoint=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=l(e.spatialReference,t);if(n&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");return n?o.project(e,t,r):s.project(e,t)},t.projectExtent=function(e,t,r){if(void 0===r&&(r=null),e.spatialReference.equals(t))return e;var n=l(e.spatialReference,t);if(n&&!o.isLoaded())throw new i("rasterprojectionhelper-projectExtent","projection engine is not loaded");return n?o.project(e,t,r):s.project(e,t)},t.getProjectionOffsetGrid=function(e,r,u,p,c,f){void 0===p&&(p=null),void 0===c&&(c=!1),void 0===f&&(f=[t.defaultGridSpacing,t.defaultGridSpacing]);var d=r.spatialReference.equals(e.spatialReference),h=l(e.spatialReference,r.spatialReference);if(h&&!o.isLoaded())throw new i("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&r&&u))return null;for(var _,m,y,g=e.xmin,v=e.ymin,x=e.xmax,P=e.ymax,w=e.spatialReference,b=r.spatialReference,T=a.getInfo(w),S=T&&T.valid[0],I=T&&T.valid[1],R={x:f[0]*u.x,y:f[1]*u.y},E={cols:Math.ceil((x-g)/R.x-.1)+1,rows:Math.ceil((P-v)/R.y-.1)+1},O=R.x,M=R.y,N=[],C=!1,k=0;k<E.cols;k++){for(var A=[],F=0;F<E.rows;F++)_=new n.Point({x:g+O*k,y:P-M*F,spatialReference:w}),m=d?_:h?o.project(_,b,p):s.project(_,b),A.push(m),k>0&&c&&m&&y[F]&&T&&m.x<y[F].x&&(m.x+=I-S),m?(N.push((m.x-r.xmin)/(r.xmax-r.xmin)),N.push((r.ymax-m.y)/(r.ymax-r.ymin))):(N.push(NaN),N.push(NaN),C=!0);y=A}var D=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,n=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(n-e[2*t.rows+3])]}(N,E),j=new Float32Array((E.cols-1)*(E.rows-1)*2*6),L=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),B=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(k=0;k<E.cols-1;k++){for(F=0;F<E.rows-1;F++){for(var z=k*E.rows*2+2*F,G=N[z],U=N[z+1],H=N[z+2],J=N[z+3],V=N[z+=2*E.rows],Y=N[z+1],q=N[z+2],W=N[z+3],X=0,Z=12*(F*(E.cols-1)+k),K=0;K<3;K++)j[Z++]=L[X++]*G+L[X++]*H+L[X++]*q;for(X=0,K=0;K<3;K++)j[Z++]=L[X++]*U+L[X++]*J+L[X++]*W;for(X=0,K=0;K<3;K++)j[Z++]=B[X++]*G+B[X++]*V+B[X++]*q;for(X=0,K=0;K<3;K++)j[Z++]=B[X++]*U+B[X++]*Y+B[X++]*W}if(C)for(var $=0;$<j.length;$++)isNaN(j[$])&&(j[$]=-1)}return{offsets:N,error:D,coefficients:j,spacing:f,size:[E.cols-1,E.rows-1]}},t.snapPyramid=function(e,t,r){var i=Math.log(e.x/t.pixelSize.x)/Math.LN2,o=Math.log(e.y/t.pixelSize.y)/Math.LN2,a=t.storageInfo.maximumPyramidLevel||0,s="down"===r?Math.floor(Math.min(i,o)):"up"===r?Math.ceil(Math.max(i,o)):Math.round((i+o)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);var u=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new n.Point({x:u*t.pixelSize.x,y:u*t.pixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}}.apply(null,n))||(e.exports=i)},1495:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(7),r(8),r(92),r(1)],void 0===(i=function(e,t,r,n,i,o,a){var s,l=o.SetFromValues(["Raster","Raster2","DEM","FillRaster"]),u=o.SetFromValues(["Rasters"]),p=function(e){return e&&e.rasterFunction?f.fromJSON(e):e},c=function(e){return e&&e instanceof f?e.toJSON():e};!function(e){e[e.MOSAIC=0]="MOSAIC",e[e.GROUP=1]="GROUP",e[e.ITEM=2]="ITEM"}(s||(s={}));var f=function(e){function t(t){var r=e.call(this,t)||this;return r.functionArguments=null,r.functionName=null,r.outputPixelType="unknown",r.variableName=null,r.description=null,r.functionDefinition=null,r.thumbnail=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readFunctionArguments=function(e,t){return function(e){if(null==e)return null;for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];l.has(i)?t[i]=p(e[i]):u.has(i)&&Array.isArray(e[i])?t[i]=e[i].map(p):t[i]=e[i]}return t}(t.arguments||t.rasterFunctionArguments)},t.prototype.writeFunctionArguments=function(e,t,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];l.has(a)?n[a]=c(e[a]):u.has(a)&&Array.isArray(e[a])?n[a]=e[a].map(c):n[a]=c(e[a])}this.functionDefinition?t.arguments=n:t[r]=n},t.prototype.readFunctionName=function(e,t){var r=t.rasterFunctionInfos;return t.name||(r&&r.length&&"None"!==r[0].name?r[0].name:t.rasterFunction)},t.prototype.writeFunctionName=function(e,t,r){this.functionDefinition?t.name=e:t[r]=e},t.prototype.readFunctionType=function(e){return s[e]},t.prototype.writeFunctionType=function(e,t,r){t[r]=s[e]},t.prototype.clone=function(){return new n({functionName:this.functionName,functionArguments:i.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})},r.__decorate([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],t.prototype,"functionArguments",void 0),r.__decorate([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],t.prototype,"readFunctionArguments",null),r.__decorate([a.writer("functionArguments")],t.prototype,"writeFunctionArguments",null),r.__decorate([a.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0),r.__decorate([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],t.prototype,"readFunctionName",null),r.__decorate([a.writer("functionName")],t.prototype,"writeFunctionName",null),r.__decorate([a.enumeration({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),a.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"description",void 0),r.__decorate([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionType",void 0),r.__decorate([a.reader("functionType")],t.prototype,"readFunctionType",null),r.__decorate([a.writer("functionType")],t.prototype,"writeFunctionType",null),r.__decorate([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionDefinition",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"thumbnail",void 0),n=r.__decorate([a.subclass("esri.layers.support.RasterFunction")],t)}(n.JSONSupport);return f}.apply(null,n))||(e.exports=i)},1554:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(235),r(1529),r(33),r(11),r(22),r(5),r(2),r(171),r(4),r(1),r(19),r(76),r(170),r(307),r(306),r(682),r(415),r(233),r(1592),r(237),r(1593),r(1691),r(172),r(2031),r(1656),r(690)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,_,m,y,g,v,x,P,w,b,T,S,I,R,E,O){var M=l.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"});function N(){return{enabled:!this.loaded||"RasterTileServer"===this.raster.datasetFormat&&"Raster"===this.raster.tileType}}var C=u.getLogger("esri.layers.ImageryTileLayer");return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},n.bandIds=null,n.copyright=null,n.fullExtent=null,n.interpolation="nearest",n.legendEnabled=!0,n.isReference=null,n.listMode="show",n.raster=null,n.rasterInfo=null,n.sourceJSON=null,n.spatialReference=null,n.tileInfo=null,n.version=null,n.title=null,n.type="imagery-tile",n.url=null,n.operationalLayerType="ArcGISTiledImageServiceLayer",n.popupEnabled=!0,n.popupTemplate=null,n.symbolizer=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r.__assign({url:e},t):e},t.prototype.load=function(e){var t=this,r=p.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((function(){return t._openRaster(r)}),(function(){return t._openRaster(r)}))),f.resolve(this)},Object.defineProperty(t.prototype,"multidimensionalDefinition",{set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){var e,t,r=[new b({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null===(t=null===(e=this.rasterInfo)||void 0===e?void 0:e.attributeTable)||void 0===t?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){this._set("renderer",e),this.updateRenderer()},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=o.read(n,r)||void 0;if(null!=i)return i},t.prototype.createPopupTemplate=function(e){return O.createPopupTemplate(this,e)},t.prototype.updateRenderer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.loaded?JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer)?[2]:(e=this._rasterJobHandler.instance)?(this.symbolizer.renderer=this.renderer,this.symbolizer.bind(),[4,e.updateSymbolizer(this.symbolizer)]):[2]:[2];case 1:return t.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}}))}))},t.prototype.applyRenderer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return(n=e&&e.pixelBlock)&&n.pixels&&n.pixels.length>0?(this.updateRenderer(),o=this._rasterJobHandler.instance,a=this.bandIds,o?[4,o.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a}))]:[3,2]):[2,null];case 1:return i=s.sent(),[3,3];case 2:i=this.symbolizer.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a})),s.label=3;case 3:return[2,i]}}))}))},t.prototype.getTileUrl=function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?this.url+"/tile/"+e+"/"+t+"/"+r:""},t.prototype.getCompatibleTileInfo=function(e,t){if(!this.loaded)return null;var r=_.getInfo(e);return I.create({size:256,spatialReference:e,origin:r?{x:r.origin[0],y:r.origin[1]}:{x:t.xmin,y:t.ymax}})},t.prototype.getCompatibleFullExtent=function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null},t.prototype.fetchTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s;return r.__generator(this,(function(l){switch(l.label){case 0:return i.requestAsImageElement?(o=this.getTileUrl(e,t,n),[2,a(o,{responseType:"image",query:{sliceId:this._sliceId,_ts:i.timestamp},signal:i.signal}).then((function(e){return e.data}))]):[4,this._initJobHandler()];case 1:return l.sent(),this.multidimensionalDefinition&&(s=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:s},i)),[2,this.raster.fetchTile(e,t,n,i)]}}))}))},t.prototype.fetchPixels=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,this._initJobHandler()];case 1:return a.sent(),this.multidimensionalDefinition&&(o=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:o},i)),[2,this.raster.fetchPixels(e,t,n,i)]}}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),this.raster.identify(e,t)},t.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},t.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},t.prototype.write=function(t,r){var n=this.raster;if(this.loaded?"RasterTileServer"===n.datasetFormat&&("Raster"===n.tileType||"Map"===n.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return e.prototype.write.call(this,t,r);if(r&&r.messages){var i=r.origin+"/"+(r.layerContainerType||"operational-layers");r.messages.push(new s("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+i+"'",{layer:this}))}return null},t.prototype._initJobHandler=function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new S;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise},t.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},t.prototype._openRaster=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,a,l,u,p,c,f,d;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,R.open(this.raster||{url:this.url,sourceJSON:this.sourceJSON,signal:e})];case 1:if(t=r.sent(),this.url||(this.url=t.url),this.raster=t,!(n=t.rasterInfo))throw new s("tile-imagery-layer:load","cannot load resources on "+this.url);if(this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText)),"Map"===this.raster.tileType&&(this.popupEnabled=!1),i=n.spatialReference,o=n.pixelSize,a=n.storageInfo,!(l=a.tileInfo)){for(u=[],p=a.maximumPyramidLevel||0,c=Math.max(o.x,o.y),f=1/.0254*96*c,d=0;d<=p;d++)u.push({level:p-d,resolution:c,scale:f}),c*=2,f*=2;l=new I({origin:a.origin,size:[a.blockWidth,a.blockHeight],spatialReference:i,lods:u}),a.tileInfo=l}return null==this.title&&(this.title=this.raster.datasetName),n.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)),this._configDefaultRenderer(),[2,t]}}))}))},t.prototype._configDefaultSlice=function(){var e=this.raster.rasterInfo.multidimensionalInfo.variables[0],t=[];e.dimensions.forEach((function(r){t.push(new w({variableName:e.name,dimensionName:r.name,values:r.values[0],isSlice:!0}))})),this.multidimensionalDefinition=t},t.prototype._configDefaultRenderer=function(){var e=this.raster.rasterInfo,t=e.pixelType;this.bandIds||(this.bandIds=T.getDefaultBandCombination(e)),this.renderer||(this.renderer=T.createDefaultRenderer(e,this.bandIds)),"u8"===t&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]),this.symbolizer?(this.symbolizer.renderer=this.renderer,this.symbolizer.rasterInfo=e):this.symbolizer=new E({renderer:this.renderer,rasterInfo:e}),this.symbolizer.bind()||C.warn("ImageryTileLayer","The given renderer is not supported by the layer.")},r.__decorate([d.property()],t.prototype,"_cachedRendererJson",void 0),r.__decorate([d.property()],t.prototype,"_sliceId",void 0),r.__decorate([d.property()],t.prototype,"_compatibleFullExtent",void 0),r.__decorate([d.property()],t.prototype,"_rasterJobHandler",void 0),r.__decorate([d.property({type:[h.Integer],json:{write:{overridePolicy:N}}})],t.prototype,"bandIds",void 0),r.__decorate([d.property()],t.prototype,"copyright",void 0),r.__decorate([d.property({type:n.Extent}),d.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),r.__decorate([d.property({type:String,json:{read:{reader:M.read},write:{writer:M.write,overridePolicy:N}}})],t.prototype,"interpolation",void 0),r.__decorate([d.property(P.legendEnabled)],t.prototype,"legendEnabled",void 0),r.__decorate([d.property({type:Boolean,json:{read:!1}})],t.prototype,"isReference",void 0),r.__decorate([d.property({type:["show","hide"]})],t.prototype,"listMode",void 0),r.__decorate([d.property({type:[w]})],t.prototype,"multidimensionalDefinition",null),r.__decorate([d.property()],t.prototype,"raster",void 0),r.__decorate([d.property({readOnly:!0}),d.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),r.__decorate([d.property()],t.prototype,"sourceJSON",void 0),r.__decorate([d.property({type:n.SpatialReference}),d.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),r.__decorate([d.property({type:I,dependsOn:["rasterInfo"]}),d.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"version",void 0),r.__decorate([d.property()],t.prototype,"title",void 0),r.__decorate([d.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),r.__decorate([d.property(P.url)],t.prototype,"url",void 0),r.__decorate([d.property({type:["ArcGISTiledImageServiceLayer"]})],t.prototype,"operationalLayerType",void 0),r.__decorate([d.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:N,writer:function(e,t,r){t[r]=!e}}}})],t.prototype,"popupEnabled",void 0),r.__decorate([d.property({type:i,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:N}}})],t.prototype,"popupTemplate",void 0),r.__decorate([d.property({readOnly:!0,dependsOn:["title"]})],t.prototype,"defaultPopupTemplate",null),r.__decorate([d.property({readOnly:!0,type:[b],dependsOn:["rasterInfo"]})],t.prototype,"fields",null),r.__decorate([d.property({types:o.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:N}}})],t.prototype,"renderer",null),r.__decorate([d.reader("renderer")],t.prototype,"readRenderer",null),r.__decorate([d.property()],t.prototype,"symbolizer",void 0),r.__decorate([d.subclass("esri.layers.ImageryTileLayer")],t)}(x.ScaleRangeLayer(v.RefreshableLayer(y.OperationalLayer(g.PortalLayer(c.MultiOriginJSONMixin(m))))))}.apply(null,n))||(e.exports=i)},1592:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(7),r(8),r(1),r(19)],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.variableName=null,r.dimensionName=null,r.values=[],r.isSlice=!1,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:i.clone(this.values),isSlice:this.isSlice})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"variableName",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"dimensionName",void 0),r.__decorate([o.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],t.prototype,"values",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"isSlice",void 0),n=r.__decorate([o.subclass("esri.layers.support.DimensionalDefinition")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},1593:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1529),r(30),r(8),r(1495),r(1584),r(1657),r(737)],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},p={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},c=l.fromJSON(a.PREDEFINED_JSON_COLOR_RAMPS[0]);t.isSupportedRendererType=function(e){return["raster-stretch","unique-value","class-breaks","raster-shaded-relief"].indexOf(e.type)>-1},t.combineRenderingRules=function(e,t){if(!e||!t)return i.clone(e||t);var r=i.clone(e);return"none"!==t.functionName.toLowerCase()&&((function e(t){var r=t.Raster;return r&&"esri.layers.support.RasterFunction"===r.declaredClass?e(r.functionArguments):t}(r.functionArguments)).Raster=t),r},t.convertRendererToRenderingRule=function(e,t){switch(t=t||{},e.type){case"raster-stretch":return function(e,t){var r=new o;r.functionName="Stretch";var n=f[s.stretchTypeJSONDict.toJSON(e.stretchType)],i={StretchType:n,Statistics:function(e){var t=[];return e.forEach((function(e){var r=e;if(Array.isArray(r))t.push(r);else{if(null==r.min||null==r.max)return;var n=[r.min,r.max,r.avg||0,r.stddev||0];t.push(n)}})),t}(e.statistics),DRA:e.dynamicRangeAdjustment,UseGamma:e.useGamma,Gamma:e.gamma,ComputeGamma:e.computeGamma};if(null!=e.outputMin&&(i.Min=e.outputMin),null!=e.outputMax&&(i.Max=e.outputMax),n===f.standardDeviation?(i.NumberOfStandardDeviations=e.numberOfStandardDeviations,r.outputPixelType="u8"):n===f.percentClip?(i.MinPercent=e.minPercent,i.MaxPercent=e.maxPercent,r.outputPixelType="u8"):n===f.minMax?r.outputPixelType="u8":n===f.sigmoid&&(i.SigmoidStrengthLevel=e.sigmoidStrengthLevel),r.functionArguments=i,r.variableName="Raster",e.colorRamp){var l=e.colorRamp,u=new o,p=a.getColorRampName(l);return p?u.functionArguments={colorRamp:p}:!t.convertColorRampToColormap||"algorithmic"!==l.type&&"multipart"!==l.type?u.functionArguments={colorRamp:e.colorRamp.toJSON()}:u.functionArguments={Colormap:a.convertColorRampToColormap(l,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=r,u}return r}(e,t);case"class-breaks":return function(e,t){var r=[],n=[],i=[],a=[],s=t.pixelType,l=t.rasterAttributeTable,u=l&&l.features,p=h(l);if(u&&Array.isArray(u)&&e.classBreakInfos){e.classBreakInfos.forEach((function(t,r){var n,i=t.symbol.color;i.a&&u.forEach((function(o){((n=o.attributes[e.field])>=t.minValue&&n<t.maxValue||r===e.classBreakInfos.length-1&&n>=t.minValue)&&a.push([o.attributes[p],i.r,i.g,i.b])}))}));var c=s?d(a,s):a,f=new o;return f.functionName="Colormap",f.functionArguments={},f.functionArguments.Colormap=c,f.variableName="Raster",f}e.classBreakInfos.forEach((function(e,t){var o=e.symbol&&e.symbol.color;o.a?(0===t?r.push(e.minValue,e.maxValue+1e-6):r.push(e.minValue+1e-6,e.maxValue+1e-6),n.push(t),a.push([t,o.r,o.g,o.b])):i.push(e.minValue,e.maxValue)}));var _=s?d(a,s):a,m=new o;m.functionName="Remap",m.functionArguments={InputRanges:r,OutputValues:n,NoDataRanges:i},m.variableName="Raster";var y=new o;return y.functionName="Colormap",y.functionArguments={Colormap:_,Raster:m},y}(e,t);case"unique-value":return function(e,t){var r=[],n=t.pixelType,i=t.rasterAttributeTable,a=i&&i.features,s=h(i),l=!1;if(e.uniqueValueInfos&&e.uniqueValueInfos.forEach((function(t){var n=t.symbol.color;n.a&&(e.field!==s&&a?a&&a.forEach((function(i){String(i.attributes[e.field])===String(t.value)&&r.push([i.attributes[s],n.r,n.g,n.b])})):isNaN(t.value)?l=!0:r.push([t.value,n.r,n.g,n.b]))})),l)return null;var u=n&&r.length>0?d(r,n):r,p=new o;return p.functionName="Colormap",p.functionArguments={},p.functionArguments.Colormap=u,p.variableName="Raster",p}(e,t);case"raster-colormap":return function(e,t){var r=e.extractColormap();if(r&&0!==r.length){var n=t.pixelType,i=n?d(r,n):r,a=new o;return a.functionName="Colormap",a.functionArguments={},a.functionArguments.Colormap=i,a}}(e,t);case"raster-shaded-relief":return function(e,t){if("elevation"!==t.dataType)return new o;var r=new o;r.functionName="Hillshade";var n="traditional"===e.hillshadeType?0:1,i="none"===e.scalingType?1:3,s={HillshadeType:n,SlopeType:i,ZFactor:e.zFactor};return 0===n&&(s.Azimuth=e.azimuth,s.Altitude=e.altitude),3===i&&(s.PSPower=e.pixelSizePower,s.PSZFactor=e.pixelSizeFactor),r.functionArguments=s,r.variableName="Raster",e.colorRamp&&(r.functionName="ShadedRelief",s.Colormap=a.convertColorRampToColormap(e.colorRamp,256)),r}(e,t)}},t.createDefaultRenderer=function(e,t){if(e){var n,i,o,s,l,u,f,d=e.attributeTable,h=e.dataType,_=e.bandCount,m=e.pixelType,y=e.colormap,g=e.statistics,v=e.histograms;if(t&&t.length>0&&(g=g?t.map((function(e){return g[e]})):null,v=v?t.map((function(e){return v[e]})):null),d&&(i=d.fields.filter((function(e){return"red"===e.name.toLowerCase()}))[0],o=d.fields.filter((function(e){return"green"===e.name.toLowerCase()}))[0],s=d.fields.filter((function(e){return"blue"===e.name.toLowerCase()}))[0],u=d.fields.filter((function(e){return"value"===e.name.toLowerCase()}))[0],(l=d.fields.filter((function(e){return"classname"===e.name.toLowerCase()||"class_name"===e.name.toLowerCase()}))[0])||(l=d.fields.filter((function(e){return"string"===e.type}))[0])||(l=u)),1===_&&(null==y?void 0:y.length)>0)d&&i&&o&&s&&(f={},d.features.forEach((function(e){var t=e.attributes;f[t[u.name]]=l?t[l.name]:t[u.name]}))),n=r.RasterColormapRenderer.createFromColormap(y,f);else if(1===_&&d){var x=void 0,P=d.features;if(i&&o&&s&&l)x=P.map((function(e){return{value:e.attributes[l.name],label:e.attributes[l.name],symbol:{type:"esriSFS",style:"esriSFSSolid",color:[e.attributes[i.name],e.attributes[o.name],e.attributes[s.name],255]}}}));else{var w=a.convertColorRampToColormap(c,P.length);x=P.map((function(e,t){return{value:e.attributes[u.name],label:e.attributes[u.name],symbol:{color:w[t].slice(1,4),type:"esriSFS",style:"esriSFSSolid"}}}))}x.sort((function(e,t){return e.value>t.value?1:-1})),n=r.UniqueValueRenderer.fromJSON({field1:l.name,uniqueValueInfos:x})}if(!n){var b=void 0,T=!1,S=void 0,I=void 0,R=void 0;"u8"===m&&"processed"===h?(b="none",g=1===_?[{min:0,max:255}]:[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===m||"elevation"===h?(b="min-max",T=!g):"scientific"===h?(b="min-max",T=!g,S=p):v&&v.length>0?(b="percent-clip",R=I=.25):g?b="min-max":(b="percent-clip",T=!0),n=r.RasterStretchRenderer.fromJSON({stretchType:b,dra:T,colorRamp:S,min:0,max:255,statistics:T?null:g,histograms:T?null:v,maxPercent:I,minPercent:R})}return n}},t.getDefaultBandCombination=function(e){var t=e.bandCount;if(1===t)return null;if(2===t)return[0];var r,n,i,o,a,s=e.keyProperties&&e.keyProperties.BandProperties;if(s&&s.length===t){for(var l=0;l<s.length;l++)s[l].BandName&&"red"===s[l].BandName.toLowerCase()&&(n=l),s[l].BandName&&"green"===s[l].BandName.toLowerCase()&&(i=l),s[l].BandName&&"blue"===s[l].BandName.toLowerCase()&&(o=l),s[l].BandName&&"nearinfrared"===s[l].BandName.toLowerCase()&&(a=l);void 0!==n&&void 0!==i&&void 0!==o?r=[n,i,o]:void 0!==n&&void 0!==i&&void 0!==a&&(r=[a,n,i])}return!r&&t>3&&(r=[0,1,2]),r};var f={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function d(e,t){var r=u[String(t).toLowerCase()];return r&&e.push([Math.floor(r[0]-1),0,0,0],[Math.ceil(r[1]+1),0,0,0]),e}function h(e){if(e){var t=e.fields,r=t&&n.find(t,(function(e){return e&&e.name&&"value"===e.name.toLowerCase()}));return r&&r.name}}}.apply(null,n))||(e.exports=i)},1594:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(7),r(1),r(50)],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockWidth=void 0,t.blockHeight=void 0,t.compression=null,t.origin=null,t.firstPyramidLevel=null,t.maximumPyramidLevel=null,t.pyramidScalingFactor=2,t.pyramidBlockWidth=null,t.pyramidBlockHeight=null,t.tileInfo=null,t.blockBoundary=null,t}return r.__extends(t,e),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockHeight",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"compression",void 0),r.__decorate([i.property({type:o,json:{write:!0}})],t.prototype,"origin",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"firstPyramidLevel",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maximumPyramidLevel",void 0),r.__decorate([i.property()],t.prototype,"pyramidScalingFactor",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockHeight",void 0),r.__decorate([i.property({json:{write:!0}})],t.prototype,"tileInfo",void 0),r.__decorate([i.property()],t.prototype,"blockBoundary",void 0),r.__decorate([i.subclass("esri.layers.support.RasterStorageInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},1595:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(33),r(11),r(7),r(2),r(127),r(4),r(26),r(1),r(233),r(172),r(1665),r(1655),r(1456),r(1491)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,_,m,y){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rasterJobHandler=null,t.datasetName=null,t.datasetFormat=null,t.rasterInfo=null,t.ioConfig={sampling:"closest"},t}return r.__extends(t,e),t.prototype.init=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=y.load(),this.addResolvingPromise(e),[4,this.when()];case 1:return t.sent(),[2]}}))}))},t.prototype.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e=r.__assign(r.__assign({},e),{ioConfig:r.__assign({resolution:null,bandIds:null,sampling:"closest",tileInfo:d.create()},e.ioConfig)})),e},Object.defineProperty(t.prototype,"url",{set:function(e){var t=p.urlToObject(e);this._set("url",t.path)},enumerable:!0,configurable:!0}),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:open-not-implemented","open() is not implemented")}))}))},t.prototype.fetchTile=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u;return r.__generator(this,(function(r){return a=o.tileInfo,s=a.lodAt(e),l=new n.Point({x:s.resolution,y:s.resolution,spatialReference:a.spatialReference}),u=this._getTileExtent(l,t,i,a),[2,this.fetchPixels(u,a.size[0],a.size[1],o)]}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,l,u,p,c,f,d,_,m,g,v,x,P,w,b;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.rasterInfo,i=n.spatialReference,o=n.extent,a=t.datumTransformation,l=y.projectPoint(e,i,a),o.intersects(l)?(u=0,t.srcResolution?(p=y.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling),u=p.pyramidLevel,[3,3]):[3,1]):[2,{location:l,value:null}];case 1:return[4,this.computeBestPyramidLevelForLocation(e,t)];case 2:if(null==(u=r.sent()))return[2,{location:l,value:null}];r.label=3;case 3:return null===(c=this.identifyPixelLocation(l,u,null))?[2,{location:l,value:null}]:(f=c.row,d=c.col,_=c.rowOffset,m=c.colOffset,g=this.url,v=u+"/"+f+"/"+d,x=h.getBlock(g,null,v),s.isSome(x)||(x=this.fetchRawTile(u,f,d,t),h.putBlock(g,null,v,x)),[4,x]);case 4:return(P=r.sent())&&P.pixels&&P.pixels.length>0?(w=_*this.rasterInfo.storageInfo.blockHeight+m,b=!P.mask||P.mask[w]?P.pixels.map((function(e){return e[w]})):null,[2,{location:l,value:b,pyramidLevel:u}]):[2,{location:l,value:null}]}}))}))},t.prototype.fetchPixels=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u,p,c,f,d,h,_,g,v,x,P,w,b,T,S,I,R,E,O,M,N,C;return r.__generator(this,(function(r){switch(r.label){case 0:return a=e.clone().normalize(),e=a[0],s=this.rasterInfo.spatialReference,l=!e.spatialReference.equals(s),u=o.datumTransformation,p=new n.Point({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/i,spatialReference:e.spatialReference}),(c=o.srcResolution||(l?y.projectResolution(p,s,e,u):p))?(f=y.snapPyramid(c,this.rasterInfo,this.ioConfig.sampling),d=f.pyramidLevel,h=f.pyramidResolution,f.excessiveReading?[2,null]:(_=this.rasterInfo.storageInfo,null==(g=l?y.projectExtent(e,s,u):e)?[2,null]:(v={x:Math.floor((g.xmin-_.origin.x)/h.x+.1),y:Math.floor((_.origin.y-g.ymax)/h.y+.1)},x=Math.ceil((g.xmax-g.xmin)/h.x-.1),P=Math.ceil((g.ymax-g.ymin)/h.y-.1),x/t>8||P/i>8?[2,null]:[4,this.fetchRawPixels(d,v,{width:x,height:P},o)]))):[2,null];case 1:return(w=r.sent())?(b=d>0?_.pyramidBlockWidth:_.blockWidth,T=d>0?_.pyramidBlockHeight:_.blockHeight,l||1!==w.pixelBlocks.length||b!==t||T!==i||c.x!==p.x||c.y!==p.y?(S=y.getProjectionOffsetGrid(e,w.extent,p,u),R=!o.requestRawData,E={rows:S.spacing[0],cols:S.spacing[1]},O=w.pixelBlocks,M=w.mosaicSize,N=w.isPartiallyFilled,this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:O,srcMosaicSize:M,destDimension:R?{width:t,height:i}:null,coefs:R?S.coefficients:null,sampleSpacing:R?E:null},o)]:[3,3]):[2,{extent:e,srcExtent:g,pixelBlock:w.pixelBlocks[0],transformGrid:null}]):[2,null];case 2:return I=r.sent(),[3,4];case 3:C=m.mosaic(O,M),I=R?m.approximateTransform(C,{width:t,height:i},S.coefficients,E):C,r.label=4;case 4:return[2,{srcExtent:g,pixelBlock:I,transformGrid:S,extent:e,isPartiallyFilled:N}]}}))}))},t.prototype.fetchRawPixels=function(e,t,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,p,c,f,d,h,_,m,y,g,v,x,P,w,b,T,S,I,R,E,O,M,N,C;return r.__generator(this,(function(r){switch(r.label){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,l=a.blockBoundary,p=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,c=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,f=Math.floor(t.x/p),d=Math.floor(t.y/c),h=Math.floor((t.x+i.width-1)/p),_=Math.floor((t.y+i.height-1)/c),m=this.rasterInfo,y=m.pixelSize,g=m.spatialReference,!(v=l[e]))return[2,null];if(x=v.minRow,P=v.minCol,w=v.maxCol,b=v.maxRow,_<x||h<P||d>b||f>w)return[2,null];for(T=[],I=!1,R=d;R<=_;R++)for(E=f;E<=h;E++)R>=x&&E>=P&&b>=R&&w>=E?(S=this._fetchRawTile(e,R,E,o),this.ioConfig.allowPartialFill&&(S=u.create((function(e){S.then((function(t){return e(t)})).catch((function(){I=!0,e(null)}))}))),T.push(S)):T.push(null);return 0===T.length?[2,null]:[4,u.all(T)];case 1:return O=r.sent(),M={height:(_-d+1)*p,width:(h-f+1)*c},N=y.x*Math.pow(2,e),C=y.y*Math.pow(2,e),[2,{extent:new n.Extent({xmin:s.x+f*p*N,xmax:s.x+(h+1)*p*N,ymin:s.y-(_+1)*c*C,ymax:s.y-d*c*C,spatialReference:g}),pixelBlocks:O,mosaicSize:M,isPartiallyFilled:I}]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}))}))},t.prototype.computeExtent=function(e){return y.projectExtent(this.rasterInfo.extent,e)},t.prototype.decodePixelBlock=function(e,t){return this.rasterJobHandler?this.rasterJobHandler.decode({data:e,options:t}):_.decode(e,t)},t.prototype.request=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,l,u,p;return r.__generator(this,(function(c){switch(c.label){case 0:n=this.ioConfig.customFetchParameters,o=e.url,a=e.range,s=e.query,l=e.responseType,null==e.retryCount&&this.ioConfig.retryCount&&(e.retryCount=this.ioConfig.retryCount),u=a?{Range:"bytes="+a.from+"-"+a.to}:null,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,i(o,{query:r.__assign(r.__assign({},s),n),headers:u,responseType:l,signal:t})];case 2:return[2,c.sent().data];case 3:if(p=c.sent(),e.retryCount>0)return e.retryCount--,[2,this.request(e,t)];throw p;case 4:return[2]}}))}))},t.prototype.getSliceIndex=function(e){var t=this.rasterInfo.multidimensionalInfo;if(!t||0===e.length)return null;for(var r=0,n=e[0].variableName,i=function(i){var o=t.variables[i],a=o.dimensions;if(o.name!==n)return r+=a.map((function(e){return e.values.length})).reduce((function(e,t){return e+t})),"break";for(var s=a.map((function(e){return e.values.length})),l=a.length,u=function(t){var n=e.filter((function(e){return e.dimensionName===a[t].name}))[0];if(null==n)return{value:null};var i=Array.isArray(n.values[0])?n.values[0][0]:n.values[0],o=a[t].values.indexOf(i);if(-1===o)return{value:null};s.shift(),r+=t===l-1?o:o*s.reduce((function(e,t){return e+t}))},p=0;p<l;p++){var c=u(p);if("object"==typeof c)return c}},o=0;o<t.variables.length;o++){var a=i(o);if("object"==typeof a)return a.value;if("break"===a)break}return r},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,0]}))}))},t.prototype.identifyPixelLocation=function(e,t,r){var n=this.rasterInfo,i=n.spatialReference,o=n.pixelSize,a=n.extent,s=this.rasterInfo.storageInfo,l=s.blockWidth,u=s.blockHeight,p=s.maximumPyramidLevel,c=s.pyramidScalingFactor,f=s.origin,d=y.projectPoint(e,i,r);if(!a.intersects(d))return null;if(t<0||t>p)return null;var h=Math.pow(c,t),_=h*o.x,m=h*o.y,g=(f.y-d.y)/m/u,v=(d.x-f.x)/_/l,x=Math.min(u-1,Math.floor((g-Math.floor(g))*u)),P=Math.min(l-1,Math.floor((v-Math.floor(v))*l));return{pyramidLevel:t,row:Math.floor(g),col:Math.floor(v),rowOffset:x,colOffset:P,srcLocation:d}},t.prototype._getTileExtent=function(e,t,r,i){var o=i.origin,a=i.spatialReference,s=i.size[0],l=i.size[1],u=o.x+r*s*e.x,p=u+s*e.x,c=o.y-t*l*e.y,f=c-l*e.y;return new n.Extent({xmin:u,xmax:p,ymin:f,ymax:c,spatialReference:a})},t.prototype._fetchRawTile=function(e,t,n,i){var o=this.url,a=e+"/"+t+"/"+n,l=h.getBlock(o,i.registryId,a);if(!s.isSome(l)){var p=u.createAbortController();l=this.fetchRawTile(e,t,n,r.__assign(r.__assign({},i),{signal:p.signal})),h.putBlock(o,i.registryId,a,l,p),l.catch((function(){h.deleteBlock(o,i.registryId,a)}))}return i.signal&&u.onAbort(i,(function(){h.decreaseRefCount(o,i.registryId,a)})),l},r.__decorate([c.property(f.url)],t.prototype,"url",null),r.__decorate([c.property({type:String,json:{write:!0}})],t.prototype,"datasetName",void 0),r.__decorate([c.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([c.property()],t.prototype,"rasterInfo",void 0),r.__decorate([c.property()],t.prototype,"ioConfig",void 0),r.__decorate([c.property()],t.prototype,"sourceJSON",void 0),r.__decorate([c.subclass("esri.layers.support.rasterDatasets.BaseRaster")],t)}(l.EsriPromiseMixin(a.JSONSupport))}.apply(null,n))||(e.exports=i)},1665:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(28),r(1666),r(1491)],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var o=new Map,a=new n;t.register=function(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){var n=o.get(e);return n.push(r),n.length-1}return o.set(e,[r]),0},t.unregister=function(e,t){o.has(e)&&(o.get(e)[t]=null)},t.deleteRaster=function(e){o.delete(e)},t.decreaseRefCount=function(e,t,r){if(!o.has(e))return null==t?a.decreaseRefCount(e,r):0;var n=o.get(e);if(null==n[t])return a.decreaseRefCount(e,r);var i=n[t].cache;if(i.has(r)){var s=i.get(r);if(s.refCount--,0===s.refCount){i.delete(r);for(var l=0;l<n.length;l++)n[l]&&n[l].cache.has(r)&&n[l].cache.delete(r);s.controller&&s.controller.abort()}return s.refCount}return 0},t.getBlock=function(e,t,r){if(!o.has(e))return null==t?a.getBlock(e,r):null;var n=o.get(e);if(null==n[t]){for(var i=0;i<n.length;i++)if(n[i]&&n[i].cache.has(r))return(s=n[i].cache.get(r)).refCount++,s.block;return a.getBlock(e,r)}var s,l=n[t].cache;if(l.has(r))return(s=l.get(r)).refCount++,s.block;for(i=0;i<n.length;i++)if(i!==t&&n[i]&&n[i]&&n[i].cache.has(r)){var u=n[i].cache.get(r);return u.refCount++,l.set(r,u),u.block}return null},t.putBlock=function(e,t,r,n,i){if(void 0===i&&(i=null),o.has(e)){var s=o.get(e);null!=s[t]?s[t].cache.set(r,{refCount:1,block:n,controller:i}):a.putBlock(e,r,n,i)}else null==t&&a.putBlock(e,r,n,i)},t.deleteBlock=function(e,t,r){if(o.has(e)){var n=o.get(e);null!=n[t]?n[t].cache.delete(r):a.deleteBlock(e,r)}else null==t&&a.deleteBlock(e,r)},t.update=function(e,t,n,a,s,l,u){void 0===u&&(u=null);var p=function(e,t){if(!o.has(e))return null;var r=o.get(e);return null==r[t]?null:r[t]}(e,t),c=p.extent,f=p.cache,d=p.rasterInfo,h=n.clone().normalize();if(n=h[0],!c||c.xmin!==n.xmin||c.xmax!==n.xmax||c.ymin!==n.ymin||c.ymax!==n.ymax){var _=d.spatialReference,m=i.projectExtent(n,_,u),y=new r.Point({x:a,y:a,spatialReference:n.spatialReference});if(null!==s||(s=i.projectResolution(y,_,n,u))){var g=i.snapPyramid(s,d,l||"closest"),v=g.pyramidLevel,x=g.pyramidResolution;if(!g.excessiveReading){for(var P=Math.floor((m.xmin-d.storageInfo.origin.x)/x.x),w=Math.floor((d.storageInfo.origin.y-m.ymax)/x.y),b=Math.ceil((m.xmax-m.xmin)/x.x-.1),T=Math.ceil((m.ymax-m.ymin)/x.y-.1),S=v>0?d.storageInfo.pyramidBlockWidth:d.storageInfo.blockWidth,I=v>0?d.storageInfo.pyramidBlockHeight:d.storageInfo.blockHeight,R=Math.floor(P/S),E=Math.floor(w/I),O=Math.floor((P+b-1)/S),M=Math.floor((w+T-1)/I),N=new Set,C=E-1;C<=M+1;C++)for(var k=R-1;k<=O+1;k++)N.add(v+"/"+C+"/"+k);f.forEach((function(e,t){N.has(t)||f.delete(t)})),p.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}}}}}}.apply(null,n))||(e.exports=i)},1666:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(67)],void 0===(i=function(e,t,r){return function(){function e(e,t){void 0===e&&(e=15e3),void 0===t&&(t=5e3),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}return e.prototype.decreaseRefCount=function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0},e.prototype.getBlock=function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null},e.prototype.putBlock=function(e,t,r,n){void 0===n&&(n=null);var i=this._cachedBlocks,o=e+"/"+t;if(i.has(o)){var a=i.get(o);a.ts=Date.now(),a.refCount++}else i.set(o,{block:r,ts:Date.now(),refCount:1,controller:n});this.trim(),this.updateTimer()},e.prototype.deleteBlock=function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)},e.prototype.updateMaxSize=function(e){this._size=e,this.trim()},e.prototype.empty=function(){this._cachedBlocks.clear(),this.clearTimer()},e.prototype.getCurrentSize=function(){return this._cachedBlocks.size},e.prototype.updateTimer=function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var n=r.pairsOfMap(t),i=Date.now(),o=0;o<n.length&&n[o][1].ts<=i-e._duration;o++)t.delete(n[o][0]);0===t.size&&e.clearTimer()}),this._interval)}},e.prototype.trim=function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=r.pairsOfMap(e),n=0;n<t.length-this._size;n++)e.delete(t[n][0])},e.prototype.clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)},e}()}.apply(null,n))||(e.exports=i)},1691:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(11),r(4),r(238),r(1423)],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(){this._workerThread=null,this._destroyed=!1}return e.prototype.initialize=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,o.open("RasterWorker")];case 1:return e=t.sent(),this._destroyed?e.close():this._workerThread=e,[2]}}))}))},e.prototype.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},e.prototype.decode=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",e,t)];case 1:return[2,(i=r.sent())?new a(i):null]}}))}))},e.prototype.symbolize=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return i={extent:e.extent&&e.extent.toJSON(),pixelBlock:e.pixelBlock.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},[4,this._workerThread.invoke("symbolize",i,t)];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.updateSymbolizer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return o=e&&e.renderer&&"raster-stretch"===e.renderer.type&&e.renderer.histograms,[4,i.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:o},t))];case 1:return r.sent(),[2]}}))}))},e.prototype.stretch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.pixelBlock?(i={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},[4,this._workerThread.invoke("stretch",i,t)]):[2,null];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.mosaicAndTransform=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(s){switch(s.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.srcPixelBlocks&&e.srcPixelBlocks.length>0?(i=r.__assign(r.__assign({},e),{srcPixelBlocks:e.srcPixelBlocks.map((function(e){return e?e.toJSON():null}))}),[4,this._workerThread.invoke("mosaicAndTransform",i,t)]):[2,null];case 1:return[2,(o=s.sent())?new a(o):null]}}))}))},e}()}.apply(null,n))||(e.exports=i)},2031:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(11),r(67),r(2032),r(2034),r(2035),r(2037)],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=new Map;return u.set("CRF",{desc:"Cloud Raster Format",constructor:o}),u.set("MRF",{desc:"Meta Raster Format",constructor:s}),u.set("TIFF",{desc:"GeoTIFF",constructor:l}),u.set("RasterTileServer",{desc:"Raster Tile Server",constructor:a}),function(){function e(){}return Object.defineProperty(e,"supportedFormats",{get:function(){var e=new Set;return u.forEach((function(t,r){return e.add(r)})),e},enumerable:!0,configurable:!0}),e.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,s,l,p,c,f,d,h,_;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.url,o=e.ioConfig,a=e.sourceJSON,null==(s=e.datasetFormat)&&t.lastIndexOf(".")&&(s=t.slice(t.lastIndexOf(".")+1).toUpperCase()),"OVR"===s||"TIF"===s?s="TIFF":t.toLowerCase().indexOf("/imageserver")>-1&&(s="RasterTileServer"),l={bandIds:null,sampling:null},p={url:t,sourceJSON:a,datasetFormat:s,ioConfig:o||l},this.supportedFormats.has(s)?(c=u.get(s).constructor,[4,(f=new c(p)).open({signal:e.signal})]):[3,2];case 1:return r.sent(),[2,f];case 2:if(s)throw new n("rasterfactory:open","not a supported format "+s);return d=i.keysOfMap(u),h=0,[2,(_=function(){return(s=d[h++])?(c=u.get(s).constructor,(f=new c(p)).open({signal:e.signal}).then((function(){return f})).catch((function(){return _()}))):null})()]}}))}))},e.register=function(e,t,r){u.has(e.toUpperCase())||u.set(e.toUpperCase(),{desc:t,constructor:r})},e}()}.apply(null,n))||(e.exports=i)},2032:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(11),r(2),r(4),r(1),r(1490),r(1594),r(172),r(1595),r(2033),r(305)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,d){var h=new Map;return h.set("int16","esriFieldTypeSmallInteger"),h.set("int32","esriFieldTypeInteger"),h.set("int64","esriFieldTypeInteger"),h.set("float32","esriFieldTypeSingle"),h.set("float64","esriFieldTypeDouble"),h.set("text","esriFieldTypeString"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageInfo=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,l,u;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},t)];case 2:if(n=r.sent(),!this._validateHeader(n))throw new i("cloudraster:open","Invalid or unsupported conf.json.");return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),a=this._parseHeader(n),s=a.storageInfo,"thematic"!==(l=a.rasterInfo).dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:u=r.sent(),l.attributeTable=u,r.label=4;case 4:return this._set("storageInfo",s),this._set("rasterInfo",l),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=this.rasterInfo.storageInfo.maximumPyramidLevel-e)<0?[2,null]:(a=this._buildCacheFilePath(o,t,n,i.multidimensionalDefinition),s=this._getIndexRecordFromBundle(t,n),[4,this.request({url:a,range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},i.signal)]);case 1:return(l=r.sent())?(u=new Uint8Array(l),0===(p=this._getTileEndAndContentType(u,s)).recordSize?[2,null]:[4,this.request({url:a,range:{from:p.position,to:p.position+p.recordSize},responseType:"array-buffer"},i.signal)]):[2,null];case 2:return(c=r.sent())?[2,this.decodePixelBlock(c,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null})]:[2,null]}}))}))},t.prototype._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))},t.prototype._parseHeader=function(e){var t,r,i,o,a=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],s=e.bandCount,c=e.histograms,f=e.colormap,d=e.blockWidth,h=e.blockHeight,_=e.firstPyramidLevel,m=e.maximumPyramidLevel,y=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),g=new n.SpatialReference(e.extent.spatialReference||e.geodataXform.spatialReference),v=new n.Extent({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:g}),x=new n.Point({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:g}),P=e.properties,w=e.format.toLowerCase().replace("cache/",""),b=new n.Point(e.origin.x,e.origin.y,g);if(f&&f.colors)for(t=[],r=0;r<f.colors.length;r++)i=f.colors[r],o=f.values?f.values[r]:r,t.push([o,255&i,i<<16>>>24,i<<8>>>24,i>>>24]);var T=e.LODInfos,S=[];for(r=0;r<T.levels.length;r++)S.push({level:T.levels[r],resolution:T.resolutions[r],scale:96/.0254*T.resolutions[r]});var I=new p({dpi:96,lods:S,format:w,origin:b,size:[d,h],spatialReference:g}),R={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},E=Math.round((v.xmax-v.xmin)/x.x),O=Math.round((v.ymax-v.ymin)/x.y),M=[{maxCol:Math.ceil(E/d)-1,maxRow:Math.ceil(O/h)-1,minCol:0,minRow:0}],N=2;if(m>0)for(r=0;r<m;r++)M.push({maxCol:Math.ceil(E/N/d)-1,maxRow:Math.ceil(O/N/h)-1,minCol:0,minRow:0}),N*=2;var C=e.mdInfo;return{storageInfo:R,rasterInfo:new l({width:E,height:O,pixelType:a,bandCount:s,extent:v,spatialReference:g,pixelSize:x,keyProperties:P,statistics:y,histograms:c,multidimensionalInfo:C,colormap:t,storageInfo:new u({blockWidth:d,blockHeight:h,pyramidBlockWidth:d,pyramidBlockHeight:h,origin:b,tileInfo:I,firstPyramidLevel:_,maximumPyramidLevel:m,blockBoundary:M})})}},t.prototype._fetchAuxiliaryInformation=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,s,l,u,p;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.request({url:this.url+"/conf.vat.json",responseType:"json"},e).then((function(e){return e})).catch((function(){return null})),n=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},e).then((function(e){return e})).catch((function(){return null})),[4,a.all([t,n])];case 1:return(i=r.sent())[0]&&(s=i[0].fields,l=i[0].values,s&&l&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":h.get(e.type),name:e.name,alias:e.alias||e.name}})),u=l.map((function(e){return{attributes:e}})),s&&l&&(o={fields:s,features:u}))),!o&&i[1]&&(p=f.parse(i[1]),o=p.recordSet),[2,d.fromJSON(o)]}}))}))},t.prototype._buildCacheFilePath=function(e,t,r,n){var i=this.storageInfo.packetSize,o=Math.floor(t/i)*i,a=Math.floor(r/i)*i,s="R"+this._toHexString4(o)+"C"+this._toHexString4(a),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=n&&n[0];if(!u)return this.url+"/_alllayers/"+l+"/"+s+".bundle";for(var p=this.rasterInfo.multidimensionalInfo.variables.filter((function(e){return e.name===u.variableName}))[0].dimensions[0].values.indexOf(u.values[0]).toString(16),c=4-p.length,f=0;f<c;f++)p="0"+p;return p="S"+p,this.url+"/_alllayers/"+u.variableName+"/"+p+"/"+l+"/"+s+".bundle"},t.prototype._getIndexRecordFromBundle=function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44},t.prototype._getTileEndAndContentType=function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var o=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:o,recordSize:0xffffffffff&i}},t.prototype._toHexString4=function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t},r.__decorate([s.property({readOnly:!0})],t.prototype,"storageInfo",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(c)}.apply(null,n))||(e.exports=i)},2033:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1751)],void 0===(i=function(e,t,r){return function(){function e(){}return Object.defineProperty(e,"supportedVersions",{get:function(){return[5]},enumerable:!0,configurable:!0}),e.parse=function(e){var t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};var i,o=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),l={version:n,recordCount:o,headerByteCount:a,recordByteCount:s},u=32,p=[],c=[];if(3===n){for(;13!==t.getUint8(u);)i=String.fromCharCode(t.getUint8(u+11)).trim(),p.push({name:r.bytesToUTF8(new Uint8Array(e,u,11)),type:i,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(i)],length:t.getUint8(u+16)}),u+=32;if(u+=1,p.length>0)for(var f=function(){var n=[];32===t.getUint8(u)?(u+=1,p.forEach((function(t){if("C"===t.type)n.push(r.bytesToUTF8(new Uint8Array(e,u,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim()));else if("D"===t.type){var i=String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim();n.push(new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6,8),10)))}u+=t.length})),c.push(n)):u+=s};c.length<o&&e.byteLength-u>s;)f()}var d=function(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),o=i.map((function(e){return e.name})),a=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<o.length;l++)t[o[l]]=e[l-1];a.push({attributes:t})})),{displayFieldName:"",fields:i,features:a}}({fields:p,records:c});return{header:l,fields:p,records:c,recordSet:d}},e}()}.apply(null,n))||(e.exports=i)},2034:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(33),r(11),r(2),r(4),r(26),r(1),r(1490),r(1594),r(476),r(172),r(257),r(1595),r(1456),r(305)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f,d,h,_,m,y){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._levelOffset=0,t._slices=null,t._tilemapCache=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,u,p,_,m,y,g,v,x,P,w,b,T,S,I,R,E,O,M,N,C,k,A;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e&&e.signal,this.sourceJSON?(s={data:this.sourceJSON},[3,4]):[3,2];case 2:return[4,i(this.url,{responseType:"json",query:{f:"json"},signal:t})];case 3:s=r.sent(),r.label=4;case 4:if((n=s).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),u=n.data,this.sourceJSON=u,p=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=u.cacheType,null===this.tileType&&(p.indexOf(u.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===u.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),!u)throw new o("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!u.tileInfo)throw new o("imageserverraster:open","use ImageryLayer to open non-tiled image services");return this.datasetName=u.name,[4,this._fetchRasterInfo({signal:t})];case 5:if(_=r.sent(),!a.isSome(_))throw new o("image-server-raster:open","cannot initialize image service");if(m="Map"===this.tileType?f.readServiceTileInfo(u.tileInfo,u,null):d.fromJSON(u.tileInfo),y=_.extent,g=_.pixelSize,v=.5/_.width*g.x,x=void 0,P=void 0,w=m.lodAt(Math.max.apply(null,m.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==u.maxScale&&("Raster"===this.tileType?(x=m.lods.filter((function(e){return e.resolution===g.x}))[0])||(x=m.lods.filter((function(e){return e.resolution>g.x})).sort((function(e,t){return e.resolution>t.resolution?1:-1}))[0]):(x=m.lods.filter((function(e){return Math.abs(e.scale-u.maxScale)<v}))[0])||(x=m.lods.filter((function(e){return e.scale>u.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),g.x=g.y=x.resolution,_.width=Math.ceil((y.xmax-y.xmin)/g.x-.1),_.height=Math.ceil((y.ymax-y.ymin)/g.y-.1)),x||(x=w),b=m.lodAt(Math.min.apply(null,m.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=m.lods[0].level:0!==u.minScale&&"Elevation"===this.tileType&&(P=m.lods.filter((function(e){return Math.abs(e.scale-u.minScale)<v}))[0],this._levelOffset=P.level-b.level),P||(P=b),T=Math.max(g.x,g.y),(Math.abs(g.x-g.y)>v||!m.lods.some((function(e){return Math.abs(e.resolution-T)<v})))&&(g.x=g.y=x.resolution,_.width=Math.ceil((y.xmax-y.xmin)/g.x-.1),_.height=Math.ceil((y.ymax-y.ymin)/g.y-.1)),S=x.level-P.level,I=m.size,R=I[0],E=I[1],O=m.origin,M=g.x,N=g.y,C=[{minCol:Math.floor((y.xmin-O.x+.1*M)/R/M),maxCol:Math.floor((y.xmax-O.x-.1*M)/R/M),minRow:Math.floor((O.y-y.ymax+.1*N)/E/N),maxRow:Math.floor((O.y-y.ymin-.1*N)/E/N)}],S>0)for(k=0;k<S;k++)M*=2,N*=2,C.push({minCol:Math.floor((y.xmin-O.x+.1*M)/R/M),maxCol:Math.floor((y.xmax-O.x-.1*M)/R/M),minRow:Math.floor((O.y-y.ymax+.1*N)/E/M),maxRow:Math.floor((O.y-y.ymin-.1*N)/E/M)});return _.storageInfo=new c({blockWidth:m.size[0],blockHeight:m.size[1],pyramidBlockWidth:m.size[0],pyramidBlockHeight:m.size[1],compression:m.format,origin:m.origin,firstPyramidLevel:1,maximumPyramidLevel:S,tileInfo:m,blockBoundary:C}),this._set("rasterInfo",_),u.capabilities.toLowerCase().indexOf("tilemap")>-1&&(A={tileInfo:_.storageInfo.tileInfo,parsedUrl:l.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new h.TilemapCache({layer:A})),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c,f,d,h,_,y,g,v,x,P,w,b,T,S,I,R;return r.__generator(this,(function(r){switch(r.label){case 0:return o=this.rasterInfo,a=o.storageInfo,s=o.extent,l=o.pixelSize,u=a.maximumPyramidLevel-e+this._levelOffset,p=this.url+"/tile/"+u+"/"+t+"/"+n,c=this._slices?{sliceId:i.sliceId||0}:null,[4,this.request({url:p,query:c,responseType:"array-buffer"},i.signal)];case 1:return(f=r.sent())?[4,this.decodePixelBlock(f,{width:a.tileInfo.size[0],height:a.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:return d=r.sent(),h=a.blockBoundary[e],"jpg"!==a.compression||n>h.minCol&&n<h.maxCol&&t>h.minRow&&t<h.maxRow||(_=a.origin,y=a.blockWidth,g=a.blockHeight,v=Math.pow(2,e),x=Math.round((s.xmin-_.x)/(l.x*v))%y,P=Math.round((s.xmax-_.x)/(l.x*v))%y,w=Math.round((_.y-s.ymax)/(l.x*v))%g,b=Math.round((_.y-s.ymin)/(l.x*v))%g,T=n===h.minCol?x:0,S=t===h.minRow?w:0,I=n===h.maxCol?P:y,R=t===h.maxRow?b:g,m.setValidBoundary(d,{x:T,y:S},{width:I-T,height:R-S})),[2,d]}}))}))},t.prototype.getSliceIndex=function(e){for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return r?(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0]):null})))return r}return null},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._tilemapCache)return[2,0];if(null===(n=this.identifyPixelLocation(e,0,t.datumTransformation)))return[2,null];i=0,o=this.rasterInfo.storageInfo.maximumPyramidLevel,a=o-i+this._levelOffset,s=n.srcLocation,r.label=1;case 1:if(!(a>=0))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(a,n.row,n.col,t)];case 3:return"available"===r.sent()?[3,6]:[3,5];case 4:return r.sent(),[3,5];case 5:return a--,i++,null===(n=this.identifyPixelLocation(s,i,t.datumTransformation))?[2,null]:[3,1];case 6:return-1===a||null==n?[2,null]:[2,i]}}))}))},t.prototype._fetchRasterInfo=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,l,u,c,f,d,h,_,m,g,v=this;return r.__generator(this,(function(r){return t=this.sourceJSON,o=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),a=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),l=n.SpatialReference.fromJSON(t.spatialReference||t.extent.spatialReference),"Map"===this.tileType?[2,new p({width:o,height:a,bandCount:3,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:"u8",statistics:null})]:(u=e.slice,c=e.signal,f=!!t.hasRasterAttributeTable&&i(this.url+"/rasterAttributeTable",{query:{slice:u,f:"json"},signal:c}).then((function(e){return y.fromJSON(e.data)})).catch((function(){return null})),d=!!t.hasColormap&&i(this.url+"/colormap",{query:{slice:u,f:"json"},signal:c}).then((function(e){return e.data&&e.data.colormap})),h=!!t.hasHistograms&&i(this.url+"/histograms",{query:{slice:u,f:"json"},signal:c}).then((function(e){return e.data&&e.data.histograms})),_=i(this.url+"/keyProperties",{query:{f:"json"},signal:c}).then((function(e){return e.data})).catch((function(){})),m=!!t.hasMultidimensions&&i(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:c}).then((function(e){return e.data&&e.data.multidimensionalInfo})),g=!!t.hasMultidimensions&&i(this.url+"/slices",{query:{f:"json"},signal:c}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),[2,s.all([f,d,h,_,m,g]).then((function(e){var r=null;if(t.minValues&&t.minValues.length===t.bandCount){r=[];for(var i=0;i<t.minValues.length;i++)r.push({min:t.minValues[i],max:t.maxValues[i],avg:t.meanValues[i],stddev:t.stdvValues[i]})}return v._slices=e[5]||null,new p({width:o,height:a,bandCount:t.bandCount,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:t.pixelType.toLowerCase(),statistics:r,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||null,multidimensionalInfo:e[4]||null})}))])}))}))},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([u.property()],t.prototype,"tileType",void 0),r.__decorate([u.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],t)}(_)}.apply(null,n))||(e.exports=i)},2035:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(11),r(2),r(4),r(1),r(1423),r(1490),r(1594),r(1595),r(2036)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c,f){var d,h,_=(d=new ArrayBuffer(4),h=new Uint8Array(d),new Uint32Array(d)[0]=1,1===h[0]),m=new Map;m.set("Int8","s8"),m.set("UInt8","u8"),m.set("Int16","s16"),m.set("UInt16","u16"),m.set("Int32","s32"),m.set("UInt32","u32"),m.set("Float32","f32"),m.set("Float64","f32"),m.set("Double64","f32");var y=new Map;return y.set("lerc",".lrc"),y.set("none",".til"),y.set("deflate",".pzp"),y.set("jpeg",".jzp"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._storageIndex=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a,s,l,u,p,c,f,d,h,_,m,y,g,v,x,P,w,b;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,responseType:"xml"},t)];case 2:return n=r.sent(),i=this._parseHeader(n),a=i.rasterInfo,s=i.files,this._set("rasterInfo",a),this._files=s,[4,this.request({url:s.index,responseType:"array-buffer"},t)];case 3:for(l=r.sent(),this._storageIndex=this._parseIndex(l),u=0,p=-1,d=this.rasterInfo.storageInfo,h=d.blockWidth,_=d.blockHeight,m=d.compression,y=this.rasterInfo.storageInfo.pyramidScalingFactor,g=this.rasterInfo,v=g.width,x=g.height,P=g.bandCount,w=[],b="none"===m?1:P;u<this._storageIndex.length;)p++,c=Math.ceil(v/h/Math.pow(y,p)),f=Math.ceil(x/_/Math.pow(y,p)),u+=c*f*b*4,w.push({maxRow:f,maxCol:c,minCol:0,minRow:0});return this.rasterInfo.storageInfo.blockBoundary=w,p>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=p),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s,u,p,c,f,d,h,_,m,y,g,v,x,P,w,b,T,S,I,R,E,O,M,N,C;return r.__generator(this,(function(r){switch(r.label){case 0:if(o=this.rasterInfo.storageInfo,s=o.blockWidth,u=o.blockHeight,p=o.blockBoundary,c=o.compression,!(f=p[e])||f.maxRow<t||f.maxCol<n||f.minRow>t||f.minCol>n)return[2,null];if(d=this.rasterInfo,h=d.bandCount,_=d.pixelType,m=this._getTileLocation(e,t,n),y=m.ranges,g=m.actualTileWidth,v=m.actualTileHeight,!y||0===y.length)return[2,null];if(0===y[0].from&&0===y[0].to)return C=new Uint8Array(s*u),[2,new l({width:s,height:u,pixels:null,mask:C,validPixelCount:0})];for(x=this.ioConfig.bandIds,P="none"===c?1:h,w=[],b=0,b=0;b<P;b++)(!x||x.indexOf[b]>-1)&&w.push(this.request({url:this._files.data,range:{from:y[b].from,to:y[b].to},responseType:"array-buffer"},i.signal));return[4,a.all(w)];case 1:for(T=r.sent(),S=T.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),I=new Uint8Array(S),R=0,b=0;b<P;b++)I.set(new Uint8Array(T[b]),R),R+=T[b].byteLength;return E="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",[4,this.decodePixelBlock(I.buffer,{width:s,height:u,format:E,pixelType:_})];case 2:if(O=r.sent(),M=0,N=0,g!==s||v!==u)if(C=O.mask)for(b=0;b<u;b++)if(N=b*s,b<v)for(M=g;M<s;M++)C[N+M]=0;else for(M=0;M<s;M++)C[N+M]=0;else for(C=new Uint8Array(s*u),O.mask=C,b=0;b<v;b++)for(N=b*s,M=0;M<g;M++)C[N+M]=1;return[2,O]}}))}))},t.prototype._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,o,a;if(_){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),o=0;o<e.byteLength/4;o++)for(a=0;a<4;a++)n[4*o+a]=r[4*o+3-a];t=new Uint32Array(i)}else t=new Uint32Array(e);return t},t.prototype._getTileLocation=function(e,t,r){var n,i,o,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.pyramidScalingFactor,p=a.compression,c=this.rasterInfo,f=c.width,d=c.height,h=c.bandCount,_="none"===p?1:h,m=0,y=0;for(o=0;o<e;o++)y=Math.pow(u,o),m+=(n=Math.ceil(f/s/y))*(i=Math.ceil(d/l/y));y=Math.pow(u,e),n=Math.ceil(f/s/y),i=Math.ceil(d/l/y),m+=t*n+r,m*=4*_;for(var g=this._storageIndex.subarray(m,m+4*_),v=0,x=0,P=[],w=0;w<_;w++)x=(v=g[4*w+0]*Math.pow(2,32)+g[4*w+1])+g[4*w+2]*Math.pow(2,32)+g[4*w+3],P.push({from:v,to:x});return{ranges:P,actualTileWidth:r<n-1?s:Math.ceil(f/y)-s*(n-1),actualTileHeight:t<i-1?l:Math.ceil(d/y)-l*(i-1)}},t.prototype._parseHeader=function(e){var t=f.getElement(e,"MRF_META/Raster");if(!t)throw new i("mrf:open","not a valid MRF format");var r=f.getElement(t,"Size"),o=parseInt(r.getAttribute("x"),10),a=parseInt(r.getAttribute("y"),10),s=parseInt(r.getAttribute("c"),10),l=(f.getElementValue(t,"Compression")||"none").toLowerCase();if(!l||-1===["none","lerc"].indexOf(l))throw new i("mrf:open","currently does not support compression "+l);var c=f.getElementValue(t,"DataType")||"UInt8",d=m.get(c);if(null==d)throw new i("mrf:open","currently does not support pixel type "+c);var h,_,g=f.getElement(t,"PageSize"),v=parseInt(g.getAttribute("x"),10),x=parseInt(g.getAttribute("y"),10),P=f.getElement(t,"DataValues");if(P&&null!=(_=P.getAttribute("NoData"))&&(h=_.trim().split(" ").map((function(e){return parseFloat(e)}))),f.getElement(e,"MRF_META/CachedSource"))throw new i("mrf:open","currently does not support MRF referencing other data files");var w=f.getElement(e,"MRF_META/GeoTags"),b=f.getElement(w,"BoundingBox");if(null==b)throw new i("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var T,S=parseFloat(b.getAttribute("minx")),I=parseFloat(b.getAttribute("miny")),R=parseFloat(b.getAttribute("maxx")),E=parseFloat(b.getAttribute("maxy")),O=f.getElementValue(w,"Projection"),M=f.getElementValue(e,"datafile"),N=f.getElementValue(e,"IndexFile");"LOCAL_CS[]"!==O&&(T=new n.SpatialReference({wkt:O}));var C=new n.Extent(S,I,R,E);C.spatialReference=T;var k=f.getElement(e,"MRF_META/Rsets"),A=parseInt(k&&k.getAttribute("scale")||"2",10),F=new p({origin:new n.Point({x:C.xmin,y:C.ymax,spatialReference:T}),blockWidth:v,blockHeight:x,pyramidBlockWidth:v,pyramidBlockHeight:x,compression:l,pyramidScalingFactor:A}),D=new n.Point({x:(R-S)/o,y:(E-I)/a,spatialReference:T});return{rasterInfo:new u({width:o,height:a,extent:C,spatialReference:T,bandCount:s,pixelType:d,pixelSize:D,noDataValue:h,storageInfo:F}),files:{mrf:this.url,index:N||this.url.replace(".mrf",".idx"),data:M||this.url.replace(".mrf",y.get(l))}}},r.__decorate([s.property()],t.prototype,"_files",void 0),r.__decorate([s.property()],t.prototype,"_storageIndex",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterIO.MRFRaster")],t)}(c)}.apply(null,n))||(e.exports=i)},2036:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(!e||!t)return[];var r,i=t;if(t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="",!(r=t?n(e,i).getElementsByTagNameNS("*",t):e.getElementsByTagNameNS("*",i))||0===r.length)return[];for(var o=[],a=0;a<r.length;a++)o.push(r[a]||r.item[a]);return o}function n(e,t){if(!e||!t)return null;var i=t;t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var o=r(e,i);return o.length>0?t?n(o[0],t):o[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getElements=r,t.getElement=n,t.getElementValue=function(e,t){var r,i=n(e,t);return i&&(r=i.textContent||i.nodeValue||i.innerText)?r.trim():null},t.getElementValues=function(e,t){for(var n,i=r(e,t),o=[],a=0;a<i.length;a++)(n=i[a].textContent||i[a].nodeValue||i[a].innerText)&&""!==(n=n.trim())&&o.push(n);return o}}.apply(null,n))||(e.exports=i)},2037:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(0),r(28),r(11),r(2),r(1),r(1490),r(1594),r(1595),r(1750),r(1752)],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,p,c){var f=function(e,t){var r=e.get(t);return r&&r.values},d=function(e,t){var r=e.get(t);return r&&r.values[0]};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._headerInfo=null,t._bufferSize=1048576,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a,u,c,f,d,h,_,m,y,g,v,x,P,w,b,T,S,I,R,E,O,M,N,C,k,A;return r.__generator(this,(function(F){switch(F.label){case 0:return[4,this.init()];case 1:return F.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},t)];case 2:if(!(a=F.sent()))throw new i("tiffraster:open","failed to open url "+this.url);return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),u=p.parseSignature(a),c=u.littleEndian,f=u.firstIFD,d=[],[4,this.readIFDs(d,a,c,f,0,4,t)];case 3:if(F.sent(),h=p.getImageInfo(d),_=h.width,m=h.height,y=h.tileWidth,g=h.tileHeight,v=h.planes,x=h.pixelType,P=h.compression,w=h.firstPyramidLevel,b=h.maximumPyramidLevel,T=h.pyramidBlockWidth,S=h.pyramidBlockHeight,I=h.tileBoundary,R=h.metadata,E=n.Extent.fromJSON(h.extent),O=E.spatialReference,M=E?new n.Point({x:E.xmin,y:E.ymax,spatialReference:O}):new n.Point({x:0,y:0}),N=new l({blockWidth:y,blockHeight:g,pyramidBlockWidth:T,pyramidBlockHeight:S,compression:P,origin:M,firstPyramidLevel:w,maximumPyramidLevel:b,blockBoundary:I}),C=new n.Point({x:(E.xmax-E.xmin)/_,y:(E.ymax-E.ymin)/m,spatialReference:O}),k=R?{BandProperties:R.bandProperties,DataType:R.dataType}:null,A=new s({width:_,height:m,bandCount:v,pixelType:x,compression:P,pixelSize:C,storageInfo:N,spatialReference:O,keyProperties:k,extent:E,statistics:R?R.statistics:null}),this._set("rasterInfo",A),this._headerInfo=r.__assign({littleEndian:c,ifds:d},h),!this._headerInfo.isSupported)throw new i("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,p,c,f,d,h,_,m,y,g,v;return r.__generator(this,(function(r){switch(r.label){case 0:return!this._headerInfo&&this._headerInfo.isSupported?[2,null]:(o=this.rasterInfo.storageInfo.blockBoundary,a=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,s=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,!(l=o[e])||l.maxRow<t||l.maxCol<n||l.minRow>t||l.minCol>n?[2,null]:(u=this.getTileLocation(e,t,n))?(p=u.range,c=u.actualTileWidth,f=u.actualTileHeight,d=u.ifd,[4,this.request({url:this.url,range:p,responseType:"array-buffer"},i.signal)]):[2,null]);case 1:return h=r.sent(),[4,this.decodePixelBlock(h,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:d,offset:0,size:0},width:a,height:s,planes:null,pixelType:null})];case 2:if(_=r.sent(),c!==a||f!==s)if(v=_.mask)for(m=0;m<s;m++)if(g=m*a,m<f)for(y=c;y<a;y++)v[g+y]=0;else for(y=0;y<a;y++)v[g+y]=0;else for(v=new Uint8Array(a*s),_.mask=v,m=0;m<f;m++)for(g=m*a,y=0;y<c;y++)v[g+y]=1;return[2,_]}}))}))},t.prototype.readIFDs=function(e,t,n,i,o,a,s){return void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l;return r.__generator(this,(function(r){switch(r.label){case 0:return i?i>=t.byteLength||i<0?[4,this.request({url:this.url,range:{from:i+o,to:i+o+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]:[2,null];case 1:t=r.sent(),o=i+o,i=0,r.label=2;case 2:return[4,this.readIFD(t,n,i,o,c.TIFF_TAGS,a,s)];case 3:return l=r.sent(),e.push(l.ifd),l.nextIFD?[4,this.readIFDs(e,t,n,l.nextIFD-o,o,a,s)]:[2,null];case 4:return r.sent(),[2]}}))}))},t.prototype.readIFD=function(e,t,n,i,o,a,s){return void 0===o&&(o=c.TIFF_TAGS),void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l,u,f,d,h,_,m,y;return r.__generator(this,(function(r){switch(r.label){case 0:return e?(l=p.parseIFD(e,t,n,i,o,a)).success?(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),u.length>0?(f=u.map((function(e){return e.offlineOffsetSize})),d=Math.min.apply(null,f.map((function(e){return e[0]}))),Math.min.apply(null,f.map((function(e){return e[0]+e[1]})))-d<=this._bufferSize?[4,this.request({url:this.url,range:{from:d,to:d+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]):[3,2]):[3,5]:[2,null];case 1:e=r.sent(),i=d,u.forEach((function(r){return p.parseFieldValues(e,t,r,i)})),r.label=2;case 2:return l.ifd.has("GEOKEYDIRECTORY")?(h=l.ifd.get("GEOKEYDIRECTORY"),(_=h.values)&&_.length>4?(m=_[0]+"."+_[1]+"."+_[2],[4,this.readIFD(e,t,h.valueOffset+6-i,i,c.GEO_KEYS,2,s)]):[3,4]):[3,4];case 3:y=r.sent(),h.data=y.ifd,h.data&&h.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[m]}),r.label=4;case 4:return[2,l];case 5:return l.requiredBufferSize&&l.requiredBufferSize!==e.byteLength?[4,this.request({url:this.url,range:{from:i,to:i+l.requiredBufferSize+4},responseType:"array-buffer"},s)]:[3,7];case 6:return(e=r.sent()).byteLength<l.requiredBufferSize?[2,null]:[2,this.readIFD(e,t,0,i,c.TIFF_TAGS,4,s)];case 7:return[2]}}))}))},t.prototype.getTileLocation=function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,o=n.blockBoundary,a=0===e?0:e-(i-1),s=this._headerInfo.ifds[a];if(!s)return null;var l=f(s,"TILEOFFSETS");if(void 0===l)return null;var u=f(s,"TILEBYTECOUNTS"),p=o[a],c=p.minRow,h=p.minCol,_=p.maxRow,m=p.maxCol;if(t>_||r>m||t<c||r<h)return null;var y=d(s,"IMAGEWIDTH"),g=d(s,"IMAGELENGTH"),v=d(s,"TILEWIDTH"),x=d(s,"TILELENGTH"),P=t*(m+1)+r,w=l[P],b=u[P];return null==w||null==b?null:{range:{from:w,to:w+b-1},ifd:s,actualTileWidth:r===m?y%v:v,actualTileHeight:t===_?g%x:x}},r.__decorate([a.property()],t.prototype,"_files",void 0),r.__decorate([a.property()],t.prototype,"_headerInfo",void 0),r.__decorate([a.property()],t.prototype,"_bufferSize",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([a.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(u)}.apply(null,n))||(e.exports=i)}}]);