(function(){var e={"esri/views/3d/layers/StreamLayerView3D":1379,"esri/views/layers/support/FeatureFilter":1406,"esri/views/3d/layers/support/projectExtentUtils":1410,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1445,"esri/views/3d/layers/graphics/ExtentSet":1446,"esri/views/3d/layers/graphics/Graphics3DObjectStates":1447,"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":1448,"esri/views/3d/layers/support/attributeUtils":1449,"esri/views/3d/layers/graphics/QueryEngine":1460,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1477,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1533,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":1534,"esri/layers/graphics/controllers/FeatureTileController3D":1588,"esri/views/3d/layers/support/FeatureTileFetcher3D":1589,"esri/views/3d/layers/support/featureReference":1676,"esri/views/3d/layers/support/FeatureTile":1677,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":1678,"esri/views/3d/layers/FeatureLikeLayerView3D":1679,"esri/views/layers/StreamLayerView":2010},t=this||window,i=t.webpackJsonp=t.webpackJsonp||[];i.registerAbsMids?i.registerAbsMids(e):(i.absMidsWaiting=i.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{1379:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(11),i(2),i(1),i(304),i(1679),i(680),i(678),i(2010),i(14)],void 0===(n=function(e,t,r,n,s,a,o,u,l,c,p){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.asyncGraphicsUpdates=!0,t.hasZ=!0,t.hasM=!1,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"connectionError",{get:function(){var e=this.get("controller.connection.errorString");if(e)return new n("stream-controller",e)},enumerable:!0,configurable:!0}),t.prototype.createQuery=function(){return new o({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})},t.prototype.queryLatestObservations=function(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),s.get(t,"signal"))},t.prototype.createController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(e,t){Promise.all([i.e(4),i.e(72)]).then(function(){var t=[i(2180)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return e=r.sent().default,[4,(t=new e({layer:this.layer,layerView:this})).when()];case 2:return r.sent(),[2,t]}}))}))},r.__decorate([a.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r.__decorate([a.property({dependsOn:["controller.connection.errorString"],readOnly:!0})],t.prototype,"connectionError",null),r.__decorate([a.property()],t.prototype,"controller",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"hasZ",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"hasM",void 0),r.__decorate([a.subclass("esri.views.3d.layers.StreamLayerView3D")],t)}(p.StreamLayerView(u.FeatureLikeLayerView3D(l.LayerView3D(c))))}.apply(null,r))||(e.exports=n)},1406:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(28),i(236),i(22),i(7),i(8),i(92),i(1),i(29),i(304)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p){var h=new s.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),d=new s.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var i=e.call(this,t)||this;return i.where=null,i.geometry=null,i.spatialRelationship="intersects",i.hiddenIds=new Set,i.distance=void 0,i.objectIds=null,i.units=null,i.timeExtent=null,i.enabled=!1,i}var s;return i.__extends(t,e),s=t,t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.enable=function(){this._set("enabled",!0)},t.prototype.createQuery=function(e){void 0===e&&(e={});var t=this,r=t.where,n=t.geometry,s=t.spatialRelationship,a=t.timeExtent,u=t.objectIds,l=t.units,c=t.distance;return new p(i.__assign({geometry:o.clone(n),objectIds:o.clone(u),spatialRelationship:s,timeExtent:o.clone(a),where:r,units:l,distance:c},e))},t.prototype.clone=function(){var e=this,t=e.where,i=e.geometry,r=e.spatialRelationship,n=e.hiddenIds,a=e.timeExtent,u=e.objectIds,l=e.units,c=e.distance,p=new Set;return n.forEach((function(e){return p.add(e)})),new s({geometry:o.clone(i),hiddenIds:p,objectIds:o.clone(u),spatialRelationship:r,timeExtent:o.clone(a),where:t,units:l,distance:c})},i.__decorate([l.property({type:String})],t.prototype,"where",void 0),i.__decorate([l.writer("where")],t.prototype,"writeWhere",null),i.__decorate([l.property({types:r.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"geometry",void 0),i.__decorate([l.property({type:String,json:{read:{source:"spatialRel",reader:h.read},write:{target:"spatialRel",writer:h.write}}})],t.prototype,"spatialRelationship",void 0),i.__decorate([l.property({json:{write:function(e,t,i){return t[i]=u.valuesOfSet(e)},read:function(e){return u.SetFromValues(e)}}})],t.prototype,"hiddenIds",void 0),i.__decorate([l.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),i.__decorate([l.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),i.__decorate([l.property({type:String,json:{read:d.read,write:{writer:d.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),i.__decorate([l.property({type:n,json:{write:!0}})],t.prototype,"timeExtent",void 0),i.__decorate([l.property({readOnly:!0})],t.prototype,"enabled",void 0),s=i.__decorate([l.subclass("esri.views.layers.support.FeatureFilter")],t)}(a.JSONSupport)}.apply(null,r))||(e.exports=n)},1410:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(46),i(239)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,s=e.layer.fullExtent,a=s&&s.spatialReference;return a?a.equals(t)?i.resolve(s.clone()):r.canProject(a,t)?i.resolve(r.project(s,t)):e.view.state.isLocal?n.projectGeometry(s,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):i.resolve(null):i.resolve(null)}}.apply(null,r))||(e.exports=n)},1445:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(9),i(38),i(17),i(92),i(1),i(1446),i(100)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new u.ExtentSet,t.globalDirty=!1,t.dirtyGraphicsSet=new Set,t.handles=new s,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new n,t}return i.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,i,r){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=r;var s=this.layerView.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",(function(e){return n.elevationUpdateHandler(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),s.registerTask(l.Task.ELEVATION_ALIGNMENT,(function(e){return n.update(e)}),(function(){return n.needsUpdate()}))])},t.prototype.destroy=function(){this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty},t.prototype.update=function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this,i=this.layerView.view,r=this.graphicsCore.stageLayer.id,n=this.layerView.labeling,s=function(){var s=Math.min(o.dirtyGraphicsSet.size,100);a.someSet(o.dirtyGraphicsSet,(function(r){var n=t.graphicsCore.getGraphics3DGraphicById(r);return t.dirtyGraphicsSet.delete(r),n&&n.alignWithElevation(t.elevationProvider,i.renderCoordsHelper,t.graphicsCore.asyncUpdates),e.madeProgress(),--s<=0||e.done})),i._stage.processDirtyLayer(r),n&&n.processStageDirty()},o=this;this.dirtyGraphicsSet.size>0&&!e.done;)s()},t.prototype._updateDirtyExtents=function(e){for(var t=this;!this.dirtyExtents.empty&&this.dirtyGraphicsSet.size<100&&!e.done;){var i=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",{extent:i,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(i,this.spatialReference,(function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);i&&i.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,i){return e.dirtyGraphicsSet.add(i)}))},t.prototype.elevationUpdateHandler=function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent;if(this.spatialReference=e.spatialReference,this.layerView.suspended){if(!this.updateElevation){var i=this.graphicsCore.computedExtent;i&&t[2]>i.xmin&&t[0]<i.xmax&&t[3]>i.ymin&&t[1]<i.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:this.spatialReference})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}},i.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),i.__decorate([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(r);t.default=c}.apply(null,r))||(e.exports=n)},1446:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(57),i(34),i(100)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.extents=new i({allocator:function(e){return e||r.create()}}),this.tempExtent=r.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),r.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&this.mergeTight(),this.extents.pop()},e.prototype.merge=function(e){return this.mergeTight(e),e.hasProgressed},e.prototype.mergeTight=function(e){var t=this;void 0===e&&(e=n.noBudget);for(var i=this.extents,s=new Set,a=0;a!==i.length;){i.sort((function(e,t){return e[0]-t[0]})),a=i.length,s.clear();for(var o=function(n){if(e.done)return{value:void 0};for(var a=i.getItemAt(n),o=n+1;o<i.length;++o){var u=i.getItemAt(o);if(u[0]>=a[2])break;s.add(u)}s.forEach((function(n){if(a!==n)if(n[2]<=a[0])s.delete(n);else{var o=r.area(a),u=r.area(n),l=t.tempExtent;r.expand(a,n,l);var c=o+u;(r.area(l)-c)/c<.05&&(r.set(a,l),s.delete(n),i.remove(n),e.madeProgress())}})),s.add(a)},u=0;u<i.length;++u){var l=o(u);if("object"==typeof l)return l.value}}this.dirty=!1},e.prototype.contains=function(e){return this.extents.some((function(t){return r.contains(t,e)}))},e.prototype.removeContained=function(e){this.extents.filterInPlace((function(t){return!r.contains(e,t)}))},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{containsPoint:function(t){return e.extents.some((function(e){return r.containsPoint(e,t)}))}}},enumerable:!0,configurable:!0}),e}();t.ExtentSet=s}.apply(null,r))||(e.exports=n)},1447:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1448)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._graphicsCore=e,this._stateSets=new Array}return e.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null},e.prototype.acquireSet=function(e,t){var r=this,n=new i.Graphics3DObjectStateSet(e,t);this._stateSets.push(n);var s={remove:function(){return r.releaseSet(n)},pause:function(){n.objectStateSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,r.initializeSet(n)}};return{set:n,handle:s}},e.prototype.releaseSet=function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)},e.prototype._addObjectStateSet=function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)},e.prototype._removeObjectStateSet=function(e,t){e.removeObjectState(t.objectStateSet)},e.prototype.setUid=function(e,t){e.ids.add(t);var i=this._graphicsCore.graphics3DGraphics.get(t);i&&this._addObjectStateSet(i,e)},e.prototype.setUids=function(e,t){var i=this;t.forEach((function(t){return i.setUid(e,t)}))},e.prototype.setObjectIds=function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)},e.prototype.addGraphic=function(e){var t=this;this._stateSets.forEach((function(i){!i.paused&&i.hasGraphic(e)&&t._addObjectStateSet(e,i)}))},e.prototype.removeGraphic=function(e){var t=this;this._stateSets.forEach((function(i){i.hasGraphic(e)&&t._removeObjectStateSet(e,i)}))},e.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))},e.prototype.initializeSet=function(e){var t=this,i=this._graphicsCore.graphics3DGraphics;e.objectIdField?i.forEach((function(i){i&&e.hasGraphic(i)&&t._addObjectStateSet(i,e)})):e.ids.forEach((function(r){var n=i.get(r);n&&t._addObjectStateSet(n,e)}))},Object.defineProperty(e.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0}),e}();t.Graphics3DObjectStates=r}.apply(null,r))||(e.exports=n)},1448:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(312)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new i.Object3DStateSet,this.ids=new Set,this.paused=!1}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}();t.Graphics3DObjectStateSet=r}.apply(null,r))||(e.exports=n)},1449:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var i=t.toLowerCase(),r=0,n=Object.keys(e);r<n.length;r++){var s=n[r];if(s.toLowerCase()===i)return e[s]}return null}}.apply(null,r))||(e.exports=n)},1460:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(28),i(9),i(2),i(1),i(49),i(1402),i(305),i(304)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=u.default,h=function(e){function t(t){var i=e.call(this,t)||this;return i._dataQueryEngineInstance=null,i}return i.__extends(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new c({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(i){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForCount=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(i){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForExtent=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return r=i.sent(),n=r.count,s=r.extent,a=o.fromJSON(s),[2,{count:n,extent:a}]}}))}))},t.prototype.executeQueryForIds=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(i){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForLatestObservations=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t)];case 1:return r=i.sent(),(n=l.fromJSON(r)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype.executeQuery=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return r=i.sent(),(n=l.fromJSON(r)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype._ensureQueryJSON=function(e){return s.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=r.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),n=this.layer.fields.map((function(e){return e.toJSON()})),s=this.layerView.view.resourceController.scheduler,a=this.task,o=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,c=l.hasZ,h=l.hasM;return this._dataQueryEngineInstance=new p({hasZ:c,hasM:h,geometryType:i,fields:n,timeInfo:e,spatialReference:o,objectIdField:t,featureStore:u,scheduler:s,task:a}),this._dataQueryEngineInstance},i.__decorate([a.property({constructOnly:!0})],t.prototype,"layerView",void 0),i.__decorate([a.property({constructOnly:!0})],t.prototype,"task",void 0),i.__decorate([a.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),i.__decorate([a.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),i.__decorate([a.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),i.__decorate([a.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),i.__decorate([a.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(n);t.QueryEngine=h,t.default=h}.apply(null,r))||(e.exports=n)},1477:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(9),i(17),i(13),i(1),i(47),i(709),i(100)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l){var c=-.3*o.earthRadius;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suspended=!1,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new n,t.layerView=null,t.updating=!0,t}return i.__extends(t,e),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var i=e.view,r=i.basemapTerrain,n=i.resourceController.scheduler;this.handles.add([i.on("resize",(function(){return t.viewChange()})),i.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(l.Task.FRUSTUM_VISIBILITY,(function(){return t.update()}),(function(){return t.updating})),r.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([s.init(r,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),s.init(i,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype._setDirty=function(){this.updating||this._set("updating",!0)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()},t.prototype.viewChange=function(){this._setDirty()},t.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.updateIsVisibleBelowSurface=function(){var e=this.layerView.view,t=e.basemapTerrain,i="local"===e.viewingMode,r=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!t.isOpaque()||r},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=c;else{var i=t.basemapTerrain.elevationBounds,r=i.min,n=i.max;e=r-Math.max(1,(n-r)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},i.__decorate([a.property({readOnly:!0})],t.prototype,"suspended",void 0),i.__decorate([a.property({readOnly:!0})],t.prototype,"updating",void 0),i.__decorate([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(r)}.apply(null,r))||(e.exports=n)},1533:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(91),i(9),i(24),i(17),i(4),i(13),i(1),i(689),i(46),i(304),i(428),i(1475),i(1445),i(1534),i(1477),i(1447),i(1476),i(78),i(1449),i(311)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b,F,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(t){var i=e.call(this,t)||this;return i._handles=new a,i.watchUpdatingTracking=new x.WatchUpdatingTracking,i.suspendResumeExtentMode="computed",i.dataExtent=null,i.suspendResumeExtent=null,i}return i.__extends(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendInfo",{get:function(){var e={};return this.scaleVisibility&&this.scaleVisibility.suspended&&(e.outsideScaleRange=!0),this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new m:null,i=e.scaleVisibilityEnabled?new _:null,r=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new g.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new y.default:null;return{graphicsCore:new f.Graphics3DCore({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:i,filterVisibility:r,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,i){c.diff(t,i)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,i){c.diff(t,i)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t,r,n,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,r=function(e,t,i){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,r,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(n=e.view.elevationProvider,this.elevationAlignment.setup(e,r,this.graphicsCore,n)),this._set("objectStates",new v.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,o.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return i.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return s.watchUpdatingTracking.addPromise(s.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(e,"fullOpacity",(function(){return s.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(e.view,"clippingArea",(function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,o.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var i=t[e],r=this[i];r&&(r.destroy(),this._set(i,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t){var i=this;if(e instanceof h){var n=this.objectStates.acquireSet(0,t),s=n.set,a=n.handle;return this.owner.queryObjectIds(e).then((function(e){return i.objectStates.setObjectIds(s,e)})),a}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof r)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof r){var o=e;if(!t||!o[0].attributes||null===F.attributeLookup(o[0].attributes,t)){var u=o.map((function(e){return e.uid})),l=this.objectStates.acquireSet(0,null),c=l.set;return a=l.handle,this.objectStates.setUids(c,u),a}e=o.map((function(e){return F.attributeLookup(e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var p=e,d=this.objectStates.acquireSet(0,t);return c=d.set,a=d.handle,this.objectStates.setObjectIds(c,p),a}}return S},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(u.init(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(E),e.suspendResumeExtentMode){case"computed":e._handles.add(u.init(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;case"data":e._handles.add(u.init(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;default:s.neverReached(e.suspendResumeExtentMode)}})))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!p.canProject(e,i))return;e=p.project(e,i)}return b.enlargeExtent(e,t,d.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},i.__decorate([l.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),i.__decorate([l.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),i.__decorate([l.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),i.__decorate([l.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i.__decorate([l.property({readOnly:!0})],t.prototype,"labeling",void 0),i.__decorate([l.property({readOnly:!0})],t.prototype,"objectStates",void 0),i.__decorate([l.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),i.__decorate([l.property()],t.prototype,"suspendResumeExtentMode",void 0),i.__decorate([l.property()],t.prototype,"dataExtent",void 0),i.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),i.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspendInfo",null),i.__decorate([l.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),i.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(n);t.default=w;var E="suspendResumeExtentMode",S={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,r))||(e.exports=n)},1534:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(9),i(17),i(5),i(2),i(4),i(13),i(1),i(1460),i(1406),i(100)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p,h){Object.defineProperty(t,"__esModule",{value:!0});var d=s.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),f=function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=e.apply(this,t)||this;return r.filter=null,r._dirty=!1,r._querying=!1,r._handles=new n,r}return i.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var i=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new c.default({layerView:this._layerView,task:h.Task.FILTER_VISIBILITY});var r=this._layerView.view.resourceController.scheduler;this._handles.add(r.registerTask(h.Task.FILTER_VISIBILITY,(function(e){return i._update(e)}),(function(){return i._needsUpdate()}))),this._handles.add(u.on(t.owner,"loadedGraphics","after-changes",(function(e){return i._graphicsChanged(e)}),(function(){return i.dirty=!0}))),this.filterChanged()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var i=a.isSome(e)?e.clone():new p;return i.timeExtent=i.timeExtent?i.timeExtent.intersection(t):t,i},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){o.isAbortError(e)||(d.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(i){if(e.done)return!1;var r=t._queryResult.has(t._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,r,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),i.__decorate([l.property({readOnly:!0})],t.prototype,"updating",null),i.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(r);t.Graphics3DFilterVisibility=f}.apply(null,r))||(e.exports=n)},1588:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(9),i(72),i(23),i(24),i(11),i(17),i(8),i(5),i(2),i(127),i(4),i(13),i(1),i(146),i(239),i(318),i(1589),i(1678),i(77),i(311)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b,F,x){var w=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),E=function(e){function t(t){var i=e.call(this,t)||this;return i.type="feature-tile-3d",i.watchUpdatingTracking=new x.WatchUpdatingTracking,i.serviceDataExtent=null,i.serviceDataCount=r.constants.NO_SERVICE_DATA_COUNT,i.vertexLimitExceeded=!1,i.displayFeatureLimit=null,i.suspended=!1,i.tileFetcher=null,i.handles=new u,i.fetchDataInfoPromise=null,i.fetchDataInfoAbortController=null,i.lifeCycleAbortController=d.createAbortController(),i}var r;return i.__extends(t,e),r=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("extent",i)}}else w.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===r.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,i=e.view,n=i&&i.featureTiles,s=n&&n.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&s){var a=this.approximateExtentSizeAtScale(t.minScale,s);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>r.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var i=this.layerView.view,r=Math.ceil((i.width/t.pixelSize+i.height/t.pixelSize)/2),n=t.levels[0];return r*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new s([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add(this,"mode",(function(){return e.modeChanged()}),2);var t=d.resolve().then((function(){return e.verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())})).then((function(){return e.initializeTileFetcher()}));this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new o("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.restart=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.refetch=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,i=f.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(i),i.then((function(){var i=e,r=i.layerView,n=i.tileDescriptors,s=r.layer;e.tileFetcher=new _.FeatureTileFetcher3D({context:e.context,filterExtent:e.filteredDataExtent,tileDescriptors:n,features:e.graphics}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var a=e.layerView.view.resourceController;a&&(e.handles.add(a.memoryController.events.on("quality-changed",(function(t){e.tileFetcher.memoryFactor=t}))),e.tileFetcher.memoryFactor=a.memoryController.memoryFactor);var o="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;o&&e.handles.add(f.init(e.layerView.view,"qualitySettings.graphics3D."+o,(function(t){e.tileFetcher.lodFactor=t||1}))),e.watchUpdatingTracking.add(s,"createQueryVersion",(function(){return e.dataFilterChanged()})),e.watchUpdatingTracking.add(r,"availableFields",(function(t,i){return e.availableFieldsChanged(i,t)})),e.watchUpdatingTracking.add(r,"requiredFields",(function(t,i){return e.requiredFieldsChanged(i,t)})),e.handles.add([s.on("apply-edits",(function(t){return e.applyEdits(t)})),e.watch("filteredDataExtent",(function(t){return e.tileFetcher.filterExtent=t}),!0),e.watch("tileDescriptors",(function(t){return e.tileFetcher.tileDescriptors=t}),!0),f.init(e,"maximumNumberOfFeatures",(function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t}),!0),f.init(e,"serviceDataCount",(function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures}),!0),f.init(F,"FEATURE_TILE_FETCH_SHOW_TILES",(function(i){i&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new b.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!i&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)}))]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:w.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))}))},t.prototype.availableFieldsChanged=function(e,t){this.tileFetcher&&O(this.tileFetcher.availableFields,t)&&this.refetch()},t.prototype.requiredFieldsChanged=function(e,t){this.tileFetcher&&O(this.tileFetcher.availableFields,t)&&this.restart()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,i=t.createQuery();return i.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(i.cacheHint=!0),i},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return g.isHostedAgolService(e.url);case"csv":case"geojson":case"ogc-feature":return!0;default:return void a.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return i.sent(),[3,3];case 2:return t=i.sent(),d.isAbortError(t)||this._set("serviceDataExtent",l.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}}))}))},t.prototype.tryUpdateServiceDataExtent=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,n,s,a,o,u,c,p,h,d,f;return i.__generator(this,(function(i){switch(i.label){case 0:return t=this.layerView,n=t.layer,s=n.capabilities.query.supportsExtent,a=l.clone(t.fullExtentInLocalViewSpatialReference),o=n.fullExtent,u=this.fullExtentIsAccurate(),c=this.serviceDataCount,s&&c<=r.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!a||!u)&&"queryExtent"in n?(p=this.createDataInfoQuery(),[4,n.queryExtent(p,{timeout:r.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return h=i.sent(),this._set("serviceDataExtent",h.extent),[3,6];case 2:return a?(this._set("serviceDataExtent",a),[3,6]):[3,3];case 3:return o?(d="portalItem"in n?n.portalItem:null,[4,m.projectGeometry(o,t.view.spatialReference,d,e)]):[3,5];case 4:return f=i.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),i.label=6;case 6:return[2]}}))}))},t.prototype.updateServiceDataCount=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return"queryFeatureCount"in(t=this.layerView.layer)?[4,n.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:r.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))]:(a=r.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a),[2]);case 1:if(!0===(s=i.sent()).ok)this._set("serviceDataCount",s.value);else{if(d.isAbortError(s.error))throw s.error;a=r.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a)}return[2]}}))}))},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,i=e.maximumTotalNumberOfPrimitives,r=t.primitivesPerCoordinate,n=t.primitivesPerFeature,s=this._get("vertexLimitInfo");return p.isNone(s)||s.maximumTotalNumberOfPrimitives!==i||s.primitivesPerCoordinate!==r||s.primitivesPerFeature!==n?{primitivesPerCoordinate:r,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:i}:s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return a.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,h,f,y,g,m,v,_,b;return i.__generator(this,(function(i){switch(i.label){case 0:return s=p.isSome(this.vertexLimitInfo)&&this.vertexLimitInfo.primitivesPerFeature<=0,a=this.minimumNumberOfVerticesForGeometry>1,o=this.layerView.layer,u=this.supportsExceedsLimitQuery,p.isNone(this.vertexLimitInfo)||!s&&!a?(this._set("vertexLimitExceeded",!1),[2]):(l=this.vertexLimitInfo,c=l.primitivesPerFeature,h=l.primitivesPerCoordinate,f=l.maximumTotalNumberOfPrimitives,0!==c&&p.isSome(e)?[4,e]:[3,2]);case 1:i.sent(),i.label=2;case 2:return y=this.serviceDataCount,m=y!==r.constants.NO_SERVICE_DATA_COUNT,g=m?Math.ceil((f-y*c)/(h||1)):Math.ceil(f/(h||1)),a&&(g=Math.min(g,S)),m&&this.minimumNumberOfVerticesForGeometry*y>g?(this._set("vertexLimitExceeded",!0),[2]):u?[4,n.result(o.queryFeatures(this.createVertexLimitExceededQuery(g),{timeout:r.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>g),[2]);case 3:if(!1===(v=i.sent()).ok){if(d.isAbortError(v.error))throw v.error;return this._set("vertexLimitExceeded",!1),[2]}return _=v.value,(b=_.features[0])&&b.attributes?this._set("vertexLimitExceeded",!!b.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}}))}))},t.prototype.fetchServiceDataInfo=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t,r,n,s,a=this;return i.__generator(this,(function(i){return this.cancelFetchServiceDataInfo(),e=d.createAbortController(),t=e.signal,r=this.updateServiceDataCount(t),n=d.eachAlways([r,this.updateVertexLimitExceeded(r,t)]),s=n.then((function(){return a.updateServiceDataExtent(t)})).catch((function(e){d.isAbortError(e)||w.error("#fetchServiceDataInfo()",e)})).then((function(){s===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null,a.fetchDataInfoAbortController=null),e=null})),e&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=e,[2,n.then((function(){}),(function(){}))]}))}))},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),i.__decorate([y.property({readOnly:!0})],t.prototype,"type",void 0),i.__decorate([y.property({constructOnly:!0})],t.prototype,"graphics",void 0),i.__decorate([y.property({constructOnly:!0})],t.prototype,"layerView",void 0),i.__decorate([y.property({constructOnly:!0})],t.prototype,"context",void 0),i.__decorate([y.property()],t.prototype,"extent",null),i.__decorate([y.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),i.__decorate([y.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),i.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),i.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),i.__decorate([y.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),i.__decorate([y.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),i.__decorate([y.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),i.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),i.__decorate([y.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),i.__decorate([y.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),i.__decorate([y.property()],t.prototype,"displayFeatureLimit",void 0),i.__decorate([y.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i.__decorate([y.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),i.__decorate([y.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),i.__decorate([y.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),i.__decorate([y.property()],t.prototype,"tileFetcher",void 0),i.__decorate([y.property()],t.prototype,"fetchDataInfoPromise",void 0),i.__decorate([y.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),r=i.__decorate([y.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(h.EsriPromiseMixin(r)),S=5e6;function O(e,t){if(!t)return!1;for(var i=0,r=t;i<r.length;i++){var n=r[i];if(!e.has(n))return!0}return!1}return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(E||(E={})),E.constants.reset(),E}.apply(null,r))||(e.exports=n)},1589:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(9),i(30),i(17),i(5),i(2),i(4),i(54),i(92),i(13),i(1),i(34),i(106),i(431),i(304),i(1676),i(1677),i(177),i(100)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p,h,d,f,y,g,m,v,_,b){Object.defineProperty(t,"__esModule",{value:!0});var F=a.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),x=function(e){function t(t){var i=e.call(this,t)||this;return i._useTileCount=!1,i.updating=!1,i.updatingTotal=0,i.updatingRemaining=0,i.expectedFeatureDiff=0,i.maximumNumberOfFeaturesExceeded=!1,i.maximumNumberOfFeaturesExceededThrottle=1e3,i.maximumNumberOfFeaturesExceededNext=0,i._fullRatio=1,i._farRatio=1,i.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},i.handles=new s,i._dirty=!1,i.featureTiles=new Map,i.displayingFeatureReferences=new Map,i.numDisplayingFeatureReferences=0,i.suspended=!0,i.pendingEdits=null,i}return i.__extends(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryFactor",{set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodFactor",{set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTileCount",{get:function(){return this._useTileCount&&o.isSome(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))F.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("filterExtent",i),this.reclip(i,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add(p.on(this,"tileDescriptors","change",(function(){return e.setDirty()}),(function(){return e.setDirty()}))),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?m.MultiFeatureReference:m.SingleFeatureReference;var t=this.context.scheduler;o.isSome(t)&&this.handles.add(t.registerTask(b.Task.FEATURE_TILE_FETCHER,(function(t){return e.update(t)}),(function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0}))),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.restart=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.clearTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.refetch=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e.cancelFetchTile(t)})),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=null;return this.featureTiles.forEach((function(t){t.displayingFeatures&&0!==t.displayingFeatures.length&&(o.isNone(e)?e=c.SetFromValues(n.keysOfSet(t.availableFields)):e.forEach((function(i){t.availableFields.has(i)||o.unwrap(e).delete(i)})))})),o.isSome(e)?e:new Set},enumerable:!0,configurable:!0}),t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:u.resolve(),count:0,controller:u.createAbortController()},this.pause()),this.pendingEdits.count++;var i=this.pendingEdits.edits.then((function(){return e.result.catch((function(e){if(u.isAbortError(e))throw e;return null})).then((function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,o.isSome(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e}))}));return this.pendingEdits.edits=i,this.updated(),i},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var i=new Set;e.forEach((function(e){return i.add(e.objectId)})),this.featureTiles.forEach((function(e){if(e.features){var r=e.features.filter((function(e){return!i.has(f.getObjectId(e,t.objectIdField))}));r.length!==e.features.length&&(e.setFeatures(r,0,e.availableFields),t.invalidateCounts())}}))}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var n,s,a,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return n=[],s=new Set,e.forEach((function(e){return n.push(e.objectId)})),t.forEach((function(e){n.push(e.objectId),s.add(e.objectId)})),0===n.length?[2]:(a=[],this.featureTiles.forEach((function(e){var t=o.applyEditsAddUpdateTile(e,n,s,r);t&&a.push(t)})),[4,u.eachAlways(a)]);case 1:return i.sent(),[2]}}))}))},t.prototype.applyEditsAddUpdateTile=function(e,t,r,n){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,p,h=this;return i.__generator(this,(function(i){switch(i.label){case 0:return e.features?((s=this.createQuery(e)).resultType=void 0,s.cacheHint=!1,s.objectIds=t,[4,this.queryFeatures(s,n)]):[2];case 1:if(a=i.sent(),o=null,r.size>0&&(u=e.features.filter((function(e){return!r.has(f.getObjectId(e,h.objectIdField))}))).length!==e.features.length&&(o=u),a.features.length>0)for(o||(o=e.features.slice()),l=0,c=a.features;l<c.length;l++)p=c[l],o.push(p);return o&&(e.setFeatures(o,0,T(e.availableFields,a.fields)),this.invalidateCounts()),[2]}}))}))},t.prototype.queryFeatures=function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:I})},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&performance.now()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var i=this.getListOfTiles();if(this.markTilesNotAlive(i),e.run((function(){return t.addTiles(i,e)}))&&e.run((function(){return t.filterExtentTiles(i,e)}))&&e.run((function(){return t.removeTiles(i,e)}))&&!e.done){var r=this.sortTiles(i);e.run((function(){return t.displayTiles(r,e)}))&&e.run((function(){return t.fetchTiles(r,e)}))&&e.run((function(){return t.updateMemoryEstimates(r,e)}))||this.setDirty(),this.updated()}else this.setDirty()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,i=e;t<i.length;t++)i[t].alive=!1},t.prototype.addTiles=function(e,t){var i=this;return!this.suspended&&(this.tileDescriptors.forEach((function(r){var n=i.featureTiles.get(r.id);n?n.alive=!0:t.done||(e.push(i.addTile(r)),t.madeProgress())})),t.hasProgressed)},t.prototype.filterExtentTiles=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this.clearTile(n),t.madeProgress()))}return t.hasProgressed},t.prototype.removeTiles=function(e,t){for(var i=e.length-1;i>=0&&!t.done;i--){var r=e[i];r.alive||(this.removeTile(r),i!==e.length-1&&(e[i]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed},t.prototype.sortTiles=function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e},t.prototype.displayTiles=function(e,t){for(var i=this,r=this.updateRatio(e),n=function(e){if(!t.run((function(){return function(e){var t=i._fullRatio<1?r(e)*i._farRatio:1;return e.reduceFeatures(t,i.memoryFactor,i.objectIdField)&&i.setDirty(),i.showTile(e)}(e)})))return s.setDirty(),"break"},s=this,a=0,o=e;a<o.length&&"break"!==n(o[a]);a++);return t.hasProgressed},t.prototype.fetchTiles=function(e,t){var i=this;if(this.paused)return!1;for(var r=!1,n=function(e){if(!e.needsFetching)return"continue";var i=o.isSome(s.context.memoryCache)?s.context.memoryCache.pop(e.id):null;if(o.isSome(i))return e.cache=i,s.setDirty(),s.scheduleUpdated(),t.madeProgress(),"continue";if(s.needsNumFeatures(e)){var n=u.createAbortController(),a=s.fetchTileCount(e,n.signal);s._handleRequest(e,a,n,(function(){return e.numFeatures=v.FAILED_FEATURE_COUNT})),r=!0,t.madeProgress()}return t.done?{value:!0}:void 0},s=this,a=0,l=e;a<l.length;a++){var c=n(l[a]);if("object"==typeof c)return c.value}if(r)return t.hasProgressed;for(var p=function(e){if(e.needsFetching){var r=u.createAbortController(),n=h.fetchTile(e,r.signal);if(h._handleRequest(e,n,r,(function(t){e.setFeatures([],0,null),i.invalidateCounts(),e.featuresMissing=!1,i.context.logFetchError(F,t)})),t.madeProgress(),t.done)return{value:!0}}},h=this,d=0,f=e;d<f.length;d++){var y=p(f[d]);if("object"==typeof y)return y.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var i=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(i.setDirty(),!0)})),t.hasProgressed},t.prototype.reclip=function(e,t){var i=this;this.constructed&&(this.featureTiles.forEach((function(r){r.displayingFeatures&&0!==r.displayingFeatures.length&&(r.intersection(t,R),r.intersection(e,V),d.equals(R,V)||i.hideTileFeatures(r))})),this.featureTiles.forEach((function(e){return i.showTile(e)})),this.updated())},t.prototype.updated=function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var i=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",i),i){var r=0,n=0,s=0,a=0,o=0,u=0,l=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++s,t.isFetching&&t.hasPreciseFeatureCount){var i=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),r=t.displayingFeatures?t.displayingFeatures.length*l:0;u+=i-r}t.needsFetching?++o:t.numFeatures>0&&(++a,n+=t.numFeatures)})),o+=t;var c=0;n?(r=n,c=Math.min(o*n/a,n)):(r=s,c=o),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",r),this._set("updatingRemaining",c),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.featureTiles.forEach((function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded})),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,i=0,r=e;i<r.length;i++){var n=r[i];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),i=function(e){return 1/(1<<Math.max(0,t-e.descriptor.lij[0]))},r=0,n=0,s=0,a=e;s<a.length;s++){var o=a[s],u=o.numFeatures;r+=u,n+=u*i(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/r),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),i},t.prototype.maximumFeaturesUpdated=function(e,t){var i=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=i.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(i.cancelFetchTile(e),i.resetFetchTile(e))}})),this.setDirty())},t.prototype.addTile=function(e){var t=new v.FeatureTile(e);return this.featureTiles.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,i=e.descriptor.resolution;this.featureTiles.forEach((function(r){if(r.displayingFeatures&&e!==r&&(!e.descriptor.lij||!r.descriptor.lij||_.tilesAreRelated(e.descriptor.lij,r.descriptor.lij))){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,s=r.displayingFeatures;n<s.length;n++){var a=s[n];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(f.getObjectId(a,t.objectIdField));o.ref(o.feature,i),t.numDisplayingFeatureReferences++}}})),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.removeTile=function(e){this.clearTile(e),this.featureTiles.delete(e.id)},t.prototype.resetFetchTile=function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0},t.prototype.cancelFetchTile=function(e){var t=e.requestController;o.isSome(t)&&(e.requestController=null,e.resetFetching(),t.abort())},t.prototype.fetchTileCount=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r;return i.__generator(this,(function(i){switch(i.label){case 0:return r=e,[4,this.fetchCount(e,t)];case 1:return r.numFeatures=i.sent(),this.updateRatio(this.getListOfTiles()),[2,3===e.fetchStatus?1:0]}}))}))},t.prototype.fetchTile=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a,o,u,l,c,p,h,d;return i.__generator(this,(function(i){switch(i.label){case 0:return(r=this.maximumFeaturesForTile(e))<=0?[2,S(e)]:(n=this.getMaxRecordCount(e),s=Math.ceil(r/n),w(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=r&&s>g.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((a=this.createQuery(e)).maxRecordCountFactor=Math.ceil(r/n),e.isRefetching&&e.features&&e.features.length>0&&(o=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/n),a.maxRecordCountFactor=Math.max(o+1,a.maxRecordCountFactor)),[4,this.queryFeatures(a,t)]));case 1:return u=i.sent(),l=u.features,c=u.exceededTransferLimit,p=u.fields,h=c?a.maxRecordCountFactor>=g.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=l.length<e.numFeatures||c,d=this._removeEmptyFeatures(l),e.setFeatures(l,d,O(p)),this.invalidateCounts(),[2,h]}}))}))},t.prototype.fetchCount=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(i){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]}))}))},t.prototype.fetchPagedTile=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a,o,u,l,c,p,h,d,f,y;return i.__generator(this,(function(i){switch(i.label){case 0:r=0,n=0,a=0,o=this.maximumFeaturesForTile(e)-a,u=this.getMaxRecordCount(e),l=null,i.label=1;case 1:return c=this.createQuery(e),p=this.setPagingParameters(c,r,o,u),[4,this.queryFeatures(c,t)];case 2:return h=i.sent(),d=h.features,f=h.exceededTransferLimit,y=h.fields,p&&(r+=c.num),a+=d.length,n+=this._removeEmptyFeatures(d),e.featuresMissing=r<e.numFeatures||f,s=s?s.concat(d):d,l=T(l,y),e.setFeatures(s,n,l),this.invalidateCounts(),this.setDirty(),o=this.maximumFeaturesForTile(e)-a,!p||!f||o<=0?[2,f?4:5]:[3,1];case 3:return[2]}}))}))},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.context.createQuery(),i=e.descriptor.extent;if(i){var r=this.context.tilingScheme.spatialReference;t.geometry=d.toExtent(i,r)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,i,r){return!!this.context.capabilities.supportsPagination&&(e.start=t,i>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(i/r),e.num=Math.min(e.maxRecordCountFactor*r,i)):e.num=Math.min(r),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor},Object.defineProperty(t.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0}),t.prototype.setResolutionParams=function(e,t){if(this.supportsResolution){var i=this.getEffectiveTileResolution(t);null!=i&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new y.default({mode:"view",originPosition:"upper-left",tolerance:i,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=i))}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,i=0;i<e.length;){var r=e[i];f.hasVertices(r.geometry)?++i:(e[i]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&e.needsFeatureCount&&!w(e)},t.prototype.getMaxRecordCount=function(e){var t=this.context,i=t.tileMaxRecordCount,r=t.maxRecordCount;return this.useTileQuery(e)&&o.isSome(i)&&i>0&&this.context.capabilities.supportsResultType?i:o.isSome(r)&&r>0?r:C},t.prototype.useTileQuery=function(e){return(!w(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType},t.prototype._handleRequest=function(e,t,i,r){var n=this;e.fetchStatus=e.needsRefetching?3:2,e.requestController=i;var s=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===i&&(e.requestController=null,e.fetchStatus=4),u.isAbortError(t)?s=!0:r(t)})).then((function(){s||n.setDirty(),n.scheduleUpdated()}))},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(l.schedule((function(){e.handles.remove("scheduleUpdated"),e.updated()})),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var i=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],i}var r=e.descriptor.resolution,n=this.changes.updates,s=this.changes.adds,a=Math.min(e.featureLimit,t.length);e.featureLimit=a;for(var o=0;o<a;++o){var u=t[o],l=f.getObjectId(u,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var p=c.ref(u,r);p.oldVersion!==p.newVersion&&(n.removes.push(p.oldVersion),n.adds.push(p.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(u,r)),s.push(u);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,a),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,i=this.changes.removes,r=0,n=e.displayingFeatures;r<n.length;r++){var s=n[r],a=f.getObjectId(s,this.objectIdField),o=this.displayingFeatureReferences.get(a);if(o){var u=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(a),i.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,i=this.changes.removes,r=Math.min(t.length,i.length),n=0;n<r;){var s=Math.min(n+D,r);this.features.addMany(t.slice(n,s)),this.features.removeMany(i.slice(n,s)),n=s}t.length>r&&this.features.addMany(0===n?t:t.slice(n)),i.length>r&&this.features.removeMany(0===n?i:i.slice(n)),t.length=0,i.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&o.isSome(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.featureTiles.size),t=0;return this.featureTiles.forEach((function(i){return e[t++]=i})),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,i=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,r=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(i*r/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}},enumerable:!0,configurable:!0}),i.__decorate([h.property({constructOnly:!0})],t.prototype,"features",void 0),i.__decorate([h.property()],t.prototype,"tileDescriptors",void 0),i.__decorate([h.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),i.__decorate([h.property({value:1})],t.prototype,"memoryFactor",null),i.__decorate([h.property({value:1})],t.prototype,"lodFactor",null),i.__decorate([h.property({dependsOn:["context"]})],t.prototype,"useTileCount",null),i.__decorate([h.property({readOnly:!0})],t.prototype,"updating",void 0),i.__decorate([h.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),i.__decorate([h.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),i.__decorate([h.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),i.__decorate([h.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),i.__decorate([h.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),i.__decorate([h.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),i.__decorate([h.property({readOnly:!0})],t.prototype,"totalVertices",null),i.__decorate([h.property({readOnly:!0})],t.prototype,"totalFeatures",null),i.__decorate([h.property()],t.prototype,"filterExtent",null),i.__decorate([h.property({constructOnly:!0})],t.prototype,"context",void 0),i.__decorate([h.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(r);function w(e){return"dummy-tile-full-extent"===e.id}function E(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function S(e){return e.setFeatures([],0,null),e.featuresMissing=!1,4}function O(e){return o.isNone(e)?new Set:c.SetFromValues(e.map((function(e){return e.name})))}function T(e,t){if(o.isNone(e)||o.isNone(t))return O(t);for(var i=new Set,r=0,n=t;r<n.length;r++){var s=n[r].name;e.has(s)&&i.add(s)}return i}t.FeatureTileFetcher3D=x,t.contextCapabilitiesFromLayer=function(e){var t=e.capabilities.query;return{supportsMultipleResolutions:E(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}};var C=2e3,R=d.create(),V=d.create(),I=6e5,D=200;t.default=x}.apply(null,r))||(e.exports=n)},1676:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(106)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var r=this.feature;s.oldVersion=r,this.feature&&(e.uid=this.feature.uid);for(var n=0,a=this.versions;n<a.length;n++){var o=a[n];if(o.resolution===t){o.refCount++;var u=this.highestResolutionVersion===o&&!i.equals(e,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=e),s.newVersion=u?e:r,s}}var l={feature:e,resolution:t,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(s.newVersion=e,this.highestResolutionVersion=l):s.newVersion=r,s},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var i=this.versions[t];if(i.resolution===e)return i.refCount--,s.oldVersion=this.feature,0===i.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===i&&(this.recalculateHighestResolutionVersion(),s.oldVersion=i.feature)),s.newVersion=this.feature,s}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var i=this.versions[t];i.resolution<e.resolution&&(e=i)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=r;var n=function(){function e(e){this._feature=e,this.refCount=1}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return++this.refCount,s.oldVersion=this._feature,this.feature&&(e.uid=this.feature.uid),i.equals(this._feature,e)||(this._feature=e),s.newVersion=this._feature,s},e.prototype.unref=function(){return s.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(s.newVersion=null,s):(s.newVersion=this._feature,s)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var s={oldVersion:null,newVersion:null}}.apply(null,r))||(e.exports=n)},1677:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(30),i(2),i(34),i(106)],void 0===(n=function(e,t,i,r,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new Set,o=function(){function e(e){this.descriptor=e,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=u,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=a,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t,i){this._availableFields=r.unwrapOr(i,a),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+s.numVertices(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=s.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=s.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),e.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0},Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,i){if(!t||!e||i!==t.length||i>e.length)return!1;for(var r=0;r<i;++r)if(e[r]!==t[r])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(n.fromExtent(e,l),n.intersects(this.descriptor.extent,l))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(n.fromExtent(e,t),this.descriptor.extent&&n.intersection(t,this.descriptor.extent,t)):n.set(t,this.descriptor.extent),t):(n.set(t,n.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort((function(t,i){return s.getObjectId(t,e)-s.getObjectId(i,e)})),i.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t,i){if(e<=0)return!1;var r=!1;if(this._features){this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,r=!0)),!this._shuffled&&e<1&&this._shuffle(i);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))}else this.featureLimit=0;return r},Object.defineProperty(e.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},enumerable:!0,configurable:!0}),e}();t.FeatureTile=o;var u=-1;t.FAILED_FEATURE_COUNT=-2;var l=n.create()}.apply(null,r))||(e.exports=n)},1678:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(91),i(174),i(244),i(425),i(426),i(187),i(197)],void 0===(n=function(e,t,i,r,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,i){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=i,this.tilingScheme=new u(t),this.loadedSymbols=l.map((function(e){return new a(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new a(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=r.fromExtent(e);this.dataExtentGraphic=new i({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var r=this,n=[];e.forEach((function(e,i){var s=r.tileFetcher.test.getFeatureTileById(i);s&&t.filter(s)||(r.view.graphics.removeMany(e),n.push(i))})),n.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(n){if(t.filter(n)&&!e.has(n.id)){var a=n.descriptor.lij,u=a[0],l=a[1],c=a[2];r.tilingScheme.ensureMaxLod(u);var p=r.tilingScheme.getExtentGeometry(u,l,c),h=[new i({geometry:p,symbol:t.symbols[u%t.symbols.length]}),new i({geometry:p.center,symbol:new s({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,h),r.view.graphics.addMany(h)}}))},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,r))||(e.exports=n)},1679:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(11),i(2),i(4),i(13),i(1),i(106),i(1588),i(441),i(304),i(1533),i(1460),i(1410),i(100)],void 0===(n=function(e,t,i,r,n,s,a,o,u,l,c,p,h,d,f,y){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLikeLayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.asyncGraphicsUpdates=!1,t.suspendResumeExtentMode="computed",t.slicePlaneEnabled=!1,t.drapeSourceType=1,t.fullExtentInLocalViewSpatialReference=null,t.suspendResumeExtent=null,t._controllerCreated=!1,t.clippingExtent=null,t.supportsHeightUnitConversion=!0,t.pendingController=null,t.queryEngine=null,t}return i.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(s.reject(new r("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this._set("graphics3d",new h.default({owner:this,layer:t,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",(function(t){e.graphics3d.graphicsCore.preferredUpdatePolicy=t?1:0})),this.updatingHandles.add(this,"suspendResumeExtentMode",(function(t){e.graphics3d.suspendResumeExtentMode=t})),this.addResolvingPromise(this.graphics3d.setup().then((function(){return e.validateGeometryType()})).then((function(){return e.queryEngine=new d.default({layerView:e,task:y.Task.FEATURE_QUERY_ENGINE})})).then((function(){return f.toViewIfLocal(e)})).then((function(t){return e.fullExtentInLocalViewSpatialReference=t})).then((function(){return e.initializeController()}))),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},t.prototype.notifyGraphicUpdate=function(e,t){this.graphics3d.graphicsCore.notifyGraphicUpdate(e,t)},t.prototype.getRenderingInfo=function(e,t,i){var r=c.getRenderingInfo(e,{renderer:t,arcade:i});if(r&&r.color){var n=r.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return r},t.prototype.getRenderingInfoAsync=function(e,t,r,n){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(s){return[2,c.getRenderingInfoAsync(e,i.__assign({renderer:t,arcade:r},n))]}))}))},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,i=null;return this.loadedGraphics&&this.loadedGraphics.forEach((function(r){r.uid===e&&(i=u.hydrateGraphic(r,t.layer))})),i},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.computeAttachmentOrigin=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null},t.prototype.getSymbolLayerSize=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null},t.prototype.queryFeatures=function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryObjectIds=function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryFeatureCount=function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryExtent=function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),n.get(t,"signal"))},t.prototype._ensureQuery=function(e){return n.isNone(e)?this.createQuery():p.from(e)},t.prototype.highlight=function(e){return this.graphics3d.highlight(e,this.layer.objectIdField)},t.prototype.canResume=function(){return!(!e.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.getSuspendInfo=function(){var t=e.prototype.getSuspendInfo.call(this);return this.graphics3d?i.__assign(i.__assign({},t),this.graphics3d.suspendInfo):t},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed||!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)},t.prototype.initializeController=function(){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}}))}))},t.prototype.setControllerWhenInitialized=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,a.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}}))}))},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return s.reject(new r("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}},t.prototype._getResourceInfo=function(){var e=this.controller&&this.controller instanceof l?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},enumerable:!0,configurable:!0}),i.__decorate([o.property()],t.prototype,"loadedGraphics",void 0),i.__decorate([o.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),i.__decorate([o.property({dependsOn:["graphics3d.updating","controller.updating"]})],t.prototype,"updating",void 0),i.__decorate([o.property()],t.prototype,"controller",void 0),i.__decorate([o.property()],t.prototype,"graphics3d",void 0),i.__decorate([o.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),i.__decorate([o.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),i.__decorate([o.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),i.__decorate([o.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],t.prototype,"suspendInfo",void 0),i.__decorate([o.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),i.__decorate([o.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(e)}}.apply(null,r))||(e.exports=n)},2010:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(1),i(1406)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.StreamLayerView=function(e){return function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=e.apply(this,t)||this;return r.connectionError=null,r.connectionStatus="disconnected",r.filter=null,r}return i.__extends(t,e),i.__decorate([r.property({readOnly:!0})],t.prototype,"connectionError",void 0),i.__decorate([r.property({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),i.__decorate([r.property({type:n})],t.prototype,"filter",void 0),i.__decorate([r.subclass("esri.layers.mixins.StreamLayerView")],t)}(e)}}.apply(null,r))||(e.exports=n)}}]);