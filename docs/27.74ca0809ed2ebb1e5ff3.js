(function(){var e={"esri/layers/FeatureLayer":1321,"esri/layers/graphics/data/QueryEngine":1402,"esri/form/elements/inputs/Input":1407,"esri/renderers/support/styleUtils":1408,"esri/layers/support/PromiseQueue":1417,"esri/form/elements/Element":1419,"esri/layers/support/TimeInfo":1420,"esri/layers/support/FeatureReduction":1421,"esri/layers/graphics/data/FeatureStore":1427,"esri/layers/graphics/data/executeTileQuery":1433,"esri/layers/mixins/TemporalLayer":1436,"esri/layers/support/TimeReference":1437,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1442,"esri/layers/graphics/data/BoundsStore":1443,"esri/layers/support/FeatureReductionSelection":1452,"esri/layers/support/fieldProperties":1453,"esri/layers/support/FeatureReductionCluster":1462,"esri/views/2d/layers/features/support/AttributeStore":1466,"esri/views/2d/layers/graphics/graphicsUtils":1467,"esri/layers/graphics/data/QueryEngineCapabilities":1468,"esri/layers/support/labelingInfo":1485,"esri/form/support/elements":1500,"esri/form/elements/inputs/TextInput":1501,"esri/layers/support/AggregateField":1502,"esri/layers/support/OutStatistic":1503,"esri/layers/support/featureReductionUtils":1504,"esri/layers/graphics/data/QueryEngineResult":1524,"esri/layers/graphics/data/AttributesBuilder":1525,"esri/geohash/geohashUtils":1568,"esri/form/FormTemplate":1601,"esri/form/ExpressionInfo":1602,"esri/form/elements/AttachmentElement":1603,"esri/form/elements/inputs/AttachmentInput":1604,"esri/form/elements/FieldElement":1605,"esri/form/elements/support/inputs":1606,"esri/form/elements/inputs/BarcodeScannerInput":1607,"esri/form/elements/inputs/ComboBoxInput":1608,"esri/form/elements/inputs/DateTimePickerInput":1609,"esri/form/elements/inputs/RadioButtonsInput":1610,"esri/form/elements/inputs/TextAreaInput":1611,"esri/form/elements/inputs/TextBoxInput":1612,"esri/form/elements/GroupElement":1613,"esri/form/elements/RelationshipElement":1614,"esri/layers/graphics/sources/MemorySource":1615,"esri/layers/support/FeatureIndex":1616,"esri/layers/support/Relationship":1617,"esri/views/2d/layers/features/controllers/BaseController":1699,"esri/views/2d/layers/features/support/ClusterStore":1700,"esri/geohash/GeohashTree":1701,"esri/views/2d/layers/features/support/pixelBuffering":1702,"esri/layers/graphics/data/StreamFeatureManager":1703,"esri/layers/graphics/sources/connections/GeoEventConnection":1704,"esri/layers/graphics/sources/connections/StreamConnection":1705,"esri/views/2d/layers/features/controllers/StreamController":2129,"esri/views/2d/layers/features/controllers/support/DispatchQueue":2130},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[27,4,6],{1321:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(235),r(692),r(33),r(74),r(23),r(11),r(17),r(25),r(22),r(5),r(2),r(171),r(85),r(4),r(26),r(1),r(1601),r(49),r(186),r(40),r(170),r(1615),r(310),r(307),r(306),r(682),r(415),r(1436),r(146),r(233),r(1616),r(1421),r(1462),r(1452),r(1504),r(739),r(719),r(1453),r(413),r(66),r(683),r(1485),r(326),r(1617),r(1420),r(308),r(1408),r(690),r(108),r(722),r(305),r(304),r(723),r(14)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m,v,g,b,x,w,I,S,F,T,E,M,O,R,j,C,A,D,P,k,N,G,B,L,q,V,Q,z,U,J,Z,W,Y,X,H,K,$,ee,te,re){var ie=p("featurelayer-advanced-symbols")?"?returnAdvancedSymbols=true":"",ne=new d.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),oe={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},se="FeatureLayer",ae=h.getLogger("esri.layers.FeatureLayer");function ue(e){return e&&e instanceof u}function le(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function ce(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}var pe=q.defineFieldProperties();return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i._handles=new c,i.capabilities=null,i.copyright=null,i.displayField=null,i.definitionExpression=null,i.dynamicDataSource=null,i.editFieldsInfo=null,i.editingEnabled=!0,i.editingInfo=null,i.elevationInfo=null,i.featureReduction=null,i.fields=null,i.formTemplate=null,i.fullExtent=null,i.gdbVersion=null,i.geometryProperties=null,i.geometryType=null,i.hasM=void 0,i.hasZ=void 0,i.heightModelInfo=null,i.historicMoment=null,i.isTable=!1,i.labelsVisible=!0,i.labelingInfo=null,i.layerId=void 0,i.legendEnabled=!0,i.minScale=0,i.maxScale=0,i.globalIdField=null,i.objectIdField=null,i.outFields=null,i.path=null,i.popupEnabled=!0,i.popupTemplate=null,i.relationships=null,i.sourceJSON=null,i.returnM=void 0,i.returnZ=void 0,i.screenSizePerspectiveEnabled=!0,i.serviceDefinitionExpression=null,i.spatialReference=I.WGS84,i.templates=null,i.timeInfo=null,i.title=null,i.sublayerTitleMode="item-title",i.trackIdField=null,i.type="feature",i.typeIdField=null,i.types=null,i.indexes=new(u.ofType(D.FeatureIndex)),i.userIsAdmin=!1,i.version=void 0,i.visible=!0,i}return i.__extends(t,e),t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?i.__assign({url:e},t):e},t.prototype.load=function(e){var t=this,r=f.isSome(e)?e.signal:null;if(!(this.portalItem&&this.portalItem.loaded&&this.source)){var n=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch((function(e){return e})).then((function(){return i.__awaiter(t,void 0,void 0,(function(){var e,t;return i.__generator(this,(function(i){switch(i.label){case 0:return this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)?[4,this._fetchFirstLayerId(r)]:[3,2];case 1:null!=(e=i.sent())&&(this.layerId=e),i.label=2;case 2:if(!this.url&&!this._hasMemorySource())throw new l("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return t=this._initLayerProperties,[4,this.createGraphicsSource(r)];case 3:return[2,t.apply(this,[i.sent()])]}}))}))}));return this.addResolvingPromise(n),m.resolve(this)}this.addResolvingPromise(this.createGraphicsSource(r).then((function(e){return t._initLayerProperties(e)})))},t.prototype.readCapabilities=function(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}},Object.defineProperty(t.prototype,"createQueryVersion",{get:function(){return this.definitionExpression,this.timeExtent,this.timeOffset,this.geometryType,this.gdbVersion,this.historicMoment,this.returnZ,this.capabilities,this.returnM,(this._get("createQueryVersion")||0)+1},enumerable:!0,configurable:!0}),t.prototype.readEditingEnabled=function(e,t){return!t.layerDefinition||"Query"!==t.layerDefinition.capabilities},t.prototype.writeEditingEnabled=function(e,t){e||_.setDeepValue("layerDefinition.capabilities","Query",t)},t.prototype.readEditingInfo=function(e,t){var r=t.editingInfo;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null},t.prototype.readFeatureReduction=function(e,t){return G.read(e,t)},t.prototype.writeWebSceneFeatureReduction=function(e,t,r,i){G.writeTarget(e,t,"layerDefinition.featureReduction",i)},Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new V(this.fields||[])},enumerable:!0,configurable:!0}),t.prototype.readIsTable=function(e,t){return"Table"===(t=t&&t.layerDefinition||t).type},Object.defineProperty(t.prototype,"hasService",{get:function(){return!this._hasMemorySource()},enumerable:!0,configurable:!0}),t.prototype.readMinScale=function(e,t){return t.effectiveMinScale||e||0},t.prototype.readMaxScale=function(e,t){return t.effectiveMaxScale||e||0},t.prototype.readGlobalIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(var r=0,i=t.fields;r<i.length;r++){var n=i[r];if("esriFieldTypeGlobalID"===n.type)return n.name}},t.prototype.readObjectIdFieldFromService=function(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(var r=0,i=t.fields;r<i.length;r++){var n=i[r];if("esriFieldTypeOID"===n.type)return n.name}},Object.defineProperty(t.prototype,"parsedUrl",{get:function(){var e=this.url?v.urlToObject(this.url):null;if(null!=e)if(null!=this.layerId)e.path=v.join(e.path,this.layerId.toString())+ie;else if(null!=this.dynamicDataSource){var t={source:J.sourceToJSON(this.dynamicDataSource)};e.query={layer:JSON.stringify(t)}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){Q.fixRendererFields(e,this.fields),this._set("renderer",e)},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var i,n,s=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(s)(i=Y.read(s,t,r)||void 0)||ae.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r});else if(t.defaultSymbol)K.read(t.defaultSymbol,t,r),t.types&&t.types.length?(i=new o.UniqueValueRenderer({defaultSymbol:n,field:t.typeIdField}),t.types.forEach((function(e){s.addUniqueValueInfo(e.id,K.read(e.symbol,e,r))}))):i=new o.SimpleRenderer({symbol:n});else if("Table"!==t.type){switch(t.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":n=new a.SimpleMarkerSymbol;break;case"esriGeometryPolyline":n=new a.SimpleLineSymbol;break;case"esriGeometryPolygon":n=new a.SimpleFillSymbol}i=n&&new o.SimpleRenderer({symbol:n})}return i},t.prototype.writeRenderer=function(e,t,r,i){Y.writeTarget(e,t,r,i)},t.prototype.writeWebSceneRenderer=function(e,t,r,i){Y.writeTarget(e,t,"layerDefinition.drawingInfo.renderer",i)},Object.defineProperty(t.prototype,"source",{set:function(e){var t=this._get("source");t!==e&&(ue(t)&&this._resetMemorySource(t),ue(e)&&this._initMemorySource(e),this._set("source",e))},enumerable:!0,configurable:!0}),t.prototype.castSource=function(e){return e?Array.isArray(e)||e instanceof u?new F.default({layer:this,items:e}):e:null},t.prototype.readSource=function(e,t){var r=ee.fromJSON(t.featureSet);return new F.default({layer:this,items:r&&r.features||[]})},t.prototype.readServiceDefinitionExpression=function(e,t){return t.definitionQuery||t.definitionExpression},t.prototype.readTemplates=function(e,t){var r=t.editFieldsInfo,i=r&&r.creatorField,n=r&&r.editorField;return e=e&&e.map((function(e){return B.fromJSON(e)})),this._fixTemplates(e,i),this._fixTemplates(e,n),e},t.prototype.readTitle=function(e,t){var r=t.layerDefinition&&t.layerDefinition.name||t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){var n=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?C.titleFromUrlAndName(this.url,r):r;var o=r||this.url&&C.parse(this.url).title;if(!o)return;return"item-title-and-service-name"===this.sublayerTitleMode&&n&&n!==o&&(o=n+" - "+o),C.cleanTitle(o)}if("item-title"===this.sublayerTitleMode&&i)return i},t.prototype.readTitleFromWebMap=function(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name},t.prototype.readTypeIdField=function(e,t){var r=(t=t.layerDefinition||t).typeIdField;if(r){var i=Q.getField(t.fields,r);i&&(r=i.name)}return r},t.prototype.readTypes=function(e,t){var r=this;e=(t=t.layerDefinition||t).types;var i=t.editFieldsInfo,n=i&&i.creatorField,o=i&&i.editorField;return e&&e.map((function(e){return e=L.fromJSON(e),r._fixTemplates(e.templates,n),r._fixTemplates(e.templates,o),e}))},Object.defineProperty(t.prototype,"url",{set:function(e){var t=C.sanitizeUrlWithLayerId(this,e,ae);this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)},enumerable:!0,configurable:!0}),t.prototype.writeUrl=function(e,t,r,i){C.writeUrlWithLayerId(this,e,null,t,i)},t.prototype.readVersion=function(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3},t.prototype.readVisible=function(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0},t.prototype.addAttachment=function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("addAttachment"in r.source))throw new l(se,"Layer source does not support addAttachment capability");return r.source.addAttachment(e,t)}))},t.prototype.updateAttachment=function(e,t,r){var i=this;return this.load().then((function(){return i._checkAttachmentSupport(e)})).then((function(){if(!("updateAttachment"in i.source))throw new l(se,"Layer source does not support updateAttachment capability");return i.source.updateAttachment(e,t,r)}))},t.prototype.applyEdits=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(e,t){r.e(113).then(function(){var t=[r(1771)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,i.sent().applyEdits(this,e,t)]}}))}))},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.createPopupTemplate=function(e){return H.createPopupTemplate(this,e)},t.prototype.createGraphicsSource=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,n;return i.__generator(this,(function(i){switch(i.label){case 0:return this._hasMemorySource()?(this.emit("graphics-source-create",{graphicsSource:this.source}),[2,this.source.load({signal:e})]):[4,new Promise((function(e,t){r.e(114).then(function(){var t=[r(1772)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return t=i.sent(),m.throwIfAborted(e),[4,new t.default({layer:this}).load({signal:e})];case 2:return n=i.sent(),this.emit("graphics-source-create",{graphicsSource:n}),[2,n]}}))}))},t.prototype.createQuery=function(){var e=new te,t=this.get("capabilities.data");e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";var r=this.timeOffset,i=this.timeExtent;return e.timeExtent=null!=r&&null!=i?i.offset(-r.value,r.unit):i||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e},t.prototype.deleteAttachments=function(e,t){var r=this;return this.load().then((function(){return r._checkAttachmentSupport(e)})).then((function(){if(!("deleteAttachments"in r.source))throw new l(se,"Layer source does not support deleteAttachments capability");return r.source.deleteAttachments(e,t)}))},t.prototype.getFeatureType=function(e){var t=this.typeIdField,r=this.types;if(!t||!e)return null;var i=e.attributes?e.attributes[t]:void 0;if(null==i)return null;var n=null;return r.some((function(e){var t=e.id;return null!=t&&(t.toString()===i.toString()&&(n=e),!!n)})),n},t.prototype.getFieldDomain=function(e,t){var r=t&&t.feature,i=this.getFeatureType(r);if(i){var n=i.domains&&i.domains[e];if(n&&"inherited"!==n.type)return n}return this._getLayerDomain(e)},t.prototype.getField=function(e){return this.fieldsIndex.get(e)},t.prototype.queryAttachments=function(e,t){var r=this;return e=$.from(e),this.load().then((function(){if(!r.get("capabilities.data.supportsAttachment"))throw new l(se,"this layer doesn't support attachments");var t=e.attachmentTypes,i=e.objectIds,n=e.globalIds,o=e.num,s=e.size,a=e.start,u=e.where;if(!r.get("capabilities.operations.supportsQueryAttachments")){var c=i&&i.length>1,p=t&&t.length,d=n&&n.length,h=s&&s.length;if(c||p||d||h||o||a||u)throw new l(se,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||u))throw new l(se,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in r.source))throw new l(se,"Layer source does not support queryAttachments capability",e);return r.source.queryAttachments(e)}))},t.prototype.queryFeatures=function(e,t){var r=this;return this.load().then((function(){return r.source.queryFeatures(te.from(e)||r.createQuery(),t)})).then((function(e){if(e&&e.features)for(var t=0,i=e.features;t<i.length;t++){var n=i[t];n.layer=n.sourceLayer=r}return e}))},t.prototype.queryObjectIds=function(e,t){var r=this;return this.load().then((function(){if(r.source.queryObjectIds)return r.source.queryObjectIds(te.from(e)||r.createQuery(),t);throw new l(se,"Layer source does not support queryObjectIds capability")}))},t.prototype.queryFeatureCount=function(e,t){var r=this;return this.load().then((function(){if(r.source.queryFeatureCount)return r.source.queryFeatureCount(te.from(e)||r.createQuery(),t);throw new l(se,"Layer source does not support queryFeatureCount capability")}))},t.prototype.queryExtent=function(e,t){var r=this;return this.load().then((function(){if(r.source.queryExtent)return r.source.queryExtent(te.from(e)||r.createQuery(),t);throw new l(se,"Layer source does not support queryExtent capability")}))},t.prototype.queryRelatedFeatures=function(e,t){var r=this;return this.load().then((function(){if("queryRelatedFeatures"in r.source)return r.source.queryRelatedFeatures(re.from(e),t);throw new l(se,"Layer source does not support queryRelatedFeatures capability")}))},t.prototype.read=function(t,r){var i=t.featureCollection;if(i){var n=i.layers;n&&1===n.length&&(e.prototype.read.call(this,n[0],r),null!=i.showLegend&&e.prototype.read.call(this,{showLegend:i.showLegend},r))}e.prototype.read.call(this,t,r),r&&"service"===r.origin&&this.revert(["objectIdField","fields","timeInfo"],"service")},t.prototype.write=function(t,r){return r&&("web-scene"===r.origin||"web-map"===r.origin)&&r.messages&&this.isTable?(r.messages.push(new l("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' using a Table source cannot written to web scenes and web maps",{layer:this})),null):e.prototype.write.call(this,t,r)},t.prototype._checkAttachmentSupport=function(e){var t=e.attributes,r=this.objectIdField;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:m.reject(new l(se,"feature is missing the identifying attribute "+r)):m.reject(new l(se,"'attributes' are required on a feature to query attachments")):m.reject(new l(se,"A feature is required to add/delete/update attachments")):m.reject(new l(se,"this layer doesn't support attachments"))},t.prototype._getLayerDomain=function(e){var t=this.fieldsIndex.get(e);return t?t.domain:null},t.prototype._fetchFirstLayerId=function(e){return s(this.url,{query:{f:"json"},responseType:"json",signal:e}).then((function(e){var t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))},t.prototype._initLayerProperties=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Q.fixRendererFields(this.renderer,this.fields),Q.fixTimeInfoFields(this.timeInfo,this.fields),[2,X.loadStyleRenderer(this,{origin:"service"})]}))}))},t.prototype._verifyFields=function(){var e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")},t.prototype._fixTemplates=function(e,t){e&&e.forEach((function(e){var r=e.prototype&&e.prototype.attributes;r&&t&&delete r[t]}))},t.prototype._verifySource=function(){if(this._hasMemorySource()){if(this.url)throw new l("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new l("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")},t.prototype._initMemorySource=function(e){var t=this;e.forEach((function(e){e.layer=t,e.sourceLayer=t})),this._handles.add([e.on("after-add",(function(e){e.item.layer=t,e.item.sourceLayer=t})),e.on("after-remove",(function(e){e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")},t.prototype._resetMemorySource=function(e){e.forEach((function(e){e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")},t.prototype._hasMemorySource=function(){return!(this.url||!this.source)},t.prototype._readAttachmentCapabilities=function(e){var t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((function(e){var r=oe[e.name];r&&(t[r]=!!e.isEnabled)})),t},t.prototype._readDataCapabilities=function(e){return{isVersioned:le(e,"isDataVersioned",!1),supportsAttachment:le(e,"hasAttachments",!1),supportsM:le(e,"hasM",!1),supportsZ:le(e,"hasZ",!1)}},t.prototype._readMetadataCapabilities=function(e){return{supportsAdvancedFieldProperties:le(e,"supportsFieldDescriptionProperty",!1)}},t.prototype._readOperationsCapabilities=function(e,t){var r=e?e.toLowerCase().split(",").map((function(e){return e.trim()})):[],i=-1!==r.indexOf("editing"),n=i&&-1!==r.indexOf("create"),o=i&&-1!==r.indexOf("delete"),s=i&&-1!==r.indexOf("update");return i&&!(n||o||s)&&(n=o=s=!0),{supportsCalculate:le(t,"supportsCalculate",!1),supportsTruncate:le(t,"supportsTruncate",!1),supportsValidateSql:le(t,"supportsValidateSql",!1),supportsAdd:n,supportsDelete:o,supportsEditing:i,supportsQuery:-1!==r.indexOf("query"),supportsQueryAttachments:le(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:le(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==r.indexOf("sync"),supportsUpdate:s,supportsExceedsLimitStatistics:le(t,"supportsExceedsLimitStatistics",!1)}},t.prototype._readQueryCapabilities=function(e){var t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,i=e.archivingInfo,n=(e.supportedQueryFormats||"").split(",").reduce((function(e,t){var r=t.toLowerCase().trim();return r&&e.add(r),e}),new Set);return{supportsStatistics:le(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:le(t,"supportsPercentileStatistics",!1),supportsCentroid:le(t,"supportsReturningGeometryCentroid",!1),supportsDistance:le(t,"supportsQueryWithDistance",!1),supportsDistinct:le(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:le(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:le(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:le(t,"supportsHavingClause",!1),supportsOrderBy:le(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:le(t,"supportsPagination",!1),supportsQuantization:le(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:le(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:le(e,"supportsReturningQueryGeometry",!1),supportsResultType:le(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:le(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:le(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:le(e,"useStandardizedQueries",!1),supportsQueryByOthers:le(r,"allowOthersToQuery",!0),supportsHistoricMoment:le(i,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:n.has("pbf"),supportsDisjointSpatialRelationship:le(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:le(t,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:ce(e,"maxRecordCountFactor",void 0),maxRecordCount:ce(e,"maxRecordCount",void 0),standardMaxRecordCount:ce(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:ce(e,"tileMaxRecordCount",void 0)}},t.prototype._readQueryRelatedCapabilities=function(e){var t=e.advancedQueryCapabilities,r=le(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:le(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r}},t.prototype._readEditingCapabilities=function(e){var t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:le(e,"allowGeometryUpdates",!0),supportsGlobalId:le(e,"supportsApplyEditsWithGlobalIds",!1),supportsRollbackOnFailure:le(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:le(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:le(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:le(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:le(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:le(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:le(t,"allowOthersToUpdate",!0)}},i.__decorate([g.property({readOnly:!0,json:{read:!1}})],t.prototype,"capabilities",void 0),i.__decorate([g.reader("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],t.prototype,"readCapabilities",null),i.__decorate([g.property({readOnly:!0,dependsOn:["definitionExpression","timeExtent","timeOffset","geometryType","gdbVersion","historicMoment","returnZ","capabilities","returnM"]})],t.prototype,"createQueryVersion",null),i.__decorate([g.property({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),i.__decorate([g.property({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),i.__decorate([g.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],t.prototype,"definitionExpression",void 0),i.__decorate([g.property({readOnly:!0,json:{read:K.read}})],t.prototype,"defaultSymbol",void 0),i.__decorate([g.property()],t.prototype,"dynamicDataSource",void 0),i.__decorate([g.property({readOnly:!0})],t.prototype,"editFieldsInfo",void 0),i.__decorate([g.property({type:Boolean})],t.prototype,"editingEnabled",void 0),i.__decorate([g.reader(["portal-item","web-map","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],t.prototype,"readEditingEnabled",null),i.__decorate([g.writer(["portal-item","web-map","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],t.prototype,"writeEditingEnabled",null),i.__decorate([g.property({readOnly:!0})],t.prototype,"editingInfo",void 0),i.__decorate([g.reader("editingInfo")],t.prototype,"readEditingInfo",null),i.__decorate([g.property(A.elevationInfo)],t.prototype,"elevationInfo",void 0),i.__decorate([g.property({types:{key:"type",base:P.default,typeMap:{selection:N,cluster:k}},json:{write:{target:"layerDefinition.featureReduction"}}})],t.prototype,"featureReduction",void 0),i.__decorate([g.reader("featureReduction",["layerDefinition.featureReduction"])],t.prototype,"readFeatureReduction",null),i.__decorate([g.writer("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:G.webSceneFeatureReductionTypes}})],t.prototype,"writeWebSceneFeatureReduction",null),i.__decorate([g.property(i.__assign(i.__assign({},pe.fields),{json:{origins:{service:{read:!0}},read:{source:"layerDefinition.fields"}}}))],t.prototype,"fields",void 0),i.__decorate([g.property({readOnly:!0,dependsOn:["fields"]})],t.prototype,"fieldsIndex",null),i.__decorate([g.property({type:b,json:{read:{source:"formInfo"},write:{target:"formInfo"}}})],t.prototype,"formTemplate",void 0),i.__decorate([g.property({type:x,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],t.prototype,"fullExtent",void 0),i.__decorate([g.property()],t.prototype,"gdbVersion",void 0),i.__decorate([g.property({readOnly:!0})],t.prototype,"geometryProperties",void 0),i.__decorate([g.property({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:ne.read}},read:{source:"layerDefinition.geometryType",reader:ne.read}}})],t.prototype,"geometryType",void 0),i.__decorate([g.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],t.prototype,"hasM",void 0),i.__decorate([g.property({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],t.prototype,"hasZ",void 0),i.__decorate([g.property({readOnly:!0,type:w})],t.prototype,"heightModelInfo",void 0),i.__decorate([g.property({type:Date})],t.prototype,"historicMoment",void 0),i.__decorate([g.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],t.prototype,"id",void 0),i.__decorate([g.property({readOnly:!0})],t.prototype,"isTable",void 0),i.__decorate([g.reader("service","isTable",["type"]),g.reader("isTable",["layerDefinition.type"])],t.prototype,"readIsTable",null),i.__decorate([g.property({dependsOn:["loaded","url","source"],readOnly:!0})],t.prototype,"hasService",null),i.__decorate([g.property(A.labelsVisible)],t.prototype,"labelsVisible",void 0),i.__decorate([g.property({type:[z],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:U.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:U.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),i.__decorate([g.property(A.opacityDrawingInfo)],t.prototype,"opacity",void 0),i.__decorate([g.property({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],t.prototype,"layerId",void 0),i.__decorate([g.property(A.legendEnabled)],t.prototype,"legendEnabled",void 0),i.__decorate([g.property({type:["show","hide"]})],t.prototype,"listMode",void 0),i.__decorate([g.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}})],t.prototype,"minScale",void 0),i.__decorate([g.reader("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),i.__decorate([g.property({type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}})],t.prototype,"maxScale",void 0),i.__decorate([g.reader("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),i.__decorate([g.property({type:String})],t.prototype,"globalIdField",void 0),i.__decorate([g.reader("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),g.reader("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),i.__decorate([g.property({type:String})],t.prototype,"objectIdField",void 0),i.__decorate([g.reader("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),g.reader("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),i.__decorate([g.property({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],t.prototype,"operationalLayerType",void 0),i.__decorate([g.property(pe.outFields)],t.prototype,"outFields",void 0),i.__decorate([g.property({readOnly:!0,dependsOn:["layerId"]})],t.prototype,"parsedUrl",null),i.__decorate([g.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),i.__decorate([g.property(A.popupEnabled)],t.prototype,"popupEnabled",void 0),i.__decorate([g.property({type:n,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),i.__decorate([g.property({readOnly:!0,dependsOn:["fields","title"]})],t.prototype,"defaultPopupTemplate",null),i.__decorate([g.property({type:[Z],readOnly:!0})],t.prototype,"relationships",void 0),i.__decorate([g.property({types:o.rendererTypes,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer"}}})],t.prototype,"renderer",null),i.__decorate([g.reader("service","renderer",["drawingInfo.renderer","defaultSymbol","type"]),g.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol","layerDefinition.type"])],t.prototype,"readRenderer",null),i.__decorate([g.writer("renderer")],t.prototype,"writeRenderer",null),i.__decorate([g.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:o.webSceneRendererTypes}})],t.prototype,"writeWebSceneRenderer",null),i.__decorate([g.property()],t.prototype,"sourceJSON",void 0),i.__decorate([g.property({type:Boolean})],t.prototype,"returnM",void 0),i.__decorate([g.property({type:Boolean})],t.prototype,"returnZ",void 0),i.__decorate([g.property(A.screenSizePerspectiveEnabled)],t.prototype,"screenSizePerspectiveEnabled",void 0),i.__decorate([g.property()],t.prototype,"source",null),i.__decorate([g.cast("source")],t.prototype,"castSource",null),i.__decorate([g.reader("portal-item","source",["featureSet"]),g.reader("web-map","source",["featureSet"])],t.prototype,"readSource",null),i.__decorate([g.property({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),i.__decorate([g.reader("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),i.__decorate([g.property({type:I,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],t.prototype,"spatialReference",void 0),i.__decorate([g.property({type:[B]})],t.prototype,"templates",void 0),i.__decorate([g.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],t.prototype,"readTemplates",null),i.__decorate([g.property({type:W})],t.prototype,"timeInfo",void 0),i.__decorate([g.property()],t.prototype,"title",void 0),i.__decorate([g.reader("service","title",["name"]),g.reader("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],t.prototype,"readTitle",null),i.__decorate([g.reader("web-map","title",["layerDefinition.name","title"])],t.prototype,"readTitleFromWebMap",null),i.__decorate([g.property({type:String})],t.prototype,"sublayerTitleMode",void 0),i.__decorate([g.property({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),i.__decorate([g.property({json:{read:!1}})],t.prototype,"type",void 0),i.__decorate([g.property({type:String})],t.prototype,"typeIdField",void 0),i.__decorate([g.reader("service","typeIdField"),g.reader("typeIdField",["layerDefinition.typeIdField"])],t.prototype,"readTypeIdField",null),i.__decorate([g.property({type:[L]})],t.prototype,"types",void 0),i.__decorate([g.reader("service","types",["types"]),g.reader("types",["layerDefinition.types"])],t.prototype,"readTypes",null),i.__decorate([g.property({type:u.ofType(D.FeatureIndex),readOnly:!0})],t.prototype,"indexes",void 0),i.__decorate([g.property(A.url)],t.prototype,"url",null),i.__decorate([g.writer("url")],t.prototype,"writeUrl",null),i.__decorate([g.property({readOnly:!0})],t.prototype,"userIsAdmin",void 0),i.__decorate([g.property({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),i.__decorate([g.reader("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),i.__decorate([g.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],t.prototype,"visible",void 0),i.__decorate([g.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],t.prototype,"readVisible",null),i.__decorate([g.subclass("esri.layers.FeatureLayer")],t)}(j.TemporalLayer(R.ScaleRangeLayer(O.RefreshableLayer(T.ArcGISService(E.OperationalLayer(M.PortalLayer(y.MultiOriginJSONMixin(S))))))))}.apply(null,i))||(e.exports=n)},1402:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(8),r(2),r(315),r(4),r(92),r(71),r(37),r(34),r(240),r(29),r(76),r(1416),r(1397),r(1468),r(1524),r(1526),r(1469),r(1405),r(413),r(1417)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m,v,g,b,x,w,I){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t};var S=new Set,F=new s.MemCacheStorage(2e6),T=0,E=function(){function e(e){var t=this;this.capabilities={query:m.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new s.MemCache(T+++"$$",F)),this.fieldsIndex=new w(e.fields),e.scheduler&&e.task&&(this._frameQueue=new I.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=b.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),[3,9];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return i=new v.default([],null,this),[3,9];case 9:return[2,i.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,s.definitionExpression,s.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return s._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return s._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return[2,(i=r.sent()).size];case 8:if((o=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw o;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,a,u,p,d,h=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),o=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,h.definitionExpression,h.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return h._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return h._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),(s=i.size)?(c.set(O,c.NEGATIVE_INFINITY),this.featureStore.forEachBounds(i.items,(function(e){return c.expand(O,e)}),M),a={xmin:O[0],ymin:O[1],xmax:O[3],ymax:O[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(O[2])&&isFinite(O[5])&&(a.zmin=O[2],a.zmax=O[5]),(u=_.project(a,i.spatialReference,o)).spatialReference=x.cleanFromGeometryEngine(o||this.spatialReference),u.xmax-u.xmin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.xmin-=p,u.xmax+=p),u.ymax-u.ymin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.ymin-=p,u.ymax+=p),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(p=l.getMetersPerUnitForSR(u.spatialReference),u.zmin-=p,u.zmax+=p),[2,{count:s,extent:u}]):[2,{count:s,extent:null}];case 8:if((d=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return u.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,o,s,a,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),o=i.items,s=new Set,[4,this._reschedule((function(){for(var e=0,t=o;e<t.length;e++){var r=t[e];s.add(i.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,s];case 9:if((a=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw a;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,o,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=n.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return o=r.sent(),[4,this._reschedule((function(){return o.executeObjectIdsQuery(t)}))];case 5:return o=r.sent(),[4,this._reschedule((function(){return o.executeTimeQuery(t)}))];case 6:return o=r.sent(),[4,this._reschedule((function(){return o.executeAttributesQuery(t)}))];case 7:return o=r.sent(),[4,this._reschedule((function(){return o.filterLatest()}))];case 8:return o=r.sent(),[3,10];case 9:if((s=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw s;return o=new v.default([],null,this),[3,10];case 10:return[2,o.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new v.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,s,a,u,l,c,p,d,h,y,_,m,b,x,w,I,S,F=this;return r.__generator(this,(function(T){switch(T.label){case 0:if(t=e.geometry,i=e.outSR,n=e.spatialRel,s=f.isValid(i)&&!f.equals(this.spatialReference,i),(a=this._geometryQueryCache?s?JSON.stringify({geometry:t,spatialRelationship:n,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:n}):null)&&(u=this._geometryQueryCache.get(a),!o.isUndefined(u)))return[2,u];if(l=function(t){return r.__awaiter(F,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return s&&(e.returnGeometry||e.returnCentroid)?[4,t.project(i)]:[3,2];case 1:return n=r.sent(),a&&this._geometryQueryCache.put(a,n,n.size||1),[2,n];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==n)return[3,3];if(!(p=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(y=new Set,_=0,m=p;_<m.length;_++)b=m[_],y.add(c.getObjectId(b));return[4,this._reschedule((function(){var e=0;d=new Array(y.size),F.featureStore.forEach((function(t){return d[e++]=t})),h=y}))];case 1:return T.sent(),[4,this._reschedule((function(){return r.__awaiter(F,void 0,void 0,(function(){var e,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,g.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),i=function(t){return!h.has(c.getObjectId(t))||e(c.getGeometry(t))},o=v.default.bind,[4,this._runSpatialFilter(d,i)];case 2:return[2,new(o.apply(v.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return w=T.sent(),[2,l(w)];case 3:return(x=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new v.default(x,t,this))]:[4,g.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)]:(w=new v.default([],t,this),a&&this._geometryQueryCache.put(a,w,w.size||1),[2,w]);case 4:return I=T.sent(),[4,this._runSpatialFilter(x,(function(e){return I(c.getGeometry(e))}))];case 5:return S=T.sent(),[2,l(new v.default(S,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s=this;return r.__generator(this,(function(a){return t?this._budget?(i=0,n=new Array,o=function(){return r.__awaiter(s,void 0,void 0,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return i<e.length?(s=e[i],t(s)&&n.push(s),this._budget.done?[4,this._reschedule((function(){return o()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++i,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return o()})).then((function(){return n}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return g.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(g.canQueryWithRBush(e)){if(h.isExtent(e))return[p.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(h.isPolygon(e))return e.rings.map((function(e){return p.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[d.getBoundsXY(p.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,(function(e){S.add(e)}))}var n=new Array(S.size),o=0;return S.forEach((function(e){return n[o++]=e})),S.clear(),n},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,a.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),g.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),_.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,o=e.outStatistics,s=o?o.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var a=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===s.indexOf(e)}));y.validateFields(this.fieldsIndex,a,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new i("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,a,u,l,c,p,d,h;return r.__generator(this,(function(r){if(t=e.outStatistics,n=e.groupByFieldsForStatistics,o=e.having,s=n&&n.length,a=t&&t.length,o){if(!s||!a)throw new i("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,o,t)}if(a){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),s&&y.validateFields(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(p=c[l],d=p.onStatisticField,"percentile_disc"!==(h=p.statisticType)&&"percentile_cont"!==h||!("statisticParameters"in p)){if("count"!==h&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new i("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:p,query:e})}else if(!p.statisticParameters)throw new i("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:p,query:e})}return[2]}))}))},e}();t.default=E;var M=c.create(),O=c.create()}.apply(null,i))||(e.exports=n)},1407:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r}return r.__extends(t,e),r.__decorate([n.property()],t.prototype,"type",void 0),r.__decorate([n.subclass("esri.form.elements.inputs.Input")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1408:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(72),r(4),r(173)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.loadStyleRenderer=function(e,t,s){return r.__awaiter(this,void 0,void 0,(function(){var a,u,l;return r.__generator(this,(function(r){switch(r.label){case 0:return(a=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin))&&"unique-value"===a.type&&a.styleOrigin?[4,i.result(a.populateFromStyle())]:[3,2];case 1:u=r.sent(),n.throwIfAborted(s),!1===u.ok&&(l=u.error,t&&t.messages&&t.messages.push(new o("renderer:style-reference","Failed to create unique value renderer from style reference: "+l.message,{error:l,context:t})),e.clear("renderer",t.origin)),r.label=2;case 2:return[2]}}))}))}}.apply(null,i))||(e.exports=n)},1417:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,i){return t._tasks.push(new n(r,i,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,i){return t._tasks.unshift(new n(r,i,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._tasks;t<i.length;t++)i[t].reject(e);this._tasks.length=0},e}();t.default=i;var n=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,i))||(e.exports=n)},1419:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(178),r(724)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0}),t.ElementMixin=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.description=null,t.label=null,t.visibilityExpression=null,t}return r.__extends(t,e),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"label",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"visibilityExpression",void 0),r.__decorate([o.subclass("esri.form.elements.ElementMixin")],t)}(e)};var s=function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r}return r.__extends(t,e),r.__decorate([n.property()],t.prototype,"type",void 0),r.__decorate([o.subclass("esri.form.elements.Element")],t)}(t.ElementMixin(i.JSONSupport));t.Element=s}.apply(null,i))||(e.exports=n)},1420:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(236),r(686),r(7),r(8),r(1),r(1437),r(142)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){return function(e){function t(t){var r=e.call(this,t)||this;return r.cumulative=!1,r.endField=null,r.fullTimeExtent=null,r.hasLiveData=!1,r.interval=null,r.startField=null,r.timeReference=null,r.trackIdField=null,r.useTime=!0,r}var o;return r.__extends(t,e),o=t,t.prototype.readFullTimeExtent=function(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;var r=t.timeExtent[0],n=t.timeExtent[1];return new i({start:r,end:n})},t.prototype.writeFullTimeExtent=function(e,t){e&&e.start&&e.end?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null},t.prototype.readInterval=function(e,t){return t.timeInterval&&t.timeIntervalUnits?new n({value:t.timeInterval,unit:l.timeUnitKebabDictionary.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new n({value:t.defaultTimeInterval,unit:l.timeUnitKebabDictionary.fromJSON(t.defaultTimeIntervalUnits)}):null},t.prototype.writeInterval=function(e,t){if(e){var r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null},t.prototype.clone=function(){var e=this,t=e.cumulative,r=e.endField,i=e.hasLiveData,n=e.interval,a=e.startField,u=e.timeReference,l=e.fullTimeExtent,c=e.trackIdField,p=e.useTime;return new o({cumulative:t,endField:r,hasLiveData:i,interval:n,startField:a,timeReference:s.clone(u),fullTimeExtent:s.clone(l),trackIdField:c,useTime:p})},r.__decorate([a.property({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],t.prototype,"cumulative",void 0),r.__decorate([a.property({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],t.prototype,"endField",void 0),r.__decorate([a.property({type:i,json:{write:{enabled:!0,allowNull:!0}}})],t.prototype,"fullTimeExtent",void 0),r.__decorate([a.reader("fullTimeExtent",["timeExtent"])],t.prototype,"readFullTimeExtent",null),r.__decorate([a.writer("fullTimeExtent")],t.prototype,"writeFullTimeExtent",null),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"hasLiveData",void 0),r.__decorate([a.property({type:n,json:{write:{enabled:!0,allowNull:!0}}})],t.prototype,"interval",void 0),r.__decorate([a.reader("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],t.prototype,"readInterval",null),r.__decorate([a.writer("interval")],t.prototype,"writeInterval",null),r.__decorate([a.property({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],t.prototype,"startField",void 0),r.__decorate([a.property({type:u,json:{write:{enabled:!0,allowNull:!0}}})],t.prototype,"timeReference",void 0),r.__decorate([a.property({type:String,json:{write:{enabled:!0,allowNull:!0}}})],t.prototype,"trackIdField",void 0),r.__decorate([a.property({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],t.prototype,"useTime",void 0),o=r.__decorate([a.subclass("esri.layers.support.TimeInfo")],t)}(o.JSONSupport)}.apply(null,i))||(e.exports=n)},1421:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=null,t}return r.__extends(t,e),r.__decorate([n.property({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([n.subclass("esri.layers.support.FeatureReduction")],t)}(i.JSONSupport);t.FeatureReduction=o,t.default=o}.apply(null,i))||(e.exports=n)},1427:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(38),r(5),r(2),r(37),r(34),r(76),r(412),r(1443),r(1433),r(1429)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h){Object.defineProperty(t,"__esModule",{value:!0});var f=o.getLogger("esri.layers.graphics.data.FeatureStore"),y=function(){function e(e){this.geometryInfo=e,this._boundsStore=new p.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new n,this.featureAdapter=h.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=u.create(u.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var i=e._boundsStore.get(r.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i],s=this._boundsStore.get(o.objectId);s&&t(a.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s,a,c,p,h,f,y,_,m,v,g,b;return r.__generator(this,(function(r){return n=i.returnGeometry,o=i.returnCentroid,s=i.returnOutline,a=i.pixelBuffer,c=new Set,p=[],h=a*e.resolution,f=u.pad(e.bounds,h,u.create()),d.createTileFeatures(p,c,this.geometryInfo,this,f,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||o)&&(y=l.getInfo(t))&&(_=y.valid,m=_[0],v=_[1],f[0]<m&&(g=u.fromValues(v-h,f[1],v,f[3]),d.createTileFeatures(p,c,this.geometryInfo,this,g,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[v,e.bounds[3]]})),f[2]>v&&(b=u.fromValues(m,f[1],m+h,f[3]),d.createTileFeatures(p,c,this.geometryInfo,this,b,n,o,s,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[m-v+e.bounds[0],e.bounds[3]]}))),p.sort((function(e,t){return e.localId-t.localId})),[2,{features:p,objectIds:c}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):s.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=c.getBoundsOptimizedGeometry(r||u.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else f.error(new i("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return s.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=y}.apply(null,i))||(e.exports=n)},1433:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(34),r(412),r(414),r(1402),r(1405)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new n.default,u={esriGeometryPoint:i.convertToPoint,esriGeometryPolyline:i.convertToPolyline,esriGeometryPolygon:i.convertToPolygon,esriGeometryMultipoint:i.convertToMultipoint};t.executeTileQueryForIds=function(e,t,i){var n=i.pixelBuffer*t.resolution,o=r.pad(t.bounds,n,r.create()),s=[];return e.featureStore.forEachInBounds(o,(function(t){return s.push(e.featureAdapter.getObjectId(t))})),s},t.createTileFeatures=function(e,t,r,i,n,p,d,h,f){var y=u[r.geometryType],_=l[r.geometryType],m="esriGeometryPolygon"===r.geometryType&&!h,v=r.hasZ?r.hasM?4:3:r.hasM?3:2;d&&!p?i.forEachInBounds(n,(function(i){return function(e,t,r,i,n){if(!t.has(r.objectId)){var a=s.getCentroid(i,r,n),u=r.attributes;a&&(t.add(r.objectId),e.push(new o.Feature(u,r.localId,null,a)))}}(e,t,i,r,f)})):p&&!d?i.forEachInBounds(n,(function(r){return function(e,t,r,i,n,s,u,l){if(!t.has(r.objectId)){var p=r.attributes,d=i(c(a,r.geometry,n,s,l,u),!1,!1);d&&(t.add(r.objectId),e.push(new o.Feature(p,r.localId,d,null)))}}(e,t,r,y,v,_,f,m)})):i.forEachInBounds(n,(function(i){return function(e,t,r,i,n,u,l,p,d){if(!t.has(r.objectId)){var h=s.getCentroid(i,r,n),f=r.attributes,y=u(c(a,r.geometry,l,p,d,n),!1,!1);y&&h&&(t.add(r.objectId),e.push(new o.Feature(f,r.localId,y,h)))}}(e,t,i,r,f,y,v,_,m)}))};var l={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function c(e,t,r,n,o,s){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var a,u,l,c,p=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=i.quantizeX(s,p[0]),e.coords[1]=i.quantizeY(s,p[1]),e.coords.length=r,e;for(var h=0,f=0,y=f,_=0,m=d;_<m.length;_++){var v=m[_];if(!(v<n))if(f=y,l=a=i.quantizeX(s,p[h]),c=u=i.quantizeY(s,p[h+1]),e.coords[f]=l,e.coords[f+1]=c,h+=r,1!==v){var g=(l=i.quantizeX(s,p[h]))-a,b=(c=i.quantizeY(s,p[h+1]))-u,x=b/g;f+=2,e.coords[f]=g,e.coords[f+1]=b,a=l,u=c,h+=r;for(var w=2;w<v;w++){if(l=i.quantizeX(s,p[h]),c=i.quantizeY(s,p[h+1]),l!==a||c!==u){var I=l-a,S=c-u,F=S/I;x!==F&&(isFinite(x)||isFinite(F))||!(o||(b>=0&&S>=0||b<=0&&S<=0)&&(g>=0&&I>=0||g<=0&&I<=0))?(g=I,b=S,f+=2):(g+=I,b+=S),e.coords[f]=g,e.coords[f+1]=b,x=F,a=l,u=c}h+=r}var T=(f+2-y)/2;T>=n&&(e.lengths.push(T),y=f+2)}else e.lengths.push(1),y=f+2}return e.coords.length>y&&(e.coords.length=y),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=c}.apply(null,i))||(e.exports=n)},1436:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(236),r(686),r(1),r(1420),r(66),r(142)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0}),t.TemporalLayer=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.timeExtent=null,t.timeOffset=null,t.useViewTime=!0,t}return r.__extends(t,e),t.prototype.readOffset=function(e,t){var r=t.timeInfo.exportOptions;if(!r)return null;var i=r.timeOffset,o=u.timeUnitKebabDictionary.fromJSON(r.timeOffsetUnits);return i&&o?new n({value:i,unit:o}):null},Object.defineProperty(t.prototype,"timeInfo",{set:function(e){a.fixTimeInfoFields(e,this.fields),this._set("timeInfo",e)},enumerable:!0,configurable:!0}),r.__decorate([o.property({type:i,json:{write:!1}})],t.prototype,"timeExtent",void 0),r.__decorate([o.property({type:n})],t.prototype,"timeOffset",void 0),r.__decorate([o.reader("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),r.__decorate([o.property({value:null,type:s,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),r.__decorate([o.property({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),r.__decorate([o.subclass("esri.layers.mixins.TemporalLayer")],t)}(e)}}.apply(null,i))||(e.exports=n)},1437:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.respectsDaylightSaving=!1,r.timezone=null,r}var i;return r.__extends(t,e),i=t,t.prototype.readRespectsDaylightSaving=function(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving},t.prototype.clone=function(){var e=this.respectsDaylightSaving,t=this.timezone;return new i({respectsDaylightSaving:e,timezone:t})},r.__decorate([n.property({type:Boolean,json:{write:!0}})],t.prototype,"respectsDaylightSaving",void 0),r.__decorate([n.reader("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],t.prototype,"readRespectsDaylightSaving",null),r.__decorate([n.property({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],t.prototype,"timezone",void 0),i=r.__decorate([n.subclass("esri.layers.support.TimeReference")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1442:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(15),r(675),r(677),r(246)],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=n.enums.WGLVVFlag;function u(e){return{value:e.value,size:i.toPt(e.size)}}function l(e){return e.map((function(e){return u(e)}))}function c(e){if("string"==typeof e||"number"==typeof e)return i.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:l(t.stops)}}t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=u,t.normalizeSizeStops=l,t.normalizeSizeElement=c,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach((function(e){var r=e.type;e.field&&(t[r]=e.field)})),t};var p=function(e){for(var t=[],r=[],n=l(e),s=n.length,a=0;a<6;a++){var u=n[Math.min(a,s-1)];t.push(u.value),r.push(null==u.size?o.NAN_MAGIC_NUMBER:i.pt2px(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function d(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(n.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,i=0;i<8;++i){var o=r[Math.min(i,r.length-1)];t.values[i]=o.value,t.opacities[i]=o.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(i=0;i<8;i++)t.values[i]=1/0,t.opacities[i]=s}return t}t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(var o=0,u=e;o<u.length;o++){var h=u[o],f=h.type;if(h.field&&(t[f]=h.field),"size"===f){i.size||(i.size={});var y=h;switch(n.getTypeOfSizeVisualVariable(y)){case a.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:y.minDataValue,maxDataValue:y.maxDataValue,minSize:c(y.minSize),maxSize:c(y.maxSize)};break;case a.SIZE_SCALE_STOPS:i.size.scaleStops={stops:l(y.stops)};break;case a.SIZE_FIELD_STOPS:if(y.levels){var _={};for(var m in y.levels)_[m]=p(y.levels[m]);i.size.fieldStops={type:"level-dependent",levels:_}}else i.size.fieldStops=r.__assign({type:"static"},p(y.stops));break;case a.SIZE_UNIT_VALUE:i.size.unitValue={unit:y.valueUnit,valueRepresentation:y.valueRepresentation}}}else if("color"===f){var v=s.convertVisualVariables([h],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!v)continue;i.color=v.color;for(var g=0;g<32;g+=4)n.color.premultiplyAlpha(i.color.colors,g,!0)}else if("opacity"===f)i.opacity=d(h);else if("rotation"===f){var b=h;i.rotation={type:b.rotationType}}}return{vvFields:t,vvRanges:i}}}.apply(null,i))||(e.exports=n)},1443:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(25),r(1414),r(14)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},o=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,i){t[r++]=i})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=function(e,t){return n.minX=t[0],n.minY=t[1],n.maxX=t[2],n.maxY=t[3],e.search(n)}(this._index,e);r<i.length;r++){var o=i[r];t(this._idByBounds.get(o))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=o}.apply(null,i))||(e.exports=n)},1452:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1421)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="selection",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n},r.__decorate([i.property({type:["selection"]})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.layers.support.FeatureReductionSelection")],t)}(n.default)}.apply(null,i))||(e.exports=n)},1453:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(234),r(5),r(237),r(66)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var s=i.getLogger("esri.layers.support.fieldProperties");t.defineFieldProperties=function(){return{fields:{type:[n],value:null},outFields:{type:[String],dependsOn:["fields"],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var e=this._userOutFields;if(!e||!e.length)return null;if(r.includes(e,"*"))return["*"];if(!this.fields)return e;for(var t=0,i=e;t<i.length;t++){var n=i[t];o.hasField(this.fields,n)||s.error("field-attributes-layer:invalid-field","Invalid field "+n+" found in outFields",{layer:this,outFields:e})}return o.fixFields(this.fields,e)}}}}}.apply(null,i))||(e.exports=n)},1462:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(235),r(7),r(8),r(15),r(1),r(1502),r(233),r(683)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="cluster",r.clusterRadius=s.toPt("80px"),r.clusterMinSize=s.toPt("12px"),r.clusterMaxSize=s.toPt("50px"),r.popupEnabled=!0,r.popupTemplate=null,r.labelingInfo=null,r.labelsVisible=!0,r.fields=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:o.clone(this.labelingInfo),labelsVisible:this.labelsVisible,fields:o.clone(this.fields),popupEnabled:this.popupEnabled,popupTemplate:o.clone(this.popupTemplate)})},r.__decorate([a.property({type:["cluster"],readOnly:!0,json:{write:!0}})],t.prototype,"type",void 0),r.__decorate([a.property({type:Number,cast:function(e){return"auto"===e?e:s.toPt(e)},json:{write:!0}})],t.prototype,"clusterRadius",void 0),r.__decorate([a.property({type:Number,cast:s.toPt,json:{write:!0}})],t.prototype,"clusterMinSize",void 0),r.__decorate([a.property({type:Number,cast:s.toPt,json:{write:!0}})],t.prototype,"clusterMaxSize",void 0),r.__decorate([a.property(l.popupEnabled)],t.prototype,"popupEnabled",void 0),r.__decorate([a.property({type:i,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],t.prototype,"popupTemplate",void 0),r.__decorate([a.property({type:[c],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],t.prototype,"labelingInfo",void 0),r.__decorate([a.property(l.labelsVisible)],t.prototype,"labelsVisible",void 0),r.__decorate([a.property({type:[u],json:{write:!0}})],t.prototype,"fields",void 0),n=r.__decorate([a.subclass("esri.layers.support.FeatureReductionCluster")],t)}(n.JSONSupport)}.apply(null,i))||(e.exports=n)},1466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(25),r(5),r(12),r(2),r(4),r(413),r(107),r(675),r(421),r(677),r(1442),r(14)],void 0===(n=function(e,t,i,n,o,s,a,u,l,c,p,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0});var _=s.getLogger("esri.views.layers.2d.features.support.AttributeStore"),m=d.debug.createDebugLogger(d.debug.DEBUG_ATTR_UPDATES,_);t.LOCAL_ID_TYPE_AGGREGATE=1;var v=function(e){return(2147483648&e)>>>31},g=function(e){return 2147483647&e};t.isAggregateId=function(e){return v(e)===t.LOCAL_ID_TYPE_AGGREGATE};var b=function(e,t){return function(r,i,n){var o;try{o=t(r,i,n)}catch(e){o=NaN}return(null===o||isNaN(o)||o===1/0)&&e||o}},x={sharedArrayBuffer:o("esri-shared-array-buffer"),oesTextureFloat:o("esri-webgl-texture-float"),maxTextureSize:o("esri-webgl-max-texture-size"),atomics:o("esri-atomics")},w=function(){function e(e,t,r,i){this.texelSize=4;var n=i.pixelType,o=i.layout,s=i.textureOnly;this.textureOnly=s||!1,this.pixelType=n,this._ctype=t,this.layout=o,this._resetRange(),this._shared=e,s||(this.data=this._initData(n,r,e,t))}return Object.defineProperty(e.prototype,"buffer",{get:function(){return u.andThen(this.data,(function(e){return e.buffer}))},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){var r=g(e);return u.unwrap(this.data)[r*this.texelSize+t]},e.prototype.setData=function(e,t,r){var i=g(e),n=1<<t;0!=(this.layout&n)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):_.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.lock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):o("esri-2d-debug")&&_.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.unlock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):o("esri-2d-debug")&&_.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=u.unwrap(this.data);t.set(r),this.data=t}},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,o=this.layout,s=u.unwrap(this.data);return s.slice?{start:e,end:t,data:i&&s.slice(e*r,(t+1)*r)||null,pixelType:n,layout:o}:i?{start:e,end:t,data:new(d.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:o}:{start:e,end:t,data:null,pixelType:n,layout:o}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,o=d.Utils.getPixelArrayCtor(e),s=new o(new n(t*t*4*o.BYTES_PER_ELEMENT)),a=0;a<s.length;a+=4)s[a+1]=255;return s},e.prototype._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},e}(),I=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(d.definitions.MAX_FILTERS),this._freeTexelsList=[],this._abortController=l.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=x.oesTextureFloat?5126:5121;m("Creating AttributeStore "+(x.sharedArrayBuffer?"with":"without")+" shared memory"),o("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&_.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map((function(){return null}))}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.invalidateResources=function(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=l.createAbortController()},e.prototype.createLocalId=function(e,t){if(void 0===t&&(t=!1),!this._idMap.has(e)){var r=function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeTexel(),t);this._idMap.set(e,-1===r?0:r),this._localToObjectId.set(r,e)}return this._idMap.get(e)},e.prototype.addLocalId=function(e){this._getBlock(0).setData(e,0,0),this._freeTexelsList.push(g(e))},e.prototype.removeLocalId=function(e){var t=this._idMap.get(e);return this._idMap.delete(e),this._localToObjectId.delete(t),t},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);o("esri-2d-debug")&&!t&&console.debug("Called freeLocalId for an invalid id"),this._getBlock(0).setData(t,0,0),this._idMap.delete(e),this._localToObjectId.delete(t),this._freeTexelsList.push(g(t))},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.setHighlight=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,o,s,a,u=this;return i.__generator(this,(function(i){switch(i.label){case 0:for(this._getBlock(0).lock(),this._idsToHighlight.forEach((function(e){var t=u.getLocalId(e);if(t){var r=u._getBlock(0).getData(t,0);u._getBlock(0).setData(t,0,-2&r)}})),this._idsToHighlight.clear(),t=0,r=e;t<r.length;t++)n=r[t],this._idsToHighlight.add(n);for(o=0;o<e.length;o++)null!=(s=this.getLocalId(e[o]))&&(a=this._getBlock(0).getData(s,0),this._getBlock(0).setData(s,0,1|a));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return i.sent(),[2]}}))}))},e.prototype.addHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.removeHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.updateFilters=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,o,s,a=this;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,o=t.filters,s=o.map((function(t,i){return a._updateFilter(e,t,i,r,n)})),[4,l.all(s)];case 1:return i.sent(),[2]}}))}))},e.prototype.setAttributeBindings=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:_.error(new n("attribute-store","Found invalid renderer type: "+e))}return[2]}))}))},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.getData=function(e,t,r){return this._getBlock(t).getData(e,r)},e.prototype.getHighlightFlag=function(e){return this._idsToHighlight.has(e)?f.HIGHLIGHT_FLAG:0},e.prototype.setAttributeData=function(e,t,r,i){var n=this,o=e;this._getBlock(0).setData(o,0,this.getFilterFlags(t));var s=this._attributeComputeMap,u=x.oesTextureFloat?1:2;s.forEach((function(e,s){var l=s*u%4,c=Math.floor(s*u/4),p=n._getBlock(c+f.ATTRIBUTE_DATA_VV),h=e(t,{$view:i},r);if(x.oesTextureFloat)p.setData(o,l,h);else if(h===d.definitions.NAN_MAGIC_NUMBER)p.setData(o,l,255),p.setData(o,l+1,255);else{var y=a.clamp(Math.round(h),-32767,32766)+32768,_=255&y,m=(65280&y)>>8;p.setData(o,l,_),p.setData(o,l+1,m)}}))},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map((function(e){return u.isSome(e)?e.toMessage():null}))};return this._currUpdate=this._createResources().then((function(){var r=function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then((function(){return t.resolve()}))}},i=e._client.update(t,e._signal).then(r).catch(r);return e._client.render(),i})).catch((function(t){return l.isAbortError(t)?(e._createResourcesPromise=null,e._createResources()):(_.error(new n("mapview-attribute-store","Encountered an error during client update",t)),l.resolve())})),this._currUpdate},e.prototype._createResources=function(){var e=this;if(u.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(f.ATTRIBUTE_DATA_ANIMATION),m("Initializing AttributeStore");var t={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:u.mapMany(this._blocks,(function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}}))},r=this._client.initialize(t,this._signal).catch((function(t){l.isAbortError(t)?e._createResourcesPromise=null:_.error(new n("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=r,r.then((function(){return u.isNone(e._createResourcesPromise)?e._createResources():void 0})),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(u.isSome(t))return t;m("Initializing AttributeBlock at index "+e);var r=x.sharedArrayBuffer,i=this._client.type,n=new w(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<x.maxTextureSize){var e=this._size<<=1;return m("Expanding block size to",e,this._blocks),u.forEachSome(this._blocks,(function(t){return t.expand(e)})),this._createResourcesPromise=null,this._size=e,0}return _.error(new n("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeTexel=function(){return this._freeTexelsList.length?this._freeTexelsList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,r,n,o,s){return i.__awaiter(this,void 0,void 0,(function(){var a,l,c,p,d,h,f,y=this;return i.__generator(this,(function(i){switch(i.label){case 0:return a=this._filters[n],(u.isSome(a)&&a.hash)===JSON.stringify(r)?[2]:(l=1<<n+1,u.isNone(r)?(this._filters[n]=null,this._idMap.forEach((function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|l)})),[2]):[4,e.queryObjectIds(r)]);case 1:return c=i.sent(),r.hiddenIds&&r.hiddenIds.length&&(c=c.filter((function(e){return-1===r.hiddenIds.indexOf(e)}))),p=c.map((function(e){return y._idMap.get(e)})),[4,this._getFilter(n,o)];case 2:for(i.sent().update(r,s),this._getBlock(0).lock(),this._idMap.forEach((function(e){if(v(e)!==t.LOCAL_ID_TYPE_AGGREGATE){var r=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,r&~l)}})),d=0;d<p.length;d++)null!=(h=p[d])&&(f=this._getBlock(0).getData(h,0),this._getBlock(0).setData(h,0,f|l));return this._getBlock(0).unlock(),[2]}}))}))},e.prototype._getFilter=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var n,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this._filters[e],u.isSome(n)?[2,n]:[4,new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(112)]).then(function(){var t=[r(1597)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return o=i.sent().default,s=new o({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=s,[2,s]}}))}))},e.prototype.isVisible=function(e){return!!(2&this._getBlock(0).getData(e.localId,0))},e.prototype.getFilterFlags=function(e){for(var r,i=0,n=(r=e.localId,v(r)===t.LOCAL_ID_TYPE_AGGREGATE?254:255),o=0;o<this._filters.length;o++){var s=!!(n&1<<o),a=this._filters[o];i|=(!s||u.isNone(a)||a.check(e)?1:0)<<o}var l=this.getFeatureId(e.localId);return i<<1|this.getHighlightFlag(l)},e.prototype._bindVVEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r=this;return i.__generator(this,(function(n){switch(n.label){case 0:return this._attributeComputeMap.clear(),u.isSome(e)?[4,l.all(e.map((function(e){return i.__awaiter(r,void 0,void 0,(function(){var r,n;return i.__generator(this,(function(i){switch(i.label){case 0:return r=d.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),u.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._bindDDEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,o,s=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>d.definitions.DOT_DENSITY_MAX_FIELDS&&_.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+d.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,l.all(e.map((function(e){return s._createNormalizedFunction(e,t)})))];case 1:for(r=i.sent().map((function(e){return b(0,e)})),n=0;n<d.definitions.DOT_DENSITY_MAX_FIELDS;n++)(o=n<e.length&&r[n])?this._attributeComputeMap.set(n,o):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}}))}))},e.prototype._createGetValueFunction=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,o,s,a,u,l;return i.__generator(this,(function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=d.getTypeOfSizeVisualVariable(e))===d.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===d.enums.WGLVVFlag.SIZE_UNIT_VALUE,o=n&&function(t){return y.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},s=b,a=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,o)]);case 1:return[2,s.apply(void 0,a.concat([i.sent()]))];case 2:return u=b,l=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}}))}))},e.prototype._createNormalizedFunction=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var o,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return(o=e.field)?"string"==typeof o?(s=e.normalizationField)?[2,function(e){if(e.attributes[o]&&e.attributes[s]){var t=e.attributes[o]/e.attributes[s];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[o])}:function(e){return e.attributes[o]}]:(_.error(new n("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof o)),[2,function(){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,p.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return a=i.sent(),[2,h.callWithOptimizedFeature.bind(null,a)];case 2:return _.error("Unable to create a normalized function for visual variable: "+e),[2,function(){}]}}))}))},e}();t.default=I}.apply(null,i))||(e.exports=n)},1467:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(15),r(422),r(687),r(35),r(417),r(40),r(34),r(240),r(424),r(29),r(685),r(76),r(76),r(675),r(675)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m){Object.defineProperty(t,"__esModule",{value:!0});var v=Math.PI/180,g=o.mat2df32.create(),b=a.vec2f32.create(),x=l.create();t.getBounds=function(e,t,r,i,n,o,s){if(!i||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var a=i;if(!d.isPoint(a)){c.getBoundsXY(e,a);var u=t[0];0===u&&(u=function(e){var t=0;switch(e.symbol.type){case"simple-fill":case"picture-fill":var r=e.symbol.outline;if(!r)return 0;t=r.width;break;case"simple-line":t=e.symbol.width;break;case"simple-marker":t=e.symbol.size;break;case"picture-marker":t=Math.max(e.symbol.width,e.symbol.height);break;case"text":var i=[0,0,0,0];C(i,e.symbol,e.mosaicItem);var n=Math.max(Math.abs(i[0]),Math.abs(i[1]));t=Math.max(i[2],i[3])+n;break;case"cim":case"expanded-cim":var o=_.CIMSymbolHelper.getEnvelope(e.symbol.data);t=Math.sqrt(o.width*o.width+o.height*o.height)}return t}(r),t[0]=u);var l=n*u/2;return e[0]-=l,e[1]-=l,e[2]+=l,e[3]+=l,e}var p=a.x,f=a.y;return"text"===r.symbol.type&&0===t[2]&&0===t[3]&&C(t,r.symbol,r.mosaicItem),function(e,t,r,i,n,o,s,a){var u;switch(i.type){case"simple-marker":case"picture-marker":u=O(t,r,i,o,s,0);break;case"text":u=j(t,r,i,n,o,0);break;case"cim":case"expanded-cim":u=R(t,r,i,o,s,0)}for(var l,c,p=0,d=0;d<u.rings[0].length-1;d++)l=(t-(c=u.rings[0][d])[0])*(t-c[0])+(r-c[1])*(r-c[1]),p=Math.max(p,l);p=Math.sqrt(p);var f=h.normalizeMapX(t-p,a),_=h.normalizeMapX(t+p,a);if(f>_){var m=y.getInfo(a);if(m){var v=m.valid;f=v[0],_=v[1]}}e[0]=f,e[1]=r-p,e[2]=_,e[3]=r+p}(e,p,f,r.symbol,t,n,o,s),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.unwrap(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var w=a.vec2f32.create(),I=a.vec2f32.create(),S=a.vec2f32.create(),F=a.vec2f32.create(),T=a.vec2f32.create(),E=a.vec2f32.create(),M=a.vec2f32.create();function O(e,t,r,o,a,u){var l,c,p=i.pt2px(r.xoffset),d=i.pt2px(r.yoffset),h=v*r.angle,f=v*u;switch(r.type){case"simple-marker":var y=r;l=c=i.pt2px(y.size);break;case"picture-marker":var _=r;l=i.pt2px(_.width),c=i.pt2px(_.height)}a<.04&&(o=.04*o/a);var m=n.mat2d.identity(g);n.mat2d.translate(m,m,s.vec2.set(b,e,t)),n.mat2d.rotate(m,m,f-h),n.mat2d.scale(m,m,s.vec2.set(b,o,-o)),n.mat2d.translate(m,m,s.vec2.set(b,p,-d));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,-.5*l,-.5*c),m);var w=[0,0];s.vec2.transformMat2d(w,s.vec2.set(b,-.5*l,.5*c),m);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,.5*l,-.5*c),m);var S=[0,0];return s.vec2.transformMat2d(S,s.vec2.set(b,.5*l,.5*c),m),{rings:[[x,I,S,w,x]]}}function R(e,t,r,o,a,u){var l=_.CIMSymbolHelper.getEnvelope(r.data);if(!l)return null;a<.04&&(o=.04*o/a);var c=i.pt2px(l.width),p=i.pt2px(l.height),d=i.pt2px(l.x),h=i.pt2px(l.y),f=0*v,y=v*u,m=n.mat2d.identity(g);n.mat2d.translate(m,m,s.vec2.set(b,e,t)),n.mat2d.rotate(m,m,y-f),n.mat2d.scale(m,m,s.vec2.set(b,o,o));var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,d,h+p),m);var w=[0,0];s.vec2.transformMat2d(w,s.vec2.set(b,d,h),m);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(b,d+c,h+p),m);var S=[0,0];return s.vec2.transformMat2d(S,s.vec2.set(b,d+c,h),m),{rings:[[x,I,S,w,x]]}}function j(e,t,r,o,a,u){var l=i.pt2px(r.xoffset),c=i.pt2px(r.yoffset),p=v*r.angle,d=v*u,h=n.mat2d.identity(g);n.mat2d.translate(h,h,s.vec2.set(b,e,t)),n.mat2d.rotate(h,h,d),n.mat2d.scale(h,h,s.vec2.set(b,a,-a));var f=o[0]+o[2]/2,y=o[1]+o[3]/2;n.mat2d.translate(h,h,s.vec2.set(b,l,-c)),n.mat2d.translate(h,h,s.vec2.set(b,f,y)),n.mat2d.rotate(h,h,p),n.mat2d.translate(h,h,s.vec2.set(b,-f,-y));var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(b,o[0],o[1]),h);var m=[0,0];s.vec2.transformMat2d(m,s.vec2.set(b,o[0],o[1]+o[3]),h);var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(b,o[0]+o[2],o[1]),h);var w=[0,0];return s.vec2.transformMat2d(w,s.vec2.set(b,o[0]+o[2],o[1]+o[3]),h),{rings:[[_,x,w,m,_]]}}function C(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=_.bidiText(t.text)[1],o=r.glyphMosaicItems,s=m.shapeGlyphs(o,n,{scale:i.pt2px(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:m.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),vAlign:m.alignmentUtils.getYAnchorDirection(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=s.x-s.halfWidth,e[1]=s.y-s.halfHeight,e[2]=s.width,e[3]=s.height,e}t.isPointOnPolyline=function(e,t,r,i){s.vec2.set(S,t,r);for(var n,o,a,u,l,c,p,d,h,f=e.paths,y=1/0,_=0;_<f.length;_++){var m=f[_];if(!(m.length<2))for(var v=1;v<m.length;v++)n=m[v-1][0],a=m[v-1][1],o=m[v][0],u=m[v][1],l=Math.min(n,o)-i,c=Math.min(a,u)-i,p=Math.max(n,o)+i,d=Math.max(a,u)+i,t<l||t>p||r<c||r>d||(s.vec2.set(w,n,a),s.vec2.set(I,o,u),s.vec2.subtract(F,I,w),s.vec2.subtract(T,w,S),s.vec2.scale(E,F,s.vec2.dot(F,T)/s.vec2.dot(F,F)),s.vec2.subtract(M,T,E),y>(h=s.vec2.dot(M,M))&&(y=h))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=O,t.getCIMMarkerBounds=R,t.getTextSymbolBounds=j,t.normalizeCentralMeridian=function(e){var t,r,i,n,o,s,a,u,l,h=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,!(r=f.getInfo(t)))return e.toJSON();i=t.isWebMercator,n=A[s=i?102100:4326].maxX,o=A[s].minX,a=A[s].plus180Line,u=A[s].minus180Line;var y=e.toJSON();if(d.isPoint(y))l=G(y,n,o);else if(d.isMultipoint(y))y.points=y.points.map((function(e){return G(e,n,o)})),l=y;else if(d.isExtent(y))l=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,o=e.ymax,s=e.xmax-e.xmin,a=e.xmin,u=e.xmax,l=t.valid,c=l[0],p=l[1],d=(r=P(e.xmin,t)).x,h=r.frameId,f=(r=P(e.xmax,t)).x,y=r.frameId,_=d===f&&s>0;if(s>2*p){var m={xmin:a<u?d:f,ymin:n,xmax:p,ymax:o},v={xmin:c,ymin:n,xmax:a<u?f:d,ymax:o},g={xmin:0,ymin:n,xmax:p,ymax:o},b={xmin:c,ymin:n,xmax:0,ymax:o},x=[],w=[];k(m,g)&&x.push(h),k(m,b)&&w.push(h),k(v,g)&&x.push(y),k(v,b)&&w.push(y);for(var I=h+1;I<y;I++)x.push(I),w.push(I);i.push({extent:m,frameIds:[h]},{extent:v,frameIds:[y]},{extent:g,frameIds:x},{extent:b,frameIds:w})}else d>f||_?i.push({extent:{xmin:d,ymin:n,xmax:p,ymax:o},frameIds:[h]},{extent:{xmin:c,ymin:n,xmax:f,ymax:o},frameIds:[y]}):i.push({extent:{xmin:d,ymin:n,xmax:f,ymax:o},frameIds:[h]});return i}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(y,r);else if(d.isPolygon(y)||d.isPolyline(y)){var _=x;c.getBoundsXY(_,y);var m={xmin:_[0],ymin:_[1],xmax:_[2],ymax:_[3]},v=D(m.xmin,o)*(2*n),g=0===v?y:function(e,t){for(var r=0,i=function(e){return d.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++)o[n][0]+=t;return e}(y,v);m.xmin+=v,m.xmax+=v,p.extentIntersectsPolyline(m,a)&&m.xmax!==n||p.extentIntersectsPolyline(m,u)&&m.xmin!==o?h=g:l=g}else l=e.clone();return null!==h?(new B).cut(h,n):l},t.getTextSymbolSize=C;var A={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}};function D(e,t){return Math.ceil((e-t)/(2*t))}function P(e,t){var r,i=t.valid,n=i[0],o=i[1],s=2*o,a=0;return e>o?(e-=(r=Math.ceil(Math.abs(e-o)/s))*s,a=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/s))*s,a=-r),{x:e,frameId:a}}function k(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,o=t.ymax;return N(e,r,i)&&N(e,r,o)&&N(e,n,o)&&N(e,n,i)}function N(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function G(e,t,r){var i;if(Array.isArray(e))if((i=e[0])>t){var n=D(i,t);e[0]=i+n*(-2*t)}else i<r&&(n=D(i,r),e[0]=i+n*(-2*r));else(i=e.x)>t?(n=D(i,t),e.x+=n*(-2*t)):i<r&&(n=D(i,r),e.x+=n*(-2*r));return e}var B=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,o=0;o<i;o++){var s=r[o];if(s&&s.length>=this.minPts){for(var a=[],u=0,l=s;u<l.length;u++){var c=l[u];a.push([c[0]+n,c[1]])}r.push(a)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},1468:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=n)},1485:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(683)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=/\[([^\[\]]+)\]/gi;t.reader=function(e,t,n){var o=this;return e?e.map((function(e){var s=new r;if(s.read(e,n),s.labelExpression){var a=t.fields||t.layerDefinition&&t.layerDefinition.fields||o.fields;s.labelExpression=s.labelExpression.replace(i,(function(e,t){return"["+function(e,t){if(!t)return e;for(var r=e.toLowerCase(),i=0;i<t.length;i++){var n=t[i].name;if(n.toLowerCase()===r)return n}return e}(t,a)+"]"}))}return s})):null}}.apply(null,i))||(e.exports=n)},1500:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(19),r(1603),r(1419),r(1605),r(1613),r(1614)],void 0===(n=function(e,t,r,i,n,o,s,a){Object.defineProperty(t,"__esModule",{value:!0});var u={base:n.Element,key:"type",typeMap:{attachment:i,field:o,group:s,relationship:a}},l={base:u.base,key:u.key,typeMap:{attachment:u.typeMap.attachment,field:u.typeMap.field,relationship:u.typeMap.relationship}};t.fromJSON=function(e,t){if(void 0===t&&(t=!0),!e)return null;var r=t?u.typeMap:l.typeMap;return e.filter((function(e){return r[e.type]})).map((function(e){return r[e.type].fromJSON(e)}))},t.toJSON=function(e,t){if(void 0===t&&(t=!0),!e)return null;var r=t?u.typeMap:l.typeMap;return e.filter((function(e){return r[e.type]})).map((function(e){return e.toJSON()}))},t.ensureType=function(e,t){return void 0===t&&(t=!0),e?e.map((function(e){return r.ensureOneOfType(t?u:l,e)})):null}}.apply(null,i))||(e.exports=n)},1501:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1407)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.maxLength=null,r.minLength=null,r.type=null,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({maxLength:this.maxLength,minLength:this.minLength,type:this.type})},r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maxLength",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"minLength",void 0),r.__decorate([i.property()],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.inputs.support.TextInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1502:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1),r(1503)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name=null,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({name:this.name,outStatistic:this.outStatistic.clone()})},r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([n.property({type:o,json:{write:!0}})],t.prototype,"outStatistic",void 0),i=r.__decorate([n.subclass("esri.layers.support.AggregateField")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1503:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.statisticType=null,t.onStatisticField=null,t.onStatisticValueExpression=null,t}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})},r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"statisticType",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"onStatisticField",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"onStatisticValueExpression",void 0),i=r.__decorate([n.subclass("esri.layers.support.OutStatistic")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1504:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(85),r(1421),r(1462),r(1452)],void 0===(n=function(e,t,r,i,n,o,s){function a(e,t,i){return e?"selection"!==e.type?(i.messages&&i.messages.push(new r("featureReduction:unsupported","FeatureReduction of type '"+e.declaredClass+"' are not supported in scenes.",{featureReduction:e,context:i})),null):e.write(t,i):null}Object.defineProperty(t,"__esModule",{value:!0}),t.webSceneFeatureReductionTypes={key:"type",base:n.default,typeMap:{selection:s}},t.read=function(e,t){var r=(t=t.layerDefinition||t).featureReduction;if(r)switch(r.type){case"selection":return s.fromJSON(r);case"cluster":return o.fromJSON(r)}return null},t.writeTarget=function(e,t,r,n){var o=a(e,{},n);o&&i.setDeepValue(r,o,t)},t.write=a}.apply(null,i))||(e.exports=n)},1524:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(67),r(2),r(4),r(92),r(316),r(76),r(412),r(1525),r(1416),r(1397),r(1469),r(1405)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f){function y(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function _(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function m(e,t,r){return r?t-e:e-t}function v(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var n=new Date(e).getTime(),o=new Date(t).getTime();if(!isNaN(n)&&!isNaN(o))return m(n,o,i)}return"number"==typeof e&&"number"==typeof t?m(e,t,i):"string"==typeof e&&"string"==typeof t?(n=e.toUpperCase(),o=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?_(n,o,i):_(y(n),y(o),i)):i?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(u.isValid(e.outSR)&&!u.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=f.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},d.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=f.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=p.getWhereClause(t.where,this.fieldsIndex);if(!r)return o.resolve(this);if(r.isStandardized){for(var i=0,n=[],s=0,a=this.items;s<a.length;s++){var u=a[s];r.testFeature(u,this.featureAdapter)&&(n[i++]=u)}var l=new e(n,this.queryGeometry,this);return l.definitionExpression=t.where,o.resolve(l)}return o.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return o.resolve(this);var r=s.SetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return o.resolve(new e(this.items.filter((function(e){return r.has(i(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=h.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!n.isSome(r))return o.resolve(this);var i=this.items.filter(r);return o.resolve(new e(i,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,s=t.endTimeField||n,a=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var p=c[l],d=u(p,r),h=u(p,s),f=a.get(d);(!f||h>u(f,s))&&a.set(d,p)}var y=i.valuesOfMap(a);return o.resolve(new e(y,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||u.equals(this.spatialReference,t)?[2,this]:(i=this.featureAdapter,[4,d.projectMany(this.items.map((function(e){return f.getGeometry(n.geometryType,n.hasZ,n.hasM,i.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return i.cloneWithGeometry(n.items[t],l.convertFromGeometry(e,n.hasZ,n.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var i=function(t){var i=t.split(" "),o=i[0],s=n.fieldsIndex.get(o),a=i[1]&&"desc"===i[1].toLowerCase();e.sort((function(e,t){return v(r(e,o,s),r(t,o,s),s,a)}))},n=this,o=0,s=t.reverse();o<s.length;o++)i(s[o])},e.prototype._createFeatureQueryResponse=function(e){var t=this,i=this.items,n=this,o=n.geometryType,s=n.hasM,u=n.hasZ,l=n.objectIdField,c=n.spatialReference,p=e.outFields,d=e.outSR,h=e.quantizationParameters,y=e.resultRecordCount,_=e.resultOffset,m=e.returnZ,v=e.returnM,g=!1;if(null!=y&&null!=_){var b=_+y;g=i.length>b,i=i.slice(_,Math.min(i.length,b))}var x=p&&(p.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):p.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:g,features:this._createFeatures(e,i),fields:x,geometryType:o,hasM:s&&v,hasZ:u&&m,objectIdFieldName:l,spatialReference:f.cleanFromGeometryEngine(d||c),transform:h&&a.toQuantizationTransform(h)||null}},e.prototype._createFeatures=function(e,t){var r=new c.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,n=this.hasZ,o=e.orderByFields,s=e.quantizationParameters,u=e.returnGeometry,l=e.returnCentroid,p=e.maxAllowableOffset,d=e.returnZ,h=void 0!==d&&d,y=e.returnM,_=n&&h,m=i&&void 0!==y&&y,v=[],g=0;if(u||l){var b=a.toQuantizationTransform(s);if(u&&!l)for(var x=0,w=t;x<w.length;x++)O=w[x],v[g++]={attributes:r.getAttributes(O),geometry:f.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),p,b,_,m)};else if(!u&&l)for(var I=0,S=t;I<S.length;I++)O=S[I],v[g++]={attributes:r.getAttributes(O),centroid:f.transformCentroid(this,this.featureAdapter.getCentroid(O,this),b)};else for(var F=0,T=t;F<T.length;F++)O=T[F],v[g++]={attributes:r.getAttributes(O),centroid:f.transformCentroid(this,this.featureAdapter.getCentroid(O,this),b),geometry:f.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),p,b,_,m)}}else for(var E=0,M=t;E<M.length;E++){var O=M[E],R=r.getAttributes(O);R&&(v[g++]={attributes:R})}return this._sortFeatures(v,o,(function(e,t,i){return r.getFieldValue(e,t,i)})),v},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=0,s=e.outStatistics;o<s.length;o++){var a=s[o];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},n=[],o=new Map,s=new Map,a=new Map,u=new Map,l=new c.default(e,this.featureAdapter,this.fieldsIndex),p=e.outStatistics,d=e.groupByFieldsForStatistics,h=e.having,f=e.orderByFields,y=d&&d.length,_=!!y,m=_&&d[0],v=_&&!this.fieldsIndex.get(m),g=0,b=p;g<b.length;g++){var x=b[g],w=x.outStatisticFieldName,I=x.statisticType,S=x,F="exceedslimit"!==I?x.onStatisticField:void 0,T="percentile_disc"===I||"percentile_cont"===I,E=_&&1===y&&(F===m||v)&&"count"===I;if(_){if(!a.has(F)){for(var M=[],O=0,R=d;O<R.length;O++){var j=R[O],C=this._getAttributeValues(l,j,o);M.push(C)}a.set(F,this._calculateUniqueValues(M))}var A=a.get(F),D=function(e){var r=A[e],i=r.count,n=r.data,s=r.items,a=r.itemPositions,c=n.join(",");if(!h||l.validateItems(s,h)){var p=u.get(c)||{attributes:{}},f=null;if(E)f=i;else{var y=P._getAttributeValues(l,F,o),_=a.map((function(e){return y[e]}));f=T&&"statisticParameters"in S?P._getPercentileValue(S,_):P._getStatisticValue(S,_)}p.attributes[w]=f,d.forEach((function(e,r){return p.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=n[r]})),u.set(c,p)}},P=this;for(var k in A)D(k)}else C=this._getAttributeValues(l,F,o),r.attributes[w]=T&&"statisticParameters"in S?this._getPercentileValue(S,C):this._getStatisticValue(S,C,s);n.push({name:w,alias:w,type:"esriFieldTypeDouble"})}var N=_?i.valuesOfMap(u):[r];return this._sortFeatures(N,f,(function(e,t){return e.attributes[t]})),{fields:n,features:N}},e.prototype._getStatisticValue=function(e,t,r){var i=e.onStatisticField,n=e.statisticType,o=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,o),o["var"===n?"variance":n]},e.prototype._getPercentileValue=function(e,t){var i=e.onStatisticField,n=e.statisticParameters,o=e.statisticType,s=n.value,a="desc"===n.orderBy,u=this.fieldsIndex.get(i),l=r.__spreadArrays(t).sort((function(e,t){return v(e,t,u,a)}));return this._calculatePercentile(l,s,"percentile_disc"===o)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),n=this.items.map((function(r){return e.getFieldValue(r,t,i)}));return r.set(t,n),n},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,n=null,o=null,s=null,a=[],u=0,l=0,c=e;l<c.length;l++)"string"==typeof(f=c[l])?u++:null==f||isNaN(f)||(i+=f,t=Math.min(t,f),r=Math.max(r,f),a.push(f),u++);if(u){n=i/u;for(var p=0,d=0,h=a;d<h.length;d++){var f=h[d];p+=Math.pow(f-n,2)}s=u>1?p/(u-1):0,o=Math.sqrt(s)}else t=null,r=null;return{avg:n,count:u,max:r,min:t,stddev:o,sum:i,variance:s}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,i=r.length,n=0;n<i;n++){for(var o=r[n],s=[],a=0,u=e;a<u.length;a++){var l=u[a];s.push(l[n])}var c=s.join(",");null==t[c]?t[c]={count:1,data:s,items:[o],itemPositions:[n]}:(t[c].count++,t[c].items.push(o),t[c].itemPositions.push(n))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,n=Math.floor(i),o=n+1,s=i%1,a=e[n],u=e[o];return o>=e.length||r||"string"==typeof a||"string"==typeof u?a:a*(1-s)+u*s},e}();t.default=g}.apply(null,i))||(e.exports=n)},1525:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1416)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var o=0,s=0,a=n;s<a.length;s++){var u=a[s],l=i.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),p=c?null:i.getWhereClause(l,r),d=c?c.name:i.getAliasFromFieldName(u)||"FIELD_EXP_"+o++;this._fieldDataCache.set(u,{alias:d,clause:p})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var n=r?r.name:t,o=null;return this._fieldDataCache.has(n)?o=this._fieldDataCache.get(n).clause:r||(o=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:o})),r?this.featureAdapter.getAttribute(e,n):o.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var o=n[i],s=this._fieldDataCache.get(o),a=s.alias,u=s.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var n=0,o=t;n<o.length;n++){var s=o[n],a=this._fieldDataCache.get(s).alias;i.push(e[a])}else for(var a in e)i.push(e[a]);var u=(t||["*"]).join(",")+"="+i.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},1568:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),i=new Float64Array(2);function n(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function o(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function s(e){return(e[0]+e[1])/2}function a(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=s(e),i=t,n=!t;e[0]=n*e[0]+i*r,e[1]=n*r+i*e[1]}function l(e,t){var r=t>s(e);return u(e,r),r}function c(e,t){for(var o=a(r,-90,90),l=a(i,-180,180),c=0;c<t.length;c++){var p=n(t.charCodeAt(c));c%2==0?(u(l,!!(16&p)),u(l,!!(4&p)),u(l,!!(1&p)),u(o,!!(8&p)),u(o,!!(2&p))):(u(o,!!(16&p)),u(o,!!(4&p)),u(o,!!(1&p)),u(l,!!(8&p)),u(l,!!(2&p)))}return e[0]=s(o),e[1]=s(l),e}function p(e,t,n){for(var s="",u=a(r,-90,90),c=a(i,-180,180),p=0;p<n;p++){var d=0;p%2?(d|=l(u,e)<<4,d|=l(c,t)<<3,d|=l(u,e)<<2,d|=l(c,t)<<1,d|=l(u,e)<<0):(d|=l(c,t)<<4,d|=l(u,e)<<3,d|=l(c,t)<<2,d|=l(u,e)<<1,d|=l(c,t)<<0),s+=o(d)}return s}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function h(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function f(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function y(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function _(e,t,r){var i=!((e.length-1)%2),s=e.substring(0,e.length-1),a=n(e.charCodeAt(e.length-1)),u=0,l=0,c=0,p=0;i?(u=8,l=4,c=1&a|(4&a)>>1|(16&a)>>2,p=(2&a)>>1|(8&a)>>2):(u=4,l=8,p=1&a|(4&a)>>1|(16&a)>>2,c=(2&a)>>1|(8&a)>>2);var d=c+t,h=p+r,f=Math.floor(d/u),y=Math.floor(h/l),m=o(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-f*u,h-y*l,i));return e.length>1&&(f||y)?_(s,f,y)+m:s+m}t.decodeBase32Char=n,t.encodeBase32Char=o,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,i=0,o=30,s=30,a=0;a<t.length;a++){var u=n(t.charCodeAt(a)),l=a%2==0;r|=f(u,l)<<(o-=l?3:2),i|=y(u,l)<<(s-=l?2:3)}return{geohashX:r,geohashY:i}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,n=-180,o=180,s=0;s<t;s++){for(var a=Math.ceil((s+1)/2),u=Math.floor((s+1)/2),l=1-s%2,c=30-(3*a+2*u),p=30-(2*a+3*u),d=3*l+2*(1-l),h=2*l+3*(1-l),f=3*l+7*(1-l)<<p,y=(7*l+3*(1-l)<<c&e.geohashX)>>c,_=(f&e.geohashY)>>p,m=d-1;m>=0;m--){var v=(n+o)/2,g=y&1<<m?1:0;n=(1-g)*n+g*v,o=(1-g)*v+g*o}for(m=h-1;m>=0;m--){var b=(r+i)/2,x=_&1<<m?1:0;r=(1-x)*r+x*b,i=(1-x)*b+x*i}}return[n,r,o,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var n=0,o=0,s=-90,a=90,u=-180,l=180,c=0;c<i/2;c++){for(var p=0;p<5;p++){var d=(u+l)/2,h=r>d?1:0;n|=h<<29-(p+5*c),u=(1-h)*u+h*d,l=(1-h)*d+h*l}for(p=0;p<5;p++){var f=(s+a)/2,y=t>f?1:0;o|=y<<29-(p+5*c),s=(1-y)*s+y*f,a=(1-y)*f+y*a}}e.geohashX=n,e.geohashY=o},t.encodeGeohash=p,t.latDistPerGeohash=d,t.lonDistPerGeohash=h,t.unpackXBits=f,t.unpackYBits=y,t.getRelativeGeohash=_,t.getIntersectingGeohashes=function(e,t,r,i,n){for(var o=Math.abs(r-e),s=Math.abs(i-t),a=d(n),u=h(n),l=Math.ceil(s/u),c=Math.ceil(o/a),f=p(e,t,n),y=new Array,m=0;m<l;m++)for(var v=0;v<c;v++)y.push(_(f,m,v));return y},t.forEachIntersectingGeohash=function(e,t,r,i,n,o){for(var s=Math.abs(r-e),a=Math.abs(i-t),u=d(n),l=h(n),f=Math.ceil(a/l),y=Math.ceil(s/u),m=p(e,t,n),v=0;v<f;v++)for(var g=0;g<y;g++){var b=_(m,v,g),x=c([0,0],b),w=x[0],I=x[1],S=w-u/2,F=I-l/2,T=w+u/2,E=I+l/2,M=u*l,O=Math.max(e,S),R=Math.max(t,F),j=Math.min(r,T)-O,C=Math.min(i,E)-R;o(b,Math.abs(j*C)/M)}}}.apply(null,i))||(e.exports=n)},1601:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(8),r(1),r(703),r(1602),r(1500)],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.description=null,r.elements=null,r.expressionInfos=null,r.title=null,r}var i;return r.__extends(t,e),i=t,t.prototype.castElements=function(e){return u.ensureType(e)},t.prototype.readElements=function(e,t){return u.fromJSON(t.formElements)},t.prototype.writeElements=function(e,t){t.formElements=u.toJSON(e)},t.prototype.clone=function(){return new i({description:this.description,expressionInfos:n.clone(this.expressionInfos),elements:n.clone(this.elements),title:this.title})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"description",void 0),r.__decorate([o.property({json:{write:!0}})],t.prototype,"elements",void 0),r.__decorate([o.cast("elements")],t.prototype,"castElements",null),r.__decorate([s.reader("elements",["formElements"])],t.prototype,"readElements",null),r.__decorate([o.writer("elements")],t.prototype,"writeElements",null),r.__decorate([o.property({type:[a],json:{write:!0}})],t.prototype,"expressionInfos",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),i=r.__decorate([o.subclass("esri.form.FormTemplate")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1602:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.expression=null,r.name=null,r.returnType="boolean",r.title=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})},r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"expression",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"name",void 0),r.__decorate([n.property({type:["boolean"],json:{write:!0}})],t.prototype,"returnType",void 0),r.__decorate([n.property({type:String,json:{write:!0}})],t.prototype,"title",void 0),i=r.__decorate([n.subclass("esri.form.ExpressionInfo")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1603:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1419),r(1604)],void 0===(n=function(e,t,r,i,n,o){return function(e){function t(t){var r=e.call(this,t)||this;return r.attachmentKeyword=null,r.editable=!0,r.input=null,r.type="attachment",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})},r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"attachmentKeyword",void 0),r.__decorate([i.property({type:Boolean,json:{default:!0,write:!0}})],t.prototype,"editable",void 0),r.__decorate([i.property({type:o,json:{read:{source:"inputType"},write:{target:"inputType"}}})],t.prototype,"input",void 0),r.__decorate([i.property({type:["attachment"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.AttachmentElement")],t)}(n.Element)}.apply(null,i))||(e.exports=n)},1604:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type=null,r}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){return new i({type:this.type})},r.__decorate([n.property({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],t.prototype,"type",void 0),i=r.__decorate([n.subclass("esri.form.elements.inputs.AttachmentInput")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1605:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1419),r(1606),r(320)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.domain=null,r.editable=!0,r.fieldName=null,r.hint=null,r.input=null,r.requiredExpression=null,r.type="field",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})},r.__decorate([i.property({types:s.types,json:{read:{reader:s.fromJSON},write:!0}})],t.prototype,"domain",void 0),r.__decorate([i.property({type:Boolean,json:{default:!0,write:!0}})],t.prototype,"editable",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"fieldName",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"hint",void 0),r.__decorate([i.property({types:o.types,json:{read:{source:"inputType"},write:{target:"inputType"}}})],t.prototype,"input",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"requiredExpression",void 0),r.__decorate([i.property({type:String,json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.FieldElement")],t)}(n.Element)}.apply(null,i))||(e.exports=n)},1606:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1607),r(1608),r(1609),r(1407),r(1610),r(1611),r(1612)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0}),t.types={base:o,key:"type",typeMap:{"barcode-scanner":r,"combo-box":i,"datetime-picker":n,"radio-buttons":s,"text-area":a,"text-box":u}}}.apply(null,i))||(e.exports=n)},1607:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1407)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="barcode-scanner",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n},r.__decorate([i.property({type:["barcode-scanner"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.inputs.BarcodeScannerInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1608:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1407)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="combo-box",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n},r.__decorate([i.property({type:["combo-box"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.inputs.ComboBoxInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1609:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1407)],void 0===(n=function(e,t,r,i,n){function o(e){return null!=e?new Date(e):null}function s(e){return e?e.getTime():null}return function(e){function t(t){var r=e.call(this,t)||this;return r.includeTime=null,r.max=null,r.min=null,r.type="datetime-picker",r}var n;return r.__extends(t,e),n=t,t.prototype.readMax=function(e,t){return o(t.max)},t.prototype.writeMax=function(e,t){t.max=s(e)},t.prototype.readMin=function(e,t){return o(t.min)},t.prototype.writeMin=function(e,t){t.min=s(e)},t.prototype.clone=function(){return new n({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})},r.__decorate([i.property({type:Boolean,json:{write:!0}})],t.prototype,"includeTime",void 0),r.__decorate([i.property({type:Date,json:{type:Number,write:!0}})],t.prototype,"max",void 0),r.__decorate([i.reader("max")],t.prototype,"readMax",null),r.__decorate([i.writer("max")],t.prototype,"writeMax",null),r.__decorate([i.property({type:Date,json:{type:Number,write:!0}})],t.prototype,"min",void 0),r.__decorate([i.reader("min")],t.prototype,"readMin",null),r.__decorate([i.writer("min")],t.prototype,"writeMin",null),r.__decorate([i.property({type:["datetime-picker"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.inputs.DateTimePickerInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1610:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1407)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="radio-buttons",r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n},r.__decorate([i.property({type:["radio-buttons"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),n=r.__decorate([i.subclass("esri.form.elements.inputs.RadioButtonsInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1611:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1501)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="text-area",r}return r.__extends(t,e),r.__decorate([i.property({type:["text-area"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.form.elements.inputs.TextAreaInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1612:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(1),r(1501)],void 0===(n=function(e,t,r,i,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.type="text-box",r}return r.__extends(t,e),r.__decorate([i.property({type:["text-box"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),r.__decorate([i.subclass("esri.form.elements.inputs.TextBoxInput")],t)}(n)}.apply(null,i))||(e.exports=n)},1613:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(8),r(1),r(439),r(725),r(1419),r(1500)],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.elements=null,r.initialState="expanded",r.type="group",r}var a;return r.__extends(t,e),a=t,t.prototype.castElements=function(e){return u.ensureType(e,!1)},t.prototype.readElements=function(e,t){return u.fromJSON(t.formElements,!1)},t.prototype.writeElements=function(e,t){t.formElements=u.toJSON(e,!1)},t.prototype.clone=function(){return new a({description:this.description,elements:i.clone(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})},r.__decorate([n.property({json:{write:!0}})],t.prototype,"elements",void 0),r.__decorate([o.cast("elements")],t.prototype,"castElements",null),r.__decorate([n.reader("elements",["formElements"])],t.prototype,"readElements",null),r.__decorate([s.writer("elements")],t.prototype,"writeElements",null),r.__decorate([n.property({type:["collapsed","expanded"],json:{default:"expanded",write:!0}})],t.prototype,"initialState",void 0),r.__decorate([n.property({type:String,json:{read:!1,write:!0}})],t.prototype,"type",void 0),a=r.__decorate([n.subclass("esri.form.elements.GroupElement")],t)}(a.Element)}.apply(null,i))||(e.exports=n)},1614:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(8),r(1),r(1419),r(731)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.displayCount=null,r.displayType="list",r.editable=!0,r.orderByFields=null,r.relationshipId=null,r.type="relationship",r}var o;return r.__extends(t,e),o=t,t.prototype.clone=function(){return new o({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:i.clone(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})},r.__decorate([n.property({type:Number,json:{write:!0}})],t.prototype,"displayCount",void 0),r.__decorate([n.property({type:["list"],json:{write:!0}})],t.prototype,"displayType",void 0),r.__decorate([n.property({type:Boolean,json:{default:!0,write:!0}})],t.prototype,"editable",void 0),r.__decorate([n.property({type:[s],json:{write:!0}})],t.prototype,"orderByFields",void 0),r.__decorate([n.property({type:Number,json:{write:!0}})],t.prototype,"relationshipId",void 0),r.__decorate([n.property({type:["relationship"],json:{read:!1,write:!0}})],t.prototype,"type",void 0),o=r.__decorate([n.subclass("esri.form.elements.RelationshipElement")],t)}(o.Element)}.apply(null,i))||(e.exports=n)},1615:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(91),r(23),r(11),r(25),r(86),r(5),r(2),r(127),r(4),r(238),r(1),r(19),r(423),r(305)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m){Object.defineProperty(t,"__esModule",{value:!0});var v=0,g=l.getLogger("esri.layers.graphics.sources.MemorySource"),b=function(e){function t(t){var r=e.call(this,t)||this;return r._idToClientGraphic=null,r.type="memory",r}return r.__extends(t,e),t.prototype.load=function(e){var t=c.isSome(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),d.resolve(this)},Object.defineProperty(t.prototype,"workerGeometryType",{get:function(){var e=this.layer&&this.layer.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null},enumerable:!0,configurable:!0}),t.prototype.applyEdits=function(e){var t=this;return this.load().then((function(){return t._applyEdits(e)}))},t.prototype.openPorts=function(){var e=this;return this.load().then((function(){return e._connection.openPorts()}))},t.prototype.queryFeatures=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var i,n,o,s,a,u,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.load(t)];case 1:return r.sent(),[4,this._connection.invoke("queryFeatures",e?e.toJSON():null,t)];case 2:if(i=r.sent(),_.applyFeatureSetZUnitScaling(e,this.layer.spatialReference,i),n=m.fromJSON(i),!this._requiresClientGraphicMapping())return[2,n];for(o=this.layer.objectIdField,s=0,a=n.features;s<a.length;s++)u=a[s],l=u.attributes[o],(c=this._idToClientGraphic.get(l))&&(u.geometry=c.geometry);return n.geometryType=this.layer.geometryType,[2,n]}}))}))},t.prototype.queryFeaturesJSON=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return this._requiresClientGraphicMapping()?[2,d.reject(new s("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)"))]:[4,this.load(t)];case 1:return r.sent(),[4,this._connection.invoke("queryFeatures",e?e.toJSON():null,t)];case 2:return i=r.sent(),_.applyFeatureSetZUnitScaling(e,this.layer.spatialReference,i),[2,i]}}))}))},t.prototype.queryFeatureCount=function(e,t){var r=this;return void 0===t&&(t={}),this.load(t).then((function(){return r._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)}))},t.prototype.queryObjectIds=function(e,t){var r=this;return void 0===t&&(t={}),this.load(t).then((function(){return r._connection.invoke("queryObjectIds",e?e.toJSON():null,t)}))},t.prototype.queryExtent=function(e,t){var r=this;return void 0===t&&(t={}),this.load(t).then((function(){return r._connection.invoke("queryExtent",e?e.toJSON():null,t)})).then((function(e){return{count:e.count,extent:i.Extent.fromJSON(e.extent)}}))},t.prototype._applyEdits=function(e){var t=this;if(!this._connection)throw new s("feature-layer-source:edit-failure","Memory source not loaded");var r=this.layer.objectIdField,i=null,n=[],o=[],a=function(e){return"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[r]?e.attributes[r]:null};if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(var u=0,l=e.deleteFeatures;u<l.length;u++)null!=(h=a(f=l[u]))&&n.push(h);var c=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(var p=0,d=e.updateFeatures;p<d.length;p++){var h,f=d[p];o.push(this._serializeFeature(f)),c&&null!=(h=a(f))&&c.set(h,f)}return _.unapplyEditsZUnitScaling(i?i.features:null,o,this.layer.spatialReference),this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:o,deletes:n}).then((function(e){var r=e.fullExtent,n=e.featureEditResults;if(t.fullExtent=r,i&&i.finish(n.uidToObjectId),t._idToClientGraphic){if(c)for(var o=0,s=n.updateResults;o<s.length;o++){var a=s[o];if(a.success){var u=c.get(a.objectId);null!=u&&t._addIdToClientGraphic(u)}}for(var l=0,p=n.deleteResults;l<p.length;l++){var d=p[l];d.success&&t._idToClientGraphic.delete(d.objectId)}}return t._createEditsResult(n)}))},t.prototype._createEditsResult=function(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}},t.prototype._createFeatureEditResult=function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new s("feature-layer-source:edit-failure",t.description,{code:t.code}):null}},t.prototype._prepareAddFeatures=function(e){for(var t=new Map,r=new Array(e.length),i=null,n=0;n<e.length;n++){var o=e[n],s=this._serializeFeature(o);!i&&c.isSome(o.geometry)&&(i=o.geometry.type),r[n]=s,t.set(""+s.uid,o)}var a=this;return{features:r,inferredGeometryType:i,finish:function(e){var r=a.sourceJSON.objectIdField;for(var i in e){var n=e[i],o=t.get(i);o&&(o.attributes||(o.attributes={}),-1===n?delete o.attributes[r]:o.attributes[r]=n,a._addIdToClientGraphic(o))}}}},t.prototype._addIdToClientGraphic=function(e){if(this._idToClientGraphic){var t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];null!=r&&this._idToClientGraphic.set(r,e)}},t.prototype._requiresClientGraphicMapping=function(){var e=this.layer.geometryType||this.sourceJSON.geometryType;return this._geometryTypeRequiresClientGraphicMapping(e)},t.prototype._geometryRequiresClientGraphicMapping=function(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)},t.prototype._geometryTypeRequiresClientGraphicMapping=function(e){return"mesh"===e||"multipatch"===e||"extent"===e},t.prototype._serializeFeature=function(e){var t=e.attributes,r=this._geometryForSerialization(e),i=(v++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}},t.prototype._geometryForSerialization=function(e){var t=e.geometry;return c.isNone(t)?null:this._geometryRequiresClientGraphicMapping(t)?i.Polygon.fromExtent(t.extent):t},t.prototype._startWorker=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,o,s,u,l,c,p,d,f,y,_,m,v,b,x;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this,[4,h.open("MemorySourceWorker",{strategy:a("esri-workers-for-memory-layers")?"dedicated":"local",signal:e})];case 1:return t._connection=r.sent(),n=this.layer,o=n.fields,s=n.spatialReference,u=n.objectIdField,l=n.hasM,c=n.hasZ,p=n.timeInfo,d="defaults"===this.layer.originOf("spatialReference"),f=this._prepareAddFeatures(this.items),this.on("before-changes",(function(e){g.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})),y={features:f.features,fields:o&&o.map((function(e){return e.toJSON()})),geometryType:i.typeKebabDictionary.toJSON(this.workerGeometryType),hasM:l,hasZ:c,objectIdField:u,spatialReference:d?null:s&&s.toJSON(),timeInfo:p?p.toJSON():null},[4,this._connection.invoke("load",y,{signal:e})];case 2:for(_=r.sent(),m=0,v=_.warnings;m<v.length;m++)b=v[m],g.warn(b.message,{layer:this.layer,warning:b});return _.featureErrors.length&&g.warn("Encountered "+_.featureErrors.length+" validation errors while loading features",_.featureErrors),x=_.layerDefinition,this._geometryTypeRequiresClientGraphicMapping(f.inferredGeometryType)&&(x.geometryType=i.typeKebabDictionary.toJSON(f.inferredGeometryType)),this.sourceJSON=x,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),f.finish(_.assignedObjectIds),[2]}}))}))},r.__decorate([f.shared({Type:n,ensureType:y.ensureType(n)})],t.prototype,"itemType",void 0),r.__decorate([f.property()],t.prototype,"type",void 0),r.__decorate([f.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([f.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"workerGeometryType",null),r.__decorate([f.property()],t.prototype,"sourceJSON",void 0),r.__decorate([f.subclass("esri.layers.graphics.sources.MemorySource")],t)}(u.LoadableMixin(p.EsriPromiseMixin(o)));t.MemorySource=b,t.default=b}.apply(null,i))||(e.exports=n)},1616:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(1)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}var i;return r.__extends(t,e),i=t,t.prototype.clone=function(){var e=this,t=e.name,r=e.fields,n=e.isAscending,o=e.isUnique,s=e.description;return new i({name:t,fields:r,isAscending:n,isUnique:o,description:s})},r.__decorate([n.property({constructOnly:!0})],t.prototype,"name",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"fields",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"isAscending",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"isUnique",void 0),r.__decorate([n.property({constructOnly:!0})],t.prototype,"description",void 0),i=r.__decorate([n.subclass("esri.layers.support.FeatureIndex")],t)}(i.JSONSupport);t.FeatureIndex=o,t.default=o}.apply(null,i))||(e.exports=n)},1617:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(22),r(7),r(1)],void 0===(n=function(e,t,r,i,n,o){var s=new i.default({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),a=new i.default({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});return function(e){function t(t){var r=e.call(this,t)||this;return r.cardinality=null,r.composite=null,r.id=null,r.keyField=null,r.keyFieldInRelationshipTable=null,r.name=null,r.relatedTableId=null,r.relationshipTableId=null,r.role=null,r}return r.__extends(t,e),r.__decorate([o.property({json:{read:s.read,write:s.write}})],t.prototype,"cardinality",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"composite",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"id",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"keyField",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"keyFieldInRelationshipTable",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"name",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"relatedTableId",void 0),r.__decorate([o.property({json:{read:!0,write:!0}})],t.prototype,"relationshipTableId",void 0),r.__decorate([o.property({json:{read:a.read,write:a.write}})],t.prototype,"role",void 0),r.__decorate([o.subclass("esri.layers.support.Relationship")],t)}(n.JSONSupport)}.apply(null,i))||(e.exports=n)},1699:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(145),r(25),r(5),r(2),r(4),r(1),r(1416),r(1402),r(413),r(308),r(304),r(675),r(1466),r(1700),r(1702)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m,v){Object.defineProperty(t,"__esModule",{value:!0});var g=s.getLogger("esri.views.2d.layers.features.controllers.BaseController"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(y.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return r.__extends(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,u.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new d(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return i(e.symbol)}));case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some((function(e){return i(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?h.fromJSON(this.config.renderer):(g.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=r.__spreadArrays(this._availableFields,t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,v.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(a.isSome(n)&&n.where)try{c.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new i("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&o("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new _.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new p.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new m.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new f,r=e.outFields,i=this.config,n=i.gdbVersion,o=i.historicMoment,s=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=n,t.historicMoment=null!=o?new Date(o):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=s||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return a.isSome(e)&&!!e.geometry}))},r.__decorate([l.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r.__decorate([l.property()],t.prototype,"config",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r.__decorate([l.property()],t.prototype,"filters",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r.__decorate([l.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r.__decorate([l.property()],t.prototype,"processor",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([l.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"viewState",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r.__decorate([l.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(n.HandleOwner);t.default=b}.apply(null,i))||(e.exports=n)},1700:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(25),r(2),r(4),r(15),r(1701),r(1568),r(76),r(46),r(419),r(414),r(1427),r(1397),r(1402),r(1405),r(107),r(421),r(677)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y,_,m,v,g,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){return o.andThen(e,(function(e){return"cluster"!==e.type?null:r.__assign(r.__assign({},e),{clusterRadius:a.pt2px(e.clusterRadius/2)})}))};function w(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,u;return r.__generator(this,(function(r){for(n=[],o=0,a=e;o<a.length;o++)u=a[o],n.push(I(u,t,i));return[2,s.all(n)]}))}))}function I(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(o=(n=e).outStatistic.onStatisticValueExpression,s=n,[4,v.createRendererExpression(o,t,i)]):[3,2];case 1:return s.expression=r.sent(),[2,n];case 2:return[2,e]}}))}))}var S=function(e){function t(t,r,i,n,o){var s=this,a=new h.default([],[r,i]);return(s=e.call(this,a,n,null,t)||this).invalid=!1,s.canDelete=!1,s.geohashBoundsInfo=o,s}return r.__extends(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,i,n,o,s,a){var u=new t(r,i,n,s,a);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=o,u},t.prototype.update=function(e,t,r,i,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=n,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(d.default),F=function(e){function t(t,r,n,o){var s=e.call(this,t)||this;return s._deferredDeletionQueue=[],s._invalidated=!1,s._aggregateFieldsHash=null,s._geohashLevel=0,s._aggregateValueRanges={},s._aggregateValueRangesChanged=!1,s._aggregateFields=[],s._hasAggregateValueExpression=!1,s._hasViewExpression=!1,s._$view={scale:0,viewingMode:"none"},s._clusters=new Map,s._tiles=new Map,s._spatialReference=r,s._attributeStore=n,s._featureReduction=x(o),s._projectionSupportCheck=y.checkProjectionSupport(r,i.SpatialReference.WGS84),s}return r.__extends(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,o.isSome(r)&&t&&(this._tree=new u.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,l,c,p,d,h,f,y,_,m=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this._featureReduction,s=o.andThen(t.featureReduction,x),a=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),l=null===n&&t.featureReduction,c=a!==this._aggregateFieldsHash,p=l||c,c?(d=this,[4,w(t.aggregateFields,this._spatialReference,i)]):[3,2];case 1:for(d._aggregateFields=r.sent(),this._hasViewExpression=!1,h=0,f=this._aggregateFields;h<f.length;h++)"onStatisticValueExpression"in(y=f[h]).outStatistic&&(_=y,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||_.expression.referencesScale());r.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return r.sent(),this._featureReduction=s,this._aggregateFieldsHash=a,this._aggregateValueRanges={},this._invalidated=!0,o.isNone(s)?(this._tree=null,[2]):(o.isSome(n)&&n.clusterRadius!==s.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),p&&(this._tree=new u.GeohashTree(t.aggregateFields),this._unindexFeatures()),(p||e)&&this._reindexFeatures(c),this._handleClusterUpdates(),this._tiles.forEach((function(e){return m._getClustersForTile(e,0,s.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,i=this._aggregateFields;r<i.length;r++){var n=i[r];if("onStatisticValueExpression"in n.outStatistic){var o=n,s=o.expression,a=o.outStatistic.onStatisticField;e.attributes[a]=g.callWithOptimizedFeature(s,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length){var n=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(n),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!o.isNone(this._featureReduction)){var s=this._featureReduction.clusterRadius;i.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,s)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var i=r[t];this._attributeStore.addLocalId(i)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var s,a,u;return r.__generator(this,(function(r){switch(r.label){case 0:return o.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,i,n)]:[4,this._projectionSupportCheck];case 1:return r.sent(),this._handleClusterUpdates(),s=this._featureReduction.clusterRadius,a=this._getTransforms(t,i),u=this._getClustersForTile(t,n.pixelBuffer,s,a),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,u]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,s,a,u){var l=this;void 0===u&&(u=!0),t=Math.max(t,50);for(var c=2*s,d=new Set,h=this._getGeohashLevel(e.key.level),f=Math.pow(2,e.key.level)*Math.ceil(b.TILE_SIZE/c),v=Math.ceil(t/c)+2,g=Math.ceil(b.TILE_SIZE/c)+2*v,x=e.key,w=x.row,I=x.col*b.TILE_SIZE,S=w*b.TILE_SIZE,F=Math.floor(I/c)-v,T=Math.floor(S/c)-v,E=F+g,M=T+g,O=new Array,R=e.tileInfoView.getLODInfoAt(e.key.level),j=F;j<=E;j++)for(var C=function(t){var s,c,v=j;R.wrap&&(v=j<0?j+f:j%f);var g=R.wrap&&j<0,b=R.wrap&&j%f!==j,x=A._lookupCluster(R,e.key.level,v,t,h);if(o.isSome(x)){var w=o.andThen(a,(function(e){return g?e.left:b?e.right:e.tile}));if(u&&o.isNone(w))return"continue";if(!x.count)return"continue";if(u&&1===x.count){var I=x.geohashBoundsInfo,S=I.xLL,F=I.yLL,T=I.xTR,E=I.yTR,M=I.level,C=o.unwrap(A._tree).findSingleOccupancyNode(S,F,T,E,M),D=o.unwrap(C).getLngLatBounds(),P={x:D[0],y:D[1]},k={x:D[2],y:D[3]},N=0,G=0,B=0,L=0;if(A._spatialReference.isWebMercator)N=(s=p.lngLatToXY(P.x,P.y))[0],G=s[1],B=(c=p.lngLatToXY(k.x,k.y))[0],L=c[1];else{var q=y.project(P,i.SpatialReference.WGS84,A._spatialReference),V=y.project(k,i.SpatialReference.WGS84,A._spatialReference);if(!q||!V)return n("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";N=q.x,G=q.y,B=V.x,L=V.y}var Q=[N,G,B,L],z=null;if(A.forEachInBounds(Q,(function(e){l._attributeStore.isVisible(e)&&(z&&n("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),z=e)})),!z)return n("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var U=m.getGeometry(A.geometryInfo.geometryType,A.geometryInfo.hasZ,A.geometryInfo.hasM,z.geometry,0,o.unwrap(w)),J=r.__assign(r.__assign({},z.attributes),x.attributes);x.referenceId=z.localId,d.add(x.objectId),O.push(new _.Feature(J,x.localId,U))}else u&&(d.add(x.objectId),U=m.getGeometry(A.geometryInfo.geometryType,A.geometryInfo.hasZ,A.geometryInfo.hasM,x.geometry,0,o.unwrap(w)),O.push(new _.Feature(x.attributes,x.localId,U)))}},A=this,D=T;D<=M;D++)C(D);return{features:O,objectIds:d}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,i=this._getGeohashLevel(e),n=2*(Math.floor(i/2)+1)-1,s=this._tree;this._geohashLevel=n,o.isNone(s)||(n>r?(s.dropLevels(0),this._featuresById.forEach((function(e){e.geohashIndexed&&(t._setGeohash(e),s.insert(e,t._geohashLevel),e.geohashIndexed=!0)}))):n<r&&s.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,o.unwrap(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,o.unwrap(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){o.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=c.getInfo(t);if(!n)return{tile:i,left:null,right:null};var o=n.valid,s=o[0],a=o[1];return{tile:i,left:r.__assign(r.__assign({},i),{translate:[a,e.bounds[3]]}),right:r.__assign(r.__assign({},i),{translate:[s-a+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);if(this._clusters.has(i)){var n=this._clusters.get(i);o.isSome(n)?n.canDelete=!0:this._clusters.delete(i)}},t.prototype._getClusterBounds=function(e,t,r){if(o.isNone(this._featureReduction))return null;var i=this._featureReduction.clusterRadius,n=2*i,s=r%2?t*n:t*n+i,a=r*n,u=s/b.TILE_SIZE,l=a/b.TILE_SIZE,c=(s+n)/b.TILE_SIZE,p=(a-n)/b.TILE_SIZE;return[e.getXForColumn(u),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(p)]},t.prototype._lookupCluster=function(e,t,n,s,a){var u,c;if(o.isNone(this._featureReduction)||o.isNone(this._tree))return null;var d=this._getClusterId(t,n,s),h=this._clusters.get(d);if(h&&o.isSome(h)&&!h.invalid&&!h.canDelete)return h;var f=this._getClusterBounds(e,n,s),_=f[0],m=f[1],v=f[2],g=f[3],b={x:_,y:m},x={x:v,y:g},w=0,I=0,F=0,T=0;if(this._spatialReference.isWebMercator)w=(u=p.xyToLngLat(b.x,b.y))[0],I=u[1],F=(c=p.xyToLngLat(x.x,x.y))[0],T=c[1];else{var E=y.project(b,this._spatialReference,i.SpatialReference.WGS84),M=y.project(x,this._spatialReference,i.SpatialReference.WGS84);if(!E||!M)return null;w=E.x,I=E.y,F=M.x,T=M.y}w>F&&(F=180);var O={geohashX:0,geohashY:0},R={geohashX:0,geohashY:0};l.setGeohashXY(O,I,w,a),l.setGeohashXY(R,T,F,a);var j=O.geohashX,C=O.geohashY,A=R.geohashX,D=R.geohashY,P={xLL:j,yLL:C,xTR:A,yTR:D,level:a},k=this._tree.getRegionStatistics(j,C,A,D,a),N=k.count,G=k.xTotal,B=k.yTotal,L=N?G/N:0,q=N?B/N:0;if(o.isSome(h)&&h.canDelete){var V=this._attributeStore.removeLocalId(h.objectId);this._deferredDeletionQueue.push(V)}var Q=o.isSome(h)&&!h.canDelete&&h.invalid,z=r.__assign({cluster_count:N},k.attributes),U=this._attributeStore,J=Q?h.update(L,q,t,z,P):S.create(U,d,L,q,t,z,P);return 0===N&&(J.geometry.coords[0]=(_+v)/2,J.geometry.coords[1]=(m+g)/2),this._attributeStore.setAttributeData(J.localId,J,this.geometryInfo,null),this._clusters.set(d,J),this._updateAggregateValueRangeForCluster(J,J.tileLevel),J},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,n=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(b.TILE_SIZE/r),n=e.key,o=n.row,s=n.col*b.TILE_SIZE,a=o*b.TILE_SIZE,u=Math.floor(s/r),l=Math.floor(a/r),c=u;c<u+i;c++)for(var p=l;p<l+i;p++)this._markForDeletion(e.key.level,c,p)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},o=y.project(r,this._spatialReference,i.SpatialReference.WGS84);o?l.setGeohashXY(e,o.y,o.x,12):n("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),o.isSome(this._featureReduction)&&o.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return o.isSome(this._featureReduction)&&o.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(f.default);t.ClusterStore=F}.apply(null,i))||(e.exports=n)},1701:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1486),r(2),r(1568)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new s(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var n=this._pool.dequeue();return this._nodes++,i.isSome(n)?n.realloc(e,t,r):new s(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var n=r.children[i];r.children[i]=null,n&&t._release(n)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,n=0,o=0,s=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,this._updateStatistics(e,i,1)),n>=t)return;var a=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),l=1-n%2,c=30-(3*a+2*u),p=30-(2*a+3*u),d=7*l+3*(1-l)<<c,h=3*l+7*(1-l)<<p,f=8*l+4*(1-l),y=(e.geohashX&d)>>c,_=(e.geohashY&h)>>p,m=y+_*f;o=o<<3*l+2*(1-l)|y,s=s<<2*l+3*(1-l)|_,null==i.children[m]&&(i.children[m]=this._acquire(o,s,n+1)),n+=1,i=i.children[m]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var n=Math.ceil((i+1)/2),o=Math.floor((i+1)/2),s=1-i%2,a=30-(3*n+2*o),u=30-(2*n+3*o),l=7*s+3*(1-s)<<a,c=3*s+7*(1-s)<<u,p=8*s+4*(1-s),d=((e.geohashX&l)>>a)+((e.geohashY&c)>>u)*p,h=r.children[d];1===h.count&&(this._release(h),r.children[d]=null),i+=1,r=h}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,n){for(var o=this._root;null!==o;){var s=o.depth,a=o.xNode,u=o.yNode,l=1-s%2,c=o.xGeohashTotal/o.count,p=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=r&&t<p&&p<=i)return o;if(s>=n)o=o.next;else{for(var d=Math.ceil((s+1)/2),h=Math.floor((s+1)/2),f=30-(3*d+2*h),y=30-(2*d+3*h),_=~((1<<f)-1),m=~((1<<y)-1),v=(e&_)>>f,g=(t&m)>>y,b=(r&_)>>f,x=(i&m)>>y,w=a<<3*l+2*(1-l),I=u<<2*l+3*(1-l),S=w+8*l+4*(1-l),F=I+4*l+8*(1-l),T=Math.max(w,v),E=Math.max(I,g),M=Math.min(S,b),O=Math.min(F,x),R=null,j=null,C=E;C<=O;C++)for(var A=T;A<=M;A++){var D=A-w+(C-I)*(8*l+4*(1-l)),P=o.children[D];P&&(R||((R=P).next=o.next),j&&(j.next=P),j=P,P.next=o.next)}o=R||o.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,n){for(var o=this._root,s=0,a=0,u=0,l={};null!==o;){var c=o.depth,p=o.xNode,d=o.yNode;if(c>=n){var h=o.xGeohashTotal/o.count,f=o.yGeohashTotal/o.count;e<h&&h<=r&&t<f&&f<=i&&(s+=o.count,a+=o.xTotal,u+=o.yTotal,this._aggregateStatistics(l,o.statistics)),o=o.next}else{for(var y=Math.ceil((c+1)/2),_=Math.floor((c+1)/2),m=1-c%2,v=30-(3*y+2*_),g=30-(2*y+3*_),b=~((1<<v)-1),x=~((1<<g)-1),w=(e&b)>>v,I=(t&x)>>g,S=(r&b)>>v,F=(i&x)>>g,T=p<<3*m+2*(1-m),E=d<<2*m+3*(1-m),M=T+8*m+4*(1-m),O=E+4*m+8*(1-m),R=Math.max(T,w),j=Math.max(E,I),C=Math.min(M,S),A=Math.min(O,F),D=null,P=null,k=j;k<=A;k++)for(var N=R;N<=C;N++){var G=N-T+(k-E)*(8*m+4*(1-m)),B=o.children[G];if(B){if(k!==j&&k!==A&&N!==R&&N!==C){h=B.xGeohashTotal/B.count,f=B.yGeohashTotal/B.count,e<h&&h<=r&&t<f&&f<=i&&(s+=B.count,a+=B.xTotal,u+=B.yTotal,this._aggregateStatistics(l,B.statistics));continue}D||((D=B).next=o.next),P&&(P.next=B),P=B,B.next=o.next}}o=D||o.next}}return{count:s,attributes:this._normalizeStatistics(l,s),xTotal:a,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var n=e.children[i];n&&(t||((t=n).next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name,a=o.outStatistic.onStatisticField,u=e.attributes[a];switch(o.outStatistic.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var l=o.outStatistic.onStatisticNormalizationField,c=e.attributes[l],p=t.statistics[s].onStatisticField||0,d=t.statistics[s].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[s].onStatisticField=p+r*u,t.statistics[s].onStatisticNormalizationField=d+r*c);break;case"sum":case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var h=t.statistics[s].value,f=t.statistics[s].nanCount;null==u||isNaN(u)?t.statistics[s].nanCount=f+r:t.statistics[s].value=h+r*u;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var y=t.statistics[s].x,_=t.statistics[s].y,m=(f=t.statistics[s].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[s].nanCount=f+r:(t.statistics[s].x=y+r*Math.cos(u*m),t.statistics[s].y=_+r*Math.sin(u*m));break;case"mode":t.statistics[s]||(t.statistics[s]={}),h=t.statistics[s][u]||0,t.statistics[s][u]=h+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var n=i[r],o=n.name;switch(n.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[o]||(e[o]={}),t[o]){var a=e[o][s]||0;e[o][s]=a+t[o][s]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,n=this._fields;i<n.length;i++){var o=n[i],s=o.name;switch(o.outStatistic.statisticType){case"norm":var a=e[s];if(t&&null==a.onStatisticNormalizationField)break;if(t&&a.onStatisticNormalizationField){r[s]=a.onStatisticField/a.onStatisticNormalizationField;break}r[s]=0;break;case"sum":if(!t)break;var u=e[s],l=u.value;if(!(t-(p=u.nanCount)))break;r[s]=l;break;case"avg":if(!t)break;var c=e[s];if(l=c.value,!(t-(p=c.nanCount)))break;r[s]=l/(t-p);break;case"avg_angle":if(!t)break;var p,d=e[s],h=d.x,f=d.y;if(!(t-(p=d.nanCount)))break;var y=h/(t-p),_=f/(t-p),m=180/Math.PI,v=Math.atan2(_,y)*m;r[s]=v;break;case"mode":var g=e[s],b=0,x=null;for(var w in g){var I=g[w];I>b&&(b=I,x=w)}r[s]="null"===x?null:x}}return r},e}();t.GeohashTree=o;var s=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),o=30-(2*t+3*r),s=this.xNode<<i,a=this.yNode<<o;return n.decodeGeohashXY({geohashX:s,geohashY:a},this.depth)},e.prototype.find=function(e,t,r,i,n,o){if(i>=r)return this;var s=1-i%2,a=3*s+2*(1-s),u=2*s+3*(1-s),l=30-n-a,c=30-o-u,p=((e&7*s+3*(1-s)<<l)>>l)+((t&3*s+7*(1-s)<<c)>>c)*(8*s+4*(1-s)),d=this.children[p];return null==d?null:d.find(e,t,r,i+1,n+a,o+u)},e}()}.apply(null,i))||(e.exports=n)},1702:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(4),r(15),r(324),r(675),r(677),r(1467)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0});var l={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o,s,a,u,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(o=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(m,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(m,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=o;u<l.length;u++)c=l[u],a.push(y(c,s));return[4,i.all(a)];case 1:return p=r.sent(),[2,n.pt2px(p.reduce(m,0))]}}))}))};var c=[0,0,0,0];function p(e,t){return null==e?t:e}function d(e,t){return null==e.outline?t:p(e.outline.width,t)}var h={sdf:!0,code:99,metrics:a.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new o.default(0,0,24,24),page:0,textureBinding:2};function f(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o,a,l,y,m,v,g,b,x,w,I,S;return r.__generator(this,(function(F){switch(F.label){case 0:return"simple-marker"===e.type?(i=Math.max(p(e.size,12),t),[2,_(e)+.707*i]):"picture-marker"===e.type?(n=Math.max(p(e.height,12),t),o=p(e.width,12)*(n/p(e.height,12)),a=o/2,l=n/2,[2,_(e)+Math.sqrt(a*a+l*l)]):"text"===e.type?(y=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[h]};for(var i=[],n=0;n<t;n++)i.push(r.__assign(r.__assign({},h),{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:i}}(e),u.getTextSymbolSize(c,e,y),m=Math.abs(c[0]),v=Math.abs(c[1]),g=c[2],b=c[3],[2,Math.max(m,v)+Math.max(g,b)]):"simple-line"===e.type?(x=e,w=Math.max(p(x.width,.75),t)/2,x.marker?[2,Math.max(6*x.width,2*t)]:[2,w]):"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(d(e,0),t)/2]:"cim"===e.type?(I=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(I.width*I.width+I.height*I.height)]:[2,0]:"web-style"!==e.type?[3,2]:(S=f,[4,e.fetchCIMSymbol()]);case 1:return[2,S.apply(void 0,[F.sent(),t])];case 2:return[2,0]}}))}))}function y(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return function(e){return e.type in l}(e)?(n=(i=Math).min,[4,f(e,t)]):[2,0];case 1:return[2,n.apply(i,[r.sent(),75])]}}))}))}function _(e){var t=p(e.xoffset,0),r=p(e.yoffset,0);return Math.sqrt(t*t+r*r)}function m(e,t){return Math.max(e,t)}}.apply(null,i))||(e.exports=n)},1703:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1486),r(12),r(2)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_STREAM_ID_FIELD="__esri_stream_id__";var o=function(){function e(e,r,i,n,o){void 0===o&&(o=128),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=Date.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=n,this.store=e,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===t.DEFAULT_STREAM_ID_FIELD}return e.prototype.add=function(e){if(this._useGeneratedIds&&(e.attributes[this.objectIdField]=this._nextId()),e.objectId=e.attributes[this.objectIdField],this.store.add(e),this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),this._timeInfo.trackIdField){var t=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(t)){var o=n.isSome(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,s=i.clamp(o,0,1e3);this._trackIdToObservations.set(t,new r.default(s))}var a=this._trackIdToObservations.get(t),u=e.attributes[this.objectIdField],l=a.enqueue(u);if(n.isSome(l)){var c=this.store.removeById(l);n.isSome(c)&&(this._addOrUpdated.has(l)?this._addOrUpdated.delete(l):this._removed.push(c))}}},e.prototype.checkForUpdates=function(){var e=this._getToAdd(),t=this._getToRemove(),r=Date.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(),this._lastPurge=r),(e||t)&&this.store.update(e,t)},e.prototype._getToAdd=function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e},e.prototype._getToRemove=function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null},e.prototype._nextId=function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e},e.prototype._purge=function(){var e=this._purgeOptions;n.isSome(e)&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeTracks())},e.prototype._purgeSomeByDisplayCount=function(e){var t=this;if(e.displayCount){var r=this.store.size;r>e.displayCount&&this._trackIdToObservations.forEach((function(i){if(r>e.displayCount&&i.size){var o=t.store.removeById(n.unwrap(i.dequeue()));n.isSome(o)&&t._removed.push(o),r--}}))}},e.prototype._purgeByAge=function(e){var t=this;if(e.age){var r=60*e.age*1e3,i=this._maxAge-r,n=this._timeInfo.startTimeField;this.store.forEach((function(e){e.attributes[n]<i&&(t.store.removeById(e.objectId),t._removed.push(e))}))}},e.prototype._purgeTracks=function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))},e}();t.default=o}.apply(null,i))||(e.exports=n)},1704:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(33),r(11),r(5),r(2),r(4),r(1),r(1321),r(1705),r(432),r(423),r(304)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var y,_=s.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection");!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(y=t.ReadyState||(t.ReadyState={}));var m=function(e){function t(t,r,i,n,o,s,a,u){void 0===s&&(s=5),void 0===a&&(a=3);var l=e.call(this)||this;return l._destroyed=!1,l.errorString=null,l._source=t,l._sourceSpatialReference=r,l._spatialReference=i,l._filter=o,l._outFields=u,l._maxQueryDepth=s,l._maxRecordCountFactor=a,l._featureZScaler=h.getGeometryZScaler(n,r,i),l._open(),l}return r.__extends(t,e),t.prototype._open=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchServiceDefinition(this._source)];case 1:return(e=r.sent()).timeInfo.trackIdField||_.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect."),[4,this._fetchWebSocketUrl(e.streamUrls,this._spatialReference)];case 2:return t=r.sent(),this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),[4,this._buddyServicesQuery];case 3:return r.sent(),[4,this._tryCreateWebSocket(t)];case 4:return r.sent(),i=this._filter,n=this._outFields,this._destroyed||this._setFilter(i,n),[2]}}))}))},t.prototype.destroy=function(){this._destroyed=!0,a.isSome(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null},Object.defineProperty(t.prototype,"connectionStatus",{get:function(){if(a.isNone(this._websocket))return"disconnected";switch(this._websocket.readyState){case y.CONNECTING:case y.OPEN:return"connected";case y.CLOSING:case y.CLOSED:return"disconnected"}},enumerable:!0,configurable:!0}),t.prototype._tryCreateWebSocket=function(e,t){return void 0===t&&(t=1e3),r.__awaiter(this,void 0,void 0,(function(){var i,n,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,4]),this._destroyed?[2]:(i=this,[4,this._createWebSocket(e)]);case 1:return i._websocket=r.sent(),this.notifyChange("connectionStatus"),[3,4];case 2:return n=r.sent(),s=t/1e3,_.error(new o("geoevent-connection","Failed to connect. Attempting to reconnect in "+s+"s",n)),[4,u.after(t)];case 3:return r.sent(),[2,this._tryCreateWebSocket(e,1.5*t)];case 4:return[2]}}))}))},t.prototype._createWebSocket=function(e){var t=this,r=new WebSocket(e),i=u.create((function(e,t){r.onopen=function(){return e(r)},r.onclose=function(e){return t(e)}}));return i.then((function(){if(t._destroyed)return r.onclose=function(){},void r.close();r.onclose=function(e){return t._onClose(e)},r.onerror=function(e){return t._onError(e)},r.onmessage=function(e){return t._onMessage(e)}})),i},t.prototype._onMessage=function(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void _.error(new o("geoevent-connection","Failed to parse message",e))}this.onFeature(t)},t.prototype._onError=function(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),_.error("geoevent-connection",t)},t.prototype._onClose=function(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&_.error("geoevent-connection","WebSocket closed unexpectedly with error code "+e.code),this._destroyed||this._open()},t.prototype._fetchServiceDefinition=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n(e,{query:{f:"json"},responseType:"json"})];case 1:return t=r.sent(),i=t.data,this._serviceDefinition=i,[2,i]}}))}))},t.prototype._fetchWebSocketUrl=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o;return r.__generator(this,(function(r){return i=e[0],n=i.urls,o=i.token,[2,this._inferWebSocketBaseUrl(n)+"/subscribe?outSR="+t.wkid+(o?"&token="+o:"")]}))}))},t.prototype._inferWebSocketBaseUrl=function(e){if(1===e.length)return e[0];for(var t=0,r=e;t<r.length;t++){var i=r[t];if(-1!==i.indexOf("wss"))return i}return _.error(new o("geoevent-connection","Unable to infer WebSocket url",e)),null},t.prototype._setFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,l,c,p,d=this;return r.__generator(this,(function(r){return i=this._websocket,this._filter=e,this._outFields=t,a.isNone(i)||a.isNone(e)&&a.isNone(t)?[2]:(n=JSON.stringify({filter:this._serializeFilter(e,t)}),s=!1,l=u.createResolver(),c=function(){s||(d._destroyed||d._websocket!==i||_.error(new o("geoevent-connection","Server timed out when setting filter")),l.reject())},p=function(e){var t=JSON.parse(e.data);t.filter&&(t.error&&(_.error(new o("geoevent-connection","Failed to set service filter",t.error)),d._set("errorString","Could not set service filter - "+t.error),l.reject(t.error)),i.onmessage=d._onMessage.bind(d),s=!0,l.resolve())},i.onmessage=p,i.send(n),setTimeout(c,1e4),[2,l.promise])}))}))},t.prototype._serializeFilter=function(e,t){var r={};if(a.isNone(e)&&a.isNone(t))return r;if(a.isSome(e)&&e.geometry)try{var n=i.fromJSON(e.geometry);if("extent"!==n.type)throw new o("Expected extent but found type "+n.type);r.geometry=JSON.stringify(n.shiftCentralMeridian())}catch(e){_.error(new o("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return a.isSome(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),a.isSome(t)&&(r.outFields=t.join(",")),r},t.prototype._enrich=function(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return _.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var i=this._relatedFeatures.get(r),n=i.attributes,s=i.geometry;for(var a in n)e.attributes[a]=n[a];return s&&(e.geometry=s),e.geometry||e.centroid||_.error(new o("geoevent-connection","Found malformed feature - no geometry found",e)),e},t.prototype._queryBuddyServices=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s,a,u,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=this._serviceDefinition,t=e.relatedFeatures,i=e.keepLatestArchive,n=this._queryRelatedFeatures(t),s=this._queryArchive(i),[4,n];case 1:return r.sent(),[4,s];case 2:if(!(a=r.sent()))return[2];for(u=0,l=a.features;u<l.length;u++)c=l[u],this.onFeature(this._enrich(c));return[3,4];case 3:return p=r.sent(),_.error(new o("geoevent-connection","Encountered an error when querying buddy services",{error:p})),[3,4];case 4:return[2]}}))}))},t.prototype._queryRelatedFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return e?[4,this._queryBuddy(e.featuresUrl)]:[2];case 1:return t=r.sent(),this._addRelatedFeatures(t),[2]}}))}))},t.prototype._queryArchive=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return e?[2,this._queryBuddy(e.featuresUrl)]:[2,void 0]}))}))},t.prototype._queryBuddy=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,o,s,u,l,p,h,y;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,(t=new c({url:e})).load()];case 1:return i=r.sent().capabilities,n=i.query.supportsMaxRecordCountFactor,o=i.query.supportsPagination,s=i.query.supportsCentroid,u=this._maxRecordCountFactor,l=t.capabilities.query.maxRecordCount,p=n?l*u:l,(h=new f).outFields=a.unwrapOr(this._outFields,["*"]),h.where=a.unwrapOr(a.get(this._filter,"where"),"1=1"),h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=this._spatialReference,s&&(h.returnCentroid=!0),n&&(h.maxRecordCountFactor=u),o?(h.num=p,t.destroy(),[2,this._queryPages(e,h)]):[4,d.executeQuery(e,h,this._sourceSpatialReference)];case 2:return y=r.sent(),t.destroy(),[2,y.data]}}))}))},t.prototype._queryPages=function(e,t,i,n){return void 0===i&&(i=[]),void 0===n&&(n=0),r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return t.start=n*t.num,[4,d.executeQuery(e,t,this._sourceSpatialReference)];case 1:return(o=r.sent().data).exceededTransferLimit&&n<this._maxQueryDepth?(o.features.forEach((function(e){return i.push(e)})),[2,this._queryPages(e,t,i,n+1)]):(i.forEach((function(e){return o.features.push(e)})),[2,o])}}))}))},t.prototype._addRelatedFeatures=function(e){for(var t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField,n=0,o=r;n<o.length;n++){var s=o[n],a=s.attributes[i];t.set(a,s)}this._relatedFeatures=t},r.__decorate([l.property()],t.prototype,"connectionStatus",null),r.__decorate([l.property()],t.prototype,"errorString",void 0),r.__decorate([l.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t)}(p.default);t.default=m}.apply(null,i))||(e.exports=n)},1705:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(38),r(145),r(1)],void 0===(n=function(e,t,r,i,n,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.onFeature=function(e){this.emit("feature",e)},r.__decorate([o.subclass("esri.layers.graphics.sources.connections.StreamConnection")],t)}(i.EventedMixin(n.HandleOwner));t.default=s}.apply(null,i))||(e.exports=n)},2129:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(25),r(67),r(2),r(4),r(1),r(412),r(1433),r(1427),r(1703),r(1704),r(1699),r(2130)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,c,p,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0});var _=function(){function e(e,t){this.store=e,this.onUpdate=t}return e.prototype.add=function(e){this.store.add(e)},e.prototype.forEach=function(e){this.store.forEach(e)},e.prototype.removeById=function(e){return this.store.removeById(e)},e.prototype.update=function(e,t){this.onUpdate(e,t)},Object.defineProperty(e.prototype,"size",{get:function(){return this.store.numFeatures},enumerable:!0,configurable:!0}),e}(),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="stream",t._tileDispatchMap=new Map,t._updateIntervalId=0,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.service,r=t.source,i=t.objectIdField,n=t.timeInfo,o=t.purgeOptions,s=t.serviceFilter,a=t.geometryType,u=t.spatialReference;this.connection=new h.default(r,u,this.spatialReference,a,s),this._set("store",new p.default(this.geometryInfo)),this._set("streamFeatureManager",new d.default(new _(this.store,(function(t,r){return e._onUpdate(t,r)})),i,n,o)),this.connection.on("feature",(function(t){return e._onFeature(t)})),["connectionStatus","errorString"].forEach((function(t){e.watch("connection."+t,(function(r){return e.remoteClient.invoke("setProperty",{propertyName:t,value:r})}))})),this._updateIntervalId=setInterval((function(){return e.streamFeatureManager.checkForUpdates()}),64),this._shouldPushDataReceived=this.service.enableDataReceived},t.prototype.destroy=function(){clearInterval(this._updateIntervalId),this.connection.destroy(),this.queryEngine.destroy(),this._tileDispatchMap.forEach((function(e){return e.destroy()}))},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.store)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._tempQueryEngine&&!!this._tempQueryEngine.featureStore.numFeatures||this._anyUpdatesQueued()},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),JSON.stringify(this.service.serviceFilter),t=this.renderer.getAttributeHash(),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return r.sent(),JSON.stringify(this.service.serviceFilter),"heatmap"===this.renderer.type?[2]:t===this.renderer.getAttributeHash()?[3,3]:(i=this.queryEngine.featureStore,[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]);case 2:r.sent(),i.forEach((function(e){return n.attributeStore.setAttributeData(e.localId,e,n.geometryInfo,n.viewParams)})),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.attributeStore.sendUpdates()];case 5:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){this._repushActiveTiles()},t.prototype.onEdits=function(){},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryLatestObservations=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(!this.service.timeInfo.trackIdField)throw new i("mapview-no-trackIdField","queryLatestObservation can only be used with services that define a TrackIdField");return[2,this.queryEngine.executeQueryForLatestObservations(e)]}))}))},t.prototype.queryStatistics=function(){throw new i("Method not implemented.")},t.prototype.refresh=function(){},t.prototype.setViewState=function(t){var r=this,i=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),i!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.queryEngine.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){var t=this,r=e.added;e.removed.forEach((function(e){return t._handleTileRemove(e)})),r.forEach((function(e){return t._handleTileAdd(e)}))},t.prototype.enableEvent=function(e){"data-received"===e.name&&(this._shouldPushDataReceived=e.value)},t.prototype._onFeature=function(e){this._shouldPushDataReceived&&this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}});try{var t=this.geometryInfo,r=t.geometryType,i=t.hasM,o=t.hasZ,s=l.convertFromFeature(e,r,o,i,this.service.objectIdField);this.streamFeatureManager.add(s)}catch(e){n("esri-2d-debug")&&console.debug(e)}},t.prototype._createStoreWithFeatures=function(e){if(s.isNone(e))return null;var t=this._createFeatureStore();return t.addMany(e),t},t.prototype._onUpdate=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return s.isSome(e)&&e.forEach((function(e){return o.onFeatureAdd(e)})),i=this._createStoreWithFeatures(e),n=this._createStoreWithFeatures(t),this.attributeStore.sendUpdates(),this.processor.supportsTileUpdates?[4,this._updateActiveTiles(i,n)]:[3,2];case 1:return r.sent(),[3,3];case 2:this._repushActiveTiles(),r.label=3;case 3:return s.isSome(t)&&t.forEach((function(e){return o.onFeatureRemove(e)})),[2]}}))}))},t.prototype._handleTileAdd=function(e){if(this._tileDispatchMap.has(e.id))(t=this._tileDispatchMap.get(e.id)).up();else{var t=new y.default;this._tileDispatchMap.set(e.id,t)}this._queryTileFeatures(e,!0,this.queryEngine)},t.prototype._handleTileRemove=function(e){var t=this._tileDispatchMap.get(e.id);t&&(t.destroy(),this._tileDispatchMap.delete(e.id))},t.prototype._anyUpdatesQueued=function(){return o.valuesOfMap(this._tileDispatchMap).some((function(e){return e.hasAction()}))},t.prototype._updateActiveTiles=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return i=s.applySome(e,(function(e){return o._createQueryEngine(e)})),n=s.applySome(t,(function(e){return o._createQueryEngine(e)})),[4,a.all(this.tileStore.tiles.map((function(e){return o._queryTileFeatures(e,!1,i,n)})))];case 1:return r.sent(),[2]}}))}))},t.prototype._repushActiveTiles=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._queryTileFeatures(r,!0,this.queryEngine)}},t.prototype._queryTileFeatures=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var o,u,l,p,d,h,f,y,_,m,v,g,b=this;return r.__generator(this,(function(x){switch(x.label){case 0:return o={hasZ:!1,hasM:!1,transform:{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}},u=this.queryInfo,l=u.returnCentroid,p=u.returnGeometry,d=this._pixelBuffer,h={returnCentroid:l,returnGeometry:p,pixelBuffer:d,returnOutline:this.returnOutline},this._tileDispatchMap.has(e.id)?(f=this._tileDispatchMap.get(e.id),[4,s.applySome(i,(function(t){return t.featureStore.executeTileQuery(e,b.spatialReference,h)}))]):[2];case 1:return y=x.sent(),_=s.mapOr(y,[],(function(e){return e.features})),m=s.mapOr(n,[],(function(t){return c.executeTileQueryForIds(t,e,h)})).map((function(e){return b.attributeStore.getLocalId(e)})),v=a.createResolver(),g=function(i){return r.__awaiter(b,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.processor.onTileData(e,{addOrUpdate:_,remove:m,clear:t,transformParams:o},{signal:i})];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),a.throwIfNotAbortError(n),[3,3];case 3:return v.resolve(),[2]}}))}))},f.enqueue(g),[2,v.promise]}}))}))},r.__decorate([u.property()],t.prototype,"connection",void 0),r.__decorate([u.property()],t.prototype,"service",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"store",void 0),r.__decorate([u.property({readOnly:!0})],t.prototype,"streamFeatureManager",void 0),r.__decorate([u.property({readOnly:!0,dependsOn:["store","service","config"]})],t.prototype,"queryEngine",null),r.__decorate([u.property()],t.prototype,"updating",null),r.__decorate([u.subclass("esri.views.2d.layers.features.controllers.StreamController")],t)}(f.default);t.default=m}.apply(null,i))||(e.exports=n)},2130:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(4)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._action=null,this._queue=[],this._abortController=i.createAbortController(),this._refs=1}return e.prototype.up=function(){this._refs++},e.prototype.down=function(){return this._refs--,0===this._refs},e.prototype.clear=function(){this._abortController.abort(),this._abortController=i.createAbortController()},e.prototype.destroy=function(){this._queue.length=0,this._action&&(this._action=null)},e.prototype.enqueue=function(e){this._action?this._queue.push(e):this._setAction(e)},e.prototype.flush=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n;return r.__generator(this,(function(r){return(e=this._action)?(t=this._abortController.signal,n=this._queue.reduce((function(e,r){return e.then((function(){return r(t)}))}),e).catch(i.throwIfNotAbortError),this._action=n.then(this._handleNext.bind(this)).catch(i.throwIfNotAbortError),this._queue.length=0,[2,n]):[2]}))}))},e.prototype.hasAction=function(){return!!this._action},e.prototype._setAction=function(e){var t=this._abortController.signal;this._action=e(t).then(this._handleNext.bind(this)).catch(i.throwIfNotAbortError)},e.prototype._handleNext=function(){this._queue.length?this._setAction(this._queue.shift()):this._action=null},e}();t.default=n}.apply(null,i))||(e.exports=n)}}]);