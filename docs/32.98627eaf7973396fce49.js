(function(){var e={"esri/layers/graphics/data/QueryEngine":1402,"esri/layers/support/PromiseQueue":1417,"esri/layers/graphics/data/FeatureStore":1427,"esri/layers/graphics/data/executeTileQuery":1433,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1442,"esri/layers/graphics/data/BoundsStore":1443,"esri/views/2d/layers/features/support/AttributeStore":1466,"esri/views/2d/layers/graphics/graphicsUtils":1467,"esri/layers/graphics/data/QueryEngineCapabilities":1468,"esri/layers/graphics/sources/support/clientSideDefaults":1470,"esri/layers/graphics/data/QueryEngineResult":1524,"esri/layers/graphics/data/AttributesBuilder":1525,"esri/geohash/geohashUtils":1568,"esri/layers/graphics/sources/geojson/geojson":1646,"esri/views/2d/layers/features/controllers/BaseController":1699,"esri/views/2d/layers/features/support/ClusterStore":1700,"esri/geohash/GeohashTree":1701,"esri/views/2d/layers/features/support/pixelBuffering":1702,"esri/views/2d/layers/features/controllers/OnDemandController":2122,"esri/layers/ogc/ogcFeatureUtils":2123,"esri/views/2d/layers/features/controllers/EditsQueue":2124,"esri/views/2d/layers/features/support/DataTile":2125,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2126,"esri/core/SetPool":2127,"esri/views/2d/layers/features/support/TileUpdateQueue":2128},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[32,6],{1402:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(8),r(2),r(315),r(4),r(92),r(71),r(37),r(34),r(240),r(29),r(76),r(1416),r(1397),r(1468),r(1524),r(1526),r(1469),r(1405),r(413),r(1417)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g,v,m,b,x,I,S){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t};var w=new Set,T=new a.MemCacheStorage(2e6),F=0,M=function(){function e(e){var t=this;this.capabilities={query:g.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new a.MemCache(F+++"$$",T)),this.fieldsIndex=new I(e.fields),e.scheduler&&e.task&&(this._frameQueue=new S.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=b.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),[3,9];case 8:if((s=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw s;return i=new v.default([],null,this),[3,9];case 9:return[2,i.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return[2,(i=r.sent()).size];case 8:if((s=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw s;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,a,o,u,h,d,f=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),s=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return x.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),(a=i.size)?(c.set(R,c.NEGATIVE_INFINITY),this.featureStore.forEachBounds(i.items,(function(e){return c.expand(R,e)}),E),o={xmin:R[0],ymin:R[1],xmax:R[3],ymax:R[4],spatialReference:x.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(R[2])&&isFinite(R[5])&&(o.zmin=R[2],o.zmax=R[5]),(u=_.project(o,i.spatialReference,s)).spatialReference=x.cleanFromGeometryEngine(s||this.spatialReference),u.xmax-u.xmin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.xmin-=h,u.xmax+=h),u.ymax-u.ymin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.ymin-=h,u.ymax+=h),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(h=l.getMetersPerUnitForSR(u.spatialReference),u.zmin-=h,u.zmax+=h),[2,{count:a,extent:u}]):[2,{count:a,extent:null}];case 8:if((d=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return u.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,a,o,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),s=i.items,a=new Set,[4,this._reschedule((function(){for(var e=0,t=s;e<t.length;e++){var r=t[e];a.add(i.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,a];case 9:if((o=r.sent())===x.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw o;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,s,a,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=n.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return x.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return s=r.sent(),[4,this._reschedule((function(){return s.executeObjectIdsQuery(t)}))];case 5:return s=r.sent(),[4,this._reschedule((function(){return s.executeTimeQuery(t)}))];case 6:return s=r.sent(),[4,this._reschedule((function(){return s.executeAttributesQuery(t)}))];case 7:return s=r.sent(),[4,this._reschedule((function(){return s.filterLatest()}))];case 8:return s=r.sent(),[3,10];case 9:if((a=r.sent())!==x.QUERY_ENGINE_EMPTY_RESULT)throw a;return s=new v.default([],null,this),[3,10];case 10:return[2,s.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new v.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,a,o,u,l,c,h,d,f,y,_,g,b,x,I,S,w,T=this;return r.__generator(this,(function(F){switch(F.label){case 0:if(t=e.geometry,i=e.outSR,n=e.spatialRel,a=p.isValid(i)&&!p.equals(this.spatialReference,i),(o=this._geometryQueryCache?a?JSON.stringify({geometry:t,spatialRelationship:n,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:n}):null)&&(u=this._geometryQueryCache.get(o),!s.isUndefined(u)))return[2,u];if(l=function(t){return r.__awaiter(T,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return a&&(e.returnGeometry||e.returnCentroid)?[4,t.project(i)]:[3,2];case 1:return n=r.sent(),o&&this._geometryQueryCache.put(o,n,n.size||1),[2,n];case 2:return o&&this._geometryQueryCache.put(o,t,t.size||1),[2,t]}}))}))},!t)return[2,l(this._getAll())];if(c=this.featureAdapter,"esriSpatialRelDisjoint"!==n)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,l(this._getAll())];for(y=new Set,_=0,g=h;_<g.length;_++)b=g[_],y.add(c.getObjectId(b));return[4,this._reschedule((function(){var e=0;d=new Array(y.size),T.featureStore.forEach((function(t){return d[e++]=t})),f=y}))];case 1:return F.sent(),[4,this._reschedule((function(){return r.__awaiter(T,void 0,void 0,(function(){var e,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),i=function(t){return!f.has(c.getObjectId(t))||e(c.getGeometry(t))},s=v.default.bind,[4,this._runSpatialFilter(d,i)];case 2:return[2,new(s.apply(v.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return I=F.sent(),[2,l(I)];case 3:return(x=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,l(new v.default(x,t,this))]:[4,m.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)]:(I=new v.default([],t,this),o&&this._geometryQueryCache.put(o,I,I.size||1),[2,I]);case 4:return S=F.sent(),[4,this._runSpatialFilter(x,(function(e){return S(c.getGeometry(e))}))];case 5:return w=F.sent(),[2,l(new v.default(w,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a=this;return r.__generator(this,(function(o){return t?this._budget?(i=0,n=new Array,s=function(){return r.__awaiter(a,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return i<e.length?(a=e[i],t(a)&&n.push(a),this._budget.done?[4,this._reschedule((function(){return s()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++i,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return s()})).then((function(){return n}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return m.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(m.canQueryWithRBush(e)){if(f.isExtent(e))return[h.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(f.isPolygon(e))return e.rings.map((function(e){return h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[d.getBoundsXY(h.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,(function(e){w.add(e)}))}var n=new Array(w.size),s=0;return w.forEach((function(e){return n[s++]=e})),w.clear(),n},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,o.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),m.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),_.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,s=e.outStatistics,a=s?s.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var o=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===a.indexOf(e)}));y.validateFields(this.fieldsIndex,o,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new i("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,a,o,u,l,c,h,d,f;return r.__generator(this,(function(r){if(t=e.outStatistics,n=e.groupByFieldsForStatistics,s=e.having,a=n&&n.length,o=t&&t.length,s){if(!a||!o)throw new i("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,s,t)}if(o){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),a&&y.validateFields(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),l=0,c=t;l<c.length;l++)if(h=c[l],d=h.onStatisticField,"percentile_disc"!==(f=h.statisticType)&&"percentile_cont"!==f||!("statisticParameters"in h)){if("count"!==f&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new i("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}else if(!h.statisticParameters)throw new i("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:h,query:e})}return[2]}))}))},e}();t.default=M;var E=c.create(),R=c.create()}.apply(null,i))||(e.exports=n)},1417:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,i){return t._tasks.push(new n(r,i,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,i){return t._tasks.unshift(new n(r,i,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._tasks;t<i.length;t++)i[t].reject(e);this._tasks.length=0},e}();t.default=i;var n=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,i))||(e.exports=n)},1427:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(38),r(5),r(2),r(37),r(34),r(76),r(412),r(1443),r(1433),r(1429)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f){Object.defineProperty(t,"__esModule",{value:!0});var p=s.getLogger("esri.layers.graphics.data.FeatureStore"),y=function(){function e(e){this.geometryInfo=e,this._boundsStore=new h.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new n,this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=u.create(u.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var i=e._boundsStore.get(r.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var s=n[i],a=this._boundsStore.get(s.objectId);a&&t(o.fromRect(r,a))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,c,h,f,p,y,_,g,v,m,b;return r.__generator(this,(function(r){return n=i.returnGeometry,s=i.returnCentroid,a=i.returnOutline,o=i.pixelBuffer,c=new Set,h=[],f=o*e.resolution,p=u.pad(e.bounds,f,u.create()),d.createTileFeatures(h,c,this.geometryInfo,this,p,n,s,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||s)&&(y=l.getInfo(t))&&(_=y.valid,g=_[0],v=_[1],p[0]<g&&(m=u.fromValues(v-f,p[1],v,p[3]),d.createTileFeatures(h,c,this.geometryInfo,this,m,n,s,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[v,e.bounds[3]]})),p[2]>v&&(b=u.fromValues(g,p[1],g+f,p[3]),d.createTileFeatures(h,c,this.geometryInfo,this,b,n,s,a,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g-v+e.bounds[0],e.bounds[3]]}))),h.sort((function(e,t){return e.localId-t.localId})),[2,{features:h,objectIds:c}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):a.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=c.getBoundsOptimizedGeometry(r||u.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else p.error(new i("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return a.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=y}.apply(null,i))||(e.exports=n)},1433:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(34),r(412),r(414),r(1402),r(1405)],void 0===(n=function(e,t,r,i,n,s,a){Object.defineProperty(t,"__esModule",{value:!0});var o=new n.default,u={esriGeometryPoint:i.convertToPoint,esriGeometryPolyline:i.convertToPolyline,esriGeometryPolygon:i.convertToPolygon,esriGeometryMultipoint:i.convertToMultipoint};t.executeTileQueryForIds=function(e,t,i){var n=i.pixelBuffer*t.resolution,s=r.pad(t.bounds,n,r.create()),a=[];return e.featureStore.forEachInBounds(s,(function(t){return a.push(e.featureAdapter.getObjectId(t))})),a},t.createTileFeatures=function(e,t,r,i,n,h,d,f,p){var y=u[r.geometryType],_=l[r.geometryType],g="esriGeometryPolygon"===r.geometryType&&!f,v=r.hasZ?r.hasM?4:3:r.hasM?3:2;d&&!h?i.forEachInBounds(n,(function(i){return function(e,t,r,i,n){if(!t.has(r.objectId)){var o=a.getCentroid(i,r,n),u=r.attributes;o&&(t.add(r.objectId),e.push(new s.Feature(u,r.localId,null,o)))}}(e,t,i,r,p)})):h&&!d?i.forEachInBounds(n,(function(r){return function(e,t,r,i,n,a,u,l){if(!t.has(r.objectId)){var h=r.attributes,d=i(c(o,r.geometry,n,a,l,u),!1,!1);d&&(t.add(r.objectId),e.push(new s.Feature(h,r.localId,d,null)))}}(e,t,r,y,v,_,p,g)})):i.forEachInBounds(n,(function(i){return function(e,t,r,i,n,u,l,h,d){if(!t.has(r.objectId)){var f=a.getCentroid(i,r,n),p=r.attributes,y=u(c(o,r.geometry,l,h,d,n),!1,!1);y&&f&&(t.add(r.objectId),e.push(new s.Feature(p,r.localId,y,f)))}}(e,t,i,r,p,y,v,_,g)}))};var l={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function c(e,t,r,n,s,a){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var o,u,l,c,h=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=i.quantizeX(a,h[0]),e.coords[1]=i.quantizeY(a,h[1]),e.coords.length=r,e;for(var f=0,p=0,y=p,_=0,g=d;_<g.length;_++){var v=g[_];if(!(v<n))if(p=y,l=o=i.quantizeX(a,h[f]),c=u=i.quantizeY(a,h[f+1]),e.coords[p]=l,e.coords[p+1]=c,f+=r,1!==v){var m=(l=i.quantizeX(a,h[f]))-o,b=(c=i.quantizeY(a,h[f+1]))-u,x=b/m;p+=2,e.coords[p]=m,e.coords[p+1]=b,o=l,u=c,f+=r;for(var I=2;I<v;I++){if(l=i.quantizeX(a,h[f]),c=i.quantizeY(a,h[f+1]),l!==o||c!==u){var S=l-o,w=c-u,T=w/S;x!==T&&(isFinite(x)||isFinite(T))||!(s||(b>=0&&w>=0||b<=0&&w<=0)&&(m>=0&&S>=0||m<=0&&S<=0))?(m=S,b=w,p+=2):(m+=S,b+=w),e.coords[p]=m,e.coords[p+1]=b,x=T,o=l,u=c}f+=r}var F=(p+2-y)/2;F>=n&&(e.lengths.push(F),y=p+2)}else e.lengths.push(1),y=p+2}return e.coords.length>y&&(e.coords.length=y),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=c}.apply(null,i))||(e.exports=n)},1442:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(15),r(675),r(677),r(246)],void 0===(n=function(e,t,r,i,n,s,a){Object.defineProperty(t,"__esModule",{value:!0});var o=n.enums.WGLVVFlag;function u(e){return{value:e.value,size:i.toPt(e.size)}}function l(e){return e.map((function(e){return u(e)}))}function c(e){if("string"==typeof e||"number"==typeof e)return i.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:l(t.stops)}}t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=u,t.normalizeSizeStops=l,t.normalizeSizeElement=c,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach((function(e){var r=e.type;e.field&&(t[r]=e.field)})),t};var h=function(e){for(var t=[],r=[],n=l(e),a=n.length,o=0;o<6;o++){var u=n[Math.min(o,a-1)];t.push(u.value),r.push(null==u.size?s.NAN_MAGIC_NUMBER:i.pt2px(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function d(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(n.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,i=0;i<8;++i){var s=r[Math.min(i,r.length-1)];t.values[i]=s.value,t.opacities[i]=s.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var a=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(i=0;i<8;i++)t.values[i]=1/0,t.opacities[i]=a}return t}t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,i=t?{}:null;if(!t)return{vvFields:t,vvRanges:i};for(var s=0,u=e;s<u.length;s++){var f=u[s],p=f.type;if(f.field&&(t[p]=f.field),"size"===p){i.size||(i.size={});var y=f;switch(n.getTypeOfSizeVisualVariable(y)){case o.SIZE_MINMAX_VALUE:i.size.minMaxValue={minDataValue:y.minDataValue,maxDataValue:y.maxDataValue,minSize:c(y.minSize),maxSize:c(y.maxSize)};break;case o.SIZE_SCALE_STOPS:i.size.scaleStops={stops:l(y.stops)};break;case o.SIZE_FIELD_STOPS:if(y.levels){var _={};for(var g in y.levels)_[g]=h(y.levels[g]);i.size.fieldStops={type:"level-dependent",levels:_}}else i.size.fieldStops=r.__assign({type:"static"},h(y.stops));break;case o.SIZE_UNIT_VALUE:i.size.unitValue={unit:y.valueUnit,valueRepresentation:y.valueRepresentation}}}else if("color"===p){var v=a.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});if(!v)continue;i.color=v.color;for(var m=0;m<32;m+=4)n.color.premultiplyAlpha(i.color.colors,m,!0)}else if("opacity"===p)i.opacity=d(f);else if("rotation"===p){var b=f;i.rotation={type:b.rotationType}}}return{vvFields:t,vvRanges:i}}}.apply(null,i))||(e.exports=n)},1443:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(25),r(1414),r(14)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},s=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,i){t[r++]=i})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=function(e,t){return n.minX=t[0],n.minY=t[1],n.maxX=t[2],n.maxY=t[3],e.search(n)}(this._index,e);r<i.length;r++){var s=i[r];t(this._idByBounds.get(s))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=s}.apply(null,i))||(e.exports=n)},1466:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(25),r(5),r(12),r(2),r(4),r(413),r(107),r(675),r(421),r(677),r(1442),r(14)],void 0===(n=function(e,t,i,n,s,a,o,u,l,c,h,d,f,p,y){Object.defineProperty(t,"__esModule",{value:!0});var _=a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=d.debug.createDebugLogger(d.debug.DEBUG_ATTR_UPDATES,_);t.LOCAL_ID_TYPE_AGGREGATE=1;var v=function(e){return(2147483648&e)>>>31},m=function(e){return 2147483647&e};t.isAggregateId=function(e){return v(e)===t.LOCAL_ID_TYPE_AGGREGATE};var b=function(e,t){return function(r,i,n){var s;try{s=t(r,i,n)}catch(e){s=NaN}return(null===s||isNaN(s)||s===1/0)&&e||s}},x={sharedArrayBuffer:s("esri-shared-array-buffer"),oesTextureFloat:s("esri-webgl-texture-float"),maxTextureSize:s("esri-webgl-max-texture-size"),atomics:s("esri-atomics")},I=function(){function e(e,t,r,i){this.texelSize=4;var n=i.pixelType,s=i.layout,a=i.textureOnly;this.textureOnly=a||!1,this.pixelType=n,this._ctype=t,this.layout=s,this._resetRange(),this._shared=e,a||(this.data=this._initData(n,r,e,t))}return Object.defineProperty(e.prototype,"buffer",{get:function(){return u.andThen(this.data,(function(e){return e.buffer}))},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){var r=m(e);return u.unwrap(this.data)[r*this.texelSize+t]},e.prototype.setData=function(e,t,r){var i=m(e),n=1<<t;0!=(this.layout&n)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):_.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.lock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1):s("esri-2d-debug")&&_.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.unlock=function(){5121===this.pixelType?this._shared&&x.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0):s("esri-2d-debug")&&_.error("AttributeStore-Bad-Type","Tried to unlock non integer array type with float array")},e.prototype.expand=function(e){if(!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=u.unwrap(this.data);t.set(r),this.data=t}},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,s=this.layout,a=u.unwrap(this.data);return a.slice?{start:e,end:t,data:i&&a.slice(e*r,(t+1)*r)||null,pixelType:n,layout:s}:i?{start:e,end:t,data:new(d.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:s}:{start:e,end:t,data:null,pixelType:n,layout:s}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,s=d.Utils.getPixelArrayCtor(e),a=new s(new n(t*t*4*s.BYTES_PER_ELEMENT)),o=0;o<a.length;o+=4)a[o+1]=255;return a},e.prototype._resetRange=function(){this.dirtyStart=2147483647,this.dirtyEnd=0},e}(),S=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(d.definitions.MAX_FILTERS),this._freeTexelsList=[],this._abortController=l.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=1,this._idsToHighlight=new Set;var t=x.oesTextureFloat?5126:5121;g("Creating AttributeStore "+(x.sharedArrayBuffer?"with":"without")+" shared memory"),s("esri-2d-debug")&&x.sharedArrayBuffer&&!x.atomics&&_.warn("Browser supports SharedArrayBuffer but not Atomics. Rendering may be impacted"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map((function(){return null}))}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.invalidateResources=function(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=l.createAbortController()},e.prototype.createLocalId=function(e,t){if(void 0===t&&(t=!1),!this._idMap.has(e)){var r=function(e,t){return((t?2147483648:0)|e)>>>0}(this._getFreeTexel(),t);this._idMap.set(e,-1===r?0:r),this._localToObjectId.set(r,e)}return this._idMap.get(e)},e.prototype.addLocalId=function(e){this._getBlock(0).setData(e,0,0),this._freeTexelsList.push(m(e))},e.prototype.removeLocalId=function(e){var t=this._idMap.get(e);return this._idMap.delete(e),this._localToObjectId.delete(t),t},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);s("esri-2d-debug")&&!t&&console.debug("Called freeLocalId for an invalid id"),this._getBlock(0).setData(t,0,0),this._idMap.delete(e),this._localToObjectId.delete(t),this._freeTexelsList.push(m(t))},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.setHighlight=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,s,a,o,u=this;return i.__generator(this,(function(i){switch(i.label){case 0:for(this._getBlock(0).lock(),this._idsToHighlight.forEach((function(e){var t=u.getLocalId(e);if(t){var r=u._getBlock(0).getData(t,0);u._getBlock(0).setData(t,0,-2&r)}})),this._idsToHighlight.clear(),t=0,r=e;t<r.length;t++)n=r[t],this._idsToHighlight.add(n);for(s=0;s<e.length;s++)null!=(a=this.getLocalId(e[s]))&&(o=this._getBlock(0).getData(a,0),this._getBlock(0).setData(a,0,1|o));return this._getBlock(0).unlock(),[4,this.sendUpdates()];case 1:return i.sent(),[2]}}))}))},e.prototype.addHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.removeHighlight=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2]}))}))},e.prototype.updateFilters=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,s,a,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,s=t.filters,a=s.map((function(t,i){return o._updateFilter(e,t,i,r,n)})),[4,l.all(a)];case 1:return i.sent(),[2]}}))}))},e.prototype.setAttributeBindings=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:_.error(new n("attribute-store","Found invalid renderer type: "+e))}return[2]}))}))},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.getData=function(e,t,r){return this._getBlock(t).getData(e,r)},e.prototype.getHighlightFlag=function(e){return this._idsToHighlight.has(e)?p.HIGHLIGHT_FLAG:0},e.prototype.setAttributeData=function(e,t,r,i){var n=this,s=e;this._getBlock(0).setData(s,0,this.getFilterFlags(t));var a=this._attributeComputeMap,u=x.oesTextureFloat?1:2;a.forEach((function(e,a){var l=a*u%4,c=Math.floor(a*u/4),h=n._getBlock(c+p.ATTRIBUTE_DATA_VV),f=e(t,{$view:i},r);if(x.oesTextureFloat)h.setData(s,l,f);else if(f===d.definitions.NAN_MAGIC_NUMBER)h.setData(s,l,255),h.setData(s,l+1,255);else{var y=o.clamp(Math.round(f),-32767,32766)+32768,_=255&y,g=(65280&y)>>8;h.setData(s,l,_),h.setData(s,l+1,g)}}))},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map((function(e){return u.isSome(e)?e.toMessage():null}))};return this._currUpdate=this._createResources().then((function(){var r=function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then((function(){return t.resolve()}))}},i=e._client.update(t,e._signal).then(r).catch(r);return e._client.render(),i})).catch((function(t){return l.isAbortError(t)?(e._createResourcesPromise=null,e._createResources()):(_.error(new n("mapview-attribute-store","Encountered an error during client update",t)),l.resolve())})),this._currUpdate},e.prototype._createResources=function(){var e=this;if(u.isSome(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(p.ATTRIBUTE_DATA_ANIMATION),g("Initializing AttributeStore");var t={shared:x.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:u.mapMany(this._blocks,(function(e){return{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}}))},r=this._client.initialize(t,this._signal).catch((function(t){l.isAbortError(t)?e._createResourcesPromise=null:_.error(new n("mapview-attribute-store","Encountered an error during client initialization",t))}));return this._createResourcesPromise=r,r.then((function(){return u.isNone(e._createResourcesPromise)?e._createResources():void 0})),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(u.isSome(t))return t;g("Initializing AttributeBlock at index "+e);var r=x.sharedArrayBuffer,i=this._client.type,n=new I(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<x.maxTextureSize){var e=this._size<<=1;return g("Expanding block size to",e,this._blocks),u.forEachSome(this._blocks,(function(t){return t.expand(e)})),this._createResourcesPromise=null,this._size=e,0}return _.error(new n("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeTexel=function(){return this._freeTexelsList.length?this._freeTexelsList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,r,n,s,a){return i.__awaiter(this,void 0,void 0,(function(){var o,l,c,h,d,f,p,y=this;return i.__generator(this,(function(i){switch(i.label){case 0:return o=this._filters[n],(u.isSome(o)&&o.hash)===JSON.stringify(r)?[2]:(l=1<<n+1,u.isNone(r)?(this._filters[n]=null,this._idMap.forEach((function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|l)})),[2]):[4,e.queryObjectIds(r)]);case 1:return c=i.sent(),r.hiddenIds&&r.hiddenIds.length&&(c=c.filter((function(e){return-1===r.hiddenIds.indexOf(e)}))),h=c.map((function(e){return y._idMap.get(e)})),[4,this._getFilter(n,s)];case 2:for(i.sent().update(r,a),this._getBlock(0).lock(),this._idMap.forEach((function(e){if(v(e)!==t.LOCAL_ID_TYPE_AGGREGATE){var r=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,r&~l)}})),d=0;d<h.length;d++)null!=(f=h[d])&&(p=this._getBlock(0).getData(f,0),this._getBlock(0).setData(f,0,p|l));return this._getBlock(0).unlock(),[2]}}))}))},e.prototype._getFilter=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var n,s,a;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this._filters[e],u.isSome(n)?[2,n]:[4,new Promise((function(e,t){Promise.all([r.e(2),r.e(3),r.e(112)]).then(function(){var t=[r(1597)];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return s=i.sent().default,a=new s({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=a,[2,a]}}))}))},e.prototype.isVisible=function(e){return!!(2&this._getBlock(0).getData(e.localId,0))},e.prototype.getFilterFlags=function(e){for(var r,i=0,n=(r=e.localId,v(r)===t.LOCAL_ID_TYPE_AGGREGATE?254:255),s=0;s<this._filters.length;s++){var a=!!(n&1<<s),o=this._filters[s];i|=(!a||u.isNone(o)||o.check(e)?1:0)<<s}var l=this.getFeatureId(e.localId);return i<<1|this.getHighlightFlag(l)},e.prototype._bindVVEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r=this;return i.__generator(this,(function(n){switch(n.label){case 0:return this._attributeComputeMap.clear(),u.isSome(e)?[4,l.all(e.map((function(e){return i.__awaiter(r,void 0,void 0,(function(){var r,n;return i.__generator(this,(function(i){switch(i.label){case 0:return r=d.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),u.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._bindDDEvaluators=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a=this;return i.__generator(this,(function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>d.definitions.DOT_DENSITY_MAX_FIELDS&&_.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+d.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,l.all(e.map((function(e){return a._createNormalizedFunction(e,t)})))];case 1:for(r=i.sent().map((function(e){return b(0,e)})),n=0;n<d.definitions.DOT_DENSITY_MAX_FIELDS;n++)(s=n<e.length&&r[n])?this._attributeComputeMap.set(n,s):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}}))}))},e.prototype._createGetValueFunction=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){var r,n,s,a,o,u,l;return i.__generator(this,(function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=d.getTypeOfSizeVisualVariable(e))===d.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===d.enums.WGLVVFlag.SIZE_UNIT_VALUE,s=n&&function(t){return y.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},a=b,o=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,s)]);case 1:return[2,a.apply(void 0,o.concat([i.sent()]))];case 2:return u=b,l=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}}))}))},e.prototype._createNormalizedFunction=function(e,t,r){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o;return i.__generator(this,(function(i){switch(i.label){case 0:return(s=e.field)?"string"==typeof s?(a=e.normalizationField)?[2,function(e){if(e.attributes[s]&&e.attributes[a]){var t=e.attributes[s]/e.attributes[a];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[s])}:function(e){return e.attributes[s]}]:(_.error(new n("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof s)),[2,function(){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,h.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return o=i.sent(),[2,f.callWithOptimizedFeature.bind(null,o)];case 2:return _.error("Unable to create a normalized function for visual variable: "+e),[2,function(){}]}}))}))},e}();t.default=S}.apply(null,i))||(e.exports=n)},1467:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(15),r(422),r(687),r(35),r(417),r(40),r(34),r(240),r(424),r(29),r(685),r(76),r(76),r(675),r(675)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g){Object.defineProperty(t,"__esModule",{value:!0});var v=Math.PI/180,m=s.mat2df32.create(),b=o.vec2f32.create(),x=l.create();t.getBounds=function(e,t,r,i,n,s,a){if(!i||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var o=i;if(!d.isPoint(o)){c.getBoundsXY(e,o);var u=t[0];0===u&&(u=function(e){var t=0;switch(e.symbol.type){case"simple-fill":case"picture-fill":var r=e.symbol.outline;if(!r)return 0;t=r.width;break;case"simple-line":t=e.symbol.width;break;case"simple-marker":t=e.symbol.size;break;case"picture-marker":t=Math.max(e.symbol.width,e.symbol.height);break;case"text":var i=[0,0,0,0];P(i,e.symbol,e.mosaicItem);var n=Math.max(Math.abs(i[0]),Math.abs(i[1]));t=Math.max(i[2],i[3])+n;break;case"cim":case"expanded-cim":var s=_.CIMSymbolHelper.getEnvelope(e.symbol.data);t=Math.sqrt(s.width*s.width+s.height*s.height)}return t}(r),t[0]=u);var l=n*u/2;return e[0]-=l,e[1]-=l,e[2]+=l,e[3]+=l,e}var h=o.x,p=o.y;return"text"===r.symbol.type&&0===t[2]&&0===t[3]&&P(t,r.symbol,r.mosaicItem),function(e,t,r,i,n,s,a,o){var u;switch(i.type){case"simple-marker":case"picture-marker":u=R(t,r,i,s,a,0);break;case"text":u=O(t,r,i,n,s,0);break;case"cim":case"expanded-cim":u=C(t,r,i,s,a,0)}for(var l,c,h=0,d=0;d<u.rings[0].length-1;d++)l=(t-(c=u.rings[0][d])[0])*(t-c[0])+(r-c[1])*(r-c[1]),h=Math.max(h,l);h=Math.sqrt(h);var p=f.normalizeMapX(t-h,o),_=f.normalizeMapX(t+h,o);if(p>_){var g=y.getInfo(o);if(g){var v=g.valid;p=v[0],_=v[1]}}e[0]=p,e[1]=r-h,e[2]=_,e[3]=r+h}(e,h,p,r.symbol,t,n,s,a),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.unwrap(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var I=o.vec2f32.create(),S=o.vec2f32.create(),w=o.vec2f32.create(),T=o.vec2f32.create(),F=o.vec2f32.create(),M=o.vec2f32.create(),E=o.vec2f32.create();function R(e,t,r,s,o,u){var l,c,h=i.pt2px(r.xoffset),d=i.pt2px(r.yoffset),f=v*r.angle,p=v*u;switch(r.type){case"simple-marker":var y=r;l=c=i.pt2px(y.size);break;case"picture-marker":var _=r;l=i.pt2px(_.width),c=i.pt2px(_.height)}o<.04&&(s=.04*s/o);var g=n.mat2d.identity(m);n.mat2d.translate(g,g,a.vec2.set(b,e,t)),n.mat2d.rotate(g,g,p-f),n.mat2d.scale(g,g,a.vec2.set(b,s,-s)),n.mat2d.translate(g,g,a.vec2.set(b,h,-d));var x=[0,0];a.vec2.transformMat2d(x,a.vec2.set(b,-.5*l,-.5*c),g);var I=[0,0];a.vec2.transformMat2d(I,a.vec2.set(b,-.5*l,.5*c),g);var S=[0,0];a.vec2.transformMat2d(S,a.vec2.set(b,.5*l,-.5*c),g);var w=[0,0];return a.vec2.transformMat2d(w,a.vec2.set(b,.5*l,.5*c),g),{rings:[[x,S,w,I,x]]}}function C(e,t,r,s,o,u){var l=_.CIMSymbolHelper.getEnvelope(r.data);if(!l)return null;o<.04&&(s=.04*s/o);var c=i.pt2px(l.width),h=i.pt2px(l.height),d=i.pt2px(l.x),f=i.pt2px(l.y),p=0*v,y=v*u,g=n.mat2d.identity(m);n.mat2d.translate(g,g,a.vec2.set(b,e,t)),n.mat2d.rotate(g,g,y-p),n.mat2d.scale(g,g,a.vec2.set(b,s,s));var x=[0,0];a.vec2.transformMat2d(x,a.vec2.set(b,d,f+h),g);var I=[0,0];a.vec2.transformMat2d(I,a.vec2.set(b,d,f),g);var S=[0,0];a.vec2.transformMat2d(S,a.vec2.set(b,d+c,f+h),g);var w=[0,0];return a.vec2.transformMat2d(w,a.vec2.set(b,d+c,f),g),{rings:[[x,S,w,I,x]]}}function O(e,t,r,s,o,u){var l=i.pt2px(r.xoffset),c=i.pt2px(r.yoffset),h=v*r.angle,d=v*u,f=n.mat2d.identity(m);n.mat2d.translate(f,f,a.vec2.set(b,e,t)),n.mat2d.rotate(f,f,d),n.mat2d.scale(f,f,a.vec2.set(b,o,-o));var p=s[0]+s[2]/2,y=s[1]+s[3]/2;n.mat2d.translate(f,f,a.vec2.set(b,l,-c)),n.mat2d.translate(f,f,a.vec2.set(b,p,y)),n.mat2d.rotate(f,f,h),n.mat2d.translate(f,f,a.vec2.set(b,-p,-y));var _=[0,0];a.vec2.transformMat2d(_,a.vec2.set(b,s[0],s[1]),f);var g=[0,0];a.vec2.transformMat2d(g,a.vec2.set(b,s[0],s[1]+s[3]),f);var x=[0,0];a.vec2.transformMat2d(x,a.vec2.set(b,s[0]+s[2],s[1]),f);var I=[0,0];return a.vec2.transformMat2d(I,a.vec2.set(b,s[0]+s[2],s[1]+s[3]),f),{rings:[[_,x,I,g,_]]}}function P(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=_.bidiText(t.text)[1],s=r.glyphMosaicItems,a=g.shapeGlyphs(s,n,{scale:i.pt2px(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:g.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),vAlign:g.alignmentUtils.getYAnchorDirection(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=a.x-a.halfWidth,e[1]=a.y-a.halfHeight,e[2]=a.width,e[3]=a.height,e}t.isPointOnPolyline=function(e,t,r,i){a.vec2.set(w,t,r);for(var n,s,o,u,l,c,h,d,f,p=e.paths,y=1/0,_=0;_<p.length;_++){var g=p[_];if(!(g.length<2))for(var v=1;v<g.length;v++)n=g[v-1][0],o=g[v-1][1],s=g[v][0],u=g[v][1],l=Math.min(n,s)-i,c=Math.min(o,u)-i,h=Math.max(n,s)+i,d=Math.max(o,u)+i,t<l||t>h||r<c||r>d||(a.vec2.set(I,n,o),a.vec2.set(S,s,u),a.vec2.subtract(T,S,I),a.vec2.subtract(F,I,w),a.vec2.scale(M,T,a.vec2.dot(T,F)/a.vec2.dot(T,T)),a.vec2.subtract(E,F,M),y>(f=a.vec2.dot(E,E))&&(y=f))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=R,t.getCIMMarkerBounds=C,t.getTextSymbolBounds=O,t.normalizeCentralMeridian=function(e){var t,r,i,n,s,a,o,u,l,f=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,!(r=p.getInfo(t)))return e.toJSON();i=t.isWebMercator,n=j[a=i?102100:4326].maxX,s=j[a].minX,o=j[a].plus180Line,u=j[a].minus180Line;var y=e.toJSON();if(d.isPoint(y))l=N(y,n,s);else if(d.isMultipoint(y))y.points=y.points.map((function(e){return N(e,n,s)})),l=y;else if(d.isExtent(y))l=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,s=e.ymax,a=e.xmax-e.xmin,o=e.xmin,u=e.xmax,l=t.valid,c=l[0],h=l[1],d=(r=G(e.xmin,t)).x,f=r.frameId,p=(r=G(e.xmax,t)).x,y=r.frameId,_=d===p&&a>0;if(a>2*h){var g={xmin:o<u?d:p,ymin:n,xmax:h,ymax:s},v={xmin:c,ymin:n,xmax:o<u?p:d,ymax:s},m={xmin:0,ymin:n,xmax:h,ymax:s},b={xmin:c,ymin:n,xmax:0,ymax:s},x=[],I=[];k(g,m)&&x.push(f),k(g,b)&&I.push(f),k(v,m)&&x.push(y),k(v,b)&&I.push(y);for(var S=f+1;S<y;S++)x.push(S),I.push(S);i.push({extent:g,frameIds:[f]},{extent:v,frameIds:[y]},{extent:m,frameIds:x},{extent:b,frameIds:I})}else d>p||_?i.push({extent:{xmin:d,ymin:n,xmax:h,ymax:s},frameIds:[f]},{extent:{xmin:c,ymin:n,xmax:p,ymax:s},frameIds:[y]}):i.push({extent:{xmin:d,ymin:n,xmax:p,ymax:s},frameIds:[f]});return i}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(y,r);else if(d.isPolygon(y)||d.isPolyline(y)){var _=x;c.getBoundsXY(_,y);var g={xmin:_[0],ymin:_[1],xmax:_[2],ymax:_[3]},v=A(g.xmin,s)*(2*n),m=0===v?y:function(e,t){for(var r=0,i=function(e){return d.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,s=i[r];n<s.length;n++)s[n][0]+=t;return e}(y,v);g.xmin+=v,g.xmax+=v,h.extentIntersectsPolyline(g,o)&&g.xmax!==n||h.extentIntersectsPolyline(g,u)&&g.xmin!==s?f=m:l=m}else l=e.clone();return null!==f?(new Q).cut(f,n):l},t.getTextSymbolSize=P;var j={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}};function A(e,t){return Math.ceil((e-t)/(2*t))}function G(e,t){var r,i=t.valid,n=i[0],s=i[1],a=2*s,o=0;return e>s?(e-=(r=Math.ceil(Math.abs(e-s)/a))*a,o=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/a))*a,o=-r),{x:e,frameId:o}}function k(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,s=t.ymax;return B(e,r,i)&&B(e,r,s)&&B(e,n,s)&&B(e,n,i)}function B(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function N(e,t,r){var i;if(Array.isArray(e))if((i=e[0])>t){var n=A(i,t);e[0]=i+n*(-2*t)}else i<r&&(n=A(i,r),e[0]=i+n*(-2*r));else(i=e.x)>t?(n=A(i,t),e.x+=n*(-2*t)):i<r&&(n=A(i,r),e.x+=n*(-2*r));return e}var Q=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,s=0;s<i;s++){var a=r[s];if(a&&a.length>=this.minPts){for(var o=[],u=0,l=a;u<l.length;u++){var c=l[u];o.push([c[0]+n,c[1]])}r.push(o)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},1468:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=n)},1470:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(25),r(8),r(697)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.defaultPointSymbolJSON:"esriGeometryPolyline"===e?s.defaultPolylineSymbolJSON:s.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(i("csp-restrictions"))return function(){var i;return r.__assign(((i={})[t]=null,i),e)};try{var n="this."+t+" = null;";for(var s in e)n+="this."+s+" = "+JSON.stringify(e[s])+";";var a=new Function(n);return function(){return new a}}catch(i){return function(){var i;return r.__assign(((i={})[t]=null,i),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:"New Feature",description:"",prototype:{attributes:n.clone(e)}}]}}.apply(null,i))||(e.exports=n)},1524:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(67),r(2),r(4),r(92),r(316),r(76),r(412),r(1525),r(1416),r(1397),r(1469),r(1405)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p){function y(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function _(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function g(e,t,r){return r?t-e:e-t}function v(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var n=new Date(e).getTime(),s=new Date(t).getTime();if(!isNaN(n)&&!isNaN(s))return g(n,s,i)}return"number"==typeof e&&"number"==typeof t?g(e,t,i):"string"==typeof e&&"string"==typeof t?(n=e.toUpperCase(),s=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?_(n,s,i):_(y(n),y(s),i)):i?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(u.isValid(e.outSR)&&!u.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},d.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=h.getWhereClause(t.where,this.fieldsIndex);if(!r)return s.resolve(this);if(r.isStandardized){for(var i=0,n=[],a=0,o=this.items;a<o.length;a++){var u=o[a];r.testFeature(u,this.featureAdapter)&&(n[i++]=u)}var l=new e(n,this.queryGeometry,this);return l.definitionExpression=t.where,s.resolve(l)}return s.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return s.resolve(this);var r=a.SetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return s.resolve(new e(this.items.filter((function(e){return r.has(i(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!n.isSome(r))return s.resolve(this);var i=this.items.filter(r);return s.resolve(new e(i,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,a=t.endTimeField||n,o=new Map,u=this.featureAdapter.getAttribute,l=0,c=this.items;l<c.length;l++){var h=c[l],d=u(h,r),f=u(h,a),p=o.get(d);(!p||f>u(p,a))&&o.set(d,h)}var y=i.valuesOfMap(o);return s.resolve(new e(y,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||u.equals(this.spatialReference,t)?[2,this]:(i=this.featureAdapter,[4,d.projectMany(this.items.map((function(e){return p.getGeometry(n.geometryType,n.hasZ,n.hasM,i.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return i.cloneWithGeometry(n.items[t],l.convertFromGeometry(e,n.hasZ,n.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var i=function(t){var i=t.split(" "),s=i[0],a=n.fieldsIndex.get(s),o=i[1]&&"desc"===i[1].toLowerCase();e.sort((function(e,t){return v(r(e,s,a),r(t,s,a),a,o)}))},n=this,s=0,a=t.reverse();s<a.length;s++)i(a[s])},e.prototype._createFeatureQueryResponse=function(e){var t=this,i=this.items,n=this,s=n.geometryType,a=n.hasM,u=n.hasZ,l=n.objectIdField,c=n.spatialReference,h=e.outFields,d=e.outSR,f=e.quantizationParameters,y=e.resultRecordCount,_=e.resultOffset,g=e.returnZ,v=e.returnM,m=!1;if(null!=y&&null!=_){var b=_+y;m=i.length>b,i=i.slice(_,Math.min(i.length,b))}var x=h&&(h.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):h.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:m,features:this._createFeatures(e,i),fields:x,geometryType:s,hasM:a&&v,hasZ:u&&g,objectIdFieldName:l,spatialReference:p.cleanFromGeometryEngine(d||c),transform:f&&o.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new c.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,n=this.hasZ,s=e.orderByFields,a=e.quantizationParameters,u=e.returnGeometry,l=e.returnCentroid,h=e.maxAllowableOffset,d=e.returnZ,f=void 0!==d&&d,y=e.returnM,_=n&&f,g=i&&void 0!==y&&y,v=[],m=0;if(u||l){var b=o.toQuantizationTransform(a);if(u&&!l)for(var x=0,I=t;x<I.length;x++)R=I[x],v[m++]={attributes:r.getAttributes(R),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),h,b,_,g)};else if(!u&&l)for(var S=0,w=t;S<w.length;S++)R=w[S],v[m++]={attributes:r.getAttributes(R),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(R,this),b)};else for(var T=0,F=t;T<F.length;T++)R=F[T],v[m++]={attributes:r.getAttributes(R),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(R,this),b),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),h,b,_,g)}}else for(var M=0,E=t;M<E.length;M++){var R=E[M],C=r.getAttributes(R);C&&(v[m++]={attributes:C})}return this._sortFeatures(v,s,(function(e,t,i){return r.getFieldValue(e,t,i)})),v},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=0,a=e.outStatistics;s<a.length;s++){var o=a[s];if("exceedslimit"===o.statisticType){r=null!=o.maxPointCount?o.maxPointCount:Number.POSITIVE_INFINITY,i=null!=o.maxRecordCount?o.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=o.maxVertexCount?o.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,l=this.featureAdapter;t=this.items.reduce((function(e,t){var r=l.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},n=[],s=new Map,a=new Map,o=new Map,u=new Map,l=new c.default(e,this.featureAdapter,this.fieldsIndex),h=e.outStatistics,d=e.groupByFieldsForStatistics,f=e.having,p=e.orderByFields,y=d&&d.length,_=!!y,g=_&&d[0],v=_&&!this.fieldsIndex.get(g),m=0,b=h;m<b.length;m++){var x=b[m],I=x.outStatisticFieldName,S=x.statisticType,w=x,T="exceedslimit"!==S?x.onStatisticField:void 0,F="percentile_disc"===S||"percentile_cont"===S,M=_&&1===y&&(T===g||v)&&"count"===S;if(_){if(!o.has(T)){for(var E=[],R=0,C=d;R<C.length;R++){var O=C[R],P=this._getAttributeValues(l,O,s);E.push(P)}o.set(T,this._calculateUniqueValues(E))}var j=o.get(T),A=function(e){var r=j[e],i=r.count,n=r.data,a=r.items,o=r.itemPositions,c=n.join(",");if(!f||l.validateItems(a,f)){var h=u.get(c)||{attributes:{}},p=null;if(M)p=i;else{var y=G._getAttributeValues(l,T,s),_=o.map((function(e){return y[e]}));p=F&&"statisticParameters"in w?G._getPercentileValue(w,_):G._getStatisticValue(w,_)}h.attributes[I]=p,d.forEach((function(e,r){return h.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=n[r]})),u.set(c,h)}},G=this;for(var k in j)A(k)}else P=this._getAttributeValues(l,T,s),r.attributes[I]=F&&"statisticParameters"in w?this._getPercentileValue(w,P):this._getStatisticValue(w,P,a);n.push({name:I,alias:I,type:"esriFieldTypeDouble"})}var B=_?i.valuesOfMap(u):[r];return this._sortFeatures(B,p,(function(e,t){return e.attributes[t]})),{fields:n,features:B}},e.prototype._getStatisticValue=function(e,t,r){var i=e.onStatisticField,n=e.statisticType,s=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,s),s["var"===n?"variance":n]},e.prototype._getPercentileValue=function(e,t){var i=e.onStatisticField,n=e.statisticParameters,s=e.statisticType,a=n.value,o="desc"===n.orderBy,u=this.fieldsIndex.get(i),l=r.__spreadArrays(t).sort((function(e,t){return v(e,t,u,o)}));return this._calculatePercentile(l,a,"percentile_disc"===s)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),n=this.items.map((function(r){return e.getFieldValue(r,t,i)}));return r.set(t,n),n},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,n=null,s=null,a=null,o=[],u=0,l=0,c=e;l<c.length;l++)"string"==typeof(p=c[l])?u++:null==p||isNaN(p)||(i+=p,t=Math.min(t,p),r=Math.max(r,p),o.push(p),u++);if(u){n=i/u;for(var h=0,d=0,f=o;d<f.length;d++){var p=f[d];h+=Math.pow(p-n,2)}a=u>1?h/(u-1):0,s=Math.sqrt(a)}else t=null,r=null;return{avg:n,count:u,max:r,min:t,stddev:s,sum:i,variance:a}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,i=r.length,n=0;n<i;n++){for(var s=r[n],a=[],o=0,u=e;o<u.length;o++){var l=u[o];a.push(l[n])}var c=a.join(",");null==t[c]?t[c]={count:1,data:a,items:[s],itemPositions:[n]}:(t[c].count++,t[c].items.push(s),t[c].itemPositions.push(n))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,n=Math.floor(i),s=n+1,a=i%1,o=e[n],u=e[s];return s>=e.length||r||"string"==typeof o||"string"==typeof u?o:o*(1-a)+u*a},e}();t.default=m}.apply(null,i))||(e.exports=n)},1525:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1416)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var s=0,a=0,o=n;a<o.length;a++){var u=o[a],l=i.getExpressionFromFieldName(u),c=this.fieldsIndex.get(l),h=c?null:i.getWhereClause(l,r),d=c?c.name:i.getAliasFromFieldName(u)||"FIELD_EXP_"+s++;this._fieldDataCache.set(u,{alias:d,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var n=r?r.name:t,s=null;return this._fieldDataCache.has(n)?s=this._fieldDataCache.get(n).clause:r||(s=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:s})),r?this.featureAdapter.getAttribute(e,n):s.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var s=n[i],a=this._fieldDataCache.get(s),o=a.alias,u=a.clause;r[o]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,o)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var n=0,s=t;n<s.length;n++){var a=s[n],o=this._fieldDataCache.get(a).alias;i.push(e[o])}else for(var o in e)i.push(e[o]);var u=(t||["*"]).join(",")+"="+i.join(","),l=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++l),l>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},1568:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Float64Array(2),i=new Float64Array(2);function n(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function s(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function o(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){var r=a(e),i=t,n=!t;e[0]=n*e[0]+i*r,e[1]=n*r+i*e[1]}function l(e,t){var r=t>a(e);return u(e,r),r}function c(e,t){for(var s=o(r,-90,90),l=o(i,-180,180),c=0;c<t.length;c++){var h=n(t.charCodeAt(c));c%2==0?(u(l,!!(16&h)),u(l,!!(4&h)),u(l,!!(1&h)),u(s,!!(8&h)),u(s,!!(2&h))):(u(s,!!(16&h)),u(s,!!(4&h)),u(s,!!(1&h)),u(l,!!(8&h)),u(l,!!(2&h)))}return e[0]=a(s),e[1]=a(l),e}function h(e,t,n){for(var a="",u=o(r,-90,90),c=o(i,-180,180),h=0;h<n;h++){var d=0;h%2?(d|=l(u,e)<<4,d|=l(c,t)<<3,d|=l(u,e)<<2,d|=l(c,t)<<1,d|=l(u,e)<<0):(d|=l(c,t)<<4,d|=l(u,e)<<3,d|=l(c,t)<<2,d|=l(u,e)<<1,d|=l(c,t)<<0),a+=s(d)}return a}function d(e){var t=Math.floor(5*e/2);return 180/Math.pow(2,t)}function f(e){var t=Math.ceil(5*e/2);return 360/Math.pow(2,t)}function p(e,t){return t?1&e|(4&e)>>1|(16&e)>>2:(2&e)>>1|(8&e)>>2}function y(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(16&e)>>2}function _(e,t,r){var i=!((e.length-1)%2),a=e.substring(0,e.length-1),o=n(e.charCodeAt(e.length-1)),u=0,l=0,c=0,h=0;i?(u=8,l=4,c=1&o|(4&o)>>1|(16&o)>>2,h=(2&o)>>1|(8&o)>>2):(u=4,l=8,h=1&o|(4&o)>>1|(16&o)>>2,c=(2&o)>>1|(8&o)>>2);var d=c+t,f=h+r,p=Math.floor(d/u),y=Math.floor(f/l),g=s(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(d-p*u,f-y*l,i));return e.length>1&&(p||y)?_(a,p,y)+g:a+g}t.decodeBase32Char=n,t.encodeBase32Char=s,t.decodeGeohash=c,t.convertGeohash32ToXY=function(e,t){for(var r=0,i=0,s=30,a=30,o=0;o<t.length;o++){var u=n(t.charCodeAt(o)),l=o%2==0;r|=p(u,l)<<(s-=l?3:2),i|=y(u,l)<<(a-=l?2:3)}return{geohashX:r,geohashY:i}},t.decodeGeohashXY=function(e,t){for(var r=-90,i=90,n=-180,s=180,a=0;a<t;a++){for(var o=Math.ceil((a+1)/2),u=Math.floor((a+1)/2),l=1-a%2,c=30-(3*o+2*u),h=30-(2*o+3*u),d=3*l+2*(1-l),f=2*l+3*(1-l),p=3*l+7*(1-l)<<h,y=(7*l+3*(1-l)<<c&e.geohashX)>>c,_=(p&e.geohashY)>>h,g=d-1;g>=0;g--){var v=(n+s)/2,m=y&1<<g?1:0;n=(1-m)*n+m*v,s=(1-m)*v+m*s}for(g=f-1;g>=0;g--){var b=(r+i)/2,x=_&1<<g?1:0;r=(1-x)*r+x*b,i=(1-x)*b+x*i}}return[n,r,s,i]},t.setGeohashXY=function(e,t,r,i){i%2&&(i+=1);for(var n=0,s=0,a=-90,o=90,u=-180,l=180,c=0;c<i/2;c++){for(var h=0;h<5;h++){var d=(u+l)/2,f=r>d?1:0;n|=f<<29-(h+5*c),u=(1-f)*u+f*d,l=(1-f)*d+f*l}for(h=0;h<5;h++){var p=(a+o)/2,y=t>p?1:0;s|=y<<29-(h+5*c),a=(1-y)*a+y*p,o=(1-y)*p+y*o}}e.geohashX=n,e.geohashY=s},t.encodeGeohash=h,t.latDistPerGeohash=d,t.lonDistPerGeohash=f,t.unpackXBits=p,t.unpackYBits=y,t.getRelativeGeohash=_,t.getIntersectingGeohashes=function(e,t,r,i,n){for(var s=Math.abs(r-e),a=Math.abs(i-t),o=d(n),u=f(n),l=Math.ceil(a/u),c=Math.ceil(s/o),p=h(e,t,n),y=new Array,g=0;g<l;g++)for(var v=0;v<c;v++)y.push(_(p,g,v));return y},t.forEachIntersectingGeohash=function(e,t,r,i,n,s){for(var a=Math.abs(r-e),o=Math.abs(i-t),u=d(n),l=f(n),p=Math.ceil(o/l),y=Math.ceil(a/u),g=h(e,t,n),v=0;v<p;v++)for(var m=0;m<y;m++){var b=_(g,v,m),x=c([0,0],b),I=x[0],S=x[1],w=I-u/2,T=S-l/2,F=I+u/2,M=S+l/2,E=u*l,R=Math.max(e,w),C=Math.max(t,T),O=Math.min(r,F)-R,P=Math.min(i,M)-C;s(b,Math.abs(O*P)/E)}}}.apply(null,i))||(e.exports=n)},1646:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(419),r(414)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function o(e){var t,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:switch(e.type){case"Feature":return[3,1];case"FeatureCollection":return[3,3]}return[3,7];case 1:return[4,e];case 2:return r.sent(),[3,7];case 3:t=0,i=e.features,r.label=4;case 4:return t<i.length?(n=i[t])?[4,n]:[3,6]:[3,7];case 5:r.sent(),r.label=6;case 6:return t++,[3,4];case 7:return[2]}}))}function u(e){for(var t=0,r=0;r<e.length;r++){var i=e[r],n=e[(r+1)%e.length];t+=i[0]*n[1]-n[0]*i[1]}return t<=0}function l(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function c(e,t,r){var i=l(t);u(i)?d(e,i,r):f(e,i,r)}function h(e,t,r){var i=l(t);u(i)?f(e,i,r):d(e,i,r)}function d(e,t,r){for(var i=0,n=t;i<n.length;i++)p(e,n[i],r);e.lengths.push(t.length)}function f(e,t,r){for(var i=t.length-1;i>=0;i--)p(e,t[i],r);e.lengths.push(t.length)}function p(e,t,r){var i=t[0],n=t[1],s=t[2];e.coords.push(i,n),r.hasZ&&e.coords.push(s||0)}function y(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}t.validateGeoJSON=function(e){if(!e)throw new i("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});var t=e.crs;if(t){var r="string"==typeof t?t:"name"===t.type?t.properties.name:null,n=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!n.test(r))throw new i("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}},t.inferLayerProperties=function(e,t){void 0===t&&(t={});for(var i=o(e),n=[],s=new Set,u=new Set,l=!1,c=Number.NEGATIVE_INFINITY,h=null,d=!1,f=void 0,p=t.geometryType,_=void 0===p?null:p,g=!1,v=function(){var e,t,o=i.next(),p=o.value;if(o.done){var v=h&&1===h.length&&h[0]||null;if(v)for(var m=0,b=n;m<b.length;m++){var x=b[m];x.name===v&&(x.type="esriFieldTypeOID")}return{value:{fields:n,geometryType:_,hasZ:l,maxObjectId:Math.max(0,c),objectIdFieldName:v,objectIdFieldType:f,unknownFields:(e=u,t=[],e.forEach((function(e){return t.push(e)})),t)}}}var I=p.geometry,S=p.properties,w=p.id;if(I&&(_||(_=a[I.type]),a[I.type]!==_))return"continue";if(!l){var T=function(e){var t,i,n,s,a,o,u,l,c;return r.__generator(this,(function(h){switch(h.label){case 0:if(!e)return[2,null];switch(e.type){case"Point":return[3,1];case"LineString":case"MultiPoint":return[3,3];case"MultiLineString":case"Polygon":return[3,5];case"MultiPolygon":return[3,10]}return[3,17];case 1:return[4,e.coordinates];case 2:return h.sent(),[3,17];case 3:return[5,r.__values(e.coordinates)];case 4:return h.sent(),[3,17];case 5:t=0,i=e.coordinates,h.label=6;case 6:return t<i.length?(n=i[t],[5,r.__values(n)]):[3,9];case 7:h.sent(),h.label=8;case 8:return t++,[3,6];case 9:return[3,17];case 10:s=0,a=e.coordinates,h.label=11;case 11:if(!(s<a.length))return[3,16];o=a[s],u=0,l=o,h.label=12;case 12:return u<l.length?(c=l[u],[5,r.__values(c)]):[3,15];case 13:h.sent(),h.label=14;case 14:return u++,[3,12];case 15:return s++,[3,11];case 16:return[3,17];case 17:return[2]}}))}(I);l=function(e){for(;;){var t=e.next(),r=t.value;if(t.done)return!1;if(r.length>2)return!0}}(T)}if(d||(d=null!=w)&&"number"==(f=typeof w)&&(h=Object.keys(S).filter((function(e){return S[e]===w}))),d&&"number"===f&&null!=w&&(c=Math.max(c,w),h.length>1?h=h.filter((function(e){return S[e]===w})):1===h.length&&(h=S[h[0]]===w?h:[])),!g&&S){var F=!0;for(var M in S)if(!s.has(M)){var E=S[M];if(null!=E){var R=y(E);"unknown"!==R?(u.delete(M),s.add(M),n.push({name:M,alias:M,type:R})):u.add(M)}else F=!1,u.add(M)}g=F}};;){var m=v();if("object"==typeof m)return m.value}},t.createOptimizedFeatures=function(e,t){return function(e){for(var t=[];;){var r=e.next(),i=r.value;if(r.done)return t;t.push(i)}}(function(e,t){var i,o,u,l,f,y,_,g;return void 0===t&&(t={}),r.__generator(this,(function(r){switch(r.label){case 0:i=t.geometryType,o=t.objectIdFieldName,r.label=1;case 1:return u=e.next(),l=u.value,u.done?[2]:(f=l.geometry,y=l.properties,_=l.id,f&&a[f.type]!==i?[3,1]:(g=y||{},o&&null!=_&&!g[o]&&(g[o]=_),[4,new n.default(f?function(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return d(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(var i=0,n=t.coordinates;i<n.length;i++){d(e,n[i],r)}return e}(e,t,r);case"MultiPoint":return function(e,t,r){return d(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(var i=0,n=t.coordinates;i<n.length;i++){var s=n[i];c(e,s[0],r);for(var a=1;a<s.length;a++)h(e,s[a],r)}return e}(e,t,r);case"Point":return function(e,t,r){return p(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){var i=t.coordinates;c(e,i[0],r);for(var n=1;n<i.length;n++)h(e,i[n],r);return e}(e,t,r)}}(new s.default,f,t):null,g)]));case 2:return r.sent(),[3,1];case 3:return[2]}}))}(o(e),t))}}.apply(null,i))||(e.exports=n)},1699:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(145),r(25),r(5),r(2),r(4),r(1),r(1416),r(1402),r(413),r(308),r(304),r(675),r(1466),r(1700),r(1702)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g,v){Object.defineProperty(t,"__esModule",{value:!0});var m=a.getLogger("esri.views.2d.layers.features.controllers.BaseController"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._availableFields=[],t._pixelBuffer=0,t.config=null,t.filters=new Array(y.definitions.MAX_FILTERS),t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t}return r.__extends(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._initAttributeStore()},t.prototype.startup=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,u.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}}))}))},t.prototype.destroy=function(){this.attributeStore&&this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureReduction",{get:function(){return this.config.featureReduction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new d(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t||"cim"===t}switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some((function(e){return i(e.symbol)}));case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some((function(e){return i(e.symbol)}));case"dot-density":return!1;default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnOutline",{get:function(){return function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol&&"outline"in e.backgroundFillSymbol&&null!=e.backgroundFillSymbol.outline||t.some((function(e){return"outline"in e&&null!=e.outline}))}(t)}}(this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?f.fromJSON(this.config.renderer):(m.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter((function(t){return-1===e._availableFields.indexOf(t)}));return this._availableFields=r.__spreadArrays(this._availableFields,t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getAggregate=function(e){return null},t.prototype.getAggregateValueRanges=function(){return{}},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map((function(e){return t.attributeStore.getLocalId(e)})).filter((function(e){return null!=e}))},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,v.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}}))}))},t.prototype.setHighlight=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this.attributeStore.setHighlight(e)]}))}))},t.prototype.validateConfig=function(e){for(var t=0,r=e.filters;t<r.length;t++){var n=r[t];if(o.isSome(n)&&n.where)try{c.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new i("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&s("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new _.default({type:"remote",initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}})},t.prototype._createQueryEngine=function(e){return new h.default({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore()),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(){var e={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};return new g.ClusterStore(e,this.spatialReference,this.attributeStore,this.featureReduction)},t.prototype._createDefaultQuery=function(e){var t=new p,r=e.outFields,i=this.config,n=i.gdbVersion,s=i.historicMoment,a=i.definitionExpression;return r=r.length/this.service.fields.length>=.75?["*"]:r,t.gdbVersion=n,t.historicMoment=null!=s?new Date(s):null,t.num=e.num,t.outFields=r,t.outSpatialReference=this.spatialReference,t.returnGeometry=e.returnGeometry,t.returnCentroid=e.returnCentroid,t.start=e.resultOffset,t.where=a||"1=1",t},t.prototype.hasGeometryFilter=function(){return this.filters.some((function(e){return o.isSome(e)&&!!e.geometry}))},r.__decorate([l.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r.__decorate([l.property()],t.prototype,"config",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"featureReduction",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r.__decorate([l.property()],t.prototype,"filters",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r.__decorate([l.property({readOnly:!0,dependsOn:["service","config"]})],t.prototype,"returnOutline",null),r.__decorate([l.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r.__decorate([l.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r.__decorate([l.property()],t.prototype,"processor",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([l.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"viewState",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r.__decorate([l.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(n.HandleOwner);t.default=b}.apply(null,i))||(e.exports=n)},1700:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(25),r(2),r(4),r(15),r(1701),r(1568),r(76),r(46),r(419),r(414),r(1427),r(1397),r(1402),r(1405),r(107),r(421),r(677)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g,v,m,b){Object.defineProperty(t,"__esModule",{value:!0});var x=function(e){return s.andThen(e,(function(e){return"cluster"!==e.type?null:r.__assign(r.__assign({},e),{clusterRadius:o.pt2px(e.clusterRadius/2)})}))};function I(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,o,u;return r.__generator(this,(function(r){for(n=[],s=0,o=e;s<o.length;s++)u=o[s],n.push(S(u,t,i));return[2,a.all(n)]}))}))}function S(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return"onStatisticValueExpression"in e.outStatistic?(s=(n=e).outStatistic.onStatisticValueExpression,a=n,[4,v.createRendererExpression(s,t,i)]):[3,2];case 1:return a.expression=r.sent(),[2,n];case 2:return[2,e]}}))}))}var w=function(e){function t(t,r,i,n,s){var a=this,o=new f.default([],[r,i]);return(a=e.call(this,o,n,null,t)||this).invalid=!1,a.canDelete=!1,a.geohashBoundsInfo=s,a}return r.__extends(t,e),Object.defineProperty(t.prototype,"count",{get:function(){return this.attributes.cluster_count},enumerable:!0,configurable:!0}),t.create=function(e,r,i,n,s,a,o){var u=new t(r,i,n,a,o);return u.localId=e.createLocalId(u.objectId,!0),u.tileLevel=s,u},t.prototype.update=function(e,t,r,i,n){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=n,this.referenceId=null,this.invalid=!1,this},t.prototype.toJSON=function(){return{objectId:this.objectId,referenceId:this.referenceId,attributes:r.__assign(r.__assign({},this.attributes),{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}},t}(d.default),T=function(e){function t(t,r,n,s){var a=e.call(this,t)||this;return a._deferredDeletionQueue=[],a._invalidated=!1,a._aggregateFieldsHash=null,a._geohashLevel=0,a._aggregateValueRanges={},a._aggregateValueRangesChanged=!1,a._aggregateFields=[],a._hasAggregateValueExpression=!1,a._hasViewExpression=!1,a._$view={scale:0,viewingMode:"none"},a._clusters=new Map,a._tiles=new Map,a._spatialReference=r,a._attributeStore=n,a._featureReduction=x(s),a._projectionSupportCheck=y.checkProjectionSupport(r,i.SpatialReference.WGS84),a}return r.__extends(t,e),t.prototype.setScale=function(e){var t=e!==this._$view.scale&&this._hasViewExpression,r=this._featureReduction;this._$view.scale=e,s.isSome(r)&&t&&(this._tree=new u.GeohashTree(this._aggregateFields),this._unindexFeatures(),this._reindexFeatures(!0))},t.prototype.update=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,a,o,l,c,h,d,f,p,y,_,g=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this._featureReduction,a=s.andThen(t.featureReduction,x),o=t.aggregateFields.reduce((function(e,t){return e+JSON.stringify(t)}),""),l=null===n&&t.featureReduction,c=o!==this._aggregateFieldsHash,h=l||c,c?(d=this,[4,I(t.aggregateFields,this._spatialReference,i)]):[3,2];case 1:for(d._aggregateFields=r.sent(),this._hasViewExpression=!1,f=0,p=this._aggregateFields;f<p.length;f++)"onStatisticValueExpression"in(y=p[f]).outStatistic&&(_=y,this._hasAggregateValueExpression=!0,this._hasViewExpression=this._hasViewExpression||_.expression.referencesScale());r.label=2;case 2:return[4,this._projectionSupportCheck];case 3:return r.sent(),this._featureReduction=a,this._aggregateFieldsHash=o,this._aggregateValueRanges={},this._invalidated=!0,s.isNone(a)?(this._tree=null,[2]):(s.isSome(n)&&n.clusterRadius!==a.clusterRadius&&this._clusters.forEach((function(e){return e.canDelete=!0})),h&&(this._tree=new u.GeohashTree(t.aggregateFields),this._unindexFeatures()),(h||e)&&this._reindexFeatures(c),this._handleClusterUpdates(),this._tiles.forEach((function(e){return g._getClustersForTile(e,0,a.clusterRadius,null,!1)})),[2])}}))}))},t.prototype._ensureAggregateFields=function(e){if(this._hasAggregateValueExpression)for(var t=this._$view,r=0,i=this._aggregateFields;r<i.length;r++){var n=i[r];if("onStatisticValueExpression"in n.outStatistic){var s=n,a=s.expression,o=s.outStatistic.onStatisticField;e.attributes[o]=m.callWithOptimizedFeature(a,e,{$view:t},this.geometryInfo)}}},t.prototype._unindexFeatures=function(){this._featuresById.forEach((function(e){e.geohashIndexed=!1}))},t.prototype._reindexFeatures=function(e){var t=this;this._featuresById.forEach((function(r){r.geohashX||r.geohashY||t._setGeohash(r),e&&t._ensureAggregateFields(r),t._attributeStore.isVisible(r)?t._insertIntoIndex(r):t._removeFromIndex(r)}))},t.prototype.onTileUpdate=function(e){var t=this,r=e.added,i=e.removed;if(r.length){var n=Math.max.apply(Math,r.map((function(e){return e.level})));this._setGeohashLevel(n),r.forEach((function(e){return t._tiles.set(e.key.id,e)}))}if(!s.isNone(this._featureReduction)){var a=this._featureReduction.clusterRadius;i.forEach((function(e){t._tiles.delete(e.key.id),t._markTileClustersForDeletion(e,a)}))}},t.prototype.sweepClusters=function(){var e=this;this._clusters.forEach((function(t,r){t.canDelete&&(e._attributeStore.freeLocalId(t.objectId),e._clusters.delete(r))}));for(var t=0,r=this._deferredDeletionQueue;t<r.length;t++){var i=r[t];this._attributeStore.addLocalId(i)}this._deferredDeletionQueue=[]},t.prototype.executeTileQuery=function(t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var a,o,u;return r.__generator(this,(function(r){switch(r.label){case 0:return s.isNone(this._featureReduction)?[2,e.prototype.executeTileQuery.call(this,t,i,n)]:[4,this._projectionSupportCheck];case 1:return r.sent(),this._handleClusterUpdates(),a=this._featureReduction.clusterRadius,o=this._getTransforms(t,i),u=this._getClustersForTile(t,n.pixelBuffer,a,o),this._aggregateValueRangesChanged&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),[2,u]}}))}))},t.prototype.getAggregate=function(e){var t=null;return this._clusters.forEach((function(r){r.localId===e&&(t=r.toJSON())})),t},t.prototype.getAggregateValueRanges=function(){return this._aggregateValueRanges},t.prototype._getClustersForTile=function(e,t,a,o,u){var l=this;void 0===u&&(u=!0),t=Math.max(t,50);for(var c=2*a,d=new Set,f=this._getGeohashLevel(e.key.level),p=Math.pow(2,e.key.level)*Math.ceil(b.TILE_SIZE/c),v=Math.ceil(t/c)+2,m=Math.ceil(b.TILE_SIZE/c)+2*v,x=e.key,I=x.row,S=x.col*b.TILE_SIZE,w=I*b.TILE_SIZE,T=Math.floor(S/c)-v,F=Math.floor(w/c)-v,M=T+m,E=F+m,R=new Array,C=e.tileInfoView.getLODInfoAt(e.key.level),O=T;O<=M;O++)for(var P=function(t){var a,c,v=O;C.wrap&&(v=O<0?O+p:O%p);var m=C.wrap&&O<0,b=C.wrap&&O%p!==O,x=j._lookupCluster(C,e.key.level,v,t,f);if(s.isSome(x)){var I=s.andThen(o,(function(e){return m?e.left:b?e.right:e.tile}));if(u&&s.isNone(I))return"continue";if(!x.count)return"continue";if(u&&1===x.count){var S=x.geohashBoundsInfo,w=S.xLL,T=S.yLL,F=S.xTR,M=S.yTR,E=S.level,P=s.unwrap(j._tree).findSingleOccupancyNode(w,T,F,M,E),A=s.unwrap(P).getLngLatBounds(),G={x:A[0],y:A[1]},k={x:A[2],y:A[3]},B=0,N=0,Q=0,D=0;if(j._spatialReference.isWebMercator)B=(a=h.lngLatToXY(G.x,G.y))[0],N=a[1],Q=(c=h.lngLatToXY(k.x,k.y))[0],D=c[1];else{var z=y.project(G,i.SpatialReference.WGS84,j._spatialReference),V=y.project(k,i.SpatialReference.WGS84,j._spatialReference);if(!z||!V)return n("esri-2d-debug")&&console.debug("Failed to reproject known tree node"),"continue";B=z.x,N=z.y,Q=V.x,D=V.y}var L=[B,N,Q,D],q=null;if(j.forEachInBounds(L,(function(e){l._attributeStore.isVisible(e)&&(q&&n("esri-2d-debug")&&console.debug("Expected to find only one feature, but found multiple"),q=e)})),!q)return n("esri-2d-debug")&&console.debug("Expected to find a feature, but found none"),"continue";var U=g.getGeometry(j.geometryInfo.geometryType,j.geometryInfo.hasZ,j.geometryInfo.hasM,q.geometry,0,s.unwrap(I)),Y=r.__assign(r.__assign({},q.attributes),x.attributes);x.referenceId=q.localId,d.add(x.objectId),R.push(new _.Feature(Y,x.localId,U))}else u&&(d.add(x.objectId),U=g.getGeometry(j.geometryInfo.geometryType,j.geometryInfo.hasZ,j.geometryInfo.hasM,x.geometry,0,s.unwrap(I)),R.push(new _.Feature(x.attributes,x.localId,U)))}},j=this,A=F;A<=E;A++)P(A);return{features:R,objectIds:d}},t.prototype._getGeohashLevel=function(e){return Math.min(Math.ceil(e/2+2),12)},t.prototype._setGeohashLevel=function(e){var t=this,r=this._geohashLevel,i=this._getGeohashLevel(e),n=2*(Math.floor(i/2)+1)-1,a=this._tree;this._geohashLevel=n,s.isNone(a)||(n>r?(a.dropLevels(0),this._featuresById.forEach((function(e){e.geohashIndexed&&(t._setGeohash(e),a.insert(e,t._geohashLevel),e.geohashIndexed=!0)}))):n<r&&a.dropLevels(this._geohashLevel))},t.prototype._insertIntoIndex=function(e){e.geohashIndexed||(this._invalidated=!0,e.geohashIndexed=!0,s.unwrap(this._tree).insert(e,this._geohashLevel))},t.prototype._removeFromIndex=function(e){e.geohashIndexed&&(this._invalidated=!0,s.unwrap(this._tree).remove(e,this._geohashLevel),e.geohashIndexed=!1)},t.prototype._handleClusterUpdates=function(){var e=this;this._invalidated&&this._clusters.size&&this._clusters.forEach((function(t){s.isSome(t)&&(t.invalid=t.invalid||e._invalidated)})),this._invalidated=!1},t.prototype._getTransforms=function(e,t){var i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},n=c.getInfo(t);if(!n)return{tile:i,left:null,right:null};var s=n.valid,a=s[0],o=s[1];return{tile:i,left:r.__assign(r.__assign({},i),{translate:[o,e.bounds[3]]}),right:r.__assign(r.__assign({},i),{translate:[a-o+e.bounds[0],e.bounds[3]]})}},t.prototype._getClusterId=function(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r},t.prototype._markForDeletion=function(e,t,r){var i=this._getClusterId(e,t,r);if(this._clusters.has(i)){var n=this._clusters.get(i);s.isSome(n)?n.canDelete=!0:this._clusters.delete(i)}},t.prototype._getClusterBounds=function(e,t,r){if(s.isNone(this._featureReduction))return null;var i=this._featureReduction.clusterRadius,n=2*i,a=r%2?t*n:t*n+i,o=r*n,u=a/b.TILE_SIZE,l=o/b.TILE_SIZE,c=(a+n)/b.TILE_SIZE,h=(o-n)/b.TILE_SIZE;return[e.getXForColumn(u),e.getYForRow(l),e.getXForColumn(c),e.getYForRow(h)]},t.prototype._lookupCluster=function(e,t,n,a,o){var u,c;if(s.isNone(this._featureReduction)||s.isNone(this._tree))return null;var d=this._getClusterId(t,n,a),f=this._clusters.get(d);if(f&&s.isSome(f)&&!f.invalid&&!f.canDelete)return f;var p=this._getClusterBounds(e,n,a),_=p[0],g=p[1],v=p[2],m=p[3],b={x:_,y:g},x={x:v,y:m},I=0,S=0,T=0,F=0;if(this._spatialReference.isWebMercator)I=(u=h.xyToLngLat(b.x,b.y))[0],S=u[1],T=(c=h.xyToLngLat(x.x,x.y))[0],F=c[1];else{var M=y.project(b,this._spatialReference,i.SpatialReference.WGS84),E=y.project(x,this._spatialReference,i.SpatialReference.WGS84);if(!M||!E)return null;I=M.x,S=M.y,T=E.x,F=E.y}I>T&&(T=180);var R={geohashX:0,geohashY:0},C={geohashX:0,geohashY:0};l.setGeohashXY(R,S,I,o),l.setGeohashXY(C,F,T,o);var O=R.geohashX,P=R.geohashY,j=C.geohashX,A=C.geohashY,G={xLL:O,yLL:P,xTR:j,yTR:A,level:o},k=this._tree.getRegionStatistics(O,P,j,A,o),B=k.count,N=k.xTotal,Q=k.yTotal,D=B?N/B:0,z=B?Q/B:0;if(s.isSome(f)&&f.canDelete){var V=this._attributeStore.removeLocalId(f.objectId);this._deferredDeletionQueue.push(V)}var L=s.isSome(f)&&!f.canDelete&&f.invalid,q=r.__assign({cluster_count:B},k.attributes),U=this._attributeStore,Y=L?f.update(D,z,t,q,G):w.create(U,d,D,z,t,q,G);return 0===B&&(Y.geometry.coords[0]=(_+v)/2,Y.geometry.coords[1]=(g+m)/2),this._attributeStore.setAttributeData(Y.localId,Y,this.geometryInfo,null),this._clusters.set(d,Y),this._updateAggregateValueRangeForCluster(Y,Y.tileLevel),Y},t.prototype._updateAggregateValueRangeForCluster=function(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,n=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)},t.prototype._markTileClustersForDeletion=function(e,t){for(var r=2*t,i=Math.ceil(b.TILE_SIZE/r),n=e.key,s=n.row,a=n.col*b.TILE_SIZE,o=s*b.TILE_SIZE,u=Math.floor(a/r),l=Math.floor(o/r),c=u;c<u+i;c++)for(var h=l;h<l+i;h++)this._markForDeletion(e.key.level,c,h)},t.prototype._setGeohash=function(e){var t=e.geometry;if(t&&t.coords.length){var r={x:t.coords[0],y:t.coords[1]},s=y.project(r,this._spatialReference,i.SpatialReference.WGS84);s?l.setGeohashXY(e,s.y,s.x,12):n("esri-2d-debug")&&console.debug("Tried to project feature geometry, but got back `null`")}},t.prototype._add=function(t){var r=this._featuresById.get(t.objectId);e.prototype._add.call(this,t),this._ensureAggregateFields(t),s.isSome(this._featureReduction)&&s.isSome(this._tree)&&(r?(t.geohashIndexed=r.geohashIndexed,t.geohashX=r.geohashX,t.geohashY=r.geohashY):this._setGeohash(t),!t.geohashIndexed&&this._attributeStore.isVisible(t)&&this._insertIntoIndex(t))},t.prototype._remove=function(t){return s.isSome(this._featureReduction)&&s.isSome(this._tree)&&this._removeFromIndex(t),e.prototype._remove.call(this,t)},t}(p.default);t.ClusterStore=T}.apply(null,i))||(e.exports=n)},1701:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1486),r(2),r(1568)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this._pool=new r.default(8024),this._nodes=0,this._root=new a(0,0,0),this._fields=e}return e.prototype._acquire=function(e,t,r){var n=this._pool.dequeue();return this._nodes++,i.isSome(n)?n.realloc(e,t,r):new a(e,t,r)},e.prototype._release=function(e){this._nodes--,this._pool.enqueue(e)},Object.defineProperty(e.prototype,"count",{get:function(){return this._root.count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"poolSize",{get:function(){return this._pool.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var e=0;return this._forEachNode((function(t){return e=Math.max(e,t.depth)})),e},enumerable:!0,configurable:!0}),e.prototype.dropLevels=function(e){var t=this;this._forEachNode((function(r){if(r.depth>=e)for(var i=0;i<r.children.length;i++){var n=r.children[i];r.children[i]=null,n&&t._release(n)}}))},e.prototype.insert=function(e,t,r){void 0===r&&(r=0);for(var i=this._root,n=0,s=0,a=0;null!==i;){if(i.depth>=r&&(i.count+=1,i.xTotal+=e.geometry.coords[0],i.yTotal+=e.geometry.coords[1],i.xGeohashTotal+=e.geohashX,i.yGeohashTotal+=e.geohashY,this._updateStatistics(e,i,1)),n>=t)return;var o=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),l=1-n%2,c=30-(3*o+2*u),h=30-(2*o+3*u),d=7*l+3*(1-l)<<c,f=3*l+7*(1-l)<<h,p=8*l+4*(1-l),y=(e.geohashX&d)>>c,_=(e.geohashY&f)>>h,g=y+_*p;s=s<<3*l+2*(1-l)|y,a=a<<2*l+3*(1-l)|_,null==i.children[g]&&(i.children[g]=this._acquire(s,a,n+1)),n+=1,i=i.children[g]}},e.prototype.remove=function(e,t){for(var r=this._root,i=0;null!==r;){if(r.count-=1,r.xTotal-=e.geometry.coords[0],r.yTotal-=e.geometry.coords[1],r.xGeohashTotal-=e.geohashX,r.yGeohashTotal-=e.geohashY,this._updateStatistics(e,r,-1),i>=t)return;var n=Math.ceil((i+1)/2),s=Math.floor((i+1)/2),a=1-i%2,o=30-(3*n+2*s),u=30-(2*n+3*s),l=7*a+3*(1-a)<<o,c=3*a+7*(1-a)<<u,h=8*a+4*(1-a),d=((e.geohashX&l)>>o)+((e.geohashY&c)>>u)*h,f=r.children[d];1===f.count&&(this._release(f),r.children[d]=null),i+=1,r=f}},e.prototype.find=function(e,t,r){return this._root.find(e,t,r,0,0,0)},e.prototype.findSingleOccupancyNode=function(e,t,r,i,n){for(var s=this._root;null!==s;){var a=s.depth,o=s.xNode,u=s.yNode,l=1-a%2,c=s.xGeohashTotal/s.count,h=s.yGeohashTotal/s.count;if(1===s.count&&e<c&&c<=r&&t<h&&h<=i)return s;if(a>=n)s=s.next;else{for(var d=Math.ceil((a+1)/2),f=Math.floor((a+1)/2),p=30-(3*d+2*f),y=30-(2*d+3*f),_=~((1<<p)-1),g=~((1<<y)-1),v=(e&_)>>p,m=(t&g)>>y,b=(r&_)>>p,x=(i&g)>>y,I=o<<3*l+2*(1-l),S=u<<2*l+3*(1-l),w=I+8*l+4*(1-l),T=S+4*l+8*(1-l),F=Math.max(I,v),M=Math.max(S,m),E=Math.min(w,b),R=Math.min(T,x),C=null,O=null,P=M;P<=R;P++)for(var j=F;j<=E;j++){var A=j-I+(P-S)*(8*l+4*(1-l)),G=s.children[A];G&&(C||((C=G).next=s.next),O&&(O.next=G),O=G,G.next=s.next)}s=C||s.next}}return null},e.prototype.getRegionStatistics=function(e,t,r,i,n){for(var s=this._root,a=0,o=0,u=0,l={};null!==s;){var c=s.depth,h=s.xNode,d=s.yNode;if(c>=n){var f=s.xGeohashTotal/s.count,p=s.yGeohashTotal/s.count;e<f&&f<=r&&t<p&&p<=i&&(a+=s.count,o+=s.xTotal,u+=s.yTotal,this._aggregateStatistics(l,s.statistics)),s=s.next}else{for(var y=Math.ceil((c+1)/2),_=Math.floor((c+1)/2),g=1-c%2,v=30-(3*y+2*_),m=30-(2*y+3*_),b=~((1<<v)-1),x=~((1<<m)-1),I=(e&b)>>v,S=(t&x)>>m,w=(r&b)>>v,T=(i&x)>>m,F=h<<3*g+2*(1-g),M=d<<2*g+3*(1-g),E=F+8*g+4*(1-g),R=M+4*g+8*(1-g),C=Math.max(F,I),O=Math.max(M,S),P=Math.min(E,w),j=Math.min(R,T),A=null,G=null,k=O;k<=j;k++)for(var B=C;B<=P;B++){var N=B-F+(k-M)*(8*g+4*(1-g)),Q=s.children[N];if(Q){if(k!==O&&k!==j&&B!==C&&B!==P){f=Q.xGeohashTotal/Q.count,p=Q.yGeohashTotal/Q.count,e<f&&f<=r&&t<p&&p<=i&&(a+=Q.count,o+=Q.xTotal,u+=Q.yTotal,this._aggregateStatistics(l,Q.statistics));continue}A||((A=Q).next=s.next),G&&(G.next=Q),G=Q,Q.next=s.next}}s=A||s.next}}return{count:a,attributes:this._normalizeStatistics(l,a),xTotal:o,yTotal:u}},e.prototype._forEachNode=function(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}},e.prototype._linkChildren=function(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var n=e.children[i];n&&(t||((t=n).next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t},e.prototype._updateStatistics=function(e,t,r){for(var i=0,n=this._fields;i<n.length;i++){var s=n[i],a=s.name,o=s.outStatistic.onStatisticField,u=e.attributes[o];switch(s.outStatistic.statisticType){case"norm":t.statistics[a]||(t.statistics[a]={});var l=s.outStatistic.onStatisticNormalizationField,c=e.attributes[l],h=t.statistics[a].onStatisticField||0,d=t.statistics[a].onStatisticNormalizationField||0;null==u||isNaN(u)||null==c||0===c||isNaN(c)||(t.statistics[a].onStatisticField=h+r*u,t.statistics[a].onStatisticNormalizationField=d+r*c);break;case"sum":case"avg":t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});var f=t.statistics[a].value,p=t.statistics[a].nanCount;null==u||isNaN(u)?t.statistics[a].nanCount=p+r:t.statistics[a].value=f+r*u;break;case"avg_angle":t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});var y=t.statistics[a].x,_=t.statistics[a].y,g=(p=t.statistics[a].nanCount,Math.PI/180);null==u||isNaN(u)?t.statistics[a].nanCount=p+r:(t.statistics[a].x=y+r*Math.cos(u*g),t.statistics[a].y=_+r*Math.sin(u*g));break;case"mode":t.statistics[a]||(t.statistics[a]={}),f=t.statistics[a][u]||0,t.statistics[a][u]=f+r}}},e.prototype._aggregateStatistics=function(e,t){for(var r=0,i=this._fields;r<i.length;r++){var n=i[r],s=n.name;switch(n.outStatistic.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var a in e[s]||(e[s]={}),t[s]){var o=e[s][a]||0;e[s][a]=o+t[s][a]}}}},e.prototype._normalizeStatistics=function(e,t){for(var r={},i=0,n=this._fields;i<n.length;i++){var s=n[i],a=s.name;switch(s.outStatistic.statisticType){case"norm":var o=e[a];if(t&&null==o.onStatisticNormalizationField)break;if(t&&o.onStatisticNormalizationField){r[a]=o.onStatisticField/o.onStatisticNormalizationField;break}r[a]=0;break;case"sum":if(!t)break;var u=e[a],l=u.value;if(!(t-(h=u.nanCount)))break;r[a]=l;break;case"avg":if(!t)break;var c=e[a];if(l=c.value,!(t-(h=c.nanCount)))break;r[a]=l/(t-h);break;case"avg_angle":if(!t)break;var h,d=e[a],f=d.x,p=d.y;if(!(t-(h=d.nanCount)))break;var y=f/(t-h),_=p/(t-h),g=180/Math.PI,v=Math.atan2(_,y)*g;r[a]=v;break;case"mode":var m=e[a],b=0,x=null;for(var I in m){var S=m[I];S>b&&(b=S,x=I)}r[a]="null"===x?null:x}}return r},e}();t.GeohashTree=s;var a=function(){function e(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}return e.prototype.realloc=function(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this},e.prototype.getLngLatBounds=function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),s=30-(2*t+3*r),a=this.xNode<<i,o=this.yNode<<s;return n.decodeGeohashXY({geohashX:a,geohashY:o},this.depth)},e.prototype.find=function(e,t,r,i,n,s){if(i>=r)return this;var a=1-i%2,o=3*a+2*(1-a),u=2*a+3*(1-a),l=30-n-o,c=30-s-u,h=((e&7*a+3*(1-a)<<l)>>l)+((t&3*a+7*(1-a)<<c)>>c)*(8*a+4*(1-a)),d=this.children[h];return null==d?null:d.find(e,t,r,i+1,n+o,s+u)},e}()}.apply(null,i))||(e.exports=n)},1702:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(4),r(15),r(324),r(675),r(677),r(1467)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1};t.computePxBuffer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,h;return r.__generator(this,(function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(s=e.getSymbols(),a=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map((function(e){return e.size})).reduce(g,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(g,0):"real-world-size"===r.transformationType?30:void 0}(e),o=[],u=0,l=s;u<l.length;u++)c=l[u],o.push(y(c,a));return[4,i.all(o)];case 1:return h=r.sent(),[2,n.pt2px(h.reduce(g,0))]}}))}))};var c=[0,0,0,0];function h(e,t){return null==e?t:e}function d(e,t){return null==e.outline?t:h(e.outline.width,t)}var f={sdf:!0,code:99,metrics:o.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new s.default(0,0,24,24),page:0,textureBinding:2};function p(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,o,l,y,g,v,m,b,x,I,S,w;return r.__generator(this,(function(T){switch(T.label){case 0:return"simple-marker"===e.type?(i=Math.max(h(e.size,12),t),[2,_(e)+.707*i]):"picture-marker"===e.type?(n=Math.max(h(e.height,12),t),s=h(e.width,12)*(n/h(e.height,12)),o=s/2,l=n/2,[2,_(e)+Math.sqrt(o*o+l*l)]):"text"===e.type?(y=function(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[f]};for(var i=[],n=0;n<t;n++)i.push(r.__assign(r.__assign({},f),{code:e.text.charCodeAt(n)}));return{glyphMosaicItems:i}}(e),u.getTextSymbolSize(c,e,y),g=Math.abs(c[0]),v=Math.abs(c[1]),m=c[2],b=c[3],[2,Math.max(g,v)+Math.max(m,b)]):"simple-line"===e.type?(x=e,I=Math.max(h(x.width,.75),t)/2,x.marker?[2,Math.max(6*x.width,2*t)]:[2,I]):"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(d(e,0),t)/2]:"cim"===e.type?(S=a.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(S.width*S.width+S.height*S.height)]:[2,0]:"web-style"!==e.type?[3,2]:(w=p,[4,e.fetchCIMSymbol()]);case 1:return[2,w.apply(void 0,[T.sent(),t])];case 2:return[2,0]}}))}))}function y(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return function(e){return e.type in l}(e)?(n=(i=Math).min,[4,p(e,t)]):[2,0];case 1:return[2,n.apply(i,[r.sent(),75])]}}))}))}function _(e){var t=h(e.xoffset,0),r=h(e.yoffset,0);return Math.sqrt(t*t+r*r)}function g(e,t){return Math.max(e,t)}}.apply(null,i))||(e.exports=n)},2122:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(247),r(11),r(25),r(5),r(4),r(13),r(238),r(1),r(49),r(29),r(412),r(2123),r(432),r(431),r(675),r(1699),r(2124),r(2125),r(2126),r(1518),r(2128),r(695)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g,v,m,b,x,I,S,w){Object.defineProperty(t,"__esModule",{value:!0});var T=a.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),F=s("esri-featurelayer-webgl"),M=s("esri-mobile"),E={maxDrillLevel:F&&"object"==typeof F&&null!=F.maxDrillLevel?F.maxDrillLevel:M?1:4,maxRecordCountFactor:F&&"object"==typeof F&&null!=F.maxRecordCountFactor?F.maxRecordCountFactor:M?1:3,enablePBFQuery:!F||"object"!=typeof F||null==F.enablePBFQuery||F.enablePBFQuery},R=new Set,C=[],O=function(){function e(e,t){var r=this;this.objectIdField=t,l.openWithPorts(e).then((function(e){return r.client=e}))}return e.prototype.destroy=function(){this.client.close(),this.client=null},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.client.invoke("queryFeatures",e.toJSON(),t)];case 1:return i=r.sent(),[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),P=function(){function e(e,t){this.source=e,this.sourceSpatialReference=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,y.executeQueryPBF(this.source,e,{type:"optimized",sourceSpatialReference:this.sourceSpatialReference},t)];case 1:return[2,r.sent().data]}}))}))},e}(),j=function(){function e(e,t,r){this.source=e,this.objectIdField=t,this.sourceSpatialReference=r}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,y.executeQuery(this.source,e,this.sourceSpatialReference,t)];case 1:return i=r.sent().data,[2,f.convertFromFeatureSet(i,this.objectIdField)]}}))}))},e}(),A=function(){function e(e,t){this.source=e,this.objectIdField=t}return e.prototype.destroy=function(){},e.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,p.queryOptimizedFeatureSet(this.source,e,t)]}))}))},e}(),G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._dataTileIndex=new x.default,t._editsQueue=new m.EditsQueue({processEdits:t._processEdits.bind(t)}),t._featuresInFlight=new Map,t.service=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this._createFeatureStore();t.onFeatureAdd=this.onFeatureAdd.bind(this),t.onFeatureRemove=this.onFeatureRemove.bind(this),this._set("featureStore",t),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach((function(e){return e.done=!1})),this._fetchQueue=new w({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._fetchTile(t,this.queryInfo,i)];case 1:return e=r.sent(),[2,{dataTile:t,featureSet:e}]}}))}))}}),this._patchQueue=new w({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new S.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._updateTile(t,r,i)}});var i,n=this.service,s=n.capabilities,a=n.source,o=n.objectIdField,u=n.spatialReference;(i=a)&&i.capabilities&&i.collectionId&&i.layerDefinition&&i.url?this.sourceAdapter=new A(a,o):Array.isArray(a)?this.sourceAdapter=new O(a,o):E.enablePBFQuery&&s.query.supportsFormatPBF?this.sourceAdapter=new P(a,u):this.sourceAdapter=new j(a,o,u),this.handles.add([this.watch("updating",(function(t){return!t&&e.onIdle()}))]),this.featureStore.events.on("valueRangesChanged",(function(t){e.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:t.valueRanges}})}))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy(),this.sourceAdapter.destroy()},Object.defineProperty(t.prototype,"queryEngine",{get:function(){return this._createQueryEngine(this.featureStore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.viewState||this._fetchQueue.updating||this._patchQueue.updating||this._updateQueue.updating||this._editsQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,l=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.validateConfig(e),i=JSON.stringify(this.config.filters),n=this.renderer.getAttributeHash(),s=e.availableFields.filter((function(e){return-1===l.availableFields.indexOf(e)})),a=this.config.definitionExpression,this._set("config",e),a!==this.config.definitionExpression&&this._set("queryEngine",this._createQueryEngine(this.featureStore)),[4,this.updatePixelBuffer()];case 1:return r.sent(),o=i!==JSON.stringify(e.filters),u=n!==this.renderer.getAttributeHash(),t?u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,3]:[3,6];case 2:r.sent(),r.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return r.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 5:return r.sent(),this.refresh(),[2];case 6:return s.length?[4,this._handleAttributeChange(s)]:[3,8];case 7:r.sent(),r.label=8;case 8:return"heatmap"===this.renderer.type?[2]:u?[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,10];case 9:r.sent(),this.featureStore.forEach((function(e){return l.attributeStore.setAttributeData(e.localId,e,l.geometryInfo,l.viewParams)})),r.label=10;case 10:return[4,this.attributeStore.updateFilters(this)];case 11:return r.sent(),[4,this.featureStore.update(o,e,this.service.fields)];case 12:return r.sent(),[4,this.attributeStore.sendUpdates()];case 13:return r.sent(),[2]}}))}))},t.prototype.invalidate=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i;return r.__generator(this,(function(r){for(e=0,t=this.tileStore.tiles;e<t.length;e++)i=t[e],this._updateQueue.push(i.id,Date.now());return[2]}))}))},t.prototype.onIdle=function(){this.featureStore.sweepClusters()},t.prototype.onEdits=function(e){var t=this;return this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then((function(){t._editsQueue.updating||t._fetchQueue.resume()}))},t.prototype.queryFeatures=function(e){return this.queryEngine.executeQuery(e)},t.prototype.queryFeatureCount=function(e){return this.queryEngine.executeQueryForCount(e)},t.prototype.queryObjectIds=function(e){return this.queryEngine.executeQueryForIds(e)},t.prototype.queryExtent=function(e){return this.queryEngine.executeQueryForExtent(e)},t.prototype.queryStatistics=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n=this;return r.__generator(this,(function(s){switch(s.label){case 0:return e=0,t=0,i=0,[4,o.all(this.tileStore.tiles.map((function(s){return r.__awaiter(n,void 0,void 0,(function(){var n,a,o,u,l,c,h,f,p,y,_;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.queryInfo,a=n.returnCentroid,o=n.returnGeometry,u=this._pixelBuffer,l={pixelBuffer:u,returnGeometry:o,returnCentroid:a,returnOutline:this.returnOutline},c=performance.now(),[4,this.featureStore.executeTileQuery(s,this.spatialReference,l)];case 1:for(h=r.sent().features,f=performance.now(),i+=f-c,e+=h.length,p=0,y=h;p<y.length;p++)(_=y[p]).geometry&&(d.isPolygon(_.geometry)?t+=_.geometry.rings.reduce((function(e,t){return e+t.length}),0):d.isPolyline(_.geometry)&&(t+=_.geometry.paths.reduce((function(e,t){return e+t.length}),0)));return[2]}}))}))})))];case 1:return s.sent(),[2,r.__assign(r.__assign({},this.featureStore.storeStatistics),{displayedFeatureCount:e,displayedVertexCount:t,displayPreProcessTime:i})]}}))}))},t.prototype.refresh=function(){return r.__awaiter(this,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){switch(t.label){case 0:return this._queryInfoHash=Math.random().toString(),this._dataTileIndex.clear(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),[4,u.whenFalseOnce(this._fetchQueue,"updating")];case 1:return t.sent(),this._updateQueue.clear(),[4,u.whenFalseOnce(this._updateQueue,"updating")];case 2:return t.sent(),this.featureStore.startMarkingUsedFeatures(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),[4,u.whenFalseOnce(this._fetchQueue,"updating")];case 3:return t.sent(),this.featureStore.sweep(),this.featureStore.forEach((function(t){return e.attributeStore.setAttributeData(t.localId,t,e.geometryInfo,e.viewParams)})),this.attributeStore.sendUpdates(),this._updateQueue.resume(),[2]}}))}))},t.prototype.setViewState=function(t){var r=this,i=this.viewState&&this.viewState.scale;e.prototype.setViewState.call(this,t),this._fetchQueue.state=t,this._updateQueue.state=t,i!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach((function(e){return r.attributeStore.setAttributeData(e.localId,e,r.geometryInfo,r.viewParams)})),this.attributeStore.sendUpdates()),this.featureStore.setScale(this.viewState.scale)},t.prototype.getAggregate=function(e){return this.featureStore.getAggregate(e)},t.prototype.getAggregateValueRanges=function(){return this.featureStore.getAggregateValueRanges()},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed),this.featureStore.onTileUpdate(e)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=r.__assign(r.__assign({},t),e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}}))}))},t.prototype._fetchChangedTileFields=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){return(i=this._dataTileIndex.get(e.id))?[2,this._fetchChangedTileFieldsDrill(i,t)]:[2]}))}))},t.prototype._fetchChangedTileFieldsDrill=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,l,c,h,d,f,p,y=this;return r.__generator(this,(function(_){switch(_.label){case 0:return n=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||i>=E.maxDrillLevel,s=e.key,a={key:s,dataTile:e,queryInfo:n},[4,this._patchQueue.push(a)];case 1:return(u=_.sent()).exceededTransferLimit&&i<E.maxDrillLevel?(l=e.tile.createChildTiles(),c=l.map((function(t){var r=new b.default;return r.tile=t,r.displayTile=e.displayTile,r})),[4,o.all(c.map((function(e){return y._fetchChangedTileFieldsDrill(e,t,i+1)})))]):[3,3];case 2:return _.sent(),[2];case 3:for(h=0,d=u.features;h<d.length;h++)f=d[h],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return[2]}}))}))},t.prototype._fetchChangedTileFieldsPaged=function(e,t,i){return void 0===i&&(i=0),r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,u,l,c,h,d,f,p;return r.__generator(this,(function(y){switch(y.label){case 0:return n=this.service.capabilities.query.supportsMaxRecordCountFactor,s=this.service.tileMaxRecordCount,a=s*(n?1:E.maxRecordCountFactor),o=r.__assign(r.__assign({},this.queryInfo),{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:i*a,num:a}),e.returnExceeded=!0,u=e.key,l={key:u,dataTile:e,queryInfo:o},[4,this._patchQueue.push(l)];case 1:for(c=y.sent(),h=0,d=c.features;h<d.length;h++)f=d[h],this.featureStore.has(f.objectId)?(p=this.featureStore.getFeature(f.objectId)).attributes=r.__assign(r.__assign({},p.attributes),f.attributes):this._featuresInFlight.set(f.objectId,f);return c.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,i+1)]:[2]}}))}))},t.prototype._fetchChangedFields=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.tileStore.tiles,i=t.map((function(t){return n._fetchChangedTileFields(t,e)})),[4,o.all(i)];case 1:return r.sent(),[2]}}))}))},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,s="esriGeometryPoint"===this.service.geometryType,a=function(e){var t=r.get(e.id);t?(t.displayTile=e,s?r.forEach((function(r){I.isChildOf(r,t)&&(r.displayTile=e)})):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),o._processDataTile(t)},o=this,u=0,l=e;u<l.length;u++)a(d=l[u]);if(t)for(var c=0,h=t;c<h.length;c++){var d=h[c];R.add(d),n.abort(d.id)}r.forEach((function(e){R.has(e.displayTile)&&C.push(e)}));for(var f=0,p=C;f<p.length;f++){var y=p[f];i.abort(y.id),r.delete(y)}C.length=0,R.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,s=this._dataTileIndex,a=this._fetchQueue,u=i.id,l=this._queryInfoHash,c=i.level-r.key.level>=E.maxDrillLevel;if(s.add(e),e.done||a.has(u)){if(e.queryInfoHash!==l||e.returnExceeded!==c)if(e.done)e.done=!1;else{if(!a.isOngoing(u))return e.queryInfoHash=l,void(e.returnExceeded=c);a.abort(u)}}else e.queryInfoHash=l,e.returnExceeded=c;e.done?this._invalidateTile(e.displayTile):a.has(u)||a.push(e).then((function(e){return t._handleResponse(e.dataTile,e.featureSet)})).catch((function(r){o.isAbortError(r)||(T.error(new n("featurelayer-controller:tile-error","Encountered an error when handling tile response",r)),e.done=!0,t._invalidateTile(e.displayTile))}))},t.prototype._handleResponse=function(e,t){if(e.done=!0,f.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else{for(var r=e.tile.createChildTiles(),n=0,s=r;n<s.length;n++){var a=s[n],o=new b.default;o.tile=a,o.displayTile=e.displayTile,this._processDataTile(o)}i.release(r)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach((function(t){I.isChildOf(t,e)&&C.push(t)}));for(var t=0,r=C;t<r.length;t++){var i=r[t];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}C.length=0},t.prototype._createQuery=function(e,t,r,i,n,s){var a=this.service.geometryType,o=this._createDefaultQuery(i);return o.maxRecordCountFactor=n,o.returnExceededLimitFeatures=s,o.resultType="tile",o.geometry=e,this.service.capabilities.query.supportsQuantization?(o.quantizationParameters=new _.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===a&&(o.maxAllowableOffset=r)):"esriGeometryPolyline"!==a&&"esriGeometryPolygon"!==a||(o.maxAllowableOffset=r),o},t.prototype._fetchTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o,u,l,c,d,p,y,_;return r.__generator(this,(function(r){switch(r.label){case 0:return n=new h({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),s=this.service.geometryType,a="esriGeometryPoint"===s?e.tile:e.displayTile,o=a.extent,u=a.resolution,l=e.returnExceeded,c=this._createQuery(n,o,u,t,E.maxRecordCountFactor,l),[4,this.sourceAdapter.executeQuery(c,i)];case 1:if((d=r.sent()).transform&&"esriGeometryPolygon"===s)for(p=0,y=d.features;p<y.length;p++)(_=y[p]).geometry=f.removeCollinearVectices(_.geometry,_.geometry,s,!1,!1);return[2,d]}}))}))},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var s=n[i].tile;r.push(s.id,s.updateTimestamp)}},t.prototype._updateTile=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,l,c,h,d,f,p,y,_,v=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.tileStore.get(e),s=this.queryInfo,a=s.returnCentroid,u=s.returnGeometry,l=this._pixelBuffer,c={pixelBuffer:l,returnGeometry:u,returnCentroid:a,returnOutline:this.returnOutline},[4,this.featureStore.executeTileQuery(n,this.spatialReference,c)];case 1:return h=r.sent(),d=h.features,f=h.objectIds,[4,this.attributeStore.sendUpdates()];case 2:return r.sent(),p={geometryType:this.service.geometryType,features:d,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform},y=[],_=!0,this._dataTileIndex.forEach((function(e){n.id!==e.id&&I.isChildOf(e,n)&&_&&!e.done&&(_=!1)})),_&&n&&n.objectIds.forEach((function(e){if(!f.has(e)){var t=v.attributeStore.getLocalId(e);y.push(t)}})),f.forEach((function(e){n.objectIds.add(e)})),n.updateTimestamp=t,[2,this.processor.onTileData(n,{clear:!0,addOrUpdate:p.features,remove:y,transformParams:g.Utils.getTransformParams(p)},i).catch((function(e){o.isAbortError(e)||T.error("update-tile",e)}))]}}))}))},t.prototype._processEdits=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,u,l,c=this;return r.__generator(this,(function(h){switch(h.label){case 0:return n=this._createTempQueryEngine(),s=this._createObjectIdsQuery(e),e.length?[4,this.sourceAdapter.executeQuery(s)]:[3,2];case 1:a=h.sent(),f.hydrateOptimizedFeatureSet(a),this._dataTileIndex.addOrUpdateFeatures(a.features),n.featureStore.addMany(a.features),h.label=2;case 2:return u=t.concat(e).map((function(e){return c.attributeStore.getLocalId(e)})),this._dataTileIndex.deleteFeaturesById(t),this.attributeStore.sendUpdates(),l=r.__assign(r.__assign({},this.queryInfo),{pixelBuffer:this._pixelBuffer,returnOutline:this.returnOutline}),this.tileStore.tiles.map((function(e){return r.__awaiter(c,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.featureStore.executeTileQuery(e,this.spatialReference,l)];case 1:return t=r.sent().features,s={transform:e.transform,hasZ:!1,hasM:!1},[2,this.processor.onTileData(e,{addOrUpdate:t,remove:u,transformParams:s},i).catch((function(e){o.isAbortError(e)||T.error("update-tile",e)}))]}}))}))})),n.destroy(),[2]}}))}))},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},r.__decorate([c.property()],t.prototype,"_fetchQueue",void 0),r.__decorate([c.property()],t.prototype,"_patchQueue",void 0),r.__decorate([c.property()],t.prototype,"_updateQueue",void 0),r.__decorate([c.property()],t.prototype,"_editsQueue",void 0),r.__decorate([c.property({readOnly:!0})],t.prototype,"featureStore",void 0),r.__decorate([c.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([c.property()],t.prototype,"sourceAdapter",void 0),r.__decorate([c.property({readOnly:!0,dependsOn:["featureStore","service"]})],t.prototype,"queryEngine",null),r.__decorate([c.property({dependsOn:["viewState","_fetchQueue.updating","_updateQueue.updating","_patchQueue.updating","_editsQueue.updating"]})],t.prototype,"updating",null),r.__decorate([c.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],t)}(v.default);t.default=G}.apply(null,i))||(e.exports=n)},2123:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(33),r(30),r(11),r(5),r(76),r(412),r(330),r(1397),r(1397),r(1646),r(1470),r(413),r(440),r(305)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,h,d,f,p,y,_){Object.defineProperty(t,"__esModule",{value:!0});var g=a.getLogger("esri.layers.graphics.sources.ogcfeature");function v(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,m(e,t,i)];case 1:return n=r.sent(),[2,u.convertToFeatureSet(n)]}}))}))}function m(e,t,n){var s;return r.__awaiter(this,void 0,void 0,(function(){var a,f,p,y,_,g,v,m,b,x,I,S,w,T,F,M,E,R,C,O,P,j,A,G,k,B,N,Q,D,z,V,L,q;return r.__generator(this,(function(U){switch(U.label){case 0:return a=e.capabilities.query.maxRecordCount,f=e.collectionId,p=e.layerDefinition,y=e.url,_=y+"/collections/"+f+"/items",g=t.geometry,v=t.num,m=t.outSpatialReference,b=t.start,x=t.timeExtent,I=t.where,S=h.project(g,o.WGS84),w=function(e){return e?e.xmin+","+e.ymin+","+e.xmax+","+e.ymax:null}(S),T=function(e){if(!e)return null;var t=e.start,r=e.end;return(t?t.toISOString():"..")+"/"+(r?r.toISOString():"..")}(x),F=function(e){return e&&"1=1"!==e?e:null}(I),M=null!=b?b:0,E=null!=v?v:null!=b&&void 0!==b?10:a,[4,i(_,r.__assign(r.__assign({},n),{query:{bbox:w,datetime:T,query:F,limit:E,startindex:M,f:"application/geo+json"}}))];case 1:if(R=U.sent().data,C=null===(s=R.links)||void 0===s?void 0:s.filter((function(e){return"next"===e.rel})),O=0!==(null==C?void 0:C.length),P=p.fields,j=p.globalIdField,A=p.hasM,G=p.hasZ,k=p.objectIdField,B=p.geometryType,N=d.createOptimizedFeatures(R,{geometryType:B,hasZ:G,objectIdFieldName:k}),!o.equals(m,o.WGS84))for(Q=0,D=N;Q<D.length;Q++)(L=D[Q]).geometry&&(L.geometry=u.convertFromGeometry(c.project(u.convertToGeometry(L.geometry,B,G,!1),o.WGS84,m)));for(z=0,V=N;z<V.length;z++)(L=V[z]).objectId=L.attributes[k];return(q=new l.default).exceededTransferLimit=O,q.features=N,q.fields=P,q.geometryType=B,q.globalIdFieldName=j,q.hasM=A,q.hasZ=G,q.objectIdFieldName=k,q.spatialReference=m||o.WGS84,[2,q]}}))}))}t.getCollectionDefinition=function(e,t,a,u,l){return void 0===l&&(l=5),r.__awaiter(this,void 0,void 0,(function(){var h,_,v,m,b,x,I,S,w,T,F,M,E,R,C;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c.checkProjectionSupport(o.WGS84,a.spatialReference)];case 1:return r.sent(),[3,3];case 2:throw r.sent(),new s("ogc-feature-layer:projection-not-supported","Projection not supported");case 3:return[4,i(e+"/collections/"+t+"/items",{signal:u,query:{limit:l,f:"application/geo+json"}})];case 4:return h=r.sent().data,[4,d.validateGeoJSON(h)];case 5:if(r.sent(),_=d.inferLayerProperties(h,{geometryType:a.geometryType}),v=a.fields||_.fields||[],m=null!=a.hasZ?a.hasZ:_.hasZ,b=_.geometryType,x=a.objectIdField||_.objectIdFieldName||"OBJECTID",I=a.timeInfo,S=n.find(v,(function(e){return e.name===x})))S.type="esriFieldTypeOID",S.editable=!1,S.nullable=!1;else{if(!_.objectIdFieldType)throw new s("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");v.unshift({name:x,alias:x,type:"esriFieldTypeOID",editable:!1,nullable:!1})}if(x!==_.objectIdFieldName&&(F=n.find(v,(function(e){return e.name===_.objectIdFieldName})))&&(F.type="esriFieldTypeInteger"),!b)throw new s("ogc-feature-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");for(v===_.fields&&_.unknownFields.length>0&&g.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:_.unknownFields}}),w=0,T=v;w<T.length;w++){if(null==(F=T[w]).name&&(F.name=F.alias),null==F.alias&&(F.alias=F.name),"esriFieldTypeOID"!==F.type&&"esriFieldTypeGlobalID"!==F.type&&(F.editable=null==F.editable||!!F.editable,F.nullable=null==F.nullable||!!F.nullable),!F.name)throw new s("ogc-feature-layer:invalid-field-name","field name is missing",{field:F});if(-1===y.kebabDict.jsonValues.indexOf(F.type))throw new s("ogc-feature-layer:invalid-field-type",'invalid type for field "'+F.name+'"',{field:F})}return I&&(M=new p(v),I.startTimeField&&((E=M.get(I.startTimeField))?(I.startTimeField=E.name,E.type="esriFieldTypeDate"):I.startTimeField=null),I.endTimeField&&((R=M.get(I.endTimeField))?(I.endTimeField=R.name,R.type="esriFieldTypeDate"):I.endTimeField=null),I.trackIdField&&((C=M.get(I.trackIdField))?I.trackIdField=C.name:(I.trackIdField=null,g.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:I}}))),I.startTimeField||I.endTimeField||(g.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:I}}),I=null)),[2,{drawingInfo:f.createDrawingInfo(b),geometryType:b,fields:v,hasZ:!!m,objectIdField:x,timeInfo:I}]}}))}))},t.getServerCollection=function(e,t,n,s){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections/"+t,{signal:s,query:{f:n}})];case 1:return[2,r.sent().data]}}))}))},t.getServerCollections=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/collections",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerConformance=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e+"/conformance",{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.getServerLandingPage=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i(e,{signal:n,query:{f:t}})];case 1:return[2,r.sent().data]}}))}))},t.queryFeatureSet=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v(e,t,i)];case 1:return n=r.sent(),[2,_.fromJSON(n)]}}))}))},t.queryFeatureSetJSON=v,t.queryOptimizedFeatureSet=m}.apply(null,i))||(e.exports=n)},2124:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(4),r(1),r(14)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=[],r._onGoingRequest=null,r._abortController=n.createAbortController(),r}return r.__extends(t,e),t.prototype.destroy=function(){this.clear()},Object.defineProperty(t.prototype,"updating",{get:function(){return!this.destroyed&&(this._queue.length>0||null!=this._onGoingRequest)},enumerable:!0,configurable:!0}),t.prototype.clear=function(){if(this.destroyed)throw new Error("instance is already destroyed");for(var e=this._queue.pop();e;)e.resolver.reject(n.createAbortError()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=n.createAbortController()},t.prototype.push=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i=this;return r.__generator(this,(function(r){if(this.destroyed)throw new Error("instance is already destroyed");return t=n.createResolver(),this._queue.push({event:e,resolver:t}),this.notifyChange("updating"),Promise.resolve().then((function(){i._processNext()})),[2,t.promise]}))}))},t.prototype._processNext=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s,a,o,u,l,c,h,d,f,p,y,_,g,v,m,b,x,I,S=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(this._onGoingRequest)return[2];for(e=[],t=new Set,i=new Set,n=new Set,s=this._queue.shift();s;){for(a=s.event,o=a.addedFeatures,u=a.deletedFeatures,l=a.updatedFeatures,c=s.resolver,e.push(c),h=0,d=o;h<d.length;h++)f=d[h],b=f.objectId,f.error||(t.add(b),i.add(b),n.delete(b));for(p=0,y=l;p<y.length;p++)_=y[p],b=_.objectId,_.error||(i.add(b),n.delete(b));for(g=0,v=u;g<v.length;g++)m=v[g],b=m.objectId,m.error||(t.has(b)?t.delete(b):n.add(b),i.delete(b));s=this._queue.shift()}return i.size||n.size?(x=[],I=[],i.size&&i.forEach((function(e){x.push(e)})),n.size&&n.forEach((function(e){I.push(e)})),this._onGoingRequest=Promise.resolve().then((function(){return S.processEdits(x,I,{signal:S._abortController.signal})})).catch((function(){})),this.notifyChange("updating"),[4,this._onGoingRequest]):(this.notifyChange("updating"),e.forEach((function(e){return e()})),[2]);case 1:return r.sent(),this._onGoingRequest=null,this.notifyChange("updating"),e.forEach((function(e){return e()})),this._queue.length>0&&this._processNext(),[2]}}))}))},r.__decorate([s.property({constructOnly:!0})],t.prototype,"processEdits",void 0),r.__decorate([s.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([s.subclass("esri.views.2d.layers.features.controllers.EditsQueue")],t)}(i);t.EditsQueue=a}.apply(null,i))||(e.exports=n)},2125:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},2126:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2127),r(1427),r(1518)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=[],a=new Set,o=function(){function e(){this._tileById=new Map,this._tilesToFeatures=new Map,this._featureToTiles=new Map}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var i=e;this._tileById.set(i.id,i),this._tilesToFeatures.set(i,r.default.acquire()),this._tilesToFeatures.forEach((function(e,r){i!==r&&(n.isParentOf(i,r)?e.forEach((function(e){t._link(i,e)})):n.isChildOf(i,r)&&t.featureStore.forEachInBounds(i.bounds,(function(r){e.has(r.objectId)&&t._link(i,r.objectId)})))}))}},e.prototype.clear=function(){this._tilesToFeatures.forEach((function(e){return r.default.release(e)})),this._tilesToFeatures.clear(),this._featureToTiles.forEach((function(e){return r.default.release(e)})),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);s.length=0,this._tilesToFeatures.get(r).forEach((function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?s.push(e):t._unlink(r,e)}));for(var i=0,n=s;i<n.length;i++){var a=n[i];this._unlink(r,a)}this.featureStore.removeManyById(s),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),s.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var i=this,n=this.get(e.id);this._tilesToFeatures.has(n)||(this._tileById.set(n.id,n),this._tilesToFeatures.set(n,r.default.acquire()));for(var o=0,u=t;o<u.length;o++){var l=u[o];a.add(l.objectId)}s.length=0,this._tilesToFeatures.get(n).forEach((function(e){if(!a.has(e)){var t=i._featureToTiles.get(e);t.has(n)&&1===t.size?s.push(e):i._unlink(n,e)}}));for(var c=0,h=s;c<h.length;c++){var d=h[c];this._unlink(n,d)}this.featureStore.removeManyById(s),this.featureStore.addMany(t),a.forEach((function(e){i._link(n,e)})),a.clear(),s.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new Set,n=new i.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),s=0,a=this.deleteFeaturesById(e.map((function(e){return e.objectId})));s<a.length;s++){var o=a[s];r.add(o)}n.addMany(e),this._tileById.forEach((function(e){n.forEachInBounds(e.bounds,(function(i){t._link(e,i.objectId),r.add(e)}))})),this.featureStore.addMany(e);var u=[];return r.forEach((function(e){return u.push(e)})),u},e.prototype.deleteFeaturesById=function(e){for(var t=this,i=new Set,n=function(e){var n=s._featureToTiles.get(e);n&&(n.forEach((function(r){i.add(r),t._tilesToFeatures.get(r).delete(e)})),r.default.release(n),s._featureToTiles.delete(e))},s=this,a=0,o=e;a<o.length;a++)n(o[a]);this.featureStore.removeManyById(e);var u=[];return i.forEach((function(e){return u.push(e)})),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,r.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(r.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=o}.apply(null,i))||(e.exports=n)},2127:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._pool=[],this._set=new Set}return e.prototype.acquire=function(){if(0===this._pool.length)return new Set;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return i.acquire()},e.release=function(e){return i.release(e)},e}();t.default=r;var i=new r}.apply(null,i))||(e.exports=n)},2128:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(4),r(54),r(1),r(35),r(734)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[0,0],c=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r.__extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=n.createAbortController();this._queue.set(e,{tileId:e,key:u.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=s.schedule(this._next))},t.prototype._next=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,i=e.tileId,n=e.key,u.TileKey.pool.release(n),this._queue.delete(i),this._onGoingTile=e,s=this.process(i,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(s))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s];case 2:case 3:return r.sent(),[3,4];case 4:return this._finalize(),[2]}}))}))},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=null;return this._queue.forEach((function(a){t.getTileCoords(l,a.key);var u=e._timestamp-a.timestamp;if(isNaN(u))(c=o.vec2.distance(l,r))<n&&(n=c,s=a);else if(u===i){var c;(c=o.vec2.distance(l,r))<n&&(n=c,s=a)}else u>i&&(i=u,n=Number.POSITIVE_INFINITY,s=a)})),s},r.__decorate([a.property({readOnly:!0})],t.prototype,"length",null),r.__decorate([a.property({constructOnly:!0})],t.prototype,"process",void 0),r.__decorate([a.property()],t.prototype,"state",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([a.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(i);t.default=c}.apply(null,i))||(e.exports=n)}}]);