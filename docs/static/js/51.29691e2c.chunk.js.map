{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js"],"names":["c","arguments","type","isAlignedMapTile","this","layer","increaseRasterJobHandlerUsage","e","updateFullExtent","addResolvingPromise","r","i","view","then","basemapTerrain","tilingScheme","tileInfo","t","indexOf","format","compatibleWith","toTileInfo","_set","updatingHandles","add","refresh","decreaseRasterJobHandlerUsage","document","createElement","getContext","size","width","height","clearRect","getImageData","lods","scale","length","levelRangeFromScaleRange","s","a","o","l","_canSymbolizeInWebGL","m","requestRawData","signal","requestAsImageElement","fetchTile","d","HTMLImageElement","h","pixelBlock","_blankTile","applyRenderer","p","n","symbolizerRenderer","symbolizer","rendererJSON","symbolizerParameters","generateWebGLParameters","_getSymbolizerOptions","transformGrid","isRendereredSource","interpolation","bandIds","lodAt","resolution","isGCS","spatialReference","isGeographic","x","y","JSON","stringify","lij","emit","suspended","supportsTextureFloat","canRenderInWebGL","readOnly","prototype","g"],"mappings":"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","file":"static/js/51.29691e2c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{unwrap as r,isNone as t}from\"../../../core/maybe.js\";import{whenTrueOnce as i}from\"../../../core/watchUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as o}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import n from\"../terrain/RasterTile.js\";import{ImageryTileLayerView as m}from\"../../layers/ImageryTileLayerView.js\";import d from\"../../layers/LayerView.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as p}from\"../../support/drapedUtils.js\";import y from\"../../webgl/capabilities.js\";let c=class extends(m(h(l(o(d))))){constructor(){super(...arguments),this.type=\"imagery-tile-3d\",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage();const e=this.updateFullExtent();this.addResolvingPromise(e);const r=i(this.view,\"basemapTerrain.tilingSchemeLocked\").then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:r}=this.layer,t=[\"png\",\"png24\",\"png32\",\"jpg\",\"mixed\"].indexOf(r.format)>-1&&e.compatibleWith(r);this.isAlignedMapTile=t;const i=t?r:e.toTileInfo();this._set(\"tileInfo\",i),this.updatingHandles.add(this,\"layer.renderer\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.interpolation\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.bandIds\",(()=>this.refresh())),this.updatingHandles.add(this,\"layer.multidimensionalDefinition\",(()=>this.refresh()))}));this.addResolvingPromise(r)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement(\"canvas\"),r=e.getContext(\"2d\"),[t,i]=this.tileInfo.size;return e.width=t,e.height=i,r.clearRect(0,0,t,i),r.getImageData(0,0,t,i)}get imageFormatIsOpaque(){return\"jpg\"===this.layer.tileInfo.format}get hasMixedImageFormats(){return\"mixed\"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,r=this.layer.tileInfo.lods,t=e[0].scale,i=r[r.length-1].scale;return this.levelRangeFromScaleRange(t,i)}async fetchTile(e,i,s,a){const o=this.tileInfo,l=this._canSymbolizeInWebGL(),m={tileInfo:o,requestRawData:l,signal:r(a.signal),requestAsImageElement:this.isAlignedMapTile},d=await this.layer.fetchTile(e,i,s,m);if(d instanceof HTMLImageElement)return d;let h=d&&d.pixelBlock;if(t(h))return this._blankTile;if(!l&&(h=await this.layer.applyRenderer(d),t(h)))return this._blankTile;const p=new n([e,i,s],h,o.size[0],o.size[1]);return l?(p.symbolizerRenderer=this.layer.symbolizer.rendererJSON,p.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),p.transformGrid=d.transformGrid):p.isRendereredSource=!0,p.interpolation=this.layer.interpolation,p.bandIds=this.layer.bandIds,p}_getSymbolizerOptions(e){const r=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:r,y:r},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,r){return p(e,r,this.view)}refresh(){this.emit(\"data-changed\")}async doRefresh(e){this.suspended||this.emit(\"data-changed\")}_canSymbolizeInWebGL(){return y().supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};e([s({readOnly:!0})],c.prototype,\"_blankTile\",null),e([s({readOnly:!0})],c.prototype,\"imageFormatIsOpaque\",null),e([s({readOnly:!0})],c.prototype,\"hasMixedImageFormats\",null),e([s({readOnly:!0})],c.prototype,\"dataLevelRange\",null),c=e([a(\"esri.views.3d.layers.ImageryTileLayerView3D\")],c);var g=c;export{g as default};\n"],"sourceRoot":""}