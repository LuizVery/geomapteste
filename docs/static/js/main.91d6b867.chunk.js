(this.webpackJsonpgeowebmap=this.webpackJsonpgeowebmap||[]).push([[52],{845:function(e,t){function i(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=845},847:function(e,t,i){},849:function(e,t,i){},850:function(e,t,i){"use strict";i.r(t);var a=i(111),n=i(423),o=i.n(n),r=i(807),s=i.n(r),l=i(21),u=i(3),p=i(4),c=i(6),h=i(7),d=i(23),v=i(34),_=i(679),f=i(397),m=i(270),g=i(819),y=i(817),b=i(820),I=i(684),S=i(823),E=i(372),w=i(822),L=i(818),O=i(682),A=i.n(O),T=i(821),k=i(280),M=i.n(k),x=i(683),V=i(812),C=i(813);function N(e){for(var t={},i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(a||[]).forEach((function(e,i){t[i]=e})),x.a.t(e,t)}var R=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"getResource",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return N.apply(void 0,[e].concat(i))}},{key:"isValidCoordinate",value:function(e){return!isNaN(e)&&null!==e}},{key:"findMinMax",value:function(e,t){return e.reduce((function(e,i){return null===(i=void 0!==t?i[t]:i)&&(i=void 0),e[0]=void 0===e[0]||i<e[0]?i:e[0],e[1]=void 0===e[1]||i>e[1]?i:e[1],e}),[])}},{key:"generateUniqueVals",value:function(t,i,a){var n={},o=[],r=e.getIndexWithLabel(a.color,t),s=a.visualizationType===e.VISUALIZATION_TYPE_CHOROPLETH;i.forEach((function(e){Object.prototype.hasOwnProperty.call(n,e[r])||(n[e[r]]=!0)}));for(var l=Object.keys(n),u=e.generateColors(l.length),p=0;p<l.length;p++)o.push({value:l[p],symbol:{type:s?"simple-fill":"simple-marker",color:u[p],size:s?null:6,style:s?"solid":"circle",outline:a.animation?null:{width:.5,color:a.outline}}});return o}},{key:"hasColorCategory",value:function(t,i){if(!t)return!1;var a=e.getIndexWithLabel(t,i);return a>-1&&("categorical"===i[a].usage||"string"===i[a].type)}},{key:"getNameWithLabel",value:function(e,t){var i=t.find((function(t){return t&&t.name===e}));return i||(i=t.find((function(t){return t&&t.label===e}))),i?i.name:null}},{key:"getIndexWithLabel",value:function(e,t){var i=t.findIndex((function(t){return t&&t.name===e}));return-1===i&&(i=t.findIndex((function(t){return t&&t.label===e}))),i}},{key:"getNameWithUsage",value:function(e,t){var i=t.find((function(t){return t&&t.usage===e}));return i?i.name:null}},{key:"logError",value:function(e){console&&console.error&&console.error(e)}},{key:"logInfo",value:function(e){console&&console.info&&console.info(e)}},{key:"publishMessage",value:function(t){var i=window.parent||window,a=e.selectionPublicationTargetOrigin();i&&i.postMessage(t,a)}},{key:"publishPropertyChange",value:function(t,i,a,n){this.publishMessage({event:e.PROPERTY_CHANGE_EVENT,resultName:t,name:i,newValue:a,oldValue:n})}},{key:"sqlEscape",value:function(t){return Array.isArray(t)?t.map(e.sqlEscapeImpl):e.sqlEscapeImpl(t)}},{key:"convertToEpochMS",value:function(e,t){return("DDMMYY8"===t&&"string"===typeof e?M.a.utc(e,"DD/MM/YYYY"):"DATE9"===t&&"string"===typeof e?M.a.utc(e,"DDMMMYYYY"):M.a.utc(e)).valueOf()}},{key:"selectionPublicationTargetOrigin",value:function(){return"*"}},{key:"sqlEscapeImpl",value:function(e){return"string"!==typeof e?e:"'"+e.replace(/[\0\x08\x09\x1a\n\r"'\\%]/g,(function(e){switch(e){case"\0":return"\\0";case"\b":return"\\b";case"\t":return"\\t";case"\x1a":return"\\z";case"\n":return"\\n";case"\r":return"\\r";case'"':case"'":case"\\":case"%":return"\\"+e;default:return e}}))+"'"}},{key:"generateColors",value:function(e){for(var t=Math.floor(Math.random()*Math.floor(360)),i=[],a=function(e,i){var a,n,o;a=n=o=0;var r=Math.floor(6*t),s=6*t-r,l=i*(1-e),u=i*(1-s*e),p=i*(1-(1-s)*e);switch(r%6){case 0:a=i,n=p,o=l;break;case 1:a=u,n=i,o=l;break;case 2:a=l,n=i,o=p;break;case 3:a=l,n=u,o=i;break;case 4:a=p,n=l,o=i;break;case 5:a=i,n=l,o=u}return{r:255*a,g:255*n,b:255*o,a:1}},n=0;n<e;n++)t+=.618033988749895,t%=1,i.push(a(.7,.95));return i}}]),e}();R.VISUALIZATION_TYPE_NONE="NONE",R.VISUALIZATION_TYPE_SCATTER="SCATTER",R.VISUALIZATION_TYPE_BUBBLE="BUBBLE",R.VISUALIZATION_TYPE_CHOROPLETH="CHOROPLETH",R.VISUALIZATION_TYPE_FILTERED="FILTERED",R.FIELD_NAME_OBJECT_ID="ObjectId",R.SAS_FEATURE_LAYER_ID="_sasFeatureLayerId",R.DEFAULT_PORTAL_URL="http://www.arcgis.com",R.PROPERTY_CHANGE_EVENT="change";var D=R,F=function(){function e(t){Object(u.a)(this,e),this._sasLayer=void 0,this._period=void 0,this._periodFormat=void 0,this._animationLabel=void 0,this._animationPlayButton=void 0,this._animationSlider=void 0,this._animationMin=void 0,this._animationMax=void 0,this._lastAnimationSliderValue=void 0,this._animation=void 0,this.resolvePeriodAndFormat(t),this.initializeAnimationControls()}return Object(p.a)(e,[{key:"generateSampleAnimationData",value:function(e,t,i,a){var n;n=D.hasColorCategory(t,e.columns)?-1:D.getIndexWithLabel(t,e.columns);for(var o=D.getIndexWithLabel(i,e.columns),r=D.getIndexWithLabel(a,e.columns),s=e.data.length,l=0;l<s;++l)for(var u=1;u<11;++u){var p=e.data[l].slice();p[r]=M.a.utc(D.convertToEpochMS(p[r],e.columns[r].format.formatString)).startOf(this._period).add(u,this._period).valueOf(),n>-1&&(p[n]=p[n]*u,isNaN(p[n])&&(p[n]=u)),o>-1&&(p[o]=2*p[o]*Math.random(),isNaN(p[o])&&(p[o]=2*Math.random())),(n>-1||o>-1||Math.random()>.75)&&e.data.push(p)}}},{key:"initializeAnimationData",value:function(e,t){this._lastAnimationSliderValue=null;var i=D.getIndexWithLabel(t,e.data.columns);this.convertDateColumn(e.data.data,i);var a=D.findMinMax(e.data.data,i);this._animationMin=M.a.utc(a[0]).startOf(this._period).valueOf(),this._animationMax=M.a.utc(a[1]).endOf(this._period).valueOf()}},{key:"initializeAnimation",value:function(e){this._sasLayer=e;var t=this.getAnimationSlider();this.processAnimationSliderValue(t?t.value:0)}},{key:"getAnimationSlider",value:function(){return this._animationSlider||(this._animationSlider=document.getElementById("animationSlider")),this._animationSlider}},{key:"getAnimationPlayButton",value:function(){return this._animationPlayButton||(this._animationPlayButton=document.getElementById("animationPlayButton")),this._animationPlayButton}},{key:"getAnimationLabel",value:function(){return this._animationLabel||(this._animationLabel=document.getElementById("animationLabel")),this._animationLabel}},{key:"initializeAnimationControls",value:function(){var e=this,t=function(t){e.stopAnimation(),e.processAnimationSliderValue(t.target.value)},i=this.getAnimationSlider();i&&(i.addEventListener("input",t),i.addEventListener("change",t));var a=this.getAnimationPlayButton();a&&a.addEventListener("click",(function(){e._animation?e.stopAnimation():e.startAnimation()}))}},{key:"convertDateColumn",value:function(e,t){var i=this;e.forEach((function(e){e[t]=M.a.utc(e[t]).startOf(i._period).valueOf()}))}},{key:"resolvePeriodAndFormat",value:function(t){var i;if(t){var a=t.toUpperCase();i=e._periodsAndFormats.find((function(e){return a===e.period}))}this._period=i?i.period:"years",this._periodFormat=i?i.format:"YYYY"}},{key:"updateAnimationLabel",value:function(e){var t=this.getAnimationLabel();t&&(t.innerHTML="object"===typeof e&&"format"in e?e.format(this._periodFormat):e)}},{key:"processAnimationSliderValue",value:function(t){var i=t/100*(this._animationMax-this._animationMin)+this._animationMin,a=M.a.utc(i).startOf(this._period);if(null===this._lastAnimationSliderValue||!a.isSame(this._lastAnimationSliderValue)){this._lastAnimationSliderValue=M()(a),this.updateAnimationLabel(a);var n=M()(a).subtract(1,this._period),o=M()(a).add(1,this._period);if(this._sasLayer){var r=e.hasClonableRenderer(this._sasLayer.renderer)?this._sasLayer.renderer.clone():this._sasLayer.renderer;r.symbol&&(r.symbol.outline=null),r.defaultSymbol&&(r.defaultSymbol.outline=null);var s=r.visualVariables.find((function(e){return"opacity"===e.type}));s&&(s.stops=[{opacity:0,value:n.valueOf()},{opacity:1,value:a.valueOf()},{opacity:0,value:o.valueOf()}]),r.visualVariables=r.visualVariables.slice(),this._sasLayer.renderer=r}}}},{key:"updateAnimationValue",value:function(){var e=this.getAnimationSlider();if(e){var t=parseInt(e.max,void 0),i=parseInt(e.min,void 0),a=parseFloat(e.value)+(t-i)/1e3;e.value=a>t?i.toString():a.toString(),this.processAnimationSliderValue(e.value)}}},{key:"startAnimation",value:function(){var t=this;this.stopAnimation();var i=this.getAnimationPlayButton();i&&(i.value="||"),this._animation=e.buildAnimationContext((function(){t.updateAnimationValue()}))}},{key:"stopAnimation",value:function(){if(this._animation){this._animation.remove(),this._animation=null;var e=this.getAnimationPlayButton();e&&(e.value=">>")}}}],[{key:"buildAnimationVisualVariable",value:function(e,t){return{type:"opacity",field:D.getNameWithLabel(t,e)}}},{key:"hasClonableRenderer",value:function(e){return e&&"function"===typeof e.clone}},{key:"buildAnimationContext",value:function(e){var t=!0;return function i(){t&&(e(),setTimeout((function(){window.requestAnimationFrame(i)}),1e3/30))}(),{remove:function(){t=!1}}}}]),e}();F._periodsAndFormats=[{period:"YEAR",format:"YYYY"},{period:"YEARS",format:"YYYY"},{period:"Y",format:"YYYY"},{period:"QUARTER",format:"L"},{period:"QUARTERS",format:"L"},{period:"Q",format:"L"},{period:"MONTH",format:"L"},{period:"MONTHS",format:"L"},{period:"M",format:"L"},{period:"WEEK",format:"L"},{period:"WEEKS",format:"L"},{period:"W",format:"L"},{period:"DAY",format:"L"},{period:"DAYS",format:"L"},{period:"D",format:"L"},{period:"HOUR",format:"LT"},{period:"HOURS",format:"LT"},{period:"H",format:"LT"},{period:"MINUTE",format:"LT"},{period:"MINUTES",format:"LT"},{period:"M",format:"LT"},{period:"SECOND",format:"LTS"},{period:"SECONDS",format:"LTS"},{period:"S",format:"LTS"},{period:"MILLISECOND",format:"x"},{period:"MILLISECONDS",format:"x"},{period:"MS",format:"x"}];var U,P=F;!function(e){e[e.error=0]="error",e[e.warning=1]="warning"}(U||(U={}));var j=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.error;Object(u.a)(this,e),this.message=void 0,this.severity=void 0,this.message=t,this.severity=i}return Object(p.a)(e,null,[{key:"error",value:function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return e.fromResource.apply(e,[U.error,t].concat(a))}},{key:"warning",value:function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return e.fromResource.apply(e,[U.warning,t].concat(a))}},{key:"fromResource",value:function(t,i){for(var a=arguments.length,n=new Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];return new e(D.getResource.apply(D,[i].concat(n)),t)}}]),e}(),W=j,z=i(56),Y=i(52),B=i(119),H=i(360),G=i(305),q=i(269),Z=function(){function e(t,i,a){Object(u.a)(this,e),this._options=void 0,this._rows=void 0,this._columns=void 0,this._options=t,this._rows=i,this._columns=a}return Object(p.a)(e,[{key:"supportsEdits",value:function(){return!1}},{key:"buildFeatureLayer",value:function(){return this.buildFeatureLayerImpl()}},{key:"getGeoIdFilter",value:function(){}},{key:"createGraphics",value:function(){var e=this.convertRowsToObjects(this._columns,this._rows),t=D.getNameWithLabel(this._options.y,this._columns),i=D.getNameWithLabel(this._options.x,this._columns);return e.map((function(e){return new B.a({geometry:new z.a({x:D.isValidCoordinate(e[i])?e[i]:0,y:D.isValidCoordinate(e[t])?e[t]:0}),attributes:e})}))}},{key:"createFields",value:function(){var e=[new G.a({name:D.FIELD_NAME_OBJECT_ID,alias:D.FIELD_NAME_OBJECT_ID,type:"oid"})];return this._columns.forEach((function(t){e.push(new G.a({name:t.name,alias:t.label,type:"number"===t.type?"double":t.type}))})),e}},{key:"convertRowsToObjects",value:function(e,t){var i=D.FIELD_NAME_OBJECT_ID;return t.map((function(t,a){var n={};n[i]=a;var o=0;return e.forEach((function(e){n[e.name]=o<t.length?t[o]:null,++o})),n}))}},{key:"createGenericUnformattedPopupTemplate",value:function(e){var t=this,i=[];return e.forEach((function(a){if(a.name!==D.FIELD_NAME_OBJECT_ID&&a.name!==D.getNameWithLabel(t._options.x,e)&&a.name!==D.getNameWithLabel(t._options.y,e)){var n={fieldName:a.name,label:a.label,visible:!0,format:{}};"number"!==a.type&&"double"!==a.type||(n.format={digitSeparator:!0}),i.push(n)}})),new q.a({title:this._options.title,content:[{type:"fields",fieldInfos:i}],fieldInfos:[]})}},{key:"validateRequiredOptions",value:function(e){var t,i=this,a=[];return e.forEach((function(e){e in i._options&&i._options[e]&&0!==i._options[e].toString().length||a.push(e)})),a.length>0&&(t=D.getResource("optionsNotIdentified",a.join(", "))),t?[new W(t)]:[]}},{key:"buildSimpleFeatureLayer",value:function(e){return new H.default({id:D.SAS_FEATURE_LAYER_ID,title:this._options.title,source:this.createGraphics(),fields:this.createFields(),objectIdField:D.FIELD_NAME_OBJECT_ID,renderer:e,spatialReference:Y.a.WGS84,elevationInfo:this.buildElevationInfo(),geometryType:"point",popupTemplate:this.createGenericUnformattedPopupTemplate(this._columns)})}},{key:"buildElevationInfo",value:function(){return{mode:this._options.useWebScene||this._options.use3D?"on-the-ground":"relative-to-ground"}}},{key:"validateCoordinates",value:function(e,t){var i=null,a=0,n=D.getIndexWithLabel(this._options.y,t),o=D.getIndexWithLabel(this._options.x,t);return n<0||o<0?i=W.error("dataNotIdentified"):(e.forEach((function(e){(!D.isValidCoordinate(e[n])||!D.isValidCoordinate(e[o])||Math.abs(Math.round(e[n]))>90||Math.abs(Math.round(e[o]))>180)&&++a})),a>0&&(i=W.warning("invalidCoordinates",a.toString()))),i?[i]:[]}}]),e}();Z.EDITS_COMPLETED="editsCompleted",Z.EDITS_APPLIED="editsApplied";var J=Z,Q=i(39),K=i(588),X=i(608),$=i(815),ee=i(816),te=i(824),ie=i(685),ae=function(){function e(){Object(u.a)(this,e),this._activeLegends=[]}return Object(p.a)(e,[{key:"addSmartLegends",value:function(e,t){if(e&&e.renderer&&!e.renderer.authoringInfo){var i=(e.renderer.visualVariables||[]).filter((function(e){return"size"===e.type||"color"===e.type})).map((function(e){return new X.a({type:e.type,maxSliderValue:0,minSliderValue:0})}));e.renderer.authoringInfo=new K.a({visualVariables:i})}this.addSmartLegendsImpl(e,t)}},{key:"expandTwoPartColorRange",value:function(e){if(e&&2===e.length){var t={value:(e[1].value-e[0].value)/2+e[0].value,color:this.midColor(e[0].color,e[1].color)};e.splice(1,0,t)}}},{key:"addSmartLegendsImpl",value:function(e,t){var i=this;this.removeSmartLegends(t),(e.renderer.visualVariables||[]).forEach((function(a){"size"===a.type?i.getHistogram(e,a).then((function(n){return i.calculateStatistics(e,a).then((function(o){var r=ie.a.fromRendererResult({renderer:e.renderer,statistics:o,visualVariables:[a]},n);i.addSlider(e,t,r)}))})):"color"===a.type&&i.getHistogram(e,a).then((function(n){return i.calculateStatistics(e,a).then((function(o){var r=new te.a({primaryHandleEnabled:!0,stops:a.stops,histogramConfig:{bins:n.bins,average:o.avg},min:o.min,max:o.max});i.addSlider(e,t,r)}))}))}))}},{key:"addSlider",value:function(e,t,i){var a=new E.a({expandIconClass:"esri-icon-question",view:t,content:i,group:"bottom-left"});t.ui.add(a,"bottom-left"),this._activeLegends.push(a);var n=i instanceof ie.a?this.buildOnSmartSizeSliderDataChangeFunction(e,i):this.buildOnSmartColorSliderDataChangeFunction(e,i);i.on("thumb-change",n),i.on("thumb-drag",n),i.on("max-change",n),i.on("min-change",n)}},{key:"buildOnSmartSizeSliderDataChangeFunction",value:function(e,t){return function(){var i=e.renderer.clone(),a=i.visualVariables.findIndex((function(e){return"size"===e.type}));a<0||(i.visualVariables.splice(a,1,t.updateVisualVariable(i.visualVariables[a])),e.renderer=i)}}},{key:"buildOnSmartColorSliderDataChangeFunction",value:function(e,t){return function(){var i=e.renderer.clone(),a=i.visualVariables.findIndex((function(e){return"color"===e.type}));if(!(a<0)){var n=i.visualVariables[a].clone();n.stops=t.stops,i.visualVariables.splice(a,1,n),e.renderer=i}}}},{key:"midColor",value:function(e,t){e=new Q.a(e),t=new Q.a(t);var i=function(e,t){var i,a;return e>t?(i=e,a=t):(i=t,a=e),(i-a)/2+a};return new Q.a({a:i(e.a,t.a),b:i(e.b,t.b),r:i(e.r,t.r),g:i(e.g,t.g)})}},{key:"removeSmartLegends",value:function(e){this._activeLegends.forEach((function(t){e.ui.remove(t)})),this._activeLegends=[]}},{key:"calculateStatistics",value:function(e,t){return Object(ee.a)({layer:e,field:t.field})}},{key:"getHistogram",value:function(e,t){return Object($.a)({layer:e,field:t.field})}}]),e}(),ne=function(e){Object(c.a)(i,e);var t=Object(h.a)(i);function i(){return Object(u.a)(this,i),t.apply(this,arguments)}return Object(p.a)(i,[{key:"validateOptions",value:function(){return this.validateRequiredOptions(["x","y","size"])}},{key:"validateResults",value:function(){return this.validateCoordinates(this._rows,this._columns)}},{key:"buildFeatureLayerImpl",value:function(){var e=this.createRenderer(this._rows,this._columns),t=this.buildSimpleFeatureLayer(e);return this.excludeWhereSizeIsNull(t),Object(d.v)(t)}},{key:"excludeWhereSizeIsNull",value:function(e){if(this._options.size){var t=D.getNameWithLabel(this._options.size,this._columns);null!==t&&t.length>0&&(e.definitionExpression=t+" IS NOT NULL")}}},{key:"createRenderer",value:function(e,t){var i,a,n=[];if(a=D.hasColorCategory(this._options.color,t)?{type:"unique-value",field:D.getNameWithLabel(this._options.color,t),defaultSymbol:{type:"simple-marker",color:"blue",size:6,outline:{width:.5,color:this._options.outline}},uniqueValueInfos:D.generateUniqueVals(t,e,this._options),visualVariables:n}:{type:"simple",symbol:{type:"simple-marker",size:2,outline:{color:this._options.outline,width:.5,opacity:0}},visualVariables:n},this._options.size){var o=D.getNameWithLabel(this._options.size,t),r=D.getIndexWithLabel(this._options.size,t);i=D.findMinMax(e,r),a.visualVariables.push({type:"size",field:o,minDataValue:i[0],maxDataValue:i[1],minSize:6,maxSize:30})}if(this._options.animation&&a.visualVariables.push(P.buildAnimationVisualVariable(t,this._options.animation)),!D.hasColorCategory(this._options.color,t)){var s=D.getNameWithLabel(this._options.color,t),l=D.getIndexWithLabel(this._options.color,t);i=D.findMinMax(e,l),a.visualVariables.push({type:"color",field:s,stops:[{value:i[0],color:this._options.colorMin},{value:i[1],color:this._options.colorMax}]}),this._options.useSmartLegends&&(new ae).expandTwoPartColorRange(n[n.length-1].stops)}return a}}]),i}(J),oe=ne,re=function(e){Object(c.a)(i,e);var t=Object(h.a)(i);function i(){var e;Object(u.a)(this,i);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._geoIdAttributeMap=void 0,e._geoIdFilter=void 0,e._queryServiceLayerOverride=void 0,e}return Object(p.a)(i,[{key:"supportsEdits",value:function(){return!0}},{key:"validateOptions",value:function(){return this.validateRequiredOptions(["geoId","featureServiceUrl","featureServiceGeoId"])}},{key:"validateResults",value:function(){var e=null;if(D.getIndexWithLabel(this._options.geoId,this._columns)<0)e=W.error("dataNotIdentifiedGeoId");else{var t=Object.keys(this._geoIdAttributeMap);t.length>0&&t.length<6?e=W.warning("regionsNotFoundFew",t.join(", ")):t.length>6&&(e=W.warning("regionsNotFoundMany",t.slice(0,5).join(", ")))}return e?[e]:[]}},{key:"getGeoIdFilter",value:function(){return this._geoIdFilter}},{key:"setQueryServiceLayerOverride",value:function(e){this._queryServiceLayerOverride=e}},{key:"buildFeatureLayerImpl",value:function(){var e=this.createRenderer(this._rows,this._columns);return this.buildChoroplethFeatureLayer(e,this._rows,this._columns)}},{key:"createRenderer",value:function(e,t){var i,a,n=[];if(a=D.hasColorCategory(this._options.color,t)?{type:"unique-value",field:D.getNameWithLabel(this._options.color,t),defaultSymbol:{type:"simple-fill",color:"blue",style:"solid",outline:{width:.5,color:this._options.outline}},uniqueValueInfos:D.generateUniqueVals(t,e,this._options),visualVariables:n}:{type:"simple",symbol:{type:"simple-fill",color:this._options.colorMax,outline:{color:this._options.outline,width:.5}},visualVariables:n},!D.hasColorCategory(this._options.color,t)&&this._options.color){var o=D.getNameWithLabel(this._options.color,t),r=D.getIndexWithLabel(this._options.color,t);i=D.findMinMax(e,r),a.visualVariables.push({type:"color",field:o,stops:[{value:i[0],color:this._options.colorMin},{value:i[1],color:this._options.colorMax}]}),this._options.useSmartLegends&&(new ae).expandTwoPartColorRange(n[n.length-1].stops)}return a}},{key:"buildFilter",value:function(e){var t="";return this._options.featureServiceWhere&&(t="("+this._options.featureServiceWhere+") AND "),t+="("+this._options.featureServiceGeoId+" IN ("+e.join()+"))"}},{key:"buildQuery",value:function(e,t){var i=e.createQuery();return i.outFields=[this._options.featureServiceGeoId],i.outSpatialReference=Y.a.WGS84,i.where=this.buildFilter(t),isNaN(this._options.featureServiceMaxAllowableOffset)||(i.maxAllowableOffset=this._options.featureServiceMaxAllowableOffset),i}},{key:"calculateMaxAllowableOffset",value:function(e,t){return window.innerHeight/window.innerWidth>t/e?e/window.innerWidth:t/window.innerHeight}},{key:"queryExtent",value:function(e,t){return e.queryExtent(this.buildQuery(e,t))}},{key:"queryFeatures",value:function(e,t,i){for(var a=this,n=0;t.length>0;){++n;var o=t.splice(0,500),r=this.buildQuery(e,o);e.queryFeatures(r).then((function(e){var t=[];e.features.forEach((function(e){var i=a._geoIdAttributeMap[e.attributes[a._options.featureServiceGeoId]];if(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e.attributes[n]=i[n]);t.push(e),delete a._geoIdAttributeMap[e.attributes[a._options.featureServiceGeoId]]}})),i.applyEdits({addFeatures:t}).then((function(){i.emit(J.EDITS_APPLIED),--n<1&&i.emit(J.EDITS_COMPLETED)}),(function(e){D.logError(e)}))}),(function(e){D.logError(e)}))}}},{key:"buildChoroplethFeatureLayer",value:function(e,t,i){var a=this;return Object(d.d)((function(t){var n=a.createGraphics(),o=a.createFields(),r=D.getNameWithLabel(a._options.geoId,i);a._geoIdAttributeMap={},n.forEach((function(e){a._geoIdAttributeMap[e.attributes[r]]=e.attributes}));var s,l=new H.default({id:D.SAS_FEATURE_LAYER_ID,title:a._options.title,source:[],fields:o,objectIdField:D.FIELD_NAME_OBJECT_ID,renderer:e,geometryType:"polygon",popupTemplate:a.createGenericUnformattedPopupTemplate(i),spatialReference:Y.a.WGS84});if(n.length<1)return t(l),void setTimeout((function(){l.emit(J.EDITS_COMPLETED)}),10);s=a._queryServiceLayerOverride?a._queryServiceLayerOverride:new H.default({url:a._options.featureServiceUrl,objectIdField:D.FIELD_NAME_OBJECT_ID,spatialReference:Y.a.WGS84});var u=D.sqlEscape(Object.keys(a._geoIdAttributeMap));a.queryExtent(s,u).then((function(e){l.fullExtent=e.extent,t(l),isNaN(a._options.featureServiceMaxAllowableOffset)&&(a._options.featureServiceMaxAllowableOffset=a.calculateMaxAllowableOffset(e.extent.width,e.extent.height)),a.queryFeatures(s,u,l)}),(function(e){D.logError(e),t(l)}))}))}}]),i}(J),se=re,le=function(e){Object(c.a)(i,e);var t=Object(h.a)(i);function i(){var e;Object(u.a)(this,i);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._geoIdFilter=void 0,e}return Object(p.a)(i,[{key:"validateOptions",value:function(){return this.validateRequiredOptions(["geoId","featureServiceUrl","featureServiceGeoId"])}},{key:"validateResults",value:function(){var e=null;return D.getIndexWithLabel(this._options.geoId,this._columns)<0?e=W.error("dataNotIdentifiedGeoId"):this._rows.length>i.MAX_FILTER_VALUES&&(e=W.error("tooManyFilteredValues",i.MAX_FILTER_VALUES.toString())),e?[e]:[]}},{key:"getGeoIdFilter",value:function(){return this._geoIdFilter}},{key:"buildFeatureLayerImpl",value:function(){return Object(d.v)(this.buildFilteredFeatureLayer(this._rows,this._columns))}},{key:"buildFilteredFeatureLayer",value:function(e,t){var i=D.getIndexWithLabel(this._options.geoId,t),a=e.map((function(e){return e[i]}));return this._geoIdFilter=this._options.featureServiceGeoId+" IN ("+D.sqlEscape(a)+")",new H.default({id:D.SAS_FEATURE_LAYER_ID,title:this._options.title,url:this._options.featureServiceUrl,spatialReference:Y.a.WGS84,definitionExpression:this._geoIdFilter})}}]),i}(J);le.MAX_FILTER_VALUES=500;var ue=le,pe=function(e){Object(c.a)(i,e);var t=Object(h.a)(i);function i(){return Object(u.a)(this,i),t.apply(this,arguments)}return Object(p.a)(i,[{key:"validateOptions",value:function(){return this.validateRequiredOptions(["x","y"])}},{key:"validateResults",value:function(){return this.validateCoordinates(this._rows,this._columns)}},{key:"buildFeatureLayerImpl",value:function(){var e=this.createRenderer(this._rows,this._columns);return Object(d.v)(this.buildSimpleFeatureLayer(e))}},{key:"createRenderer",value:function(e,t){var i=[];return this._options.animation&&i.push(P.buildAnimationVisualVariable(t,this._options.animation)),D.hasColorCategory(this._options.color,t)?{type:"unique-value",field:D.getNameWithLabel(this._options.color,t),defaultSymbol:{type:"simple-marker",color:"green",size:6,outline:{width:.5,color:this._options.outline}},uniqueValueInfos:D.generateUniqueVals(t,e,this._options),visualVariables:i}:{type:"simple",symbol:{type:"simple-marker",size:6,color:this._options.colorMax,outline:{width:.5,color:this._options.outline}},visualVariables:i}}}]),i}(J),ce=pe,he=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,[{key:"createLayerBuilder",value:function(e,t,i){switch(e.visualizationType){case D.VISUALIZATION_TYPE_BUBBLE:return new oe(e,t,i);case D.VISUALIZATION_TYPE_CHOROPLETH:return new se(e,t,i);case D.VISUALIZATION_TYPE_FILTERED:return new ue(e,t,i);default:return new ce(e,t,i)}}}],[{key:"getInstance",value:function(){return e._instance||(e._instance=new e),e._instance}}]),e}();he._instance=void 0;var de=he,ve=function(){function e(){Object(u.a)(this,e),this._mapView=void 0,this._sasFeatureLayerId=void 0,this._dataResultName=void 0,this._selectionColumnName=void 0,this._highlights=void 0}return Object(p.a)(e,[{key:"registerMapView",value:function(e,t){var i=this;this._mapView=e,this._sasFeatureLayerId=t,this._mapView.popup.watch("selectedFeature",(function(e){e&&i.onSelection(e)})),this._mapView.popup.watch("visible",(function(e){e||i.onSelection(null)}))}},{key:"registerMapData",value:function(e,t){this._dataResultName=e,this._selectionColumnName=t}},{key:"applySelectionsFromData",value:function(e){var t=this,i=this.getMapView(),a=i?i.map:null;if(!a||a.findLayerById(e.id)){this.clearSelections();var n=function(e){e.queryFeatures().then((function(i){var a,n=i.features.filter((function(e){return 1===e.attributes[t._selectionColumnName]}));a=[n,e],t.drawSelection(a[0],a[1])}))};i.whenLayerView(e).then((function(e){if(e.updating)var t=e.watch("updating",(function(i){i||(n(e),t.remove())}));else n(e)}),(function(e){D.logError(e)}))}else D.logInfo("Cannot apply selections before layer added to map.  Skipping.")}},{key:"getMapView",value:function(){return this._mapView}},{key:"onSelection",value:function(e){var t=e&&e.layer&&e.layer.id===this._sasFeatureLayerId,i=t&&e&&e.attributes?e.attributes[D.FIELD_NAME_OBJECT_ID]:null,a=null===i?[]:[{row:i}];D.publishMessage({resultName:this._dataResultName,selections:a}),this.clearSelections(),t&&this.drawSelection(e)}},{key:"clearSelections",value:function(){this.clearHighlights()}},{key:"drawSelection",value:function(e,t){e&&(e=Array.isArray(e)?e:[e],this.drawHighlights(e,t))}},{key:"clearHighlights",value:function(){this._highlights&&(this._highlights.remove(),this._highlights=null)}},{key:"drawHighlights",value:function(e,t){this.clearHighlights(),t&&e&&e.length>0&&(this._highlights=t.highlight(e))}}]),e}(),_e=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"postOptions",value:function(t){D.publishMessage({resultName:t,optionsConfig:e.getOptions()})}},{key:"getOptions",value:function(){return e._options||(e._options=e.buildOptions()),e._options}},{key:"buildOptions",value:function(){var e=function(e){return D.getResource(e)};return{version:1,urlOption:!0,label:e("vaoptions_label"),groups:[{label:e("vaoptions_webmap_label"),fields:[{name:"portalItemId",label:e("vaoptions_portalItemId_label"),tooltip:e("vaoptions_portalItemId_help"),type:"String"},{name:"basemap",label:e("vaoptions_basemap_label"),tooltip:e("vaoptions_basemap_help"),value:" ",dataProvider:[{key:"topo",text:e("vaoptions_basemap_topo")},{key:"streets",text:e("vaoptions_basemap_streets")},{key:"satellite",text:e("vaoptions_basemap_satellite")},{key:"hybrid",text:e("vaoptions_basemap_hybrid")},{key:"dark-gray",text:e("vaoptions_basemap_dark_gray")},{key:"gray",text:e("vaoptions_basemap_gray")},{key:"national-geographic",text:e("vaoptions_basemap_national_geographic")},{key:"oceans",text:e("vaoptions_basemap_oceans")},{key:" ",text:e("vaoptions_basemap_osm")},{key:"terrain",text:e("vaoptions_basemap_terrain")},{key:"dark-gray-vector",text:e("vaoptions_basemap_dark_gray_vector")},{key:"gray-vector",text:e("vaoptions_basemap_gray_vector")},{key:"streets-vector",text:e("vaoptions_basemap_streets_vector")},{key:"streets-night-vector",text:e("vaoptions_basemap_streets_night_vector")},{key:"streets-navigation-vector",text:e("vaoptions_basemap_streets_navigation_vector")},{key:"topo-vector",text:e("vaoptions_basemap_topo_vector")},{key:"streets-relief-vector",text:e("vaoptions_basemap_streets_relief_vector")}]},{name:"use3D",label:e("vaoptions_use3D_label"),tooltip:e("vaoptions_use3D_help"),type:"Boolean"},{name:"portalUrl",label:e("vaoptions_portalUrl_label"),tooltip:e("vaoptions_portalUrl_help"),placeholder:e("vaoptions_portalUrl_placeholder"),type:"String"}]},{label:e("vaoptions_vaLayer_label"),fields:[{name:"title",label:e("vaoptions_title_label"),tooltip:e("vaoptions_title_help"),type:"String",placeholder:e("vaoptions_title_placeholder")},{name:"visualizationType",label:e("vaoptions_visualizationType_label"),tooltip:e("vaoptions_visualizationType_help"),value:D.VISUALIZATION_TYPE_NONE,dataProvider:[{key:D.VISUALIZATION_TYPE_NONE,text:e("vaoptions_visualizationType_none")},{key:"scatter",text:e("vaoptions_visualizationType_scatter")},{key:"bubble",text:e("vaoptions_visualizationType_bubble")},{key:"choropleth",text:e("vaoptions_visualizationType_choropleth")},{key:"filtered",text:e("vaoptions_visualizationType_filtered")}]},{name:"x",label:e("vaoptions_x_label"),tooltip:e("vaoptions_x_help"),type:"String",placeholder:e("vaoptions_x_placeholder")},{name:"y",label:e("vaoptions_y_label"),tooltip:e("vaoptions_y_help"),type:"String",placeholder:e("vaoptions_y_placeholder")},{name:"size",label:e("vaoptions_size_label"),tooltip:e("vaoptions_size_help"),type:"String",placeholder:e("vaoptions_size_placeholder")},{name:"color",label:e("vaoptions_color_label"),tooltip:e("vaoptions_color_help"),type:"String",placeholder:e("vaoptions_color_placeholder")},{name:"geoId",label:e("vaoptions_geoId_label"),tooltip:e("vaoptions_geoId_help"),placeholder:e("vaoptions_geoId_placeholder"),type:"String"},{name:"featureServiceUrl",label:e("vaoptions_featureServiceUrl_label"),tooltip:e("vaoptions_featureServiceUrl_help"),placeholder:e("vaoptions_featureServiceUrl_placeholder"),type:"String"},{name:"featureServiceGeoId",label:e("vaoptions_featureServiceGeoId_label"),tooltip:e("vaoptions_featureServiceGeoId_help"),placeholder:e("vaoptions_featureServiceGeoId_placeholder"),type:"String"},{name:"featureServiceWhere",label:e("vaoptions_featureServiceWhere_label"),tooltip:e("vaoptions_featureServiceWhere_help"),type:"String"},{name:"featureServiceMaxAllowableOffset",label:e("vaoptions_featureServiceMaxAllowableOffset_label"),tooltip:e("vaoptions_featureServiceMaxAllowableOffset_help"),type:"Number"},{name:"animation",label:e("vaoptions_animation_label"),tooltip:e("vaoptions_animation_help"),type:"String"},{name:"period",label:e("vaoptions_period_label"),tooltip:e("vaoptions_period_help"),placeholder:e("vaoptions_period_placeholder"),type:"String"},{name:"colorMin",label:e("vaoptions_colorMin_label"),tooltip:e("vaoptions_colorMin_help"),placeholder:e("vaoptions_colorMin_placeholder"),type:"String"},{name:"colorMax",label:e("vaoptions_colorMax_label"),tooltip:e("vaoptions_colorMax_help"),placeholder:e("vaoptions_colorMax_placeholder"),type:"String"},{name:"outline",label:e("vaoptions_outline_label"),tooltip:e("vaoptions_outline_help"),placeholder:e("vaoptions_outline_placeholder"),type:"String"},{name:"zIndex",label:e("vaoptions_zIndex_label"),tooltip:e("vaoptions_zIndex_help"),type:"Integer",placeholder:e("vaoptions_zIndex_placeholder"),constraints:{min:0}}]}]}}}]),e}();_e._options=null;var fe=_e,me=function(){function e(t){var i=this;Object(u.a)(this,e),this._options=void 0,this._mapView=void 0,this._sasLegend=void 0,this._animationHelper=void 0,this._selectionHelper=void 0,this._smartLegendHelper=void 0,this._lastMessageReceivedBeforeMapViewRegistered=void 0,this._hasUserPanned=!1,this._warningControl=void 0,this._warning=void 0,this._dataResultName=void 0,this._selectionHelper=new ve,this._options=t,this._options.visualizationType=this._options.visualizationType?this._options.visualizationType.toUpperCase():null,this._options.visualizationType!==D.VISUALIZATION_TYPE_SCATTER&&this._options.visualizationType!==D.VISUALIZATION_TYPE_BUBBLE&&this._options.visualizationType!==D.VISUALIZATION_TYPE_CHOROPLETH&&this._options.visualizationType!==D.VISUALIZATION_TYPE_FILTERED&&this._options.visualizationType!==D.VISUALIZATION_TYPE_NONE&&(this._options.geoId?this._options.visualizationType=D.VISUALIZATION_TYPE_CHOROPLETH:this._options.size?this._options.visualizationType=D.VISUALIZATION_TYPE_BUBBLE:this._options.visualizationType=D.VISUALIZATION_TYPE_SCATTER),this._options.x=this._options.x||"Longitude",this._options.y=this._options.y||"Latitude",void 0!==this._options.colorMin&&null!==this._options.colorMin||(this._options.colorMin="#bfe4e7"),void 0!==this._options.colorMax&&null!==this._options.colorMax||(this._options.colorMax="#00929f"),void 0!==this._options.outline&&null!==this._options.outline||(this._options.outline="#007E88"),this._options.useSampleData=this._options.useSampleData&&"TRUE"===this._options.useSampleData.toUpperCase(),this._options.useSmartLegends=this._options.useSmartLegends&&"TRUE"===this._options.useSmartLegends.toUpperCase(),this._options.featureServiceWhere&&this._options.featureServiceWhere.length<1&&(this._options.featureServiceWhere=null),this._options.zIndex=Math.max(parseInt(this._options.zIndex,void 0),0),this._options.featureServiceMaxAllowableOffset=parseFloat(this._options.featureServiceMaxAllowableOffset),this._options.featuresMax=parseInt(this._options.featuresMax,void 0),this._options.filterToFeatureServiceGeoId=this._options.filterToFeatureServiceGeoId&&"TRUE"===this._options.filterToFeatureServiceGeoId.toUpperCase(),this._options.useSampleData||window.addEventListener("message",(function(e){return i.onMessage(e)})),this._options.animation&&(this._animationHelper=new P(this._options.period)),this._options.useSmartLegends&&(this._smartLegendHelper=new ae)}return Object(p.a)(e,[{key:"registerMapView",value:function(e){var t=this;if(this._mapView=e,this._options.title=this._options.title||D.getResource("defaultLayerTitle"),this._options.showBasemapSelector&&this._mapView.map.watch("basemap",(function(e,i){D.publishPropertyChange(t._dataResultName,"basemap",e?e.title:"",i?i.title:"")})),this._options.visualizationType!==D.VISUALIZATION_TYPE_SCATTER||this._options.color){this._sasLegend=new T.default({view:this._mapView,container:document.createElement("div")});var a=new E.a({expandIconClass:"esri-icon-question",view:this._mapView,content:this._sasLegend,group:"bottom-left"});this._mapView.ui.add(a,"bottom-left")}this._options.useSampleData?i.e(260).then(i.t.bind(null,1339,3)).then((function(e){t._options.useSampleData&&t._options.animation&&t._animationHelper.generateSampleAnimationData(e,t._options.color,t._options.size,t._options.animation),t.onMessage({data:e,origin:window.location.origin})}),(function(e){D.logError(e)})):this._lastMessageReceivedBeforeMapViewRegistered&&(this.onMessage(this._lastMessageReceivedBeforeMapViewRegistered),this._lastMessageReceivedBeforeMapViewRegistered=null),this._mapView.on("drag",(function(){t._hasUserPanned=!0})),this._options.use3D&&(this._mapView.highlightOptions.color=this._options.outline),this._selectionHelper.registerMapView(this._mapView,D.SAS_FEATURE_LAYER_ID)}},{key:"getMapView",value:function(){return this._mapView}},{key:"onMessage",value:function(e){!this.getMapView()&&this.isVAMessage(e)?this._lastMessageReceivedBeforeMapViewRegistered=e:this.processMessageEvent(e)}},{key:"isVAMessage",value:function(e){return e&&e.data&&e.data.columns&&e.data.data}},{key:"processMessageEvent",value:function(e){var t=this;if(this.isVAMessage(e)){if(this._dataResultName=e.data.resultName,this.setWarning(null),fe.postOptions(this._dataResultName),this._options.visualizationType===D.VISUALIZATION_TYPE_NONE||!this.validateOptions()||!this.validateFeaturesMax(e.data.data,this._options.featuresMax))return void this.removeSasLayer();this._selectionHelper.registerMapData(this._dataResultName,D.getNameWithUsage("brush",e.data.columns)),this.purgeSasIdiom(e.data.data,e.data.columns),this.convertDates(e.data.data,e.data.columns),this._options.animation&&this._animationHelper.initializeAnimationData(e,this._options.animation);var i=de.getInstance().createLayerBuilder(this._options,e.data.data,e.data.columns);i.buildFeatureLayer().then((function(e){if(t.addOrReplaceSasLayer(e),i.supportsEdits()?e.when((function(e){var a=e.on(J.EDITS_COMPLETED,(function(){t.appendWarning(i.validateResults()),t._selectionHelper.applySelectionsFromData(e),a.remove()}))})):t.appendWarning(i.validateResults()),t._options.filterToFeatureServiceGeoId){var a=i.getGeoIdFilter();a&&a.length>0&&t.applyFilterToAllLayersWithGeoIDs(a)}}),(function(e){D.logError(e)}))}}},{key:"addOrReplaceSasLayer",value:function(e){var t=this,i=this.getMapView(),a=i?i.map:null;if(a){var n=a.findLayerById(D.SAS_FEATURE_LAYER_ID);n&&a.remove(n),isNaN(this._options.zIndex)?a.add(e):a.add(e,this._options.zIndex),e.when((function(e){t._selectionHelper.applySelectionsFromData(e),t._hasUserPanned&&t._options.visualizationType!==D.VISUALIZATION_TYPE_CHOROPLETH||t.goToDataExtent(e),t._options.animation&&t._animationHelper.initializeAnimation(e),e.layerEnabled=!1,t._sasLegend&&(e.layerInfos=[{layer:e,title:t._options.title}]),t._options.useSmartLegends&&t._smartLegendHelper.addSmartLegends(e,t.getMapView())}),(function(e){D.logError(e)}))}}},{key:"removeSasLayer",value:function(){var e=this.getMapView(),t=e?e.map:null;if(t){var i=t.findLayerById(D.SAS_FEATURE_LAYER_ID);i&&t.remove(i)}}},{key:"purgeSasIdiom",value:function(e,t){var i,a,n=[];for(i=0;i<t.length;++i)"STRING"!==t[i].type.toUpperCase()&&n.push(i);for(i=0;i<e.length;++i)for(a=0;a<n.length;++a)"."===e[i][n[a]]&&(e[i][n[a]]=null)}},{key:"convertDates",value:function(e,t){var i,a,n=[];for(i=0;i<t.length;++i)"date"===t[i].type&&t[i].format&&"DATE"===t[i].format.name.toUpperCase()&&n.push(i);for(i=0;i<e.length;++i)for(a=0;a<n.length;++a)e[i][n[a]]=D.convertToEpochMS(e[i][n[a]],t[n[a]].format.formatString)}},{key:"applyFilterToAllLayersWithGeoIDs",value:function(e){var t=this;e&&e.length>0&&this.getMapView().map.allLayers.forEach((function(i){if(i.type&&"feature"===i.type&&i.id!==D.SAS_FEATURE_LAYER_ID&&i.fields){var a=i.fields.find((function(e){return e.name===t._options.featureServiceGeoId}));i.definitionExpression=a?e:""}}))}},{key:"validateFeaturesMax",value:function(e,t){return!(e.length>t)||(this.appendWarning(W.error("tooManyFeatures",e.length.toString(),t.toString())),!1)}},{key:"validateOptions",value:function(){var e=de.getInstance().createLayerBuilder(this._options,[],[]).validateOptions();return this.appendWarning(e),0===e.length}},{key:"getWarningControl",value:function(){if(!this._warningControl){var e=document.createElement("div");e.setAttribute("class","warning"),this._warningControl=new E.a({id:"sasWarningControl",expandIconClass:"esri-icon-notice-triangle",view:this._mapView,content:e,group:"bottom-right",expanded:!0})}return this._warningControl}},{key:"setWarning",value:function(e){this._warning!==e&&(this._warning=e,this.displayWarning(this._warning))}},{key:"getWarning",value:function(){return this._warning}},{key:"appendWarning",value:function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach((function(e){return t.appendWarningImpl(e)}))}},{key:"appendWarningImpl",value:function(e){var t=this.getWarning(),i=(t&&t.length>0?" ":"")+e.message;this.setWarning(i)}},{key:"displayWarning",value:function(e){var t=this.getWarningControl();e&&e.length>0?(t.content&&t.content instanceof Element&&(t.content.innerHTML=e),this._mapView.ui.add(t,"bottom-right"),D.logError(e)):this._mapView.ui.remove(t)}},{key:"goToDataExtent",value:function(e){var t=this;e.fullExtent?this.getMapView().goTo(e.fullExtent,{animate:!1}):this.forDataExtent(e,(function(e){t.getMapView().goTo(e.extent,{animate:!1})}))}},{key:"forDataExtent",value:function(e,t){var i=function(e){e.queryExtent().then((function(e){t(e)}))};this.getMapView().whenLayerView(e).then((function(e){if(e.updating)var t=e.watch("updating",(function(a){a||(t.remove(),i(e))}));else i(e)}))}}]),e}(),ge=(i(847),i(324)),ye=function(e){Object(c.a)(i,e);var t=Object(h.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e))._visualizationBridge=void 0,a._map=void 0,a._view=void 0,a.state={urlOptions:a.getOptionsFromUrl(),mapDiv:o.a.createRef()},a}return Object(p.a)(i,[{key:"urlOptions",get:function(){return this.state?this.state.urlOptions:null}},{key:"render",value:function(){var e=Object(l.a)({},i.CSS.webmapAnimated,this.state.urlOptions.animation),t=Object(l.a)({},i.CSS.animationControlsAnimated,this.state.urlOptions.animation);return Object(ge.jsxs)("div",{className:i.CSS.base,children:[Object(ge.jsx)("div",{ref:this.state.mapDiv,className:A()(i.CSS.webmap,e)}),Object(ge.jsxs)("footer",{id:"animationControls",className:A()(i.CSS.animationControls,t),children:[Object(ge.jsx)("div",{id:"animationLabel"}),Object(ge.jsx)("input",{id:"animationPlayButton",type:"button",value:">>",readOnly:!0}),Object(ge.jsx)("input",{id:"animationSlider",type:"range",min:"0",max:"100",step:"0.001",defaultValue:"0",style:{width:"100%"}})]})]})}},{key:"componentDidMount",value:function(){this.state.mapDiv.current&&(this._visualizationBridge=new me(this.urlOptions),this.afterMount(this.state.mapDiv.current))}},{key:"getOptionsFromUrl",value:function(){var e=v.K(window.location.href).query||{};return e.basemap=e.basemap||"osm",e.use3D=e.use3D&&"TRUE"===e.use3D.toUpperCase(),e.useWebScene=!1,e.showBasemapSelector=void 0===e.showBasemapSelector||null===e.showBasemapSelector||"TRUE"===e.showBasemapSelector.toUpperCase(),e}},{key:"getPortalUrl",value:function(e){return e.portalUrl?e.portalUrl:D.DEFAULT_PORTAL_URL}},{key:"afterMount",value:function(e){this.urlOptions.portalUrl&&(a.a.portalUrl=this.urlOptions.portalUrl),this.urlOptions.portalToken?(_.default.registerToken({token:this.urlOptions.portalToken,server:this.getPortalUrl(this.urlOptions)}),this.loadUI(e)):this.loadUI(e)}},{key:"loadPortalItem",value:function(e,t){return e?new m.default({id:e,url:t||void 0}).load():Object(d.v)(null)}},{key:"loadUI",value:function(e){var t=this,i=function(){t.buildMap(e)};x.a.use(V.a).use(C.a).init({fallbackLng:"en",backend:{loadPath:"i18n/{{lng}}.json"}}).then(i,i)}},{key:"buildMap",value:function(e){var t=this;this.loadPortalItem(this.urlOptions.portalItemId,this.urlOptions.portalUrl).then((function(i){!i||"Web Scene"!==i.type&&"CityEngine Web Scene"!==i.type?t._map=i?new b.a({portalItem:i}):new f.a({basemap:t.urlOptions.basemap}):(t.urlOptions.useWebScene=!0,t._map=new I.a({portalItem:i})),t.buildMapView(e)}),(function(e){D.logError(e)}))}},{key:"buildMapView",value:function(e){var t=this;this.urlOptions.use3D||this._map instanceof I.a?this._view=new y.a({map:this._map,container:e}):this._view=new g.a({map:this._map,container:e}),this._view.when((function(e){t.addMapWidgets(e||e),t._visualizationBridge.registerMapView(e||e)}),(function(e){D.logError(e)}))}},{key:"addMapWidgets",value:function(e){var t=new w.a({view:e}),i=new E.a({expandIconClass:"esri-icon-layer-list",view:e,content:t,group:"top-right"});if(e.ui.add(i,"top-right"),this.state.urlOptions.showBasemapSelector){var a=new S.a({view:e}),n=new E.a({expandIconClass:"esri-icon-basemap",view:e,content:a,group:"top-right"});e.ui.add(n,"top-right")}e.ui.move("zoom","top-right"),e.ui.move("navigation-toggle","top-right"),e.ui.move("compass","top-right");var o=new L.a({view:e,container:document.createElement("div")}),r=new E.a({expandIconClass:"esri-icon-search",view:e,content:o});e.ui.add(r,"top-left")}}]),i}(o.a.Component);ye.CSS={base:"main",webmap:"webmap",webmapAnimated:"webmap-animating",animationControls:"animationControls",animationControlsAnimated:"animationControls-animating"};var be=ye,Ie=(i(849),function(e){e&&e instanceof Function&&i.e(259).then(i.bind(null,1340)).then((function(t){var i=t.getCLS,a=t.getFID,n=t.getFCP,o=t.getLCP,r=t.getTTFB;i(e),a(e),n(e),o(e),r(e)}))});a.a.assetsPath="./assets",s.a.render(Object(ge.jsx)(o.a.StrictMode,{children:Object(ge.jsx)(be,{})}),document.getElementById("root")),Ie()}},[[850,53,54]]]);
//# sourceMappingURL=main.91d6b867.chunk.js.map