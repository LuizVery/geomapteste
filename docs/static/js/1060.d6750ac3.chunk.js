"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[1060],{32500:(e,t,i)=>{i.d(t,{I:()=>g,b:()=>p});var r=i(71011),s=i(33280),a=i(94951),n=i(21002),o=i(15226),l=i(10763),d=i(116),c=i(98634),h=i(64201),u=i(4760);function p(e){const t=new h.kG;return t.include(a.w,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add(u.T.POSITION,"vec3"),t.attributes.add(u.T.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(c.H`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(s.p2,e),e.multipassTerrainEnabled&&(t.fragment.include(n.S),t.include(o.l,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),e.output===r.H.Alpha?t.fragment.code.add(c.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${c.H.float(l.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(d.Y),t.fragment.code.add(c.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${c.H.float(l.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const g=Object.freeze({__proto__:null,build:p})},72511:(e,t,i)=>{i.d(t,{S:()=>_,b:()=>g});var r=i(43505),s=i(71011),a=i(33280),n=i(94951),o=i(21002),l=i(15226),d=i(10763),c=i(116),h=i(98634),u=i(64201),p=i(4760);function g(e){const t=new u.kG;return t.include(n.w,{linearDepth:!1}),t.include(r.A,{}),t.include(a.p2,e),t.fragment.include(c.Y),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("uColor","vec4"),t.attributes.add(p.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(p.T.OFFSET,"vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add(p.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(h.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(h.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(h.H`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(o.S),t.include(l.l,e)),t.fragment.code.add(h.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(h.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`):t.fragment.code.add(h.H`vec4 finalColor = uColor;`),t.fragment.code.add(h.H`
      if (finalColor.a < ${h.H.float(d.bf)}) {
        discard;
      }
      ${e.output===s.H.Alpha?h.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===s.H.Color?h.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}const _=Object.freeze({__proto__:null,build:g})},11316:(e,t,i)=>{i.d(t,{S:()=>o,b:()=>n});var r=i(98634),s=i(64201),a=i(4760);function n(){const e=new s.kG;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add(a.T.POSITION,"vec3"),e.attributes.add(a.T.UV0,"vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(r.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(r.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const o=Object.freeze({__proto__:null,build:n})},66576:(e,t,i)=>{i.d(t,{B:()=>m});var r=i(92026),s=i(80292),a=i(35995),n=i(71907),o=i(33397),l=i(25265),d=i(49861);function c(e){return h[function(e){return e instanceof Blob?e.type:function(e){const t=(0,a.Ml)(e);return g[t]||u}(e.url)}(e)]||p}const h={},u="text/plain",p=h[u],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const b in g)h[g[b]]=b;var _=i(53283);function m(e){const t=(0,r.pC)(e)&&e.origins?e.origins:[void 0];return(i,n)=>{const h=function(e,t,i){if((0,r.pC)(e)&&"resource"===e.type)return function(e,t,i){const n=(0,o.VZ)(t,i);return{type:String,read:(e,t,i)=>{const r=(0,_.r)(e,t,i);return n.type===String?r:"function"==typeof n.type?new n.type({url:r}):void 0},write:{writer(t,o,d,h){if(!h||!h.resources)return"string"==typeof t?void(o[d]=(0,_.t)(t,h)):void(o[d]=t.write({},h));const u=function(e){return(0,r.Wi)(e)?null:"string"==typeof e?e:e.url}(t),p=u?(0,_.t)(u,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},_.M.NO):null,g=n.type!==String&&(!(0,s.l)(this)||h&&h.origin&&this.originIdOf(i)>(0,l.M9)(h.origin));h&&h.portalItem&&(0,r.pC)(p)&&!(0,a.YP)(p)?g?function(e,t,i,r,s,n,o,l){const d=o.portalItem.resourceFromPath(r),h=y(i,r,o);c(h)===(0,a.Ml)(d.path)?(f(e,t,d,h,o.resources.toUpdate),s[n]=r):v(e,t,i,r,s,n,o,l)}(this,i,t,p,o,d,h,e):function(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}(p,o,d,h):h&&h.portalItem&&((0,r.Wi)(p)||(0,r.pC)((0,_.i)(p))||(0,a.jc)(p)||g)?v(this,i,t,p,o,d,h,e):o[d]=p}}}}(e,t,i);switch((0,r.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=_.p;return{read:e,write:t}}}}(e,i,n);for(const e of t){const t=(0,d.CJ)(i,e,n);for(const e in h)t[e]=h[e]}}}function v(e,t,s,o,l,d,h,u){const p=(0,n.D)(),g=y(s,o,h),_=(0,a.v_)((0,r.U2)(u,"prefix"),p),m=`${_}.${c(g)}`,v=h.portalItem.resourceFromPath(m);(0,a.jc)(o)&&h.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(i,76200))).default,{data:r}=await t(e,{responseType:"blob"});return r}(o).then((e=>{v.path=`${_}.${c(e)}`,l[d]=v.itemRelativeUrl})).catch((()=>{}))),f(e,t,v,g,h.resources.toAdd),l[d]=v.itemRelativeUrl}function f(e,t,i,r,s){s.push({resource:i,content:r,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function y(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},98074:(e,t,i)=>{i.d(t,{p:()=>l});var r=i(27366),s=i(92026),a=i(67426),n=i(49861),o=(i(63780),i(93169),i(25243),i(69912));const l=e=>{let t=class extends((0,a.v)(e)){constructor(){super(...arguments),this.parent=null}get updating(){return!1}get visible(){const e=!(0,s.pC)(this.parent)||this.parent.visible&&!this.parent.suspended;return this.analysis.visible&&e}};return(0,r._)([(0,n.Cb)({readOnly:!0})],t.prototype,"type",void 0),(0,r._)([(0,n.Cb)({constructOnly:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,n.Cb)({constructOnly:!0})],t.prototype,"parent",void 0),(0,r._)([(0,n.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,n.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,r._)([(0,n.Cb)({readOnly:!0})],t.prototype,"visible",null),t=(0,r._)([(0,o.j)("esri.views.3d.analysis.AnalysisView3D")],t),t}},41060:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Qe});var r=i(27366),s=i(85015),a=i(92026),n=i(49861),o=(i(63780),i(93169)),l=i(25243),d=i(69912),c=i(98074),h=(i(59486),i(11582)),u=i(46784),p=i(89125),g=i(66576),_=i(80064),m=i(7882);let v=class extends((0,h.J)(u.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,a._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,r._)([(0,n.Cb)({readOnly:!0,json:{read:!1,write:!0}})],v.prototype,"type",void 0),(0,r._)([(0,n.Cb)({type:m.Z}),(0,g.B)()],v.prototype,"position",void 0),(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,g.B)(),(0,p.p)((e=>_.LU.normalize((0,l.q9)(e),0,!0)))],v.prototype,"heading",void 0),(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,g.B)(),(0,p.p)((e=>_.LU.normalize((0,l.q9)(e),0,!0)))],v.prototype,"tilt",void 0),(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0}),(0,g.B)()],v.prototype,"width",void 0),(0,r._)([(0,n.Cb)({type:Number,nonNullable:!0}),(0,g.B)()],v.prototype,"height",void 0),v=(0,r._)([(0,d.j)("esri.analysis.SlicePlane")],v);const f=v;var y=i(100),b=i(32718),w=i(94172),C=i(8537),E=i(82218),P=i(74184),T=i(59147),O=i(33906),S=i(41644),V=i(16889),x=i(14226),A=i(81949),R=(i(48976),i(11186)),D=i(71353),N=i(79803),W=i(14320),I=i(55652),H=i(40885),F=i(40927),L=i(51378),M=(i(91505),i(17842)),z=(i(23879),i(22753),i(11873)),U=(i(88396),i(92183),i(65156),i(85981)),G=(i(37818),i(81703),i(30425),i(66327),i(68401)),j=(i(97882),i(99034));(0,M.s1)(),(0,U.Ue)(),(0,H.Ue)(),(0,z.c)(),(0,A.c)(),(0,A.c)(),(0,I.Ue)(),(0,D.c)(),(0,D.c)(),(0,D.c)(),(0,D.c)(),(0,D.c)(),(0,D.c)(),new m.Z({x:0,y:0,z:0,spatialReference:null});var B=i(67077),k=(i(96387),i(70619)),q=i(56529),Z=(i(74818),i(41414),i(25158),i(55158),i(71011)),$=i(23620),Y=(i(94425),i(93822)),K=(i(97731),i(4760)),J=(i(33236),i(22909)),X=i(43505),Q=i(33280),ee=i(15226),te=i(41012),ie=i(82144),re=i(31132),se=i(33559),ae=i(78041),ne=i(27627),oe=i(72511),le=i(8548),de=i(36207);class ce extends re.A{initializeProgram(e){const t=ce.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,oitEnabled:i.transparencyPassType===G.Am.Color,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new ne.$(e.rctx,r,ue)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:r}=this.configuration,{color:s,shadingTint:a,shadingDirection:n}=e;(0,te.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("uColor",s),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,ee.p)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this._blendColor(pe,a,s)),this.program.setUniform3fv("shadingDirection",n),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&(0,X.o)(this.program,e,t)}bindDraw(e){(0,te.id)(this.program,e),(0,te.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,Q.DA)(this.program,this.configuration,e),this.program.rebindTextures()}_blendColor(e,t,i){const r=1-t[3],s=t[3]+i[3]*r;return 0===s?(e[3]=s,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*r)/s,e[1]=(t[1]*t[3]+i[1]*i[3]*r)/s,e[2]=(t[2]*t[3]+i[2]*i[3]*r)/s,e[3]=i[3],e)}_setPipelineState(e){const t=this.configuration,i=e===G.Am.NONE,r=e===G.Am.FrontFace;return(0,de.sm)({blending:t.output!==Z.H.Color&&t.output!==Z.H.Alpha||!t.transparent?null:i?ae.wu:(0,ae.j7)(e),culling:(0,de.zp)(t.cullFace),depthTest:{func:r?le.wb.LESS:t.shadingEnabled?le.wb.LEQUAL:le.wb.LESS},depthWrite:i?t.writeDepth&&de.LZ:(0,ae.K5)(e),colorWrite:de.BK,polygonOffset:i||r?null:ae.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}ce.shader=new ie.J(oe.S,(()=>i.e(6556).then(i.bind(i,36556))));class he extends se.m{constructor(){super(...arguments),this.output=Z.H.Color,this.cullFace=G.Vr.None,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=G.Am.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}(0,r._)([(0,se.o)({count:Z.H.COUNT})],he.prototype,"output",void 0),(0,r._)([(0,se.o)({count:G.Vr.COUNT})],he.prototype,"cullFace",void 0),(0,r._)([(0,se.o)()],he.prototype,"slicePlaneEnabled",void 0),(0,r._)([(0,se.o)()],he.prototype,"transparent",void 0),(0,r._)([(0,se.o)()],he.prototype,"writeDepth",void 0),(0,r._)([(0,se.o)()],he.prototype,"screenSizeEnabled",void 0),(0,r._)([(0,se.o)()],he.prototype,"shadingEnabled",void 0),(0,r._)([(0,se.o)({count:G.Am.COUNT})],he.prototype,"transparencyPassType",void 0),(0,r._)([(0,se.o)()],he.prototype,"multipassTerrainEnabled",void 0),(0,r._)([(0,se.o)()],he.prototype,"cullAboveGround",void 0);const ue=new Map([[K.T.POSITION,0],[K.T.NORMAL,1],[K.T.OFFSET,2]]),pe=(0,B.c)();(0,R.n)((0,D.c)(),[.5,-.5,-.5]),G.Vr.None,q.mo;(0,D.c)(),(0,D.c)();function ge(e,t,i,r){const s=(0,R.n)(L.WM.get(),e),a=(0,R.n)(L.WM.get(),t),n=(0,R.c)(L.WM.get(),s,a);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=n[0],r[9]=n[1],r[10]=n[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}(0,o.Z)("mac"),Math.cos((0,V.Vl)(45)),Math.cos((0,V.Vl)(5));const _e=[1,.5,0],me=[..._e,.7],ve=[0,0,0,.04],fe=[..._e,.5];var ye=i(33837),be=i(90045),we=i(151),Ce=i(52168),Ee=i(64226),Pe=i(7566),Te=i(11316);class Oe extends re.A{initializeProgram(e){const t=Oe.shader.get().build();return new ne.$(e.rctx,t,Pe.i)}bindPass(e,t){(0,te.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){(0,te.id)(this.program,e),this.program.rebindTextures()}initializePipeline(){return(0,de.sm)({blending:(0,de.wK)(le.zi.ONE,le.zi.ONE,le.zi.ONE_MINUS_SRC_ALPHA,le.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:le.wb.LESS},colorWrite:de.BK})}}Oe.shader=new ie.J(Te.S,(()=>i.e(8492).then(i.bind(i,18492))));class Se extends q.F5{constructor(e){super(e,xe),this._config=new se.m}intersect(e,t,i,r,s,a,n){return(0,J.Bw)(e,t,r,s,a,void 0,n)}createBufferWriter(){return new Ee.G_(Ee.W1)}requiresSlot(e){return e===Y.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(e){return e.output===Z.H.Color?new Ve(e):null}getTechniqueConfig(){return this._config}}class Ve extends $.Z{constructor(e){super(e),this.ensureTechnique(Oe,null)}updateParameters(){return(0,a.Wg)(this.technique)}beginSlot(){return(0,a.Wg)(this.technique)}bind(e,t){t.bindPass(this._material.parameters,e)}}const xe={backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4,...q.mo};class Ae extends Ce._{constructor(e){super(e),this._material=null,this._renderOccluded=q.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,we.f)(1,0,0,1),this._backgroundColor=(0,we.f)(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){(0,be.c)(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){(0,be.c)(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new Se(this.materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){(0,a.pC)(this._material)&&e(this._material)}createGeometries(e){if((0,a.pC)(this._material)){const t=k.Z.createSquareGeometry();e.addGeometry(t,this._material)}}get materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){(0,a.pC)(this._material)&&this._material.setParameters(this.materialParameters)}}var Re=i(91643);i(81782),i(66156),i(99196),i(58901),i(53866);const De=b.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ne(e,t,i){const r=t.worldUpAtPosition(e.origin,L.WM.get()),s=e.basis1,a=Ie(e,r),n=Math.round(a/Ge)*Ge;return(0,E.r)(e,n-a,s,i)}var We;function Ie(e,t){return(0,F.cp)(t,e.basis2,e.basis1)+Ge}function He(e,t,i){return(0,F.cp)(e.basis1,i,t)-Ge}function Fe(e,t,i,r,s,a){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,E.c)();return a.toRenderCoords(e,n.origin)?(a.worldBasisAtPosition(n.origin,W.R.X,n.basis1),a.worldBasisAtPosition(n.origin,W.R.Y,n.basis2),(0,I.my)(n.basis2,n.basis1,n.origin,n.plane),(0,E.r)(n,-(0,V.Vl)(t),(0,E.n)(n),n),(0,E.r)(n,(0,V.Vl)(i),n.basis1,n),(0,R.a)(n.basis1,n.basis1,r/2),(0,R.a)(n.basis2,n.basis2,s/2),(0,E.u)(n),n):(De.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Le(e,t){if((0,a.Wi)(e)||(0,a.Wi)(e.position))return null;const i=(0,O.G)(e.position,t.spatialReference,t.elevationProvider);if((0,a.Wi)(i))return null;const r=Re.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*r,n=e.height*r;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:n}}function Me(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,E.c)();if((0,a.Wi)(e))return null;const s=Fe(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,r);return!i.tiltEnabled&&(0,a.pC)(s)&&Ne(s,t.renderCoordsHelper,s),s}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(We||(We={}));j.jg.Custom1;var ze,Ue;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(ze||(ze={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(Ue||(Ue={}));j.jg.Custom2,(0,H.Ue)();const Ge=Math.PI/2;j.jg.Custom1,j.jg.Custom2;var je;function Be(e){const t="building-scene-3d"===e.type?e:null;return(0,a.pC)(t)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(je||(je={}));const ke=b.Z.getLogger("esri.views.3d.analysis.Slice.SliceController");let qe=class extends s.Z{constructor(e){super(e),this._handles=new y.Z,this._internalChange=!1,this._currentSlicePlane=null,this.state="ready"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(e=>{const t=e.item;null!=t&&(t instanceof P.Z||t instanceof T.Z)?t instanceof P.Z&&function(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,S.Bg)(e.type),!1}}(t)?(ke.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(ke.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))),function(e,t){Ze.has(e)||Ze.set(e,{all:[],activeController:null}),Ze.get(e).all.push(t)}(this.view,this),this._handles.add([(0,w.YP)((()=>this.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),{sync:!0}),(0,w.YP)((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),(0,w.YP)((()=>[this.analysisViewData.active,this.analysisViewData.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),{sync:!0}),(0,w.YP)((()=>this._allLayerAndSubLayerViews),(()=>this._updateLayerViews()))]),this._handles.add([(0,w.YP)((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){"destroyed"!==this.state&&(this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function(e,t){if(!Ze.has(e))throw new Error("view expected in global slice register");const i=Ze.get(e),r=i.all.lastIndexOf(t);if(-1===r)throw new Error("controller expected in global slice register");i.all.splice(r,1),0===i.all.length&&Ze.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await(0,C.N1)(this,"ready"),this}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Be).flatMap((e=>{let{sublayerViews:t}=e;return t.items})))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if((0,a.Wi)(t)&&(0,a.Wi)(e)||(0,a.pC)(t)&&(0,a.pC)(e)&&e.equals(t))return;let i=null,r=null;if((0,a.pC)(e)&&(0,a.pC)(e.position)){const t=e.position.spatialReference,s=Le(e,this.view);(0,a.Wi)(s)&&(0,O.e)(this.analysis,t,ke),i=Me(s,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,E.c)()),(0,a.pC)(i)&&(r={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=r,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new f;if((0,a.Wi)(e))return null;const{renderCoordsHelper:s}=t,n=s.fromRenderCoords(e.origin,t.spatialReference);if((0,a.Wi)(n))return null;const o=(0,N.fM)(n,i);if((0,a.Wi)(o))return null;r.position=o;const l=s.worldUpAtPosition(e.origin,L.WM.get()),d=s.worldBasisAtPosition(e.origin,W.R.Y,L.WM.get()),c=2*(0,R.l)(e.basis1),h=2*(0,R.l)(e.basis2),u=Re.Z.renderUnitScaleFactor(t.spatialReference,i);return r.width=c*u,r.height=h*u,r.tilt=(0,V.BV)(Ie(e,l)),r.heading=(0,V.BV)(He(e,l,d)),r}(this.analysisViewData.plane,this.view,this.view.spatialReference,new f);let t=null;(0,a.pC)(e)&&(t={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=e,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if($e)return;const e=Ye(this.view);if(this.analysisViewData.active)(0,a.pC)(e.activeController)&&e.activeController!==this?($e=!0,e.activeController.analysisViewData.active=!1,$e=!1):(0,a.pC)(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if((0,a.pC)(e.activeController)&&e.activeController!==this)return;(0,a.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&function(e){const t=Ye(e).activeController;(0,a.pC)(t)&&(0,a.pC)(t.analysisViewData.plane)&&t.analysisViewData.visible?e.slicePlane=t.analysisViewData.plane:e.slicePlane=null}(this.view)}_updateLayerViews(){const e=(0,a.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=e=>{"layers"in e?e.layers.forEach(i):t.push(e)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach((i=>{i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&t.indexOf(i.layer)<0),"sublayerViews"in i&&i.sublayerViews.forEach((i=>{i.slicePlaneEnabled=e&&t.indexOf(i.sublayer)<0})))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,r._)([(0,n.Cb)({readOnly:!0})],qe.prototype,"state",void 0),(0,r._)([(0,n.Cb)()],qe.prototype,"view",void 0),(0,r._)([(0,n.Cb)()],qe.prototype,"analysis",void 0),(0,r._)([(0,n.Cb)()],qe.prototype,"analysisViewData",void 0),(0,r._)([(0,n.Cb)()],qe.prototype,"ready",null),(0,r._)([(0,n.Cb)()],qe.prototype,"_allLayerAndSubLayerViews",null),qe=(0,r._)([(0,d.j)("esri.views.3d.analysis.Slice.SliceController")],qe);const Ze=new Map;let $e=!1;function Ye(e){return Ze.get(e)}var Ke=i(24070);let Je=class extends s.Z{constructor(e){super(e),this._handles=new y.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}async _initialize(){if("destroyed"===this.state||"ready"===this.state)return;await(0,C.N1)(this.view,"ready",!0);const e=this.analysisViewData;if((0,a.Wi)(e))throw new Error("expected internal object to be valid");this._gridVisualElement=function(e){return new Ae({view:e,attached:!0,backgroundColor:[...ve],gridColor:fe,gridWidth:4,renderOccluded:q.yD.OccludeAndTransparent})}(this.view),this._outlineVisualElement=function(e){return new ye.r({view:e,attached:!0,color:me,width:1,writeDepthEnabled:!1,renderOccluded:q.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}(this.view),this._handles.add([(0,w.YP)((()=>({visible:(0,a.pC)(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,editable:this.editable,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),w.tX),(0,w.YP)((()=>e.plane),(e=>this._updatePlane(e)),w.tX)],"internal"),this._set("state","ready")}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=(0,a.SC)(this._gridVisualElement),this._outlineVisualElement=(0,a.SC)(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){return await(0,C.N1)(this,"ready"),this}_updatePlane(e){if((0,a.Wi)(e))return;const t=(0,R.s)(L.WM.get(),(0,R.l)(e.basis1),(0,R.l)(e.basis2),1),i=(0,x.u)(L.MP.get(),t),r=function(e,t){return ge(e.basis1,e.basis2,e.origin,t)}(e,L.MP.get()),s=(0,x.m)(i,r,i);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials(e){let{visible:t,active:i,editable:r,showGrid:s}=e;this._outlineVisualElement.color=me,this._outlineVisualElement.width=r?1:2,this._outlineVisualElement.stipplePattern=i?null:(0,Ke.z5)(5);const a=s?fe:[0,0,0,0];this._gridVisualElement.backgroundColor=ve,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=t,this._outlineVisualElement.visible=t}};(0,r._)([(0,n.Cb)({readOnly:!0})],Je.prototype,"state",void 0),(0,r._)([(0,n.Cb)()],Je.prototype,"view",void 0),(0,r._)([(0,n.Cb)()],Je.prototype,"analysis",void 0),(0,r._)([(0,n.Cb)()],Je.prototype,"analysisViewData",void 0),(0,r._)([(0,n.Cb)()],Je.prototype,"ready",null),(0,r._)([(0,n.Cb)()],Je.prototype,"showGrid",void 0),(0,r._)([(0,n.Cb)()],Je.prototype,"editable",void 0),Je=(0,r._)([(0,d.j)("esri.views.3d.analysis.Slice.SliceVisualization")],Je);let Xe=class extends((0,c.p)(s.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new Je({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new qe({view:this.view,analysis:this.analysis,analysisViewData:this})}destroy(){this.analysisVisualization=(0,a.SC)(this.analysisVisualization),this.analysisController=(0,a.SC)(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};(0,r._)([(0,n.Cb)()],Xe.prototype,"type",void 0),(0,r._)([(0,n.Cb)()],Xe.prototype,"analysis",void 0),(0,r._)([(0,n.Cb)()],Xe.prototype,"plane",void 0),(0,r._)([(0,n.Cb)()],Xe.prototype,"active",void 0),(0,r._)([(0,n.Cb)({aliasOf:"analysisVisualization.showGrid"})],Xe.prototype,"showGrid",void 0),(0,r._)([(0,n.Cb)({aliasOf:"analysisVisualization.editable"})],Xe.prototype,"editable",void 0),Xe=(0,r._)([(0,d.j)("esri.views.3d.analysis.SliceAnalysisView3D")],Xe);const Qe=Xe},33906:(e,t,i)=>{i.d(t,{G:()=>n,e:()=>o});var r=i(92026),s=i(79803),a=i(77648);function n(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=(0,s.fM)(e,t);return(0,r.Wi)(o)?null:(o.hasZ&&!n||!(0,r.pC)(i)||(o.z=(0,r.Pt)((0,a.KO)(i,o),0)),o)}function o(e,t,i){i.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},33837:(e,t,i)=>{i.d(t,{r:()=>g});var r=i(92026),s=i(14226),a=i(81949),n=i(11186),o=i(71353),l=i(90045),d=i(151),c=i(52168),h=i(75558),u=i(56529),p=i(58901);class g extends c._{constructor(e){super(e),this._renderOccluded=u.yD.OccludeAndTransparent,this._width=1,this._color=(0,d.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromRenderSpacePoint(e){const t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,o.c)(),r=(0,o.c)(),s=100,a=[];(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),(0,n.s)(i,e[2],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),(0,n.s)(i,e[2],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),(0,n.s)(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),this.geometry=[a]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,r=e.basis1,s=e.basis2,a=.5,n=(0,o.c)(),l=(0,o.c)(),d=(0,o.c)(),c=(0,o.c)();n[0]=i[0]-r[0]*a-s[0]*a,n[1]=i[1]-r[1]*a-s[1]*a,n[2]=i[2]-r[2]*a-s[2]*a,l[0]=i[0]-r[0]*a+s[0]*a,l[1]=i[1]-r[1]*a+s[1]*a,l[2]=i[2]-r[2]*a+s[2]*a,d[0]=i[0]+r[0]*a+s[0]*a,d[1]=i[1]+r[1]*a+s[1]*a,d[2]=i[2]+r[2]*a+s[2]*a,c[0]=i[0]+r[0]*a-s[0]*a,c[1]=i[1]+r[1]*a-s[1]*a,c[2]=i[2]+r[2]*a-s[2]*a,t.push([n[0],n[1],n[2]]),t.push([l[0],l[1],l[2]]),t.push([d[0],d[1],d[2]]),t.push([c[0],c[1],c[2]]),t.push([n[0],n[1],n[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,s.f)(_,t);const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Z;this.transform=(0,s.f)(_,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,l.g)(e,this._color)||((0,l.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,r.pC)(e)?!(0,r.Wi)(this._innerColor)&&(0,l.g)(e,this._innerColor)||(this._innerColor=(0,l.c)((0,d.c)(),e),this._updateMaterial()):(0,r.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,r.pC)(e)!==(0,r.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,r.Wi)(e)||(0,r.Wi)(this._stippleOffColor)||!(0,l.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,r.pC)(e)?(0,d.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){this._stipplePreferContinuous!==e&&(this._stipplePreferContinuous=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new p.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const r=(0,h.YU)(t[i]);e.addGeometry(r,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if((0,r.Wi)(e)||0===e.length)return[];const t=[];return e.forEach((e=>{const i=e.length,r=new Float64Array(3*i);e.forEach(((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const s={overlayInfo:null,attributeData:{position:r},removeDuplicateStartEnd:h.NW.KEEP};t.push(s)})),t}}const _=(0,a.c)()},52168:(e,t,i)=>{i.d(t,{_:()=>c});var r=i(92026),s=i(14226),a=i(81949),n=i(86244),o=i(68401),l=i(66327),d=i(97882);class c extends n.l{constructor(e){super(e.view),this._resources=null,this._transform=(0,a.c)()}get object(){return(0,r.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,s.c)(this._transform,e),(0,r.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,r.Wi)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new d.F({isPickable:!1,updatePolicy:o.jq.SYNC});e.add(t);const i=new l.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!(0,r.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,r.Wi)(this._resources)||this._resources.object.setVisible(e)}}},86244:(e,t,i)=>{i.d(t,{l:()=>r});class r{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},43505:(e,t,i)=>{i.d(t,{A:()=>s,o:()=>a});var r=i(98634);function s(e){e.vertex.uniforms.add("cameraPosition","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(r.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function a(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},66156:(e,t,i)=>{i.d(t,{j:()=>V});var r=i(71011),s=i(68401),a=i(94425),n=i(40485),o=i(56529),l=i(78041),d=i(93822),c=i(64226),h=i(22909),u=i(27366),p=i(33280),g=i(15226),_=i(41012),m=i(82144),v=i(31132),f=i(33559),y=i(7566),b=i(27627),w=i(50411),C=i(32500),E=i(8548),P=i(36207);class T extends v.A{initializeProgram(e){const t=T.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,oitEnabled:i.transparencyPassType===s.Am.Color,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new b.$(e.rctx,r,y.i)}bindPass(e,t){(0,_.II)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,g.p)(this.program,t))}bindDraw(e){(0,_.id)(this.program,e),(0,p.DA)(this.program,this.configuration,e),this.program.rebindTextures()}_setPipelineState(e,t){const i=this.configuration,a=e===s.Am.NONE,n=e===s.Am.FrontFace;return(0,P.sm)({blending:i.output!==r.H.Color&&i.output!==r.H.Alpha||!i.transparent?null:a?O:(0,l.j7)(e),culling:(0,P.zp)(i.cullFace),depthTest:{func:(0,l.Bh)(e)},depthWrite:a?i.writeDepth&&P.LZ:(0,l.K5)(e),colorWrite:P.BK,stencilWrite:i.sceneHasOcludees?w.s3:null,stencilTest:i.sceneHasOcludees?t?w.eD:w.RY:null,polygonOffset:a||n?null:(0,l.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}T.shader=new m.J(C.I,(()=>i.e(8957).then(i.bind(i,18957))));const O=(0,P.if)(E.zi.ONE,E.zi.ONE_MINUS_SRC_ALPHA);class S extends f.m{constructor(){super(...arguments),this.output=r.H.Color,this.cullFace=s.Vr.None,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=s.Am.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}(0,u._)([(0,f.o)({count:r.H.COUNT})],S.prototype,"output",void 0),(0,u._)([(0,f.o)({count:s.Vr.COUNT})],S.prototype,"cullFace",void 0),(0,u._)([(0,f.o)()],S.prototype,"slicePlaneEnabled",void 0),(0,u._)([(0,f.o)()],S.prototype,"transparent",void 0),(0,u._)([(0,f.o)()],S.prototype,"enableOffset",void 0),(0,u._)([(0,f.o)()],S.prototype,"writeDepth",void 0),(0,u._)([(0,f.o)()],S.prototype,"sceneHasOcludees",void 0),(0,u._)([(0,f.o)({count:s.Am.COUNT})],S.prototype,"transparencyPassType",void 0),(0,u._)([(0,f.o)()],S.prototype,"multipassTerrainEnabled",void 0),(0,u._)([(0,f.o)()],S.prototype,"cullAboveGround",void 0);class V extends o.F5{constructor(e){super(e,A),this.supportsEdges=!0,this.techniqueConfig=new S}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<l.ve,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,s,a,n){(0,h.Bw)(e,t,r,s,a,void 0,n)}requiresSlot(e,t){return e===d.r.DRAPED_MATERIAL||((0,a.S)(t)===r.H.Highlight?e===d.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?d.r.TRANSPARENT_MATERIAL:d.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d.r.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===r.H.Color||e.output===r.H.Alpha||e.output===r.H.Highlight?new x(e):void 0}createBufferWriter(){return new c.G_(c.W1)}}class x extends n.Z{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(T,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return this._output!==r.H.Color&&this._output!==r.H.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const A={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:s.Vr.None,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...o.mo}}}]);
//# sourceMappingURL=1060.d6750ac3.chunk.js.map