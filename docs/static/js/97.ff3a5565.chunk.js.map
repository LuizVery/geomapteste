{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["c","y","this","exportImageParameters","i","layer","destroy","e","commitProperty","_get","s","a","Promise","reject","r","p","get","l","minScale","o","maxScale","visible","sublayers","forEach","popupEnabled","u","defaultPopupTemplateEnabled","t","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","m","renderer","createFetchPopupFeaturesQueryGeometry","geometry","n","outFields","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","timeExtent","isEmpty","prototype","readOnly","arguments","type","updatingHandles","add","addPromise","refreshDebounced","view","xoffset","Math","max","abs","yoffset","stops","length","size","maxSize","minSize","f","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","d","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","push","has","indexOf","keyField","defaultPopupTemplate","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","x","xmin","min","ymin","xmax","ymax"],"mappings":"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","file":"static/js/97.ff3a5565.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as i}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as m}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new i({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const p=this.get(\"view.scale\"),i=[],l=async e=>{const r=0===e.minScale||p<=e.minScale,o=0===e.maxScale||p>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(l);else if(e.popupEnabled){const r=u(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&i.unshift({sublayer:e,popupTemplate:r})}},c=a.sublayers.toArray().reverse().map(l);await Promise.all(c);const y=i.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),p=t(s)?s.event:null,i=m({renderer:r.renderer,event:p}),l=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=l,a.outFields=await n(r,o);const u=await this._loadArcadeModules(o);u&&u.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=l.width/i);return(await r.queryFeatures(a)).features}));return(await o(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return l()}};return e([s()],y.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],y.prototype,\"exportImageVersion\",null),e([s()],y.prototype,\"layer\",void 0),e([s()],y.prototype,\"suspended\",void 0),e([s(p)],y.prototype,\"timeExtent\",void 0),y=e([a(\"esri.views.layers.MapImageLayerView\")],y),y};export{c as MapImageLayerView,c as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{MapImageLayerView as t}from\"../../layers/MapImageLayerView.js\";import{createQueryGeometry as o}from\"../../support/drapedUtils.js\";let i=class extends(t(s)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this.updatingHandles.add(this,\"exportImageVersion\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return o(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent}}};i=e([r(\"esri.views.3d.layers.MapImageLayerView3D\")],i);var a=i;export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}