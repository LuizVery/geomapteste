{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js","../node_modules/@arcgis/core/chunks/PointRenderer.glsl.js","../node_modules/@arcgis/core/views/3d/layers/PointCloudWorkerHandle.js","../node_modules/@arcgis/core/views/3d/layers/i3s/LoDUtil.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PagedNodeIndex.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudRendererUtil.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointGraphic.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointHighlights.js","../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/PointRendererTechnique.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointRenderer.js","../node_modules/@arcgis/core/views/3d/layers/PointCloudLayerView3D.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"names":["c","u","e","s","this","layer","popupEnabled","a","r","t","_validateFetchPopupFeatures","Promise","reject","clientGraphics","length","resolve","n","l","type","associatedLayer","o","fieldsIndex","i","h","prepareFetchPopupFeatures","y","Set","p","push","whenGraphicAttributes","catch","then","concat","d","output","extensions","add","include","attributes","vertex","uniforms","varyings","code","drawScreenSize","fragment","Object","freeze","__proto__","build","geometryBuffer","primaryAttributeData","buffer","modulationAttributeData","filterAttributesData","userAttributesData","indexOf","getParentId","remove","pop","load","g","_pages","pageSize","_nodeSR","_renderSR","nodes","renderObbs","parents","Uint32Array","getRenderObb","center","index","queue","masks","tempAabb","hasNodes","getNode","f","clippingBox","frustum","predicate","firstChild","childCount","hasPage","pageMiss","obb","obbs","renderer","toJSON","attributeStorageInfo","field","colorModulation","rendererJSON","isRGBRenderer","primaryAttribute","modulationAttribute","filters","map","filterJSON","attributeInfo","pointSizeAlgorithm","name","attributeValues","valueType","valuesPerElement","storageInfo","useElevation","encoding","toLowerCase","cloneProperties","pointCloudMetadata","constructOnly","prototype","context","highlights","size","enableSet","removeSet","disableSet","delete","enabled","forEachNode","enableSetForNode","ids","get","id","forEach","addHighlight","disableSetForNode","removeHighlight","Map","nodeId","pointId","set","shader","configuration","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","rctx","depthTest","func","depthWrite","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","m","arguments","count","k","positions","offset","stride","normalized","colors","T","_params","isGround","_bindParameters","inverseViewport","highlightDepthTexture","_highlights","j","canRender","layerUid","_useFixedSizes","_scaleFactor","_minSizePx","_useRealWorldSymbolSizes","_size","_sizePx","_slicePlaneEnabled","_clipBox","z","P","_techniqueConfig","L","tempMatrix4","tempVec3","_","hasHighlights","_context","_techniqueRep","shaderTechniqueRep","requestRender","x","v","camera","perScreenPixelRatio","near","_getSizeParams","S","q","node","point","dist","normal","A","C","B","b","forAll","splatSize","F","H","G","isLeaf","D","V","U","M","w","origin","E","coordinates","R","$","options","store","N","metadata","createGraphic","I","intersector","results","min","max","all","pass","vao","_initNode","selectTechnique","program","setUniform3fv","useProgram","bindPipelineState","setUniformMatrix4fv","projectionMatrix","setUniform2f","far","isHighlightPass","fullViewport","pixelRatio","drawFixedSize","fixedSize","fullHeight","sliceHelper","plane","screenMinSize","W","viewMatrix","bindVAO","_renderHighlightFragments","drawArrays","component","_requestRender","nodeAdded","filterInPlace","nodeRemoved","removeAll","clear","J","K","filter","Q","O","createVertex","rgb","drawScreenSpace","hasOccludees","releaseAndAcquire","_technique","Math","isInstanceOfNode","hasOwnProperty","ae","getLogger","le","he","maximumPointCount","_renderer","_rendererAdded","_renderedNodes","_nodeScales","_updateViewNeeded","_lodFactor","_maxLoggedBoxWarnings","_pageMultiplier","_nodeLoadEpoch","_indexQueue","_workQueue","Array","_idleQueue","_indexPagesLoading","_loadingNodes","_recalcWork","_layerIsVisible","_codedDomainPopulationPromise","_codedDomainPopulationAbortController","_totalWork","_index","_loadingInitNodePage","_nodeIdArray","scaleFactor","useRealWorldSymbolSizes","pointsPerInch","outFields","from","view","clippingArea","renderSpatialReference","ee","elevationInfo","mode","spatialReference","unit","resourceController","_worker","schedule","addResolvingPromise","promise","_tmpPoint","_indexRequester","createStreamDataRequester","_dataRequester","_initRenderer","_initNodePages","memoryController","_memCache","getMemCache","uid","updatingHandles","_setUpdateViewNeeded","_elevationOffsetChanged","_rendererChanged","_reload","state","handles","basemapTerrain","on","_scaleUpdateHandler","events","when","scheduler","registerTask","ne","POINT_CLOUD_LAYER","registerIdleStateCallbacks","_idleBegin","_idleEnd","_clearNodeState","_updateLoading","cancelLoading","destroy","_destroyRenderer","abort","X","_createGraphic","_setPointsVisible","minSizePx","sqrt","sizePx","slicePlane","pointIdFilterMap","computeMapPointFromVec3d","_createGraphicAttributes","Y","pointIndexInNode","attributePointIndexInNode","epoch","geometry","sourceLayer","_encodeGraphicAttribute","values","_stage","addRenderPlugin","removeRenderPlugin","useFixedSizes","minScale","maxScale","extent","pe","has","scale","contentCamera","viewForward","sort","getRenderCenter","_updateQueues","_computeWork","notifyChange","_cancelNodeLoading","_cancelIndexLoading","abortController","cancelAll","_removeFromRenderer","suspended","_isRootNodeVisible","run","_updateWorkQueues","_processIndexQueue","_processWorkQueue","process","shift","_loadNodePage","addPage","_elevationOffset","done","_scheduleWorkEntry","_processWorkEntry","madeProgress","find","toString","loadNode","signal","_setupRendererData","_addToRenderer","domain","queryCachedStatistics","ok","value","labels","isArray","codedValues","label","populateClassCodeCodedDomain","_splitGraphicsPerNode","_loadElevationAttributeFromGeometry","resourceId","_loadAndParseAttribute","_isValidPointGraphic","_loadAttribute","vertexCount","defaultGeometrySchema","_loadGeometry","isCollection","toArray","highlight","_graphicToPointDefinition","nodesPerPage","nodePerIndexBlock","renderCoordsHelper","_traverseVisible","createVisibilityTraverse","baseUrl","_requestNodePage","pointCount","lodThreshold","effectiveArea","inverseDensity","_getLodMemoryFactor","_computeNodesForMinimumDensity","_computePointCount","displayNodes","memoryFactor","_clippingBox","eye","se","_getScale","oe","_computeAveragePixelArea","getScale","te","loadNodeAsync","error","loadAdditionalUserAttributes","schema","rendererInfo","filterInfo","elevationOffset","inSR","outSR","invoke","_requestData","key","token","apiKey","request","query","removeNode","put","ue","addNode","halfSize","warn","setRenderObb","points","ce","reduce","getUsedMemory","displayedNumberOfFeatures","maximumNumberOfFeatures","totalNumberOfFeatures","core","visibleNodes","Z","re","readOnly","aliasOf","Boolean","ie","_e","popupTemplate","getRequiredFields","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate"],"mappings":"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","file":"static/js/99.4603e632.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Error.js\";import{isSome as s}from\"../../../../core/maybe.js\";import\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as t}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{unpackFieldNames as o,populateMissingFields as p}from\"../../../../layers/support/fieldUtils.js\";import{getFetchPopupTemplate as a,getRequiredFields as i}from\"../../../layers/support/popupUtils.js\";const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;if(!t)return new r(\"scenelayerview3d:fetchPopupFeatures\",\"Popups are disabled\",{layer:s});return a(s,e)?void 0:new r(\"scenelayerview3d:fetchPopupFeatures\",\"Layer does not define a popup template\",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);const c=s(r)?r.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const u=[],n=[],l=\"scene\"===this.layer.type&&s(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,h=o(this.layer.fieldsIndex,await i(l,a(this.layer,r)));await this.prepareFetchPopupFeatures(h);const y=new Set;for(const s of c)p(h,s,y)?n.push(s):u.push(s);return 0===n.length?Promise.resolve(u):this.whenGraphicAttributes(n,[...y]).catch((()=>n)).then((e=>u.concat(e)))}};return u=e([t(\"esri.views.3d.layers.support.PopupSceneLayerView\")],u),u};export{c as PopupSceneLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{OutputHighlight as i}from\"../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{RgbaFloatEncoding as o}from\"../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as a}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function r(r){const n=new a,d=0===r.output,c=1===r.output,s=4===r.output;return n.extensions.add(\"GL_OES_standard_derivatives\"),n.include(e,r),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"color\",\"vec3\"),n.vertex.uniforms.add(\"uModelViewMatrix\",\"mat4\").add(\"uProjectionMatrix\",\"mat4\").add(\"uScreenMinMaxSize\",\"vec2\").add(\"uPointScale\",\"vec2\").add(\"uClipMin\",\"vec3\").add(\"uClipMax\",\"vec3\"),c?(n.vertex.uniforms.add(\"nearFar\",\"vec2\"),n.varyings.add(\"depth\",\"float\")):4!==r.output&&n.varyings.add(\"vColor\",\"vec3\"),n.vertex.code.add(t`\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||\n        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera = uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize = uPointScale.x;\n      vec4 position = uProjectionMatrix * camera;\n     ${r.drawScreenSize?t`\n      float clampedScreenSize = pointSize;`:t`\n      float pointRadius = 0.5 * pointSize;\n      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset = uProjectionMatrix * cameraOffset;\n      float radius = abs(positionOffset.y - position.y);\n      float viewHeight = uPointScale.y;\n      // screen diameter = (2 * r / w) * (h / 2)\n      float screenPointSize = (radius / position.w) * viewHeight;\n      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position = uProjectionMatrix * camera;`}\n\n     gl_PointSize = clampedScreenSize;\n     gl_Position = position;\n\n     ${c?t`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:\"\"}\n     ${d?t`vColor = color;`:\"\"}\n    }\n  `),n.fragment.include(o,r),s&&n.include(i),n.fragment.code.add(t`\n    void main(void) {\n      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n      float r2 = dot(vOffset, vOffset);\n\n      if (r2 > 0.25) {\n        discard;\n      }\n      ${c?t`gl_FragColor = float2rgba(depth);`:\"\"}\n      ${s?t`outputHighlight();`:\"\"}\n      ${d?t`gl_FragColor = vec4(vColor, 1.0);`:\"\"}\n    }\n  `),n}var n=Object.freeze({__proto__:null,build:r});export{n as P,r as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{WorkerHandle as r}from\"../../../core/workers/WorkerHandle.js\";class e extends r{constructor(t){super(\"PointCloudWorker\",\"transform\",t)}getTransferList(r){const e=[r.geometryBuffer];if(t(r.primaryAttributeData)&&r.primaryAttributeData.buffer&&e.push(r.primaryAttributeData.buffer),t(r.modulationAttributeData)&&r.modulationAttributeData.buffer&&e.push(r.modulationAttributeData.buffer),t(r.filterAttributesData))for(const u of r.filterAttributesData)t(u)&&u.buffer&&e.push(u.buffer);for(const t of r.userAttributesData)t.buffer&&e.push(t.buffer);return e}}export{e as PointCloudWorkerHandle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{d as e}from\"../../../../chunks/vec3.js\";function t(e,t,g){for(let n=0;n<t.length;n++)r[n]=!1,o[n]=null;for(let r=0;r<e.length;r++)n[r]=!1,l[r]=null;for(let n=0;n<t.length;n++){const o=h(t[n],e,g);o>=0&&(r[n]=!0,null!=l[o]?l[o].push(t[n]):l[o]=[t[n]])}for(let l=0;l<e.length;l++){const r=h(e[l],t,g);r>=0&&(n[l]=!0,null!=o[r]?o[r].push(e[l]):o[r]=[e[l]])}const u=[];for(let r=0;r<e.length;r++)null!=l[r]||n[r]||u.push({load:[],remove:[e[r]]});for(let n=0;n<t.length;n++)null!=o[n]||r[n]||u.push({load:[t[n]],remove:[]});for(let n=0;n<t.length;n++)null!=o[n]&&(o[n].length>1||o[n][0]!==t[n])&&u.push({load:[t[n]],remove:o[n]});for(let n=0;n<e.length;n++)null!=l[n]&&(l[n].length>1||l[n][0]!==e[n])&&u.push({load:l[n],remove:[e[n]]});return u}const n=[!1],l=[null],r=[!1],o=[null];function h(e,t,n){let l=e;for(;l>0;){const e=t.indexOf(l);if(e>=0)return e;l=n.getParentId(l)}return t.indexOf(l)}function g(t,n,l){return t.sort(((t,r)=>{if(0===t.load.length&&0===r.load.length)return 0;if(0===t.load.length)return-1;if(0===r.load.length)return 1;if(0===t.remove.length&&0===r.remove.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return e(o,n)-e(h,n)}if(0===t.remove.length)return-1;if(0===r.remove.length)return 1;if(1===t.load.length&&1===r.load.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return e(o,n)-e(h,n)}if(1===t.load.length)return-1;if(1===r.load.length)return 1;{const o=l.getRenderCenter(t.remove[0]),h=l.getRenderCenter(r.remove[0]);return e(o,n)-e(h,n)}}))}function u(e,t,n){for(let l=0;l<e.length;++l){const r=e[l];r.load.length>t&&1===r.remove.length&&d(e,r,n)}}function d(e,t,n){const l=[t.remove[0]],r=[];for(;1===l.length;){const e=l.pop();r.length=0;for(let o=0;o<t.load.length;o++){let h=t.load[o],g=n.getParentId(h);for(;g!==e;)h=g,g=n.getParentId(h);let u=l.indexOf(h);u<0&&(u=l.length,l.push(h),r.push([])),r[u].push(t.load[o])}}t.load=l;for(let o=0;o<l.length;o++)r[o].length>1?e.push({remove:[l[o]],load:r[o]}):l[o]=r[o][0]}export{t as nodeDiff,g as sortFrontToBack,u as splitWorkEntries,d as splitWorkEntry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{create as e,contains as t,intersects as s}from\"../../../../geometry/support/aaBoundingBox.js\";import{transformObb as n}from\"./I3SUtil.js\";import{set as i,toAaBoundingBox as r,intersectPlane as o,ObbArray as p}from\"../../support/orientedBoundingBox.js\";class h{constructor(e,t,s){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=s}addPage(e,t,s=0){for(;this._pages.length<e;)this._pages.push(null);const n=g(t,this._nodeSR,this._renderSR,s);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},u(this._pages,this.pageSize)}hasPage(e){return!!this._pages[e]}getNode(e){const t=this.pageSize;return this._pages[l(e,t)].nodes[c(e,t)]}getRenderObb(e){const t=this.pageSize;return this._pages[l(e,t)].renderObbs[c(e,t)]}getRenderCenter(e){return this.getRenderObb(e).center}setRenderObb(e,t){const s=this.pageSize;i(t,this._pages[l(e,s)].renderObbs[c(e,s)])}getParentId(e){const t=this.pageSize;return this._pages[l(e,t)].parents[c(e,t)]}hasNodes(e,t){const s=l(e,this.pageSize),n=l(e+t-1,this.pageSize);for(let i=s;i<=n;i++)if(null==this._pages[i])return!1;return!0}forEachNodeId(e){for(let t=0;t<this._pages.length;t++){const s=this._pages[t];if(s)for(let n=0;n<s.nodes.length;n++)e(t*this.pageSize+n)}}createVisibilityTraverse(){const t={index:this,queue:[],masks:[],tempAabb:e()};return(e,s)=>a(t,e,s)}}function a(e,n,i){const p=e.index;if(!p.hasNodes(0,1))return;const h=e.queue;h.length=0,h.push(0);const a=e.masks;for(a.length=0,a.push(0);h.length>0;){const g=h.pop();let u=a.pop();const c=p.getNode(g),d=p.getRenderObb(g);let f=!0;if(null!=n.clippingBox){const i=1<<n.frustum.length;if(0==(u&i)){const o=r(d,e.tempAabb);t(n.clippingBox,o)?u|=i:s(n.clippingBox,o)||(f=!1)}}for(let e=0;e<n.frustum.length&&f;e++){const t=1<<e;if(0==(u&t)){const s=o(d,n.frustum[e]);s>0?f=!1:s<0&&(u|=t)}}if(i.predicate(g,c,f)){const e=c.firstChild,t=c.childCount;let s=!1;const n=l(e,p.pageSize),r=l(e+t-1,p.pageSize);for(let o=n;o<=r;o++)if(!p.hasPage(o)){i.pageMiss(g,o),s=!0;break}if(!s)for(let i=0;i<t;i++)h.push(e+i),a.push(u)}}}function g(e,t,s,i){const r=new p(e.length);for(let o=0;o<e.length;o++)n(e[o].obb,t,r.obbs[o],s,i);return r.obbs}function u(e,t){const s=[0];for(;s.length;){const n=s.pop(),i=e[l(n,t)].nodes[c(n,t)];for(let r=0;r<i.childCount;r++){const o=i.firstChild+r;null!=e[l(o,t)]&&(e[l(o,t)].parents[c(o,t)]=n,s.push(o))}}}function l(e,t){return e/t|0}function c(e,t){return e%t}export{h as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction t(t){const e=t.renderer,n=e&&e.type,o=e&&t.renderer.toJSON()||null;let r=null,i=!1;\"point-cloud-unique-value\"===n||\"point-cloud-stretch\"===n||\"point-cloud-class-breaks\"===n?r=u(t.attributeStorageInfo,e.field):\"point-cloud-rgb\"===n?(r=l(t.attributeStorageInfo,e.field),i=null!=r):(r=l(t.attributeStorageInfo,\"RGB\"),i=null!=r);let a=null;return e&&e.colorModulation&&(a=u(t.attributeStorageInfo,e.colorModulation.field)),{rendererJSON:o,isRGBRenderer:i,primaryAttribute:r,modulationAttribute:a}}function e(t){const e=t.filters;return e?e.map((e=>({filterJSON:e.toJSON(),attributeInfo:u(t.attributeStorageInfo,e.field)}))):[]}function n(t){const e=t&&t.pointSizeAlgorithm;return e&&\"splat\"===e.type?e:null}function o(t){const e=t&&t.pointSizeAlgorithm;return e&&\"fixed-size\"===e.type?e:null}function r(t){const e=t&&t.pointSizeAlgorithm;return!(!e||!e.type)&&\"fixed-size\"===e.type}function l(t,e){for(const n of t)if(n.name===e&&null!=n.attributeValues&&\"UInt8\"===n.attributeValues.valueType&&3===n.attributeValues.valuesPerElement)return{name:e,storageInfo:n,useElevation:!1};return null}function u(t,e){for(const n of t)if(n.name===e){const t=\"embedded-elevation\"===n.encoding;return{name:e,storageInfo:t?null:n,useElevation:t}}return\"elevation\"===e.toLowerCase()?{name:e,storageInfo:null,useElevation:!0}:null}export{u as getAttributeInfo,e as getFilterInfo,o as getFixedSizeAlgorithm,t as getRendererInfo,n as getSplatSizeAlgorithm,r as rendererUsesFixedSizes};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../../chunks/tslib.es6.js\";import o from\"../../../../Graphic.js\";import{property as e}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";var t;let p=t=class extends o{constructor(r){super(r)}clone(){return new t(this.cloneProperties())}cloneProperties(){const{pointCloudMetadata:r}=this;return{...super.cloneProperties(),pointCloudMetadata:r}}};r([e({constructOnly:!0})],p.prototype,\"pointCloudMetadata\",void 0),p=t=r([s(\"esri.views.3d.layers.i3s.PointGraphic\")],p);export{p as PointGraphic};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{makeHandle as e}from\"../../../../core/handleUtils.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{Object3DStateID as i}from\"../../webgl-engine/lib/Object3DStateID.js\";class h{constructor(e){this.context=e,this.highlights=new Set}get hasHighlights(){return this.highlights.size>0}destroy(){this.highlights=null}add(t){const i=new s(t);return this.highlights.add(i),this.enableSet(i),e((()=>this.removeSet(i)))}removeSet(e){this.disableSet(e),this.highlights.delete(e)}enableSet(e){e.enabled||(e.enabled=!0,this.context.forEachNode((t=>this.enableSetForNode(e,t))))}enableSetForNode(e,t){if(!e.enabled)return;const i=e.ids.get(t.id);i&&i.forEach((i=>this.context.addHighlight(t,i,e.id)))}disableSet(e){e.enabled&&(e.enabled=!1,this.context.forEachNode((t=>this.disableSetForNode(e,t))))}disableSetForNode(e,t){e.enabled||this.context.removeHighlight(t,e.id)}nodeAdded(e){this.highlights.forEach((t=>this.enableSetForNode(t,e)))}nodeRemoved(e){this.highlights.forEach((t=>this.disableSetForNode(t,e)))}removeAll(){this.highlights.forEach((e=>this.disableSet(e)))}}class s{constructor(e){this.id=new i(0),this.ids=new Map,this.enabled=!1;for(const i of e)t(i)&&this.add(i.nodeId,i.pointId)}add(e,t){const i=this.ids.get(e);i?i.add(t):this.ids.set(e,new Set([t]))}}export{h as PointHighlights};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as r}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as t}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as i,ShaderTechniqueConfiguration as s}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as o}from\"../lib/DefaultVertexAttributeLocations.js\";import{Program as n}from\"../lib/Program.js\";import{stencilWriteMaskOn as l,stencilBaseAllZerosParams as c}from\"../lib/StencilUtils.js\";import{P as a}from\"../../../../chunks/PointRenderer.glsl.js\";import{makePipelineState as u,defaultDepthWriteParams as d,defaultColorWriteParams as p}from\"../../../webgl/renderState.js\";class h extends t{constructor(e,r,t){super(e,r,t)}initializeProgram(e){const r=h.shader.get(),t=this.configuration,i=r.build({output:t.output,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:t.drawScreenSize});return new n(e.rctx,i,o)}initializePipeline(){return u({depthTest:{func:513},depthWrite:d,colorWrite:p,stencilWrite:this.configuration.sceneHasOcludees?l:null,stencilTest:this.configuration.sceneHasOcludees?c:null})}}h.shader=new r(a,(()=>import(\"./PointRenderer.glsl.js\")));class m extends s{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.drawScreenSize=!1,this.sceneHasOcludees=!1}}e([i({count:8})],m.prototype,\"output\",void 0),e([i()],m.prototype,\"slicePlaneEnabled\",void 0),e([i()],m.prototype,\"drawScreenSize\",void 0),e([i()],m.prototype,\"sceneHasOcludees\",void 0);export{h as PointRendererTechnique,m as PointRendererTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isNone as e,unwrap as i,disposeMaybe as t,isSome as s}from\"../../../../core/maybe.js\";import r from\"../../../../core/PooledArray.js\";import{i as n,t as o,m as a}from\"../../../../chunks/mat4.js\";import{c as h}from\"../../../../chunks/mat4f32.js\";import{I as l}from\"../../../../chunks/mat4f64.js\";import{f as c,l as d,a as u,o as m,d as p,p as g,s as f}from\"../../../../chunks/vec3.js\";import{c as _}from\"../../../../chunks/vec3f32.js\";import{c as x}from\"../../../../chunks/vec3f64.js\";import{s as S}from\"../../../../chunks/vec4.js\";import{create as z,POSITIVE_INFINITY as P,offset as b,contains as w,containsPoint as R,equals as y,set as q}from\"../../../../geometry/support/aaBoundingBox.js\";import{create as v}from\"../../../../geometry/support/plane.js\";import{fromPoints as M}from\"../../../../geometry/support/ray.js\";import{PointHighlights as j}from\"./PointHighlights.js\";import{minimumDistancePlane as F,maximumDistancePlane as H,intersectLine as V,toAaBoundingBox as U}from\"../../support/orientedBoundingBox.js\";import{bindSliceUniforms as A}from\"../../webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{bindOutputHighlight as C}from\"../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{Default3D as B}from\"../../webgl-engine/lib/DefaultVertexAttributeLocations.js\";import{IntersectorResult as E}from\"../../webgl-engine/lib/intersectorUtils.js\";import{PointRendererTechniqueConfiguration as L,PointRendererTechnique as I}from\"../../webgl-engine/shaders/PointRendererTechnique.js\";import N from\"../../../webgl/BufferObject.js\";import O from\"../../../webgl/VertexArrayObject.js\";const k={positions:[{name:\"position\",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:\"color\",count:3,type:5121,offset:0,stride:3,normalized:!0}]};class T{constructor(e){this._params=e,this.type=\"Point\",this.isGround=!1,this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null},this._highlights=new j({forEachNode:e=>this.forEachNode(e),addHighlight:(e,i,t)=>this.addHighlight(e,i,t),removeHighlight:(e,i)=>this.removeHighlight(e,i)}),this.canRender=!0,this.layerUid=\"\",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=z(P),this._techniqueConfig=new L,this.tempMatrix4=h(),this.tempVec3=_(),this.nodes=new r}get needsHighlight(){return this._highlights.hasHighlights}initializeRenderContext(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRep,e.requestRender()}uninitializeRenderContext(){}intersect(e,i,t,s){const r=x(),n=x(),o=x(),a=x(),h=v(),f=e.camera.perScreenPixelRatio/2,_=e.camera.near,P=this._getSizeParams();c(n,s,t);const y=1/d(n);u(n,n,y),m(o,n),S(h,n[0],n[1],n[2],-p(n,t));class q{constructor(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=\"\"}}const j=new q,A=new q,C=[],B=z(),L=z(this._clipBox);b(L,-t[0],-t[1],-t[2],L),this.nodes.forAll((l=>{const d=l.splatSize*this._scaleFactor;let u=F(l.obb,h),m=H(l.obb,h);u-=G(d,u+_,P,f,l.isLeaf),m-=G(d,m+_,P,f,l.isLeaf);const x=m<0,S=null!=j.dist&&null!=A.dist&&j.dist<u*y&&A.dist>m*y;if(x||S)return;const z=D(d,m+_,P,f,l.isLeaf);if(!V(l.obb,t,n,z))return;const v=z*z;U(l.obb,B),b(B,-t[0],-t[1],-t[2],B);const M=!w(L,B);c(a,l.origin,t);const E=l.coordinates.length/3;for(let h=0;h<E;h++){if(r[0]=a[0]+l.coordinates[3*h],r[1]=a[1]+l.coordinates[3*h+1],r[2]=a[2]+l.coordinates[3*h+2],M&&!R(L,r))continue;const c=p(r,n),u=g(r)-c*c;if(u>v)continue;let m=c+_;const x=G(d,m,P,f,l.isLeaf);if(c-x<0)continue;m-=x;const S=D(d,m,P,f,l.isLeaf);if(u>S*S)continue;const z=(c-x)*y,b=e=>{e.point=$(l,h,e.point),e.dist=z,e.normal=o,e.node=l,e.pointId=h,e.layerUid=this.layerUid};if((null==j.dist||z<j.dist)&&(null==i||i(t,s,z))&&b(j),0!==e.options.store&&(null==A.dist||z>A.dist)&&(null==i||i(t,s,z))&&b(A),2===e.options.store&&(null==i||i(t,s,z))){const e=new q;b(e),C.push(e)}}}));const I=e=>{const{layerUid:i,node:t,pointId:s}=e;return{type:\"external\",point:e.point,metadata:{layerUid:i,createGraphic:()=>this._params.createGraphic(t,s,e.point)}}},N=(e,i)=>{const t=I(i),s=`${i.layerUid}/${i.node.id}/${i.pointId}`;e.set(t,s,i.dist,i.normal,l,void 0),e.intersector=\"PointRenderer\"};if(null!=j.dist){const i=e.results.min;(null==i.dist||j.dist<i.dist)&&N(i,j)}if(null!=A.dist&&0!==e.options.store){const i=e.results.max;(null==i.dist||A.dist>i.dist)&&N(i,A)}if(2===e.options.store){const i=M(t,s);for(const t of C){const s=new E(i);N(s,t),e.results.all.push(s)}}}render(e){if(0!==e.pass&&2!==e.pass&&5!==e.pass)return!1;const i=2===e.pass,t=e.rctx;this.nodes.forAll((i=>{null==i.vao&&this._initNode(e,i)}));const s=this._getSizeParams(),r=this.selectTechnique(e,s),h=r.program;if(null==h||0===this.nodes.length)return!0;const l=this._clipBox,c=!y(l,P,((e,i)=>e===i));c||(f(this.tempVec3,-1/0,-1/0,-1/0),h.setUniform3fv(\"uClipMin\",this.tempVec3),f(this.tempVec3,1/0,1/0,1/0),h.setUniform3fv(\"uClipMax\",this.tempVec3)),t.useProgram(h),r.bindPipelineState(t),h.setUniformMatrix4fv(\"uProjectionMatrix\",e.camera.projectionMatrix),i&&h.setUniform2f(\"nearFar\",e.camera.near,e.camera.far),e.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=e.highlightDepthTexture,C(h,this._bindParameters));const d=e.camera.pixelRatio;s.drawFixedSize&&h.setUniform2f(\"uPointScale\",s.fixedSize*d,e.camera.fullHeight);const u=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null;return this.nodes.forAll((i=>{if(0===i.coordinates.length||e.isHighlightPass&&!i.highlights)return;if(h.setUniform2f(\"uScreenMinMaxSize\",s.screenMinSize*d,W(i.isLeaf)*d),!s.drawFixedSize){const t=i.splatSize*this._scaleFactor;h.setUniform2f(\"uPointScale\",t*d,e.camera.fullHeight/d)}const m=i.origin;c&&(f(this.tempVec3,l[0]-m[0],l[1]-m[1],l[2]-m[2]),h.setUniform3fv(\"uClipMin\",this.tempVec3),f(this.tempVec3,l[3]-m[0],l[4]-m[1],l[5]-m[2]),h.setUniform3fv(\"uClipMax\",this.tempVec3)),n(this.tempMatrix4),o(this.tempMatrix4,this.tempMatrix4,m),a(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),h.setUniformMatrix4fv(\"uModelViewMatrix\",this.tempMatrix4),A(h,r.configuration,u,m),t.bindVAO(i.vao),e.isHighlightPass?this._renderHighlightFragments(t,i):t.drawArrays(0,0,i.coordinates.length/3)})),!0}_renderHighlightFragments(t,s){const r=s.highlights;if(e(r))return;let n=i(r[0].component),o=n+1;for(let e=1;e<r.length;e++){const s=i(r[e].component);if(s!==o){const e=o-n;e>0&&t.drawArrays(0,n,e),n=s}o=s+1}const a=o-n;a>0&&t.drawArrays(0,n,a)}set useFixedSizes(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())}get useFixedSizes(){return this._useFixedSizes}set scaleFactor(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())}get scaleFactor(){return this._scaleFactor}set minSizePx(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())}get minSizePx(){return this._minSizePx}set useRealWorldSymbolSizes(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())}get useRealWorldSymbolSizes(){return this._useRealWorldSymbolSizes}set size(e){this._size!==e&&(this._size=e,this._requestRender())}get size(){return this._size}set sizePx(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())}get sizePx(){return this._sizePx}set clippingBox(e){q(this._clipBox,e||P)}get slicePlane(){return this._slicePlaneEnabled}set slicePlane(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}get intersectionHandlerId(){return this.layerUid}addNode(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}removeNode(e){let i=null;return this.nodes.filterInPlace((s=>s.id!==e||(i=s,s.vao=t(s.vao),this._highlights.nodeRemoved(s),!1))),this._requestRender(),i}forEachNode(e){this.nodes.forAll(e)}removeAll(){this.nodes.forAll((e=>e.vao=t(e.vao))),this._highlights.removeAll(),this.nodes.clear(),this._requestRender()}highlight(e){return this._highlights.add(e)}addHighlight(e,i,t){e.highlights=K(e.highlights,i,t),this._requestRender()}removeHighlight(e,i){e.highlights=Q(e.highlights,i),this._requestRender()}_initNode(e,i){const t=e.rctx;i.vao=new O(t,B,k,{positions:N.createVertex(t,35044,i.coordinates),colors:N.createVertex(t,35044,i.rgb)})}_requestRender(){this._context&&this._context.requestRender()}_getSizeParams(){const e=this._useFixedSizes,i=e&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:i,drawFixedSize:e,fixedSize:i?this._sizePx:this._size,screenMinSize:e?0:this._minSizePx}}selectTechnique(e,i){return this._techniqueConfig.drawScreenSize=i.drawScreenSpace,this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled,this._techniqueConfig.sceneHasOcludees=e.hasOccludees,this._techniqueConfig.output=2===e.pass?1:5===e.pass?4:0,this._techniqueRep.releaseAndAcquire(I,this._techniqueConfig,this._technique)}}function W(e){return e?256:64}function D(e,i,t,s,r){if(t.drawScreenSpace)return t.fixedSize*i*s;const n=W(r)*i*s;return t.drawFixedSize?Math.min(t.fixedSize/2,n):t.screenMinSize>0?Math.min(Math.max(t.screenMinSize*i*s,e/2),n):Math.min(e/2,n)}function G(e,i,t,s,r){return t.drawScreenSpace?0:D(e,i,t,s,r)}function $(e,i,t){return null==t&&(t=x()),t[0]=e.origin[0]+e.coordinates[3*i],t[1]=e.origin[1]+e.coordinates[3*i+1],t[2]=e.origin[2]+e.coordinates[3*i+2],t}function J(e){return s(e.component)?e.component:-1}function K(i,t,s){e(i)&&(i=[]);const r={component:t,id:s};i.push(r);const n=J(r);let o=i.length-1;for(;o>0&&n<J(i[o-1]);)[i[o-1],i[o]]=[i[o],i[o-1]],--o;return i}function Q(i,t){if(e(i))return i;const s=i.filter((e=>e.id!==t));return 0===s.length?null:s}!function(e){function i(e){return e.hasOwnProperty(\"splatSize\")}e.isInstanceOfNode=i}(T||(T={}));export{T as PointRenderer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{result as t,forEach as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Collection.js\";import s from\"../../../core/Logger.js\";import{unwrapOr as o,isSome as n,isNone as a,mapSome as d}from\"../../../core/maybe.js\";import{createAbortController as l,eachAlways as h,isAbortError as u,eachAlwaysValues as p,throwIfAborted as c}from\"../../../core/promiseUtils.js\";import{pt2px as _}from\"../../../core/screenUtils.js\";import{estimateSize as m,isArrayBuffer as g}from\"../../../core/typedArrayUtil.js\";import{getMetersPerVerticalUnitForSR as f}from\"../../../core/unitUtils.js\";import{property as y}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as b}from\"../../../core/accessorSupport/decorators/subclass.js\";import{d as w}from\"../../../chunks/vec3.js\";import{a as N}from\"../../../chunks/vec3f32.js\";import{projectBoundingRect as x}from\"../../../geometry/projection.js\";import{create as P}from\"../../../geometry/support/aaBoundingBox.js\";import{containsPoint as v,create as C}from\"../../../geometry/support/aaBoundingRect.js\";import{create as S,fromNormalAndOffset as I}from\"../../../geometry/support/plane.js\";import{makeDehydratedPoint as A}from\"../../../layers/graphics/dehydratedFeatures.js\";import k from\"../../../layers/support/CodedValue.js\";import V from\"../../../layers/support/CodedValueDomain.js\";import\"../../../layers/support/Domain.js\";import\"../../../layers/support/InheritedDomain.js\";import\"../../../layers/support/RangeDomain.js\";import{unpackFieldNames as R}from\"../../../layers/support/fieldUtils.js\";import L from\"../../../layers/support/PromiseQueue.js\";import{getMetersPerUnit as j}from\"../../../symbols/support/unitConversionUtils.js\";import{LayerView3D as Q}from\"./LayerView3D.js\";import{PointCloudWorkerHandle as U}from\"./PointCloudWorkerHandle.js\";import{checkPointCloudLayerValid as D,checkPointCloudLayerCompatibleWithView as F}from\"./i3s/I3SUtil.js\";import{nodeDiff as z,sortFrontToBack as M,splitWorkEntries as W}from\"./i3s/LoDUtil.js\";import O from\"./i3s/PagedNodeIndex.js\";import{getSplatSizeAlgorithm as E,getFixedSizeAlgorithm as H,getRendererInfo as B,getFilterInfo as G,rendererUsesFixedSizes as q,getAttributeInfo as T}from\"./i3s/PointCloudRendererUtil.js\";import{getAttributeValues as $,readGeometry as J,elevationFromPositions as K}from\"./i3s/PointCloudWorkerUtil.js\";import{PointGraphic as Y}from\"./i3s/PointGraphic.js\";import{PointRenderer as X}from\"./i3s/PointRenderer.js\";import{PopupSceneLayerView as Z}from\"./support/PopupSceneLayerView.js\";import{projectToBoundingBox as ee}from\"../support/extentUtils.js\";import{minimumDistancePlane as te}from\"../support/orientedBoundingBox.js\";import{updatingProgress as ie}from\"../support/updatingProperties.js\";import re from\"../../layers/LayerView.js\";import{extractSafeScaleBounds as se,scaleBoundsPredicate as oe}from\"../../support/layerViewUtils.js\";import{TaskPriority as ne}from\"../../support/Scheduler.js\";const ae=s.getLogger(\"esri.views.3d.layers.PointCloudLayerView3D\"),de=8,le=S();let he=class extends(Z(Q(re))){constructor(){super(...arguments),this.type=\"point-cloud-3d\",this.maximumPointCount=4e6,this.slicePlaneEnabled=!1,this._renderer=null,this._rendererAdded=!1,this._renderedNodes=new Set,this._nodeScales=new Map,this._updateViewNeeded=!0,this._lodFactor=1,this._maxLoggedBoxWarnings=5,this._pageMultiplier=1,this._nodeLoadEpoch=0,this._indexQueue=[],this._workQueue=new Array,this._idleQueue=new L,this._indexPagesLoading=new Map,this._loadingNodes=new Map,this._recalcWork=!0,this._layerIsVisible=!1,this._codedDomainPopulationPromise=null,this._codedDomainPopulationAbortController=null,this._totalWork=0,this._index=null,this._loadingInitNodePage=!1,this._nodeIdArray=[]}get pointScale(){const e=E(this.layer&&this.layer.renderer),t=1;return e&&null!=e.scaleFactor?e.scaleFactor:t}get useRealWorldSymbolSizes(){const e=H(this.layer&&this.layer.renderer),t=!1;return e&&null!=e.useRealWorldSymbolSizes?e.useRealWorldSymbolSizes:t}get pointSize(){const e=H(this.layer&&this.layer.renderer),t=0;return e&&null!=e.size?e.size:t}get inverseDensity(){const e=96;return this.layer&&this.layer.renderer?1*e/this.layer.renderer.pointsPerInch:5}get availableFields(){const e=B(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);const i=G(this.layer);if(i)for(const r of i)t.add(r.attributeInfo.name);if(this.layer.outFields)for(const r of R(this.layer.fieldsIndex,this.layer.outFields))t.add(r);return Array.from(t)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const e=P(),t=this.view.renderSpatialReference;return ee(this.view.clippingArea,e,t)?e:null}get _elevationOffset(){const e=this.layer&&this.layer.elevationInfo;if(e&&\"absolute-height\"===e.mode){const t=f(this.layer.spatialReference),i=j(e.unit);return o(e.offset,0)*i/t}return 0}initialize(){const e=this.view.resourceController;this._worker=new U((t=>e.schedule(t))),this.addResolvingPromise(this._worker.promise),this._tmpPoint=A(0,0,0,this.layer.spatialReference),D(this.layer),F(this.layer,this.view),this._indexRequester=e.createStreamDataRequester(2),this._dataRequester=e.createStreamDataRequester(3),this._initRenderer();const t=this._initNodePages(),i=this.view.resourceController.memoryController;this._memCache=i.getMemCache(this.layer.uid),this.updatingHandles.add(this,\"_clippingBox\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,\"_elevationOffset\",(()=>this._elevationOffsetChanged()),2),this.updatingHandles.add(this.layer,\"renderer\",(()=>this._rendererChanged()),2),this.updatingHandles.add(this.layer,\"filters\",(()=>this._reload()),2),this.updatingHandles.add(this.layer,\"outFields\",(()=>this._reload()),2),this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this._setUpdateViewNeeded())),this.updatingHandles.add(this,\"clippingArea\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view.state,\"contentCamera\",(()=>this._setUpdateViewNeeded())),this.handles.add([this.view.basemapTerrain.on(\"scale-change\",(e=>this._scaleUpdateHandler(e))),i.events.on(\"quality-changed\",(()=>this._setUpdateViewNeeded()))]),this.addResolvingPromise(t),this.when((()=>{this.handles.add([e.scheduler.registerTask(ne.POINT_CLOUD_LAYER,this),e.scheduler.registerIdleStateCallbacks((()=>this._idleBegin()),(()=>this._idleEnd())),this.updatingHandles.add(this,\"suspended\",(e=>{e?this._clearNodeState():this._setUpdateViewNeeded()}),2)])}),(()=>{this.updatingHandles.removeAll(),this.handles.removeAll()}))}_setUpdateViewNeeded(){this._updateViewNeeded=!0,this._updateLoading()}destroy(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new X({createGraphic:(e,t,i)=>this._createGraphic(e,t,i)}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,\"_clippingBox\",(e=>this._renderer.clippingBox=e),2),this.updatingHandles.add(this,\"suspended\",(e=>this._setPointsVisible(!e)),2),this.updatingHandles.add(this,\"pointScale\",(e=>this._renderer.scaleFactor=e),2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,\"useRealWorldSymbolSizes\",(e=>this._renderer.useRealWorldSymbolSizes=e),2),this.updatingHandles.add(this,\"pointSize\",(e=>{const t=_(e);this._renderer.size=e,this._renderer.sizePx=t}),2),this.updatingHandles.add(this,\"slicePlaneEnabled\",(e=>this._renderer.slicePlane=e),2),this.updatingHandles.add(this,\"inverseDensity\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,\"maximumPointCount\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view,\"qualitySettings.sceneService.pointCloud.lodFactor\",(e=>{this._lodFactor=e,this._setUpdateViewNeeded()}),2)}_destroyRenderer(){this._renderer.removeAll(),this._setPointsVisible(!1)}_createGraphic(e,t,i){const r=n(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,s=this.view.computeMapPointFromVec3d(i),o=this._createGraphicAttributes(e,r);return new Y({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:r,epoch:this._nodeLoadEpoch},geometry:s,attributes:o,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(e,t){const i={};for(const r of e.attributes)this._encodeGraphicAttribute(r.attributeInfo,r.values,t,i);return i}_encodeGraphicAttribute(e,t,i,r){const s=e.storageInfo&&e.storageInfo.attributeValues,o=s?s.valuesPerElement:1;if(1===o)r[e.name]=t[i];else if(\"UInt8\"===s.valueType&&o<=4){let s=0;const n=i*o;for(let e=n;e<n+o;e++)s=(s<<8)+t[e];r[e.name]=s}else r[e.name]=void 0}_setPointsVisible(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=q(this.layer.renderer),this._reload()}_reload(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}_scaleUpdateHandler(e){this.layer.minScale||this.layer.maxScale?x(e.extent,e.spatialReference,pe,this.layer.spatialReference)&&(this._nodeScales.forEach(((t,i)=>{if(!this._renderedNodes.has(i))return void this._nodeScales.delete(i);const r=this._index.getNode(i);v(pe,r.obb.center)&&this._nodeScales.set(i,e.scale)})),this._setUpdateViewNeeded()):this._nodeScales.clear()}displayNodes(e){this._workQueue=z([...this._renderedNodes],e,this._index),M(this._workQueue,this.view.state.contentCamera.viewForward,this._index),W(this._workQueue,de,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange(\"suspended\")}cancelLoading(){this._cancelNodeLoading(),this._cancelIndexLoading()}_cancelNodeLoading(){const e=new Array;this._loadingNodes.forEach((({abortController:t})=>e.push(t))),this._loadingNodes.clear();for(const t of e)t.abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}_updateQueues(){const e=new Set;this._workQueue.forEach((t=>t.load.forEach((t=>e.add(t)))));const t=new Array,i=new Map;this._loadingNodes.forEach(((r,s)=>{e.has(s)?i.set(s,r):t.push(r)})),this._loadingNodes=i;for(const{abortController:r}of t)r.abort();this._workQueue=this._workQueue.filter((e=>{for(const t of e.load)if(this._loadingNodes.has(t))return this._recalcWork=!0,!1;return!0})),this._totalWork=this._computeWork(),this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[],this._indexPagesLoading.forEach((({abortController:e})=>e.abort())),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++,this._renderedNodes.forEach((e=>this._removeFromRenderer(e))),this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0}runTask(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;const e=this._isRootNodeVisible();e!==this._layerIsVisible&&(this._layerIsVisible=e,this.notifyChange(\"suspended\")),this._updateLoading()}}else{for(e.run((()=>this._updateWorkQueues()));this._indexQueue.length>0&&e.run((()=>this._processIndexQueue())););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run((()=>this._idleQueue.process())););}}_processIndexQueue(){const e=this._indexQueue.shift(),t=this._loadNodePage(e);return this._indexPagesLoading.set(e,t),t.promise.then((t=>{this._index.addPage(e,t,this._elevationOffset),this._setUpdateViewNeeded()})).then((()=>{this._indexPagesLoading.delete(e)}),(()=>{this._indexPagesLoading.delete(e)})),!0}_processWorkQueue(e){for(;!e.done;){const t=this._scheduleWorkEntry();if(a(t))return;this._processWorkEntry(t),e.madeProgress()}}_scheduleWorkEntry(){let e=this._workQueue.length;for(;e--;){const e=this._workQueue.shift();if(!e.remove.find((e=>!this._renderedNodes.has(e))))return e;this._workQueue.push(e)}return null}_processWorkEntry(e){if(0!==e.load.length)Promise.all(e.load.map((e=>{const t=l(),i=this._memCache.pop(e.toString());return n(i)?this._loadingNodes.set(e,{abortController:t,promise:Promise.resolve(i)}):this._loadingNodes.has(e)||this._loadingNodes.set(e,{abortController:t,promise:this.loadNode(e,t.signal)}),this._loadingNodes.get(e).promise}))).then((t=>{for(let i=0;i<e.load.length;i++)if(t[i]){const r=this._setupRendererData(e.load[i],t[i]);this._addToRenderer(r)}for(const i of e.remove)this._removeFromRenderer(i)})).catch((()=>{})).then((()=>{for(const t of e.load)this._loadingNodes.delete(t);this._updateLoading(),this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())})),this._updateLoading();else for(const t of e.remove)this._removeFromRenderer(t)}async populateClassCodeCodedDomain(e,i){const r=\"CLASS_CODE\",s=this.layer.fieldsIndex.get(r);if(!s||s.domain)return;if(-1===e.indexOf(s.name))return;const o=await t(this.layer.queryCachedStatistics(r,{signal:i}));if(!1===o.ok)return;const n=o.value,a=n&&n.labels&&n.labels.labels;a&&Array.isArray(a)&&(s.domain=new V({name:\"CLASS_CODE\",codedValues:a.map((e=>new k({code:e.value,name:e.label})))}))}async prepareFetchPopupFeatures(e){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=l(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then((()=>{this._codedDomainPopulationAbortController=null}))),this._codedDomainPopulationPromise}async whenGraphicAttributes(e,t){const r=this._splitGraphicsPerNode(e),s=this.layer.attributeStorageInfo,o=t.map((e=>T(s,e))),n=async(e,t)=>{const r=this._index.getNode(t);await i(o,(async t=>{const i=t.useElevation?await this._loadElevationAttributeFromGeometry(r.resourceId):await this._loadAndParseAttribute(r,t);if(i)for(const r of e)if(this._isValidPointGraphic(r)){const e=r.pointCloudMetadata.attributePointIndexInNode;this._encodeGraphicAttribute(t,i,e,r.attributes)}}))},a=[];return r.forEach(((e,t)=>{a.push(n(e,t))})),await h(a),e}_isValidPointGraphic(e){return e instanceof Y&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(e){const t=new Map;for(const i of e){if(!this._isValidPointGraphic(i))continue;const e=i.pointCloudMetadata,r=t.get(e.nodeId);r?r.push(i):t.set(e.nodeId,[i])}return t}async _loadAndParseAttribute(e,t){const i=await this._loadAttribute(e.resourceId,t,null);return n(i)?$({attributeInfo:t,buffer:i},null,e.vertexCount):null}async _loadElevationAttributeFromGeometry(e){const t=this.layer.store.defaultGeometrySchema,i=J(t,await this._loadGeometry(e,null));return K(i,i.length/3)}highlight(e){if(!e)return{remove(){}};const t=r.isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(t.map((e=>this._graphicToPointDefinition(e))))}_graphicToPointDefinition(e){if(!this._isValidPointGraphic(e))return null;const{nodeId:t,pointIndexInNode:i}=e.pointCloudMetadata;return null!=t&&null!=i?{nodeId:t,pointId:i}:null}_computeWork(){let e=0;for(const t of this._workQueue)e+=t.load.length+t.remove.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,e+=this._loadingInitNodePage?100:0,e+=this._updateViewNeeded?100:0,e}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}_updateLoading(){this.notifyChange(\"updating\"),this.notifyChange(\"updatingProgressValue\")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}_initNodePages(){const e=this.layer.store.index,t=e.nodesPerPage||e.nodePerIndexBlock;return this._index=new O(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,t),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange(\"suspended\"),this._updateLoading(),this._pageMultiplier=null!=e.nodesPerPage?1:e.nodePerIndexBlock,this._loadNodePage(0).promise.then((e=>{this._index.addPage(0,e,this._elevationOffset),this._loadingInitNodePage=!1,this._setUpdateViewNeeded()}))}_loadNodePage(e){const t=l(),i=`${this.baseUrl}/nodepages/${e*this._pageMultiplier}`;return{promise:this._requestNodePage(i,t.signal).then((t=>t.nodes.map(((t,i)=>({resourceId:null!=t.resourceId?t.resourceId:e*this._index.pageSize+i,obb:t.obb,firstChild:t.firstChild,childCount:t.childCount,vertexCount:null!=t.vertexCount?t.vertexCount:t.pointCount,lodThreshold:null!=t.lodThreshold?t.lodThreshold:t.effectiveArea}))))),abortController:t}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;let e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(r/(.75*t));for(;r>t;)e*=s,i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(2);return this.displayNodes(i),this._updateViewNeeded=!1,this._updateLoading(),!0}_computePointCount(e){let t=0;for(let i=0;i<e.length;i++){const r=this._index.getNode(e[i]);r&&(t+=r.vertexCount)}return t}_getLodMemoryFactor(){return this.view.resourceController.memoryController.memoryFactor}_isRootNodeVisible(){let e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(t,i,r)=>(e=r,!1),pageMiss:()=>{}}),e}_computeNodesForMinimumDensity(e){const t=this.view.state.contentCamera,i=t.frustum,r=this._clippingBox,s=t.viewForward,o=w(s,t.eye),n=I(s,-o,le),a=t.perScreenPixelRatio/2,d=e*e,l=this._nodeIdArray;l.length=0;const{minScale:h,maxScale:u}=se(this.layer),p=0===h&&0===u?e=>l.push(e):e=>{const t=this._getScale(e);oe(t,h,u)&&l.push(e)};return this._traverseVisible({frustum:i,clippingBox:r},{predicate:(e,t,i)=>{if(!i)return!1;if(0===t.childCount)return p(e),!1;const r=this._index.getRenderObb(e);return!(this._computeAveragePixelArea(r,t.lodThreshold,t.vertexCount,n,a)<=d)||(p(e),!1)},pageMiss:(e,t)=>{p(e),this._indexQueue.indexOf(t)<0&&this._indexQueue.push(t)}}),l}_getScale(e){let t=this._nodeScales.get(e);if(null==t){const i=this._index.getNode(e).obb.center;this._tmpPoint.x=i[0],this._tmpPoint.y=i[1],this._tmpPoint.z=i[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}_computeAveragePixelArea(e,t,i,r,s){const o=1e-7,n=Math.max(o,te(e,r));return t/(n*n)/(4*s*s)/i}loadNode(e,t){try{return this.loadNodeAsync(e,t)}catch(i){throw u(i)||ae.error(i),i}}async loadAdditionalUserAttributes(e,t,i){const r=this.layer.outFields;if(!r)return[];const s=R(this.layer.fieldsIndex,r),o=new Set(e.map((e=>n(e)?e.name:null))),a=this.layer.attributeStorageInfo,l=[];for(const n of s){if(o.has(n))continue;const e=T(a,n);e&&l.push(t(e))}const h=await p(l);return c(i),d(h,(e=>e))}async loadNodeAsync(e,t){const i=this._index.getNode(e),r=B(this.layer),s=G(this.layer),o=i.resourceId,d=async e=>{if(a(e))return null;if(e.useElevation)return{attributeInfo:e,buffer:null};const i=await this._loadAttribute(o,e,t);return n(i)?{attributeInfo:e,buffer:i}:null};return this._idleQueue.push((async()=>{const i=this._loadGeometry(o,t),{primaryAttribute:n,modulationAttribute:a}=r,l=d(n),h=d(a),u=s.map((e=>e.attributeInfo)),p=u.map((e=>d(e))),_=this.loadAdditionalUserAttributes([n,a,...u],d,t),[m,g,f,y,b]=await Promise.all([i,l,h,Promise.all(p),_]);c(t);const w={geometryBuffer:m,primaryAttributeData:g,modulationAttributeData:f,filterAttributesData:y,userAttributesData:b,schema:this.layer.store.defaultGeometrySchema,rendererInfo:r,filterInfo:s,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(w,t)}),t)}async _loadGeometry(e,t){return this._requestData(`${this.baseUrl}/nodes/${e}/geometries/0`,t)}async _loadAttribute(e,t,i){if(a(t)||!t.storageInfo)return null;const r=t.storageInfo.key;return this._requestData(`${this.baseUrl}/nodes/${e}/attributes/${r}`,i)}_requestNodePage(e,t){const i={f:\"json\",token:this.layer.apiKey};return this._indexRequester.request(e,\"json\",{query:i,signal:t})}_requestData(e,t){return this._dataRequester.request(e,\"binary\",{query:{token:this.layer.apiKey},signal:t})}_removeFromRenderer(e){if(this._renderedNodes.has(e)){const t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,ue(t))}}_addToRenderer(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}_setupRendererData(e,t){const i=this._index.getNode(e),r=Math.sqrt(i.lodThreshold/i.vertexCount),s=this._index.getRenderObb(e);if(X.isInstanceOfNode(t))return t.splatSize=r,t.obb=s,t.origin=N(t.obb.center),t;const o=.01*Math.max(s.halfSize[0],s.halfSize[1],s.halfSize[2]);if(t.obb.halfSize[0]>s.halfSize[0]+o||t.obb.halfSize[1]>s.halfSize[1]+o||t.obb.halfSize[2]>s.halfSize[2]+o){if(this._maxLoggedBoxWarnings>0){const i=e=>`[${e.halfSize[0]}, ${e.halfSize[1]}, ${e.halfSize[2]}]`;ae.warn(`Node ${e} reported bounding box too small. got ${i(s)} but points cover ${i(t.obb)}`),0==--this._maxLoggedBoxWarnings&&ae.warn(\"  Too many bounding box errors, stopping reporting for this layer.\")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:N(s.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:r,obb:s,isLeaf:0===i.childCount}}getUsedMemory(){let e=0;return this._renderer.forEachNode((t=>{e+=ce,e+=m(t.coordinates);for(const i of t.attributes){const t=i.values;g(t.buffer)&&(e+=m(t))}})),e}getUnloadedMemory(){const e=this._renderedNodes.size;if(e<4)return 0;const t=[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount));let i=this._loadingNodes.size;for(let r=0;r<this._workQueue.length;r++)i+=this._workQueue[r].load.length,i-=this._workQueue[r].remove.length;if(i<0)return 0;return i*t/e*((this.getUsedMemory()-e*ce)/t)+i*ce}ignoresMemoryFactor(){return!1}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount),0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,\"Loading Nodes\":this._loadingNodes.size,\"Index Queue\":this._indexQueue.length,\"Work Queue\":this._workQueue.length,\"Idle Queue\":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};function ue(e){return 5*e.coordinates.length+128}e([y()],he.prototype,\"layer\",void 0),e([y({readOnly:!0,aliasOf:\"layer.parsedUrl.path\"})],he.prototype,\"baseUrl\",void 0),e([y({readOnly:!0})],he.prototype,\"pointScale\",null),e([y({readOnly:!0})],he.prototype,\"useRealWorldSymbolSizes\",null),e([y({readOnly:!0})],he.prototype,\"pointSize\",null),e([y({readOnly:!0})],he.prototype,\"inverseDensity\",null),e([y()],he.prototype,\"maximumPointCount\",void 0),e([y({readOnly:!0})],he.prototype,\"availableFields\",null),e([y({readOnly:!0})],he.prototype,\"_clippingBox\",null),e([y({readOnly:!0})],he.prototype,\"_elevationOffset\",null),e([y({type:Boolean})],he.prototype,\"slicePlaneEnabled\",void 0),e([y()],he.prototype,\"updating\",void 0),e([y(ie)],he.prototype,\"updatingProgress\",void 0),e([y({readOnly:!0})],he.prototype,\"updatingProgressValue\",null),he=e([b(\"esri.views.3d.layers.PointCloudLayerView3D\")],he);const pe=C(),ce=160;var _e=he;export{_e as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n"],"sourceRoot":""}