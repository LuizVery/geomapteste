"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[9481],{19481:(e,t,i)=>{i.r(t),i.d(t,{default:()=>x});var r=i(27366),a=i(10064),n=i(92026),s=i(8537),l=i(49861),o=(i(63780),i(93169),i(25243),i(69912)),p=i(42069),d=i(77385),u=i(64153),h=i(55245),m=i(67581),c=i(13107),f=i(45008),y=i(90316),g=i(49800);let b=class extends((0,h.R)((0,c.y)((0,d.r)((0,p.A)(m.Z))))){constructor(){super(...arguments),this.type="imagery-tile-3d",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new a.Z("layerview:spatial-reference-incompatible","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})));const e=(0,s.LR)(this.view,"basemapTerrain.tilingSchemeLocked").then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:t}=this.layer,i=["png","png24","png32","jpg","mixed"].indexOf(t.format)>-1&&e.compatibleWith(t);this.isAlignedMapTile=i;const r=i?t:e.toTileInfo();this.tileInfo=r,this.updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement("canvas"),t=e.getContext("2d"),[i,r]=this.tileInfo.size;return e.width=i,e.height=r,t.clearRect(0,0,i,r),t.getImageData(0,0,i,r)}get imageFormatIsOpaque(){return"jpg"===this.layer.tileInfo.format}get hasMixedImageFormats(){return"mixed"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,t=this.layer.tileInfo.lods,i=e[0].scale,r=t[t.length-1].scale;return this.levelRangeFromScaleRange(i,r)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,t,i,r){const a=this.tileInfo,s=this._canSymbolizeInWebGL(),l={tileInfo:a,requestRawData:s,signal:(0,n.Wg)(r.signal),requestAsImageElement:this.isAlignedMapTile},o=await this.layer.fetchTile(e,t,i,l);if(o instanceof HTMLImageElement)return o;let p=o&&o.pixelBlock;if((0,n.Wi)(p))return this._blankTile;if(!s&&(p=await this.layer.applyRenderer(o),(0,n.Wi)(p)))return this._blankTile;const d=new u.H([e,t,i],p,a.size[0],a.size[1]);return s?(d.symbolizerRenderer=this.layer.symbolizer.rendererJSON,d.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),d.transformGrid=o.transformGrid):d.isRendereredSource=!0,d.interpolation=this.layer.interpolation,d.bandIds=this.layer.bandIds,d}_getSymbolizerOptions(e){const t=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:t,y:t},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,t){return(0,f.K)(e,t,this.view)}refresh(){this.emit("data-changed")}async doRefresh(){this.suspended||this.emit("data-changed")}_canSymbolizeInWebGL(){const e=(0,y.hc)(this.view._stage.renderView.renderingContext.type);return(e.type===g.zO.WEBGL2||e.supportsTextureFloat)&&this.layer.symbolizer.canRenderInWebGL}};(0,r._)([(0,l.Cb)({readOnly:!0})],b.prototype,"_blankTile",null),(0,r._)([(0,l.Cb)({readOnly:!0})],b.prototype,"imageFormatIsOpaque",null),(0,r._)([(0,l.Cb)({readOnly:!0})],b.prototype,"hasMixedImageFormats",null),(0,r._)([(0,l.Cb)({readOnly:!0})],b.prototype,"dataLevelRange",null),b=(0,r._)([(0,o.j)("esri.views.3d.layers.ImageryTileLayerView3D")],b);const x=b},55245:(e,t,i)=>{i.d(t,{R:()=>h});var r=i(27366),a=i(52639),n=i(10064),s=i(92026),l=i(49861),o=(i(63780),i(93169),i(25243),i(69912)),p=i(45948),d=i(80394),u=i(24405);const h=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return(0,d._D)((0,s.Wg)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=(0,s.Wg)(this.layer.fullExtent),i=(0,d._D)(t,e,!1);return(0,d.tB)(t,e,i)}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return Promise.reject(new n.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:r}=i,l=(0,u.V)(i,t);if(!r||!(0,s.pC)(l))throw new n.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:r,popupTemplate:l});const o=[],{value:p,magdirValue:d}=await i.identify(e,{timeExtent:this.timeExtent});let h="";if(p&&p.length){var m,c;h="imagery-tile"===i.type&&i.hasStandardTime()&&null!=p[0]?p.map((e=>i.getStandardTimeValue(e))).join(", "):p.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(h,t);const r=null==(m=i.rasterInfo)||null==(c=m.attributeTable)?void 0:c.features;if(r&&r.length>0){const t=r.filter((e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===h}));if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const r=this._rasterFieldPrefix+t;e[r]=this._formatAttributeValue(i.attributes[t],r)}}}const n=i.rasterInfo.dataType;"vector-magdir"!==n&&"vector-uv"!==n||(e["Raster.Magnitude"]=null==d?void 0:d[0],e["Raster.Direction"]=null==d?void 0:d[1]);const s=new a.Z(this.fullExtent.clone(),null,e);s.layer=i,s.sourceLayer=s.layer,o.push(s)}return o}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,r=this._getFieldInfo(i,t),a=r&&r.format;if(a){let t,i;return e.trim().indexOf(",")>-1?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,a)):e.trim().indexOf(" ")>-1?(t=i=" ",this._formatDelimitedString(e,t,i,a)):this._formatNumberFromString(e,a)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0))),r}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map((e=>this._formatNumberFromString(e,r))).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}};return(0,r._)([(0,l.Cb)()],t.prototype,"layer",void 0),(0,r._)([(0,l.Cb)(p.qG)],t.prototype,"timeExtent",void 0),(0,r._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],t.prototype,"fullExtent",null),(0,r._)([(0,l.Cb)()],t.prototype,"tileInfo",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=(0,r._)([(0,o.j)("esri.views.layers.ImageryTileLayerView")],t),t}},13107:(e,t,i)=>{i.d(t,{y:()=>p});var r=i(27366),a=i(32718),n=i(66978),s=i(94172),l=i(49861),o=(i(63780),i(93169),i(25243),i(69912));const p=e=>{let t=class extends e{initialize(){this.handles.add((0,s.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,n.D_)(e)||a.Z.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return(0,r._)([(0,l.Cb)()],t.prototype,"layer",void 0),t=(0,r._)([(0,o.j)("esri.layers.mixins.RefreshableLayerView")],t),t}},24405:(e,t,i)=>{i.d(t,{V:()=>s,e:()=>n});var r=i(92026),a=i(80031);async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.popupTemplate;if(!(0,r.pC)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:n}=t,{objectIdField:s,typeIdField:l,globalIdField:o,relationships:p}=e;if(i.includes("*"))return["*"];const d=n?await(0,a.CH)(e):[],u=(0,a.Q0)(e.fieldsIndex,[...i,...d]);return l&&u.push(l),u&&s&&e.fieldsIndex.has(s)&&-1===u.indexOf(s)&&u.push(s),u&&o&&e.fieldsIndex.has(o)&&-1===u.indexOf(o)&&u.push(o),p&&p.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)})),u}function s(e,t){return e.popupTemplate?e.popupTemplate:(0,r.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,r.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},45008:(e,t,i)=>{i.d(t,{K:()=>s});i(59486);var r=i(92026),a=i(68860),n=i(53866);function s(e,t,i){let s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Z;if("2d"===i.type)s=t*i.resolution;else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),l=i.basemapSpatialReference;s=(0,r.pC)(l)&&!l.equals(i.spatialReference)?(0,a.c9)(l)/(0,a.c9)(i.spatialReference):t*n}const o=e.x-s,p=e.y-s,d=e.x+s,u=e.y+s,{spatialReference:h}=i;return l.xmin=Math.min(o,d),l.ymin=Math.min(p,u),l.xmax=Math.max(o,d),l.ymax=Math.max(p,u),l.spatialReference=h,l}new n.Z}}]);
//# sourceMappingURL=9481.ffb08004.chunk.js.map