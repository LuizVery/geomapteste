"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[3003],{35582:(e,t,i)=>{i.d(t,{M:()=>o,b:()=>r});var s=i(98634),n=i(64201),a=i(4760);function r(){const e=new n.kG;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add(a.T.POSITION,"vec3"),e.attributes.add(a.T.NORMAL,"vec3"),e.attributes.add(a.T.UV0,"vec2"),e.attributes.add(a.T.AUXPOS1,"float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(s.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(s.H`
    const float INV_SQRT2 = ${s.H.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}const o=Object.freeze({__proto__:null,build:r})},43003:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Be});var s=i(27366),n=i(85015),a=i(92026),r=i(49861),o=(i(63780),i(93169),i(25243),i(69912)),l=i(77671),d=i(98074),h=i(51817),c=i(100),u=i(32718),_=i(47898),p=i(94172),g=i(8537),m=i(11186),v=i(71353),y=i(2170),b=i(29909),w=i(79803),C=i(92183),P=i(15559),f=i(39409),S=i(33906);const O=u.Z.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController");let L=class extends n.Z{constructor(e){super(e),this._unitNormalizer=new f.D,this._handles=new c.Z,this._tempStartPosition=(0,v.c)(),this._tempEndPosition=(0,v.c)(),this._tempCornerPosition=(0,v.c)()}initialize(){this._handles.add((0,g.N1)(this.view,"ready",(()=>this._initialize()),!0))}destroy(){this._handles=(0,a.SC)(this._handles)}_initialize(){const e=this.view.spatialReference,t=(0,C.rS)(e),i=t===C.GG?C.wY:t;this._sphericalPCPF=i;const s=(0,w.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([(0,p.YP)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(e=>{let{viewData:t,startPoint:i}=e;t.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(i)}),p.tX),(0,p.YP)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(e=>{let{viewData:t,endPoint:i}=e;t.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(i)}),p.tX),(0,p.YP)((()=>({result:this._computedResult,viewData:this.viewData})),(e=>{let{result:t,viewData:i}=e;i.result=t}),p.tX)])}_applyProjectionAndElevationAlignment(e){if((0,a.Wi)(e))return e;const t=(0,S.G)(e,this.view.spatialReference,this.view.elevationProvider);return(0,a.Wi)(t)?((0,S.e)(this.analysis,e.spatialReference,O),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,a.Wi)(e)||(0,a.Wi)(t))return null;const s=this._euclideanDistances(e,t),n=this._geodesicDistance(e,t,s.horizontal.value),r=i===h.e.Geodesic||i===h.e.Auto&&s.horizontal.value>1e5?"geodesic":"euclidean";return{mode:r,distance:"euclidean"===r?s.direct:n,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:n}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,n=this._tempEndPosition,a=this._tempCornerPosition,r=this.view.spatialReference,o=this._sphericalPCPF,l=(0,w.Up)(r,o)?o:r;(0,w.KC)(e,s,l),(0,w.KC)(t,n,l),(0,w.KC)(i,a,l);const d=(0,m.i)(s,n),h=(0,m.i)(a,n),c=Math.abs(t.z-e.z),u=e=>this._unitNormalizer.normalizeDistance(e),p=u(d),g=u(h),v=u(c);return{direct:(0,_.EV)(p,"meters"),horizontal:(0,_.EV)(g,"meters"),vertical:(0,_.EV)(v,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,n=new b.Z({spatialReference:s});n.addPath([e,t]);const r=s.isGeographic&&(0,P.Gb)(s)?(0,P.Jf)([n],"meters")[0]:s.isWebMercator?(0,y.geodesicLength)(n,"meters"):null,o=(0,a.pC)(r)?r:this._fallbackGeodesicDistance(e,t,i);return(0,_.EV)(o,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,w.UY)(e,z)&&(0,w.UY)(t,M)){const e={distance:0};return(0,P.cA)(e,z,M),e.distance}return i}};(0,s._)([(0,r.Cb)()],L.prototype,"view",void 0),(0,s._)([(0,r.Cb)()],L.prototype,"analysis",void 0),(0,s._)([(0,r.Cb)()],L.prototype,"viewData",void 0),(0,s._)([(0,r.Cb)()],L.prototype,"_computedResult",null),L=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],L);const z=(0,v.c)(),M=(0,v.c)();i(59166);var E,A,V,D=i(16889),T=i(58935),x=i(17842),G=i(68860),R=i(88396),W=i(151);(V=E||(E={}))[V.None=0]="None",V[V.Direct=1]="Direct",V[V.Triangle=2]="Triangle",V[V.ProjectedGeodesic=3]="ProjectedGeodesic",function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(A||(A={}));var j=i(26243),N=i(25736),q=i(33837),U=i(81949),H=i(67077),I=i(51378),k=i(52168),Q=i(70619),F=i(56529),Z=i(55158),B=i(71011),X=i(68401),Y=i(23620),$=i(93822),K=i(4760),J=i(41012),ee=i(82144),te=i(31132),ie=i(33559),se=i(7566),ne=i(78041),ae=i(27627),re=i(35582),oe=i(8548),le=i(36207);class de extends te.A{constructor(e,t,i){super(e,t,i)}initializeProgram(e){const t=de.shader.get().build();return new ae.$(e.rctx,t,se.i)}bindPass(e,t){(0,J.II)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("width",e.width),this.program.setUniform1f("outlineSize",e.outlineSize),this.program.setUniform4fv("outlineColor",e.outlineColor),this.program.setUniform1f("stripeLength",e.stripeLength),this.program.setUniform4fv("stripeEvenColor",e.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",e.stripeOddColor)}bindDraw(e){(0,J.id)(this.program,e),this.program.rebindTextures()}_setPipelineState(e){const t=e===X.Am.NONE,i=this.configuration;return(0,le.sm)({blending:i.transparent?t?ne.wu:(0,ne.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:oe.wb.LESS},depthWrite:le.LZ,colorWrite:le.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return oe.MX.TRIANGLE_STRIP}}de.shader=new ee.J(re.M,(()=>i.e(4142).then(i.bind(i,14142))));class he extends ie.m{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=X.Am.NONE}}(0,s._)([(0,ie.o)()],he.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,ie.o)()],he.prototype,"transparent",void 0),(0,s._)([(0,ie.o)({count:X.Am.COUNT})],he.prototype,"transparencyPassType",void 0);class ce extends F.F5{constructor(e){super(e,_e),this.techniqueConfig=new he}getTechniqueConfig(e,t){var i;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=null!=(i=null==t?void 0:t.transparencyPassType)?i:X.Am.NONE,this.techniqueConfig}dispose(){}getPassParameters(){return this.parameters}intersect(){}requiresSlot(e){return e===$.r.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===B.H.Color?new ue(e):null}createBufferWriter(){return new we}}class ue extends Y.Z{updateParameters(e){return this.ensureTechnique(de,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const _e={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...F.mo},pe=(0,Z.U$)().vec3f(K.T.POSITION).vec3f(K.T.NORMAL).vec2f(K.T.UV0).f32(K.T.AUXPOS1),ge=(0,v.c)(),me=(0,v.c)(),ve=(0,v.c)(),ye=(0,v.c)(),be=(0,v.c)();class we{constructor(){this.vertexBufferLayout=pe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get(K.T.POSITION).length/2+1)}write(e,t,i,s){const n=t.vertexAttributes.get(K.T.POSITION).data,a=t.vertexAttributes.get(K.T.NORMAL).data,r=n.length/3,o=t&&t.indices&&t.indices.get(K.T.POSITION);o&&o.length!==2*(r-1)&&console.warn("MeasurementArrowMaterial does not support indices");const l=ge,d=me,h=ve,c=ye,u=be,_=e.transformation,p=e.invTranspTransformation,g=i.position,v=i.normal,y=i.uv0;let b=0;for(let C=0;C<r;++C){const e=3*C;if((0,m.s)(l,n[e],n[e+1],n[e+2]),C<r-1){const e=3*(C+1);(0,m.s)(d,n[e],n[e+1],n[e+2]),(0,m.s)(u,a[e],a[e+1],a[e+2]),(0,m.n)(u,u),(0,m.f)(h,d,l),(0,m.n)(h,h),(0,m.c)(c,u,h),(0,m.n)(c,c)}const t=(0,m.i)(l,d);_&&p&&((0,m.m)(l,l,_),(0,m.m)(d,d,_),(0,m.m)(c,c,p));const i=s+2*C,o=i+1;g.setVec(i,l),g.setVec(o,l),v.setVec(i,c),v.setVec(o,c),y.set(i,0,b),y.set(i,1,-1),y.set(o,0,b),y.set(o,1,1),C<r-1&&(b+=t)}const w=i.auxpos1;for(let m=0;m<2*r;++m)w.set(s+m,b)}}class Ce extends k._{constructor(e){super(e),this._parameters=Pe,this._handles=null,this._origin=(0,v.c)(),this._originTransform=(0,U.c)(),this._arrowCenter=(0,v.c)(),this._renderOccluded=F.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i}=this._parameters,s=(0,D.H)(fe,this._stripesEnabled?t:i,e);this._arrowMaterial.setParameters({stripeEvenColor:s})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:t,arrowOutlineColor:i}=this._parameters,s=this._stripesEnabled?e:t;this._arrowMaterial=new ce({outlineColor:i,stripeEvenColor:s,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new c.Z,this._handles.add(this.view.state.watch("camera",(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,a.Wi)(this._geometry)||(0,a.Wi)(this._geometry.startRenderSpace)||(0,a.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(e,t,i,s){const n=this.view.renderCoordsHelper,a=[],r=[],o=(e,t)=>{const s=I.WM.get();(0,m.f)(s,e,i),a.push(s),r.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=I.WM.get();n.worldUpAtPosition(this._arrowCenter,i),o(e,i),o(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),a=I.WM.get(),r=I.WM.get();s.eval(i,a),n.worldUpAtPosition(a,r),o(a,r)}}return Q.Z.createPolylineGeometry(a,r)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,a.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,n=(0,D.H)(fe,this._stripesEnabled?t:i,e),a=(0,D.H)(Se,s,e),r=(0,D.H)(Oe,i,e);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:a,stripeOddColor:r})}}const Pe={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},fe=(0,H.c)(),Se=(0,H.c)(),Oe=(0,H.c)();var Le=i(14226),ze=i(90045),Me=i(81782),Ee=i(74818),Ae=i(58901);class Ve extends k._{constructor(e){super(e),this._handles=new c.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,v.c)(),this._up=(0,v.c)(),this._right=(0,v.c)(),this._renderOccluded=F.yD.OccludeAndTransparent,this._color=(0,W.f)(1,0,0,1),this._outlineColor=(0,W.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=F.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,ze.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,ze.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:s}=e;this._maxSize=Math.min((0,m.i)(i,t),(0,m.i)(i,s))/3,(0,m.n)(this._up,(0,m.f)(this._up,t,i)),(0,m.n)(this._right,(0,m.f)(this._right,s,i)),(0,m.g)(this._position,i),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Ee.E(this.quadMaterialParameters),this._outlineMaterial=new Ae.U(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,m.b)(I.WM.get(),this._up,this._right),i=Q.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,i);(0,Le.f)(De,this._position),(0,Le.h)(De,De,[s,s,s]),(0,a.pC)(e)&&(e.transformation=De)}_quadGeometryData(e,t){const i=(0,m.b)(I.WM.get(),e,t);return new Me.Z([[K.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[K.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const De=(0,U.c)();var Te,xe=i(9052),Ge=i(24070),Re=i(36257),We=i(41201);!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"}(Te||(Te={}));let je=class extends n.Z{constructor(e){super(e),this._params={...qe},this._handles=new c.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,v.c)(),this._endPosition=(0,v.c)(),this._cornerPosition=(0,v.c)(),this._startPositionAtSeaLevel=(0,v.c)(),this._endPositionAtSeaLevel=(0,v.c)(),this._state=Te.Pending,this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=A.Auto,this.triangleCollapseRatioThreshold=.03}get ready(){return this._state===Te.Ready}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,a.Wi)(e)||(0,a.Wi)(t)||e.equals(t))return E.None;const i=this.analysisView.result;if((0,a.Wi)(i))return E.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?E.ProjectedGeodesic:E.Direct;const{verticalDistance:s,horizontalDistance:n}=i,r=s.value,o=n.value;return Math.min(r/o,o/r)<this.triangleCollapseRatioThreshold?E.Direct:E.Triangle}get actualVisualizedMeasurement(){if((0,a.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case h.e.Auto:case h.e.Euclidean:default:return"euclidean";case h.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,a.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,a.Wi)(this._triangleOrientationOverride)!==e&&((0,a.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){var e;return{labels:this.labels,stripeLength:null==(e=this._segmentVisualElement)?void 0:e.stripeLength}}initialize(){this._handles.add((0,g.N1)(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this._state){case Te.Ready:throw new Error("invalid state");case Te.Destroyed:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new Ce({...t,geometry:null,renderOccluded:F.yD.OccludeAndTransparent}),this._triangleVisualElement=new q.r({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:F.yD.OccludeAndTransparent}),this._rightAngleQuad=new Ve({...t,color:Ne,renderOccluded:F.yD.OccludeAndTransparent});const i={...t,polygonOffset:!0,renderOccluded:F.yD.OccludeAndTransparent};this._projectedGeodesicLine=new q.r({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Ge.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new q.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Ge.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new q.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Ge.z5)(e.guideStippleLengthPixels)}),this._segmentLabel=new N.Kc({...t,fontSize:e.direcLabelFontSize}),this._verticalLabel=new N.Kc({...t,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new N.Kc({...t,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,p.YP)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),p.tX),(0,p.YP)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode,state:this._state})),(e=>this._updateLabelVisibility(e)),p.tX),(0,p.YP)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),p.tX),(0,Re.qe)((async()=>this._updateMessageBundle()))]),this._state=Te.Ready,this._updateMessageBundle()}destroy(){this._state!==Te.Destroyed&&(this._handles=(0,a.SC)(this._handles),this._segmentVisualElement=(0,a.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,a.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,a.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,a.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,a.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,a.SC)(this._geodesicEndHint),this._segmentLabel=(0,a.SC)(this._segmentLabel),this._verticalLabel=(0,a.SC)(this._verticalLabel),this._horizontalLabel=(0,a.SC)(this._horizontalLabel),this.set("view",null),this._state=Te.Destroyed)}async whenReady(){await(0,g.N1)(this,"ready")}_updateVisualElementVisibility(e){let{visible:t,viewMode:i}=e;if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(i){case E.None:break;case E.Direct:this._segmentVisualElement.visible=!0;break;case E.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case E.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode(e){let{view:t,camera:i,viewMode:s,elevationAlignedStartPoint:n,elevationAlignedEndPoint:r,orientation:o,visualizedMeasurement:l,stripeLength:d}=e;const h=t.renderCoordsHelper;if((0,a.Wi)(n)||(0,a.Wi)(r)||n.equals(r))return;let c=this._startPosition,u=this._endPosition;h.toRenderCoords(n,c),h.toRenderCoords(r,u);const _=o===A.AboveSegment?1:-1,p=_*(h.getAltitude(u)-h.getAltitude(c));p<0&&(c=this._endPosition,u=this._startPosition);const g="geodesic"===l?new xe.u4(this._startPosition,this._endPosition,h.spatialReference):new xe.y$(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=g,this._updateSegmentStripeLength(d),s){case E.Direct:this._updateSegment(g,o);break;case E.Triangle:this._updateSegmentAndTriangle({view:t,camera:i,segment:g,orientation:o,startPosition:c,endPosition:u,deltaSign:_,altitudeDelta:p});break;case E.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:o,startPosition:c,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===A.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle(e){let{view:{renderCoordsHelper:t},camera:i,segment:s,orientation:n,startPosition:a,endPosition:r,deltaSign:o,altitudeDelta:l}=e;const d=this._cornerPosition;t.worldUpAtPosition(a,d),(0,m.a)(d,d,o*Math.abs(l)),(0,m.b)(d,d,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[d[0],d[1],d[2]],[r[0],r[1],r[2]]]],this._rightAngleQuad.geometry={previous:a,center:d,next:r};const h=new xe.y$(a,d),c=new xe.y$(d,r),u=function(e,t,i,s,n){const a=He,r=Ie;n.projectToRenderScreen(i,a),n.projectToRenderScreen(t,r);const o={segment:"bottom",horizontal:"top",vertical:a[0]<r[0]?"left":"right"};{const s=ke,a=Qe;if((0,j.c)(e,i,s,n),(0,j.c)(e,t,a,n),(0,R.k)(s,a)>=Ue){const e=Math.sign(s[1])===Math.sign(a[1]);o.segment=e?(0,N.jB)(o.vertical):o.vertical}else{const e=Fe;(0,j.c)(i,t,e,n),(0,R.k)(e,a)>=Ue&&(o.segment=Math.sign(e[0])===Math.sign(a[0])?(0,N.jB)(o.horizontal):o.horizontal)}}if(s===A.BelowSegment){const e=e=>"top"===e?"bottom":"top";o.segment=e(o.segment),o.horizontal=e(o.horizontal),o.vertical=e(o.vertical)}return o}(a,r,d,n,i);this._segmentLabel.anchor=u.segment,this._segmentLabel.geometry={type:"segment",segment:s,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=u.vertical,this._horizontalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._horizontalLabel.anchor=u.horizontal}_updateSegmentAndProjection(e){let{view:{renderCoordsHelper:t},orientation:i,startPosition:s,endPosition:n}=e;t.setAltitude(this._startPositionAtSeaLevel,0,s),t.setAltitude(this._endPositionAtSeaLevel,0,n);const a=new xe.u4(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new xe.y$(this._startPositionAtSeaLevel,s)),this._geodesicEndHint.setGeometryFromSegment(new xe.y$(this._endPositionAtSeaLevel,n)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=i===A.AboveSegment?"top":"bottom"}_updateLabelText(e){let{text:t,visualizedMeasurement:i}=e;(0,a.pC)(t)?(this._segmentLabel.text="euclidean"===i?t.euclideanDistance:t.geodesicDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility(e){let{state:t,visible:i,viewMode:s}=e;if(t!==Te.Ready)return;const n=this._segmentLabel,a=this._horizontalLabel,r=this._verticalLabel;if(n.visible=!1,a.visible=!1,r.visible=!1,i)switch(s){case E.Direct:n.visible=!0;break;case E.Triangle:n.visible=!0,a.visible=!0,r.visible=!0;break;case E.ProjectedGeodesic:n.visible=!0;case E.None:}}get _labelsText(){if(this._state!==Te.Ready)return null;const e=this.messages,t=this.analysisView.result;if((0,a.Wi)(t)||(0,a.Wi)(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:n,geodesicDistance:r}=t,o=this.analysisView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return l({euclideanDistance:i&&(0,T.Rd)(e,i),geodesicDistance:r&&(0,T.Rd)(e,r),horizontalDistance:s&&(0,T.Rd)(e,s),verticalDistance:n&&(0,T.Wv)(e,n)});case"imperial":return l({euclideanDistance:i&&(0,T.Ud)(e,i),geodesicDistance:r&&(0,T.Ud)(e,r),horizontalDistance:s&&(0,T.Ud)(e,s),verticalDistance:n&&(0,T.Zv)(e,n)});default:return l({euclideanDistance:i&&(0,T.VG)(e,i,o),geodesicDistance:r&&(0,T.VG)(e,r,o),horizontalDistance:s&&(0,T.VG)(e,s,o),verticalDistance:n&&(0,T.VG)(e,n,o)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,a.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,a.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===A.Auto?this.view.state.camera.aboveGround?A.AboveSegment:A.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(null==t||!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,n=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/n>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,a.Wi)(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,_.nn)(s,"meters");break;case"imperial":i=s&&(0,_.nn)(s,(0,G.FN)(s.value,s.unit));break;default:i=s&&(0,_.nn)(s,t)}return(0,a.Wi)(i)?null:(0,D.sk)(i.value/30)*(0,G.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,We.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}};(0,s._)([(0,r.Cb)()],je.prototype,"_state",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"messages",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"view",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"analysis",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"analysisView",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"ready",null),(0,s._)([(0,r.Cb)()],je.prototype,"loadingMessages",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"visible",null),(0,s._)([(0,r.Cb)()],je.prototype,"viewMode",null),(0,s._)([(0,r.Cb)()],je.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,r.Cb)()],je.prototype,"visualElementOrientation",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,r.Cb)()],je.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,r.Cb)()],je.prototype,"labels",null),(0,s._)([(0,r.Cb)()],je.prototype,"testData",null),(0,s._)([(0,r.Cb)()],je.prototype,"_labelsText",null),(0,s._)([(0,r.Cb)()],je.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,r.Cb)()],je.prototype,"_measurementArrowStripeLength",null),je=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],je);const Ne=(0,W.f)(1,.5,0,.75),qe={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:Ne,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:Ne,guideLineWidth:2,guideLineColor:Ne,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ue=Math.cos((0,D.Vl)(12)),He=(0,x.J$)(),Ie=(0,x.J$)(),ke=(0,x.gX)(),Qe=(0,x.gX)(),Fe=(0,x.gX)();let Ze=class extends((0,d.p)(n.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.result=null,this.measurementMode=h.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new je({view:e,analysis:t,analysisView:this}),this._analysisController=new L({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,a.SC)(this._analysisController),this._analysisVisualization=(0,a.SC)(this._analysisVisualization)}whenReady(){return this._analysisVisualization.whenReady()}get updating(){var e;return!(null==(e=this._analysisVisualization)||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...null==(e=this._analysisVisualization)?void 0:e.testData,visualization:this._analysisVisualization,controller:this._analysisController}}get unit(){return(0,a.Pt)(this.analysis.unit,this._defaultUnit)}};(0,s._)([(0,r.Cb)()],Ze.prototype,"updating",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"type",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"analysis",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"result",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"measurementMode",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],Ze.prototype,"viewMode",null),(0,s._)([(0,r.Cb)({readOnly:!0})],Ze.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"visualElementOrientation",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,r.Cb)({readOnly:!0})],Ze.prototype,"directLabelText",null),(0,s._)([(0,r.Cb)({readOnly:!0})],Ze.prototype,"horizontalLabelText",null),(0,s._)([(0,r.Cb)({readOnly:!0})],Ze.prototype,"verticalLabelText",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"testData",null),(0,s._)([(0,r.Cb)()],Ze.prototype,"_analysisVisualization",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"_analysisController",void 0),(0,s._)([(0,r.Cb)()],Ze.prototype,"unit",null),(0,s._)([(0,r.Cb)(l.Y)],Ze.prototype,"_defaultUnit",void 0),Ze=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],Ze);const Be=Ze}}]);
//# sourceMappingURL=3003.51e7056f.chunk.js.map