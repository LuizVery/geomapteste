{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/engine/BitmapTile.js","../node_modules/@arcgis/core/views/2d/engine/BitmapTileContainer.js","../node_modules/@arcgis/core/views/2d/engine/webgl/Mesh2D.js","../node_modules/@arcgis/core/views/2d/engine/webgl/ClippingInfo.js","../node_modules/@arcgis/core/views/2d/engine/webgl/WGLContainer.js","../node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","../node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","../node_modules/@arcgis/core/views/2d/engine/Bitmap.js"],"names":["r","t","s","i","a","n","bitmap","e","coordScale","once","ready","this","destroy","beforeRender","afterRender","stencilRef","dvs","tileMat3","transforms","stage","children","some","blendFunction","_tileInfoView","getTileBounds","tileInfo","size","registerRenderPass","name","brushes","target","map","drawPhase","MAP","visible","m","getLogger","y","o","x","coords","lengths","c","length","push","f","slice","h","g","_cache","vertices","indices","primitiveType","isMapSpace","indexBuffer","dispose","vertexBuffers","BYTES_PER_ELEMENT","u","createIndex","Object","keys","reduce","createVertex","width","height","fromScreenExtent","xmin","ymin","xmax","ymax","path","Uint32Array","Math","floor","geometry","type","fromPolygon","fromMapExtent","error","fromRect","toScreen","parseFloat","_clip","_handle","watch","_invalidate","mesh","vao","_destroyGL","remove","_lastWidth","_lastHeight","_createMesh","getIndexBuffer","getVertexBuffers","requestRender","left","right","top","bottom","max","_createScreenRect","fromPath","fromGeometry","arguments","constructor","_clips","forEach","clips","_updateClippingInfo","createRenderParams","painter","globalOpacity","profiler","LABEL","computedOpacity","recordContainerStart","beforeRenderLayer","_clippingInfos","updateTransforms","state","renderChildren","compositeLayer","recordContainerEnd","_renderPasses","prepareRenderPasses","render","requireFBO","requiresDedicatedFBO","clip","LABEL_ALPHA","DEBUG","HIGHLIGHT","setTransform","items","fromClipArea","key","level","row","col","sortChildren","setStencilReference","requiredLevel","getClosestInfoForScale","scale","displayLevel","scaleToZoom","getStencilTarget","getTileResolution","pixelBlock","extent","originalPixelBlock","l","filter","getAsRGBA","createImageData","data","set","putImageData","renderedRasterPixels","Uint8Array","buffer","pixelFormat","internalFormat","dataType","wrapMode","requestRenderOnSourceChangedEnabled","_textureInvalidated","_height","pixelRatio","resolution","rotation","_source","_width","source","bind","_texture","sourceWidth","sourceHeight","invalidateTexture","HTMLImageElement","naturalHeight","naturalWidth","updateTexture","context","toScreenNoRotation","d","PI","displayViewMat3","mips","descriptor","hasMipmap","generateMipmap","setSamplingMode","samplingMode","bindTexture","resize","getRenderedRasterPixels","setData","document","createElement","getContext"],"mappings":"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","file":"static/js/20.073d85b6.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{c as t}from\"../../../chunks/mat3f32.js\";import{Bitmap as e}from\"./Bitmap.js\";import{TiledDisplayObject as s}from\"./webgl/TiledDisplayObject.js\";class r extends s{constructor(t,s,r,i,a,n=null){super(t,s,r,i,a),this.bitmap=new e(n,\"standard\",!1),this.bitmap.coordScale=[i,a],this.bitmap.once(\"isReady\",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(t){super.beforeRender(t),this.bitmap.beforeRender(t)}afterRender(t){super.afterRender(t),this.bitmap.afterRender(t)}set stencilRef(t){this.bitmap.stencilRef=t}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:t(),tileMat3:t()}}setTransform(t,e){super.setTransform(t,e),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}export{r as BitmapTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{create as e}from\"../../../geometry/support/aaBoundingRect.js\";import{BitmapTile as r}from\"./BitmapTile.js\";import{brushes as s}from\"./brushes.js\";import{WGLDrawPhase as t}from\"./webgl/enums.js\";import i from\"./webgl/TileContainer.js\";class n extends i{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.bitmap.blendFunction))}createTile(s){const t=this._tileInfoView.getTileBounds(e(),s),[i,n]=this._tileInfoView.tileInfo.size;return new r(s,t[0],t[3],i,n)}destroyTile(){}prepareRenderPasses(e){const r=e.registerRenderPass({name:\"bitmap (tile)\",brushes:[s.bitmap],target:()=>this.children.map((e=>e.bitmap)),drawPhase:t.MAP});return[...super.prepareRenderPasses(e),r]}doRender(e){this.visible&&e.drawPhase===t.MAP&&super.doRender(e)}}export{n as BitmapTileContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import t from\"../../../../core/Logger.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{e as s}from\"../../../../chunks/earcut.js\";import{s as n}from\"../../../../chunks/vec2.js\";import{a as o}from\"../../../../chunks/vec2f64.js\";import{convertFromNestedArray as c,convertFromPolygon as i}from\"../../../../layers/graphics/featureConversionUtils.js\";import a from\"../../../../layers/graphics/OptimizedGeometry.js\";import{i1616to32 as f}from\"./number.js\";import h from\"../../../webgl/BufferObject.js\";const m=t.getLogger(\"esri.views.2d.engine.webgl.Mesh2D\"),u=t=>{switch(t.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new e(\"Cannot get DataType of array\")}},y=(e,t,r,s)=>{let n=0;for(let o=1;o<r;o++){const r=e[2*(t+o-1)],s=e[2*(t+o-1)+1];n+=(e[2*(t+o)]-r)*(e[2*(t+o)+1]+s)}return s?n>0:n<0},x=({coords:e,lengths:t},r)=>{const n=[];for(let o=0,c=0;o<t.length;c+=t[o],o+=1){const i=c,a=[];for(;o<t.length-1&&y(e,c+t[o],t[o+1],r);o+=1,c+=t[o])a.push(c+t[o]-i);const f=e.slice(2*i,2*(c+t[o])),h=s(f,a,2);for(const e of h)n.push(e+i)}return n};class g{constructor(e,t,r,s=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=s}static fromRect({x:e,y:t,width:r,height:s}){const n=e,o=t,c=n+r,i=o+s;return g.fromScreenExtent({xmin:n,ymin:o,xmax:c,ymax:i})}static fromPath(e){const t=c(new a,e.path,!1,!1),r=t.coords,s=new Uint32Array(x(t,!0)),n=new Uint32Array(r.length/2);for(let o=0;o<n.length;o++)n[o]=f(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new g({geometry:n},s,4)}static fromGeometry(t,r){const s=r.geometry.type;switch(s){case\"polygon\":return g.fromPolygon(t,r.geometry);case\"extent\":return g.fromMapExtent(t,r.geometry);default:return m.error(new e(\"mapview-bad-type\",`Unable to create a mesh from type ${s}`,r)),g.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=i(new a,t,!1,!1),s=r.coords,c=new Uint32Array(x(r,!1)),h=new Uint32Array(s.length/2),m=o(),u=o();for(let o=0;o<h.length;o++)n(m,s[2*o],s[2*o+1]),e.toScreen(u,m),h[o]=f(Math.floor(u[0]),Math.floor(u[1]));return new g({geometry:h},c,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:s}){const n={geometry:new Uint32Array([f(e,r),f(t,r),f(e,s),f(e,s),f(t,r),f(t,s)])},o=new Uint32Array([0,1,2,3,4,5]);return new g(n,o,4)}static fromMapExtent(e,t){const[r,s]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,o]=e.toScreen([0,0],[t.xmax,t.ymax]),c={geometry:new Uint32Array([f(r,s),f(n,s),f(r,o),f(r,o),f(n,s),f(n,o)])},i=new Uint32Array([0,1,2,3,4,5]);return new g(c,i,4)}destroy(){r(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)r(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return u(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=h.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,s)=>({...r,[s]:h.createVertex(e,t,this.vertices[s])})),{})),this._cache.vertexBuffers}}export{g as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/Error.js\";import e from\"../../../../core/Logger.js\";import{isSome as r,isNone as s}from\"../../../../core/maybe.js\";import{c as i}from\"../../../../chunks/mat3f32.js\";import{DisplayObject as o}from\"../DisplayObject.js\";import h from\"./Mesh2D.js\";import a from\"../../../webgl/VertexArrayObject.js\";const c=e.getLogger(\"esri.views.2d.engine.webgl.ClippingInfo\"),n=t=>parseFloat(t)/100;class m extends o{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=e.watch(\"version\",(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new m(t,e)}_destroyGL(){r(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),r(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,r,i){const[o,h]=e.size;if(\"geometry\"!==this._clip.type&&this._lastWidth===o&&this._lastHeight===h||(this._lastWidth=o,this._lastHeight=h,this._destroyGL()),s(this._cache.vao)){const s=this._createMesh(e,this._clip),o=s.getIndexBuffer(t),h=s.getVertexBuffers(t);this._cache.mesh=s,this._cache.vao=new a(t,r,i,h,o)}return this._cache.vao}_createTransforms(){return{dvs:i()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(t,e){const[r,s]=t.size,i=\"string\"==typeof e.left?n(e.left)*r:e.left,o=\"string\"==typeof e.right?n(e.right)*r:e.right,h=\"string\"==typeof e.top?n(e.top)*s:e.top,a=\"string\"==typeof e.bottom?n(e.bottom)*s:e.bottom,c=i,m=h;return{x:c,y:m,width:Math.max(r-o-c,0),height:Math.max(s-a-m,0)}}_createMesh(e,r){switch(r.type){case\"rect\":return h.fromRect(this._createScreenRect(e,r));case\"path\":return h.fromPath(r);case\"geometry\":return h.fromGeometry(e,r);default:return c.error(new t(\"mapview-bad-type\",\"Unable to create ClippingInfo mesh from clip of type: ${clip.type}\")),h.fromRect({x:0,y:0,width:1,height:1})}}}export{m as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{isNone as e,isSome as r}from\"../../../../core/maybe.js\";import{c as s}from\"../../../../chunks/mat3f32.js\";import{brushes as t}from\"../brushes.js\";import{Container as i}from\"../Container.js\";import n from\"./ClippingInfo.js\";import{WGLDrawPhase as o}from\"./enums.js\";class a extends i{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}_createTransforms(){return{dvs:s()}}doRender(e){const r=this.createRenderParams(e),{painter:s,globalOpacity:t,profiler:i,drawPhase:n}=r,a=n===o.LABEL?1:t*this.computedOpacity;i.recordContainerStart(this.name),s.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(r),s.compositeLayer(r,a),i.recordContainerEnd()}renderChildren(r){e(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(r.painter));for(const e of this.children)e.beforeRender(r);for(const e of this._renderPasses)try{e.render(r)}catch(s){}for(const e of this.children)e.afterRender(r)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:\"clip\",brushes:[t.clip],target:()=>this._clippingInfos,drawPhase:o.MAP|o.LABEL|o.LABEL_ALPHA|o.DEBUG|o.HIGHLIGHT})]}updateTransforms(e){for(const r of this.children)r.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(r(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;r(e)&&e.length&&(this._clippingInfos=e.items.map((e=>n.fromClipArea(this.stage,e)))),this.requestRender()}}export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/has.js\";import{WGLDrawPhase as r}from\"./enums.js\";import s from\"./WGLContainer.js\";import t from\"./brushes/WGLBrushInfo.js\";import n from\"./brushes/WGLBrushStencil.js\";const i=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class o extends s{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(i),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(s){const i=super.prepareRenderPasses(s);return i.push(s.registerRenderPass({name:\"stencil\",brushes:[n],drawPhase:r.DEBUG|r.MAP|r.HIGHLIGHT,target:()=>this.getStencilTarget()})),e(\"esri-tiles-debug\")&&i.push(s.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:r.DEBUG,target:()=>this.children})),i}getStencilTarget(){return this.children}updateTransforms(e){for(const r of this.children){const s=this._tileInfoView.getTileResolution(r.key);r.setTransform(e,s)}}setStencilReference(){let e=1;for(const r of this.children)r.stencilRef=e++}}export{o as default,i as sortByLevel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as o}from\"../../../chunks/vec2f32.js\";import\"../../webgl/BufferObject.js\";import\"../../webgl/FramebufferObject.js\";import\"../../../core/has.js\";import\"../../webgl/checkWebGLError.js\";import\"../../webgl/enums.js\";import\"../../../chunks/builtins.js\";import\"../../webgl/renderState.js\";import u from\"../../webgl/Texture.js\";import\"../../webgl/VertexArrayObject.js\";import{DisplayObject as a}from\"./DisplayObject.js\";import d from\"./ImageryBitmapSource.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function m(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function g(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new u(t,s)}class x extends a{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[u,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,m=Math.PI*this.rotation/180;i(n,n,o(u,a)),i(n,n,o(c/2,l/2)),s(n,n,-m),i(n,n,o(-c/2,-l/2)),r(n,n,o(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=g(e,this.sourceWidth,this.sourceHeight):this._texture=g(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof d){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(m(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{x as Bitmap,c as isImageSource,m as rasterize};\n"],"sourceRoot":""}