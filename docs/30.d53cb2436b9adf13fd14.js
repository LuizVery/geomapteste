(function(){var e={"esri/views/3d/layers/FeatureLayerView3D":1369,"esri/views/layers/support/popupUtils":1398,"esri/views/layers/support/FeatureFilter":1406,"esri/views/3d/layers/support/projectExtentUtils":1410,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1445,"esri/views/3d/layers/graphics/ExtentSet":1446,"esri/views/3d/layers/graphics/Graphics3DObjectStates":1447,"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":1448,"esri/views/3d/layers/support/attributeUtils":1449,"esri/views/3d/layers/graphics/QueryEngine":1460,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1477,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1533,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":1534,"esri/views/layers/support/FeatureEffect":1586,"esri/layers/graphics/controllers/FeatureTileController3D":1588,"esri/views/3d/layers/support/FeatureTileFetcher3D":1589,"esri/views/layers/FeatureLayerView":1660,"esri/views/layers/support/ParsedFeatureEffect":1661,"esri/views/layers/support/cssFilterParser":1662,"esri/views/layers/support/Transition":1663,"esri/views/3d/layers/support/featureReference":1676,"esri/views/3d/layers/support/FeatureTile":1677,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":1678,"esri/views/3d/layers/FeatureLikeLayerView3D":1679,"esri/views/3d/support/EventedSet":1680,"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":1994,"esri/views/3d/layers/support/featureTileQuery3D":1995,"esri/views/3d/support/PBFDecoder":1996},t=this||window,r=t.webpackJsonp=t.webpackJsonp||[];r.registerAbsMids?r.registerAbsMids(e):(r.absMidsWaiting=r.absMidsWaiting||[]).push(e)})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1369:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(24),r(11),r(4),r(13),r(1),r(106),r(1588),r(1679),r(680),r(1994),r(691),r(1680),r(1660),r(678),r(679)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y,g,m){var v=function(e){function t(t){var r=e.call(this,t)||this;return r._controllerTotal=0,r._graphicsCoreTotal=0,r.suspendResumeExtentMode="data",r}return r.__extends(t,e),t.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)},Object.defineProperty(t.prototype,"updatingProgressValue",{get:function(){var e=1;if(this.controller&&this.controller.updating){var t=this.controller.updatingRemaining;(r=this.controller.updatingTotal)>0&&(this._controllerTotal=Math.max(r,this._controllerTotal),e=(r-t)/r)}var r,i=1;this.graphics3d&&this.graphics3d.graphicsCore&&(t=this.graphics3d.graphicsCore.updatingRemaining,(r=this.graphics3d.graphicsCore.updatingTotal)>0&&(this._graphicsCoreTotal=Math.max(r,this._graphicsCoreTotal),i=(r-t)/r));return 1===e&&1===i&&(this._controllerTotal=0,this._graphicsCoreTotal=0),.5*(e+i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case"snapshot":return this.controller.serviceDataCount>b;case"tiles":return!0;default:i.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:t.supportsZ)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM},enumerable:!0,configurable:!0}),t.prototype.fetchPopupFeatures=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(r){return(e=this.validateFetchPopupFeatures(t))?[2,s.reject(e)]:[2,this.fetchClientPopupFeatures(t)]}))}))},t.prototype.setVisibility=function(e,t){this.graphics3d&&this.graphics3d.graphicsCore.setObjectIdVisibility(e,t)},t.prototype.createQuery=function(){return e.prototype.createQuery.call(this)},t.prototype.queryFeatures=function(t,r){var i=this,n=function(){return e.prototype.queryFeatures.call(i,t,r)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(t),n):n()},t.prototype.createController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t=this;return r.__generator(this,(function(r){return this.fetcherContext=new d.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM}),e=new l({layerView:this,context:this.fetcherContext,graphics:new f.EventedSet,extent:this.clippingExtent}),this.updatingHandles.add(e,"serviceDataExtent",(function(e){t.graphics3d&&(t.graphics3d.dataExtent=e)}),2),this.handles.add(a.init(this,"suspended",(function(t){t?e.suspend():e.resume()}),!0)),this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",(function(){return t.updateDisplayFeatureLimit(e)}),2),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",(function(){return t.updateDisplayFeatureLimit()}))),[2,e]}))}))},t.prototype.doRefresh=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return!this.suspended&&this.controller&&this.controller.refetch(),[2]}))}))},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)},t.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride},t.prototype.updateDisplayFeatureLimit=function(e){if(void 0===e&&(e=this.controller),e&&this.graphics3d&&this.graphics3d.graphicsCore){var t=this.graphics3d.graphicsCore.displayFeatureLimit,i=this.view.resourceController.memoryController.memoryFactor;if(1===i)e.displayFeatureLimit=t;else{var n=Math.ceil(t.maximumNumberOfFeatures*i),s=Math.ceil(t.maximumTotalNumberOfFeatures*i),a=Math.ceil(t.minimumTotalNumberOfFeatures*i);e.displayFeatureLimit=r.__assign(r.__assign({},t),{maximumNumberOfFeatures:n,maximumTotalNumberOfFeatures:s,minimumTotalNumberOfFeatures:a})}}},t.prototype._queryFeaturesMesh=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,l,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._validateQueryFeaturesMesh(e)];case 1:return r.sent(),[4,t()];case 2:if(i=r.sent(),e&&e.outStatistics)return[2,i];for(n=this.layer.objectIdField,s=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,a=[],o=0,l=i.features;o<l.length;o++)(c=l[o]).geometry?(p=s.get(c.attributes[n]))&&(c.geometry=u.hydrateGeometry(p.graphic.geometry),a.push(c)):a.push(c);return i.features=a,[2,i]}}))}))},t.prototype._validateQueryFeaturesMesh=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,s,a;return r.__generator(this,(function(r){if(!e)return[2];for(t=function(e){throw new n("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+e+"'")},i=0,s=["quantizationParameters","geometryPrecision","maxAllowableOffset"];i<s.length;i++)null!=e[a=s[i]]&&t(a);return"returnM"in e&&e.returnM&&t("returnM"),"returnCentroid"in e&&e.returnCentroid&&t("returnCentroid"),e.outSpatialReference&&!e.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference"),[2]}))}))},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){var e=this.controller&&this.controller.displayFeatureLimit,t=e&&e.maximumSymbolComplexity,i=t?"f:"+t.primitivesPerFeature+",v:"+t.primitivesPerCoordinate:"n/a",n=r.__assign(r.__assign({},this._getResourceInfo()),{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:i,nodes:this.controller?this.controller.tileDescriptors.length:0});if(this.controller&&n.displayedNumberOfFeatures){var s=this.controller.debug;n.storedFeatures=s.storedFeatures,n.totalVertices=s.totalVertices}return n},enumerable:!0,configurable:!0}),r.__decorate([o.property()],t.prototype,"layer",void 0),r.__decorate([o.property()],t.prototype,"controller",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],t.prototype,"updatingProgressValue",null),r.__decorate([o.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],t.prototype,"maximumNumberOfFeatures",void 0),r.__decorate([o.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([o.property(h.updatingProgress)],t.prototype,"updatingProgress",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["controller.mode"]})],t.prototype,"asyncGraphicsUpdates",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"hasZ",null),r.__decorate([o.property({readOnly:!0})],t.prototype,"hasM",null),r.__decorate([o.property()],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([o.subclass("esri.views.3d.layers.FeatureLayerView3D")],t)}(m.RefreshableLayerView(c.FeatureLikeLayerView3D(y.FeatureLayerView(p.LayerView3D(g))))),b=5e3;return v}.apply(null,i))||(e.exports=n)},1398:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(234),r(2),r(66)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),r.__awaiter(this,void 0,void 0,(function(){var a,o,u,l,c,p,d,h,f;return r.__generator(this,(function(y){switch(y.label){case 0:return n.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return a=y.sent(),o=t.lastEditInfoEnabled,u=e.objectIdField,l=e.typeIdField,c=e.globalIdField,p=e.relationships,i.includes(a,"*")?[2,["*"]]:o?[4,s.getFeatureEditFields(e)]:[3,3];case 2:return h=y.sent(),[3,4];case 3:h=[],y.label=4;case 4:return d=h,f=s.fixFields(e.fields,r.__spreadArrays(a,d)),l&&f.push(l),f&&u&&s.hasField(e.fields,u)&&-1===f.indexOf(u)&&f.push(u),f&&c&&s.hasField(e.fields,c)&&-1===f.indexOf(c)&&f.push(c),p&&p.forEach((function(t){var r=t.keyField;f&&r&&s.hasField(e.fields,r)&&-1===f.indexOf(r)&&f.push(r)})),[2,f]}}))}))},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:n.isSome(t)&&t.defaultPopupTemplateEnabled&&n.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,i))||(e.exports=n)},1406:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(236),r(22),r(7),r(8),r(92),r(1),r(29),r(304)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p){var d=new s.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),h=new s.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(e){function t(t){var r=e.call(this,t)||this;return r.where=null,r.geometry=null,r.spatialRelationship="intersects",r.hiddenIds=new Set,r.distance=void 0,r.objectIds=null,r.units=null,r.timeExtent=null,r.enabled=!1,r}var s;return r.__extends(t,e),s=t,t.prototype.writeWhere=function(e,t){t.where=e||"1=1"},t.prototype.enable=function(){this._set("enabled",!0)},t.prototype.createQuery=function(e){void 0===e&&(e={});var t=this,i=t.where,n=t.geometry,s=t.spatialRelationship,a=t.timeExtent,u=t.objectIds,l=t.units,c=t.distance;return new p(r.__assign({geometry:o.clone(n),objectIds:o.clone(u),spatialRelationship:s,timeExtent:o.clone(a),where:i,units:l,distance:c},e))},t.prototype.clone=function(){var e=this,t=e.where,r=e.geometry,i=e.spatialRelationship,n=e.hiddenIds,a=e.timeExtent,u=e.objectIds,l=e.units,c=e.distance,p=new Set;return n.forEach((function(e){return p.add(e)})),new s({geometry:o.clone(r),hiddenIds:p,objectIds:o.clone(u),spatialRelationship:i,timeExtent:o.clone(a),where:t,units:l,distance:c})},r.__decorate([l.property({type:String})],t.prototype,"where",void 0),r.__decorate([l.writer("where")],t.prototype,"writeWhere",null),r.__decorate([l.property({types:i.geometryTypes,json:{read:c.fromJSON,write:!0}})],t.prototype,"geometry",void 0),r.__decorate([l.property({type:String,json:{read:{source:"spatialRel",reader:d.read},write:{target:"spatialRel",writer:d.write}}})],t.prototype,"spatialRelationship",void 0),r.__decorate([l.property({json:{write:function(e,t,r){return t[r]=u.valuesOfSet(e)},read:function(e){return u.SetFromValues(e)}}})],t.prototype,"hiddenIds",void 0),r.__decorate([l.property({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],t.prototype,"distance",void 0),r.__decorate([l.property({type:[Number],json:{write:!0}})],t.prototype,"objectIds",void 0),r.__decorate([l.property({type:String,json:{read:h.read,write:{writer:h.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],t.prototype,"units",void 0),r.__decorate([l.property({type:n,json:{write:!0}})],t.prototype,"timeExtent",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"enabled",void 0),s=r.__decorate([l.subclass("esri.views.layers.support.FeatureFilter")],t)}(a.JSONSupport)}.apply(null,i))||(e.exports=n)},1410:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(46),r(239)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,s=e.layer.fullExtent,a=s&&s.spatialReference;return a?a.equals(t)?r.resolve(s.clone()):i.canProject(a,t)?r.resolve(i.project(s,t)):e.view.state.isLocal?n.projectGeometry(s,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,i))||(e.exports=n)},1445:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(38),r(17),r(92),r(1),r(1446),r(100)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new u.ExtentSet,t.globalDirty=!1,t.dirtyGraphicsSet=new Set,t.handles=new s,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new n,t}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var s=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",(function(e){return n.elevationUpdateHandler(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),s.registerTask(l.Task.ELEVATION_ALIGNMENT,(function(e){return n.update(e)}),(function(){return n.needsUpdate()}))])},t.prototype.destroy=function(){this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty},t.prototype.update=function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this,r=this.layerView.view,i=this.graphicsCore.stageLayer.id,n=this.layerView.labeling,s=function(){var s=Math.min(o.dirtyGraphicsSet.size,100);a.someSet(o.dirtyGraphicsSet,(function(i){var n=t.graphicsCore.getGraphics3DGraphicById(i);return t.dirtyGraphicsSet.delete(i),n&&n.alignWithElevation(t.elevationProvider,r.renderCoordsHelper,t.graphicsCore.asyncUpdates),e.madeProgress(),--s<=0||e.done})),r._stage.processDirtyLayer(i),n&&n.processStageDirty()},o=this;this.dirtyGraphicsSet.size>0&&!e.done;)s()},t.prototype._updateDirtyExtents=function(e){for(var t=this;!this.dirtyExtents.empty&&this.dirtyGraphicsSet.size<100&&!e.done;){var r=this.dirtyExtents.pop();this.events.emit("invalidate-elevation",{extent:r,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(r,this.spatialReference,(function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,r){return e.dirtyGraphicsSet.add(r)}))},t.prototype.elevationUpdateHandler=function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent;if(this.spatialReference=e.spatialReference,this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:this.spatialReference})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}},r.__decorate([o.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([o.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(i);t.default=c}.apply(null,i))||(e.exports=n)},1446:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(57),r(34),r(100)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.extents=new r({allocator:function(e){return e||i.create()}}),this.tempExtent=i.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),i.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&this.mergeTight(),this.extents.pop()},e.prototype.merge=function(e){return this.mergeTight(e),e.hasProgressed},e.prototype.mergeTight=function(e){var t=this;void 0===e&&(e=n.noBudget);for(var r=this.extents,s=new Set,a=0;a!==r.length;){r.sort((function(e,t){return e[0]-t[0]})),a=r.length,s.clear();for(var o=function(n){if(e.done)return{value:void 0};for(var a=r.getItemAt(n),o=n+1;o<r.length;++o){var u=r.getItemAt(o);if(u[0]>=a[2])break;s.add(u)}s.forEach((function(n){if(a!==n)if(n[2]<=a[0])s.delete(n);else{var o=i.area(a),u=i.area(n),l=t.tempExtent;i.expand(a,n,l);var c=o+u;(i.area(l)-c)/c<.05&&(i.set(a,l),s.delete(n),r.remove(n),e.madeProgress())}})),s.add(a)},u=0;u<r.length;++u){var l=o(u);if("object"==typeof l)return l.value}}this.dirty=!1},e.prototype.contains=function(e){return this.extents.some((function(t){return i.contains(t,e)}))},e.prototype.removeContained=function(e){this.extents.filterInPlace((function(t){return!i.contains(e,t)}))},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{containsPoint:function(t){return e.extents.some((function(e){return i.containsPoint(e,t)}))}}},enumerable:!0,configurable:!0}),e}();t.ExtentSet=s}.apply(null,i))||(e.exports=n)},1447:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1448)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._graphicsCore=e,this._stateSets=new Array}return e.prototype.destroy=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null},e.prototype.acquireSet=function(e,t){var i=this,n=new r.Graphics3DObjectStateSet(e,t);this._stateSets.push(n);var s={remove:function(){return i.releaseSet(n)},pause:function(){n.objectStateSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,i.initializeSet(n)}};return{set:n,handle:s}},e.prototype.releaseSet=function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)},e.prototype._addObjectStateSet=function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)},e.prototype._removeObjectStateSet=function(e,t){e.removeObjectState(t.objectStateSet)},e.prototype.setUid=function(e,t){e.ids.add(t);var r=this._graphicsCore.graphics3DGraphics.get(t);r&&this._addObjectStateSet(r,e)},e.prototype.setUids=function(e,t){var r=this;t.forEach((function(t){return r.setUid(e,t)}))},e.prototype.setObjectIds=function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)},e.prototype.addGraphic=function(e){var t=this;this._stateSets.forEach((function(r){!r.paused&&r.hasGraphic(e)&&t._addObjectStateSet(e,r)}))},e.prototype.removeGraphic=function(e){var t=this;this._stateSets.forEach((function(r){r.hasGraphic(e)&&t._removeObjectStateSet(e,r)}))},e.prototype.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))},e.prototype.initializeSet=function(e){var t=this,r=this._graphicsCore.graphics3DGraphics;e.objectIdField?r.forEach((function(r){r&&e.hasGraphic(r)&&t._addObjectStateSet(r,e)})):e.ids.forEach((function(i){var n=r.get(i);n&&t._addObjectStateSet(n,e)}))},Object.defineProperty(e.prototype,"test",{get:function(){return{states:this._stateSets}},enumerable:!0,configurable:!0}),e}();t.Graphics3DObjectStates=i}.apply(null,i))||(e.exports=n)},1448:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(312)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new r.Object3DStateSet,this.ids=new Set,this.paused=!1}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}();t.Graphics3DObjectStateSet=i}.apply(null,i))||(e.exports=n)},1449:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(s.toLowerCase()===r)return e[s]}return null}}.apply(null,i))||(e.exports=n)},1460:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(28),r(9),r(2),r(1),r(49),r(1402),r(305),r(304)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=u.default,d=function(e){function t(t){var r=e.call(this,t)||this;return r._dataQueryEngineInstance=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new c({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForExtent=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),n=i.count,s=i.extent,a=o.fromJSON(s),[2,{count:n,extent:a}]}}))}))},t.prototype.executeQueryForIds=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]}))}))},t.prototype.executeQueryForLatestObservations=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype.executeQuery=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return i=r.sent(),(n=l.fromJSON(i)).features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),[2,n]}}))}))},t.prototype._ensureQueryJSON=function(e){return s.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,r=i.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),n=this.layer.fields.map((function(e){return e.toJSON()})),s=this.layerView.view.resourceController.scheduler,a=this.task,o=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,c=l.hasZ,d=l.hasM;return this._dataQueryEngineInstance=new p({hasZ:c,hasM:d,geometryType:r,fields:n,timeInfo:e,spatialReference:o,objectIdField:t,featureStore:u,scheduler:s,task:a}),this._dataQueryEngineInstance},r.__decorate([a.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"task",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r.__decorate([a.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),r.__decorate([a.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r.__decorate([a.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(n);t.QueryEngine=d,t.default=d}.apply(null,i))||(e.exports=n)},1477:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(17),r(13),r(1),r(47),r(709),r(100)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){var c=-.3*o.earthRadius;return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suspended=!1,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new n,t.layerView=null,t.updating=!0,t}return r.__extends(t,e),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",(function(){return t.viewChange()})),r.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(l.Task.FRUSTUM_VISIBILITY,(function(){return t.update()}),(function(){return t.updating})),i.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([s.init(i,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),s.init(r,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype._setDirty=function(){this.updating||this._set("updating",!0)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()},t.prototype.viewChange=function(){this._setDirty()},t.prototype.elevationBoundsChange=function(){this._setDirty(),this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.updateIsVisibleBelowSurface=function(){var e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.isOpaque()||i},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=c;else{var r=t.basemapTerrain.elevationBounds,i=r.min,n=r.max;e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.update=function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r.__decorate([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r.__decorate([a.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(i)}.apply(null,i))||(e.exports=n)},1533:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(91),r(9),r(24),r(17),r(4),r(13),r(1),r(689),r(46),r(304),r(428),r(1475),r(1445),r(1534),r(1477),r(1447),r(1476),r(78),r(1449),r(311)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y,g,m,v,b,_,F,x){Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(t){var r=e.call(this,t)||this;return r._handles=new a,r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suspendInfo",{get:function(){var e={};return this.scaleVisibility&&this.scaleVisibility.suspended&&(e.outsideScaleRange=!0),this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new m:null,r=e.scaleVisibilityEnabled?new b:null,i=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new g.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new y.default:null;return{graphicsCore:new f.Graphics3DCore({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:r,filterVisibility:i,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,r){c.diff(t,r)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,r){c.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,i=function(e,t,r){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(n=e.view.elevationProvider,this.elevationAlignment.setup(e,i,this.graphicsCore,n)),this._set("objectStates",new v.Graphics3DObjectStates(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,o.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}))];case 1:return r.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return s.watchUpdatingTracking.addPromise(s.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(e,"fullOpacity",(function(){return s.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(e.view,"clippingArea",(function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,o.logOnError(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t){var r=this;if(e instanceof d){var n=this.objectStates.acquireSet(0,t),s=n.set,a=n.handle;return this.owner.queryObjectIds(e).then((function(e){return r.objectStates.setObjectIds(s,e)})),a}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof i)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof i){var o=e;if(!t||!o[0].attributes||null===F.attributeLookup(o[0].attributes,t)){var u=o.map((function(e){return e.uid})),l=this.objectStates.acquireSet(0,null),c=l.set;return a=l.handle,this.objectStates.setUids(c,u),a}e=o.map((function(e){return F.attributeLookup(e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var p=e,h=this.objectStates.acquireSet(0,t);return c=h.set,a=h.handle,this.objectStates.setObjectIds(c,p),a}}return S},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(u.init(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(E),e.suspendResumeExtentMode){case"computed":e._handles.add(u.init(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;case"data":e._handles.add(u.init(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),E);break;default:s.neverReached(e.suspendResumeExtentMode)}})))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!p.canProject(e,r))return;e=p.project(e,r)}return _.enlargeExtent(e,t,h.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r.__decorate([l.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r.__decorate([l.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r.__decorate([l.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"labeling",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"objectStates",void 0),r.__decorate([l.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([l.property()],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([l.property()],t.prototype,"dataExtent",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r.__decorate([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspendInfo",null),r.__decorate([l.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(n);t.default=w;var E="suspendResumeExtentMode",S={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,i))||(e.exports=n)},1534:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(17),r(5),r(2),r(4),r(13),r(1),r(1460),r(1406),r(100)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d){Object.defineProperty(t,"__esModule",{value:!0});var h=s.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),f=function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i.filter=null,i._dirty=!1,i._querying=!1,i._handles=new n,i}return r.__extends(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new c.default({layerView:this._layerView,task:d.Task.FILTER_VISIBILITY});var i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(d.Task.FILTER_VISIBILITY,(function(e){return r._update(e)}),(function(){return r._needsUpdate()}))),this._handles.add(u.on(t.owner,"loadedGraphics","after-changes",(function(e){return r._graphicsChanged(e)}),(function(){return r.dirty=!0}))),this.filterChanged()},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var r=a.isSome(e)?e.clone():new p;return r.timeExtent=r.timeExtent?r.timeExtent.intersection(t):t,r},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){o.isAbortError(e)||(h.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),r.__decorate([l.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(i);t.Graphics3DFilterVisibility=f}.apply(null,i))||(e.exports=n)},1586:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(7),r(5),r(2),r(1),r(1406),r(1661),r(1663)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){var c=n.getLogger("esri.views.layers.support.FeatureEffect");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filter=null,t.includedEffect=null,t.excludedEffect=null,t.excludedLabelsVisible=!1,t}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"insideEffect",{get:function(){return c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect},set:function(e){c.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead"),this.includedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outsideEffect",{get:function(){return c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect},set:function(e){c.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead"),this.excludedEffect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedIncludedEffect",{get:function(){return s.isSome(this.includedEffect)?"string"==typeof this.includedEffect?u.fromString(this.includedEffect):new l({from:u.fromString(this.includedEffect.from),to:u.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedExcludedEffect",{get:function(){return s.isSome(this.excludedEffect)?"string"==typeof this.excludedEffect?u.fromString(this.excludedEffect):new l({from:u.fromString(this.excludedEffect.from),to:u.fromString(this.excludedEffect.to),duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"done",{get:function(){return(!s.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!s.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new i({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})},r.__decorate([a.property({type:o,json:{write:!0}})],t.prototype,"filter",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"includedEffect",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"excludedEffect",void 0),r.__decorate([a.property({type:Boolean,json:{write:!0}})],t.prototype,"excludedLabelsVisible",void 0),r.__decorate([a.property({dependsOn:["includedEffect"]})],t.prototype,"parsedIncludedEffect",null),r.__decorate([a.property({dependsOn:["excludedEffect"]})],t.prototype,"parsedExcludedEffect",null),r.__decorate([a.property({dependsOn:["includedEffect","excludedEffect"]})],t.prototype,"renderingHash",null),i=r.__decorate([a.subclass("esri.views.layers.support.FeatureEffect")],t)}(i.JSONSupport)}.apply(null,i))||(e.exports=n)},1588:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(72),r(23),r(24),r(11),r(17),r(8),r(5),r(2),r(127),r(4),r(13),r(1),r(146),r(239),r(318),r(1589),r(1678),r(77),r(311)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y,g,m,v,b,_,F,x){var w=c.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),E=function(e){function t(t){var r=e.call(this,t)||this;return r.type="feature-tile-3d",r.watchUpdatingTracking=new x.WatchUpdatingTracking,r.serviceDataExtent=null,r.serviceDataCount=i.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new u,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=h.createAbortController(),r}var i;return r.__extends(t,e),i=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else w.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===i.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,n=r&&r.featureTiles,s=n&&n.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&s){var a=this.approximateExtentSizeAtScale(t.minScale,s);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>i.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new s([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add(this,"mode",(function(){return e.modeChanged()}),2);var t=h.resolve().then((function(){return e.verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())})).then((function(){return e.initializeTileFetcher()}));this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new o("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.restart=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.refetch=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view,r=f.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then((function(){var r=e,i=r.layerView,n=r.tileDescriptors,s=i.layer;e.tileFetcher=new b.FeatureTileFetcher3D({context:e.context,filterExtent:e.filteredDataExtent,tileDescriptors:n,features:e.graphics}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var a=e.layerView.view.resourceController;a&&(e.handles.add(a.memoryController.events.on("quality-changed",(function(t){e.tileFetcher.memoryFactor=t}))),e.tileFetcher.memoryFactor=a.memoryController.memoryFactor);var o="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;o&&e.handles.add(f.init(e.layerView.view,"qualitySettings.graphics3D."+o,(function(t){e.tileFetcher.lodFactor=t||1}))),e.watchUpdatingTracking.add(s,"createQueryVersion",(function(){return e.dataFilterChanged()})),e.watchUpdatingTracking.add(i,"availableFields",(function(t,r){return e.availableFieldsChanged(r,t)})),e.watchUpdatingTracking.add(i,"requiredFields",(function(t,r){return e.requiredFieldsChanged(r,t)})),e.handles.add([s.on("apply-edits",(function(t){return e.applyEdits(t)})),e.watch("filteredDataExtent",(function(t){return e.tileFetcher.filterExtent=t}),!0),e.watch("tileDescriptors",(function(t){return e.tileFetcher.tileDescriptors=t}),!0),f.init(e,"maximumNumberOfFeatures",(function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t}),!0),f.init(e,"serviceDataCount",(function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures}),!0),f.init(F,"FEATURE_TILE_FETCH_SHOW_TILES",(function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new _.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)}))]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:w.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))}))},t.prototype.availableFieldsChanged=function(e,t){this.tileFetcher&&C(this.tileFetcher.availableFields,t)&&this.refetch()},t.prototype.requiredFieldsChanged=function(e,t){this.tileFetcher&&C(this.tileFetcher.availableFields,t)&&this.restart()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return g.isHostedAgolService(e.url);case"csv":case"geojson":case"ogc-feature":return!0;default:return void a.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),h.isAbortError(t)||this._set("serviceDataExtent",l.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}}))}))},t.prototype.tryUpdateServiceDataExtent=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,a,o,u,c,p,d,h,f;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.layerView,n=t.layer,s=n.capabilities.query.supportsExtent,a=l.clone(t.fullExtentInLocalViewSpatialReference),o=n.fullExtent,u=this.fullExtentIsAccurate(),c=this.serviceDataCount,s&&c<=i.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!a||!u)&&"queryExtent"in n?(p=this.createDataInfoQuery(),[4,n.queryExtent(p,{timeout:i.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return d=r.sent(),this._set("serviceDataExtent",d.extent),[3,6];case 2:return a?(this._set("serviceDataExtent",a),[3,6]):[3,3];case 3:return o?(h="portalItem"in n?n.portalItem:null,[4,m.projectGeometry(o,t.view.spatialReference,h,e)]):[3,5];case 4:return f=r.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),r.label=6;case 6:return[2]}}))}))},t.prototype.updateServiceDataCount=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,s,a;return r.__generator(this,(function(r){switch(r.label){case 0:return"queryFeatureCount"in(t=this.layerView.layer)?[4,n.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))]:(a=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a),[2]);case 1:if(!0===(s=r.sent()).ok)this._set("serviceDataCount",s.value);else{if(h.isAbortError(s.error))throw s.error;a=i.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",a)}return[2]}}))}))},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,s=this._get("vertexLimitInfo");return p.isNone(s)||s.maximumTotalNumberOfPrimitives!==r||s.primitivesPerCoordinate!==i||s.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:s},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return a.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,d,f,y,g,m,v,b,_;return r.__generator(this,(function(r){switch(r.label){case 0:return s=p.isSome(this.vertexLimitInfo)&&this.vertexLimitInfo.primitivesPerFeature<=0,a=this.minimumNumberOfVerticesForGeometry>1,o=this.layerView.layer,u=this.supportsExceedsLimitQuery,p.isNone(this.vertexLimitInfo)||!s&&!a?(this._set("vertexLimitExceeded",!1),[2]):(l=this.vertexLimitInfo,c=l.primitivesPerFeature,d=l.primitivesPerCoordinate,f=l.maximumTotalNumberOfPrimitives,0!==c&&p.isSome(e)?[4,e]:[3,2]);case 1:r.sent(),r.label=2;case 2:return y=this.serviceDataCount,m=y!==i.constants.NO_SERVICE_DATA_COUNT,g=m?Math.ceil((f-y*c)/(d||1)):Math.ceil(f/(d||1)),a&&(g=Math.min(g,S)),m&&this.minimumNumberOfVerticesForGeometry*y>g?(this._set("vertexLimitExceeded",!0),[2]):u?[4,n.result(o.queryFeatures(this.createVertexLimitExceededQuery(g),{timeout:i.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>g),[2]);case 3:if(!1===(v=r.sent()).ok){if(h.isAbortError(v.error))throw v.error;return this._set("vertexLimitExceeded",!1),[2]}return b=v.value,(_=b.features[0])&&_.attributes?this._set("vertexLimitExceeded",!!_.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}}))}))},t.prototype.fetchServiceDataInfo=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,s,a=this;return r.__generator(this,(function(r){return this.cancelFetchServiceDataInfo(),e=h.createAbortController(),t=e.signal,i=this.updateServiceDataCount(t),n=h.eachAlways([i,this.updateVertexLimitExceeded(i,t)]),s=n.then((function(){return a.updateServiceDataExtent(t)})).catch((function(e){h.isAbortError(e)||w.error("#fetchServiceDataInfo()",e)})).then((function(){s===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null,a.fetchDataInfoAbortController=null),e=null})),e&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=e,[2,n.then((function(){}),(function(){}))]}))}))},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),r.__decorate([y.property({readOnly:!0})],t.prototype,"type",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"graphics",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"layerView",void 0),r.__decorate([y.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([y.property()],t.prototype,"extent",null),r.__decorate([y.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],t.prototype,"updating",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"watchUpdatingTracking",void 0),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),r.__decorate([y.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),r.__decorate([y.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([y.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),r.__decorate([y.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),r.__decorate([y.property()],t.prototype,"displayFeatureLimit",void 0),r.__decorate([y.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([y.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),r.__decorate([y.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),r.__decorate([y.property()],t.prototype,"tileFetcher",void 0),r.__decorate([y.property()],t.prototype,"fetchDataInfoPromise",void 0),r.__decorate([y.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),i=r.__decorate([y.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(d.EsriPromiseMixin(i)),S=5e6;function C(e,t){if(!t)return!1;for(var r=0,i=t;r<i.length;r++){var n=i[r];if(!e.has(n))return!0}return!1}return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(E||(E={})),E.constants.reset(),E}.apply(null,i))||(e.exports=n)},1589:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(30),r(17),r(5),r(2),r(4),r(54),r(92),r(13),r(1),r(34),r(106),r(431),r(304),r(1676),r(1677),r(177),r(100)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y,g,m,v,b,_){Object.defineProperty(t,"__esModule",{value:!0});var F=a.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),x=function(e){function t(t){var r=e.call(this,t)||this;return r._useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r.handles=new s,r._dirty=!1,r.featureTiles=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r.__extends(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryFactor",{set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodFactor",{set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTileCount",{get:function(){return this._useTileCount&&o.isSome(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))F.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add(p.on(this,"tileDescriptors","change",(function(){return e.setDirty()}),(function(){return e.setDirty()}))),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?m.MultiFeatureReference:m.SingleFeatureReference;var t=this.context.scheduler;o.isSome(t)&&this.handles.add(t.registerTask(_.Task.FEATURE_TILE_FETCHER,(function(t){return e.update(t)}),(function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0}))),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.restart=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.clearTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.refetch=function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.resetFetchTile(t)})),o.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e.cancelFetchTile(t)})),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.updated())},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=null;return this.featureTiles.forEach((function(t){t.displayingFeatures&&0!==t.displayingFeatures.length&&(o.isNone(e)?e=c.SetFromValues(n.keysOfSet(t.availableFields)):e.forEach((function(r){t.availableFields.has(r)||o.unwrap(e).delete(r)})))})),o.isSome(e)?e:new Set},enumerable:!0,configurable:!0}),t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:u.resolve(),count:0,controller:u.createAbortController()},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then((function(){return e.result.catch((function(e){if(u.isAbortError(e))throw e;return null})).then((function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,o.isSome(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e}))}));return this.pendingEdits.edits=r,this.updated(),r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach((function(e){return r.add(e.objectId)})),this.featureTiles.forEach((function(e){if(e.features){var i=e.features.filter((function(e){return!r.has(f.getObjectId(e,t.objectIdField))}));i.length!==e.features.length&&(e.setFeatures(i,0,e.availableFields),t.invalidateCounts())}}))}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,a,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:return n=[],s=new Set,e.forEach((function(e){return n.push(e.objectId)})),t.forEach((function(e){n.push(e.objectId),s.add(e.objectId)})),0===n.length?[2]:(a=[],this.featureTiles.forEach((function(e){var t=o.applyEditsAddUpdateTile(e,n,s,i);t&&a.push(t)})),[4,u.eachAlways(a)]);case 1:return r.sent(),[2]}}))}))},t.prototype.applyEditsAddUpdateTile=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,l,c,p,d=this;return r.__generator(this,(function(r){switch(r.label){case 0:return e.features?((s=this.createQuery(e)).resultType=void 0,s.cacheHint=!1,s.objectIds=t,[4,this.queryFeatures(s,n)]):[2];case 1:if(a=r.sent(),o=null,i.size>0&&(u=e.features.filter((function(e){return!i.has(f.getObjectId(e,d.objectIdField))}))).length!==e.features.length&&(o=u),a.features.length>0)for(o||(o=e.features.slice()),l=0,c=a.features;l<c.length;l++)p=c[l],o.push(p);return o&&(e.setFeatures(o,0,O(e.availableFields,a.fields)),this.invalidateCounts()),[2]}}))}))},t.prototype.queryFeatures=function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:j})},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&performance.now()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();if(this.markTilesNotAlive(r),e.run((function(){return t.addTiles(r,e)}))&&e.run((function(){return t.filterExtentTiles(r,e)}))&&e.run((function(){return t.removeTiles(r,e)}))&&!e.done){var i=this.sortTiles(r);e.run((function(){return t.displayTiles(i,e)}))&&e.run((function(){return t.fetchTiles(i,e)}))&&e.run((function(){return t.updateMemoryEstimates(i,e)}))||this.setDirty(),this.updated()}else this.setDirty()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach((function(i){var n=r.featureTiles.get(i.id);n?n.alive=!0:t.done||(e.push(r.addTile(i)),t.madeProgress())})),t.hasProgressed)},t.prototype.filterExtentTiles=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this.clearTile(n),t.madeProgress()))}return t.hasProgressed},t.prototype.removeTiles=function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this.removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed},t.prototype.sortTiles=function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),n=function(e){if(!t.run((function(){return function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.memoryFactor,r.objectIdField)&&r.setDirty(),r.showTile(e)}(e)})))return s.setDirty(),"break"},s=this,a=0,o=e;a<o.length&&"break"!==n(o[a]);a++);return t.hasProgressed},t.prototype.fetchTiles=function(e,t){var r=this;if(this.paused)return!1;for(var i=!1,n=function(e){if(!e.needsFetching)return"continue";var r=o.isSome(s.context.memoryCache)?s.context.memoryCache.pop(e.id):null;if(o.isSome(r))return e.cache=r,s.setDirty(),s.scheduleUpdated(),t.madeProgress(),"continue";if(s.needsNumFeatures(e)){var n=u.createAbortController(),a=s.fetchTileCount(e,n.signal);s._handleRequest(e,a,n,(function(){return e.numFeatures=v.FAILED_FEATURE_COUNT})),i=!0,t.madeProgress()}return t.done?{value:!0}:void 0},s=this,a=0,l=e;a<l.length;a++){var c=n(l[a]);if("object"==typeof c)return c.value}if(i)return t.hasProgressed;for(var p=function(e){if(e.needsFetching){var i=u.createAbortController(),n=d.fetchTile(e,i.signal);if(d._handleRequest(e,n,i,(function(t){e.setFeatures([],0,null),r.invalidateCounts(),e.featuresMissing=!1,r.context.logFetchError(F,t)})),t.madeProgress(),t.done)return{value:!0}}},d=this,h=0,f=e;h<f.length;h++){var y=p(f[h]);if("object"==typeof y)return y.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var r=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(r.setDirty(),!0)})),t.hasProgressed},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.featureTiles.forEach((function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,R),i.intersection(e,V),h.equals(R,V)||r.hideTileFeatures(i))})),this.featureTiles.forEach((function(e){return r.showTile(e)})),this.updated())},t.prototype.updated=function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var r=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",r),r){var i=0,n=0,s=0,a=0,o=0,u=0,l=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++s,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),i=t.displayingFeatures?t.displayingFeatures.length*l:0;u+=r-i}t.needsFetching?++o:t.numFeatures>0&&(++a,n+=t.numFeatures)})),o+=t;var c=0;n?(i=n,c=Math.min(o*n/a,n)):(i=s,c=o),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",i),this._set("updatingRemaining",c),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||performance.now()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.featureTiles.forEach((function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded})),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];n.features&&n.features.length>0&&n.alive&&(t=Math.max(t,n.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<Math.max(0,t-e.descriptor.lij[0]))},i=0,n=0,s=0,a=e;s<a.length;s++){var o=a[s],u=o.numFeatures;i+=u,n+=u*r(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/n,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}})),this.setDirty())},t.prototype.addTile=function(e){var t=new v.FeatureTile(e);return this.featureTiles.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.featureTiles.forEach((function(i){if(i.displayingFeatures&&e!==i&&(!e.descriptor.lij||!i.descriptor.lij||b.tilesAreRelated(e.descriptor.lij,i.descriptor.lij))){e.displayingFeatures=e.displayingFeatures||[];for(var n=0,s=i.displayingFeatures;n<s.length;n++){var a=s[n];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(f.getObjectId(a,t.objectIdField));o.ref(o.feature,r),t.numDisplayingFeatureReferences++}}})),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.removeTile=function(e){this.clearTile(e),this.featureTiles.delete(e.id)},t.prototype.resetFetchTile=function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0},t.prototype.cancelFetchTile=function(e){var t=e.requestController;o.isSome(t)&&(e.requestController=null,e.resetFetching(),t.abort())},t.prototype.fetchTileCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:return i=e,[4,this.fetchCount(e,t)];case 1:return i.numFeatures=r.sent(),this.updateRatio(this.getListOfTiles()),[2,3===e.fetchStatus?1:0]}}))}))},t.prototype.fetchTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,l,c,p,d,h;return r.__generator(this,(function(r){switch(r.label){case 0:return(i=this.maximumFeaturesForTile(e))<=0?[2,S(e)]:(n=this.getMaxRecordCount(e),s=Math.ceil(i/n),w(e)||!this.context.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=i&&s>g.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((a=this.createQuery(e)).maxRecordCountFactor=Math.ceil(i/n),e.isRefetching&&e.features&&e.features.length>0&&(o=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/n),a.maxRecordCountFactor=Math.max(o+1,a.maxRecordCountFactor)),[4,this.queryFeatures(a,t)]));case 1:return u=r.sent(),l=u.features,c=u.exceededTransferLimit,p=u.fields,d=c?a.maxRecordCountFactor>=g.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=l.length<e.numFeatures||c,h=this._removeEmptyFeatures(l),e.setFeatures(l,h,C(p)),this.invalidateCounts(),[2,d]}}))}))},t.prototype.fetchCount=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]}))}))},t.prototype.fetchPagedTile=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,a,o,u,l,c,p,d,h,f,y;return r.__generator(this,(function(r){switch(r.label){case 0:i=0,n=0,a=0,o=this.maximumFeaturesForTile(e)-a,u=this.getMaxRecordCount(e),l=null,r.label=1;case 1:return c=this.createQuery(e),p=this.setPagingParameters(c,i,o,u),[4,this.queryFeatures(c,t)];case 2:return d=r.sent(),h=d.features,f=d.exceededTransferLimit,y=d.fields,p&&(i+=c.num),a+=h.length,n+=this._removeEmptyFeatures(h),e.featuresMissing=i<e.numFeatures||f,s=s?s.concat(h):h,l=O(l,y),e.setFeatures(s,n,l),this.invalidateCounts(),this.setDirty(),o=this.maximumFeaturesForTile(e)-a,!p||!f||o<=0?[2,f?4:5]:[3,1];case 3:return[2]}}))}))},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=h.toExtent(r,i)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor},Object.defineProperty(t.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType},enumerable:!0,configurable:!0}),t.prototype.setResolutionParams=function(e,t){if(this.supportsResolution){var r=this.getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new y.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];f.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&e.needsFeatureCount&&!w(e)},t.prototype.getMaxRecordCount=function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this.useTileQuery(e)&&o.isSome(r)&&r>0&&this.context.capabilities.supportsResultType?r:o.isSome(i)&&i>0?i:T},t.prototype.useTileQuery=function(e){return(!w(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType},t.prototype._handleRequest=function(e,t,r,i){var n=this;e.fetchStatus=e.needsRefetching?3:2,e.requestController=r;var s=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===r&&(e.requestController=null,e.fetchStatus=4),u.isAbortError(t)?s=!0:i(t)})).then((function(){s||n.setDirty(),n.scheduleUpdated()}))},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(l.schedule((function(){e.handles.remove("scheduleUpdated"),e.updated()})),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,s=this.changes.adds,a=Math.min(e.featureLimit,t.length);e.featureLimit=a;for(var o=0;o<a;++o){var u=t[o],l=f.getObjectId(u,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var p=c.ref(u,i);p.oldVersion!==p.newVersion&&(n.removes.push(p.oldVersion),n.adds.push(p.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(u,i)),s.push(u);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,a),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,n=e.displayingFeatures;i<n.length;i++){var s=n[i],a=f.getObjectId(s,this.objectIdField),o=this.displayingFeatureReferences.get(a);if(o){var u=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(a),r.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var s=Math.min(n+P,i);this.features.addMany(t.slice(n,s)),this.features.removeMany(r.slice(n,s)),n=s}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&o.isSome(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.featureTiles.size),t=0;return this.featureTiles.forEach((function(r){return e[t++]=r})),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){return e.update(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}},enumerable:!0,configurable:!0}),r.__decorate([d.property({constructOnly:!0})],t.prototype,"features",void 0),r.__decorate([d.property()],t.prototype,"tileDescriptors",void 0),r.__decorate([d.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([d.property({value:1})],t.prototype,"memoryFactor",null),r.__decorate([d.property({value:1})],t.prototype,"lodFactor",null),r.__decorate([d.property({dependsOn:["context"]})],t.prototype,"useTileCount",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"updating",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),r.__decorate([d.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"totalVertices",null),r.__decorate([d.property({readOnly:!0})],t.prototype,"totalFeatures",null),r.__decorate([d.property()],t.prototype,"filterExtent",null),r.__decorate([d.property({constructOnly:!0})],t.prototype,"context",void 0),r.__decorate([d.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(i);function w(e){return"dummy-tile-full-extent"===e.id}function E(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function S(e){return e.setFeatures([],0,null),e.featuresMissing=!1,4}function C(e){return o.isNone(e)?new Set:c.SetFromValues(e.map((function(e){return e.name})))}function O(e,t){if(o.isNone(e)||o.isNone(t))return C(t);for(var r=new Set,i=0,n=t;i<n.length;i++){var s=n[i].name;e.has(s)&&r.add(s)}return r}t.FeatureTileFetcher3D=x,t.contextCapabilitiesFromLayer=function(e){var t=e.capabilities.query;return{supportsMultipleResolutions:E(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}};var T=2e3,R=h.create(),V=h.create(),j=6e5,P=200;t.default=x}.apply(null,i))||(e.exports=n)},1660:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(5),r(2),r(4),r(92),r(13),r(1),r(66),r(142),r(107),r(304),r(1586),r(1406),r(1398)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y,g){Object.defineProperty(t,"__esModule",{value:!0});var m=n.getLogger("esri.views.layers.FeatureLayerView");t.FeatureLayerView=function(e){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.apply(this,t)||this;return i._updatingRequiredFieldsPromise=null,i.effect=null,i.filter=null,i.layer=null,i.requiredFields=[],i.view=null,i}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;u.init(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","effect","layer.timeInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0)},Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this.layer,t=this.layer.fields,i=this.requiredFields;return"outFields"in e&&e.outFields?c.fixFields(t,r.__spreadArrays(c.unpackFieldNames(t,e.outFields),i)):c.fixFields(t,i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(e){m.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.highlight=function(e,t){throw void 0===t&&(t={}),new Error("missing implementation")},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=s.isSome(this.filter)?this.filter.createQuery(e):new h(e);return this.timeExtent&&(t.timeExtent=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t},t.prototype.queryFeatures=function(e,t){throw new Error("missing implementation")},t.prototype.queryObjectIds=function(e,t){throw new Error("missing implementation")},t.prototype.queryFeatureCount=function(e,t){throw new Error("missing implementation")},t.prototype.queryExtent=function(e,t){throw new Error("missing implementation")},t.prototype._loadArcadeModules=function(e){if(e.get("expressionInfos.length"))return d.loadArcade()},t.prototype._handleRequiredFieldsChange=function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))},t.prototype._updateRequiredFields=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,i,n,u,l,p,d,h,f,y,g,v,b,_;return r.__generator(this,(function(r){switch(r.label){case 0:return this.layer&&this.view?(e="3d"===this.view.type,i=(t=this).layer,n=t.layer,u=n.fields,l=n.objectIdField,p=n.renderer,d=n.displayField,h=i.featureReduction,f=new Set,[4,a.eachAlways([p?p.collectRequiredFields(f,u):null,c.collectLabelingFields(f,i),e?c.collectElevationFields(f,i):null,s.isSome(this.filter)?c.collectFilterFields(f,i,this.filter):null,this.effect?c.collectFilterFields(f,i,this.effect.filter):null,h?c.collectFeatureReductionFields(f,i,h):null])]):[2];case 1:for(y=r.sent(),i.timeInfo&&this.timeExtent&&c.collectFields(f,i.fields,[i.timeInfo.startField,i.timeInfo.endField]),g=0,v=y;g<v.length;g++)(b=v[g]).error&&m.error(b.error);return c.collectField(f,u,l),e&&d&&c.collectField(f,u,d),_=o.valuesOfSet(f).sort(),this._set("requiredFields",_),[2]}}))}))},t.prototype.validateFetchPopupFeatures=function(e){var t=this.layer;return this.layer.popupEnabled?g.getFetchPopupTemplate(this.layer,e)?void 0:new i("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new i("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchClientPopupFeatures=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,o,u,l,p,d,h,f,y,m;return r.__generator(this,(function(r){switch(r.label){case 0:return(t=s.isSome(e)?e.clientGraphics:null)&&0!==t.length?(i=[],n=[],o=this.layer,u=g.getFetchPopupTemplate(o,e),s.isSome(u)?[4,this._loadArcadeModules(u)]:[2,a.resolve([])]):[2,a.resolve([])];case 1:return l=r.sent(),p=l&&l.arcadeUtils.hasGeometryOperations(u),[4,this.createPopupQuery(e)];case 2:for(d=r.sent(),h=c.unpackFieldNames(o.fields,d.outFields),f=0,y=t;f<y.length;f++)m=y[f],p||!c.featureHasFields(h,m)?n.push(m):i.push(m);return"stream"===o.type||0===n.length?[2,a.resolve(i)]:(d.objectIds=n.map((function(e){return e.attributes[o.objectIdField]})),[2,o.queryFeatures(d).then((function(e){return i.concat(e.features)})).catch((function(){return n}))])}}))}))},t.prototype.createPopupQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.layer,(i=t.createQuery()).returnGeometry=!0,i.returnZ=!0,i.returnM=!0,n=i,[4,g.getRequiredFields(this.layer,g.getFetchPopupTemplate(this.layer,e))];case 1:return n.outFields=r.sent(),i.outSpatialReference=this.view.spatialReference,[2,i]}}))}))},t.prototype.canResume=function(){var t;return!(!e.prototype.canResume.call(this)||null!==(t=this.timeExtent)&&void 0!==t&&t.isEmpty)},r.__decorate([l.property()],t.prototype,"_updatingRequiredFieldsPromise",void 0),r.__decorate([l.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null),r.__decorate([l.property({type:f})],t.prototype,"effect",void 0),r.__decorate([l.property({type:y})],t.prototype,"filter",void 0),r.__decorate([l.property(p.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),r.__decorate([l.property()],t.prototype,"layer",void 0),r.__decorate([l.property({type:Number})],t.prototype,"maximumNumberOfFeatures",null),r.__decorate([l.property({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r.__decorate([l.property({readOnly:!0})],t.prototype,"requiredFields",void 0),r.__decorate([l.property({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0),r.__decorate([l.property()],t.prototype,"view",void 0),r.__decorate([l.subclass("esri.views.layers.FeatureLayerView")],t)}(e)}}.apply(null,i))||(e.exports=n)},1661:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(7),r(5),r(2),r(1),r(21),r(706),r(1662)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c){var p=s.getLogger("esri.views.layers.support.ParsedFeatureEffect"),d={grayscale:function(e){var t=1-e.amount,r=l.mat4f32.fromValues(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,1);return u.mat4.transpose(r,r)},sepia:function(e){var t=1-e.amount,r=l.mat4f32.fromValues(.393+.607*t,.769-.769*t,.189-.189*t,0,.349-.349*t,.686+.314*t,.168-.168*t,0,.272-.272*t,.534-.534*t,.131+.869*t,0,0,0,0,1);return u.mat4.transpose(r,r)},saturate:function(e){var t=e.amount,r=l.mat4f32.fromValues(.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return u.mat4.transpose(r,r)},"hue-rotate":function(e){var t=Math.sin(e.angle*Math.PI/180),r=Math.cos(e.angle*Math.PI/180),i=l.mat4f32.fromValues(.213+.787*r-.213*t,.715-.715*r-.715*t,.072-.072*r+.928*t,0,.213-.213*r+.143*t,.715+.285*r+.14*t,.072-.072*r-.283*t,0,.213-.213*r-.787*t,.715-.715*r+.715*t,.072+.928*r+.072*t,0,0,0,0,1);return u.mat4.transpose(i,i)},invert:function(e){var t=1-2*e.amount,r=e.amount,i=l.mat4f32.fromValues(t,0,0,r,0,t,0,r,0,0,t,r,0,0,0,1);return u.mat4.transpose(i,i)},brightness:function(e){var t=e.amount,r=l.mat4f32.fromValues(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return u.mat4.transpose(r,r)},contrast:function(e){var t=e.amount,r=l.mat4f32.fromValues(t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return u.mat4.transpose(r,r)}};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.customTransforms=null,t.done=!0,t}var n;return r.__extends(t,e),n=t,t.fromString=function(e){var t=[],r=null;try{for(var s=0,a=c.parse(e);s<a.length;s++){var o=a[s];"opacity"===o.type?r=o:t.push(o)}}catch(e){p.error(new i("invalid-type","Encountered an error when parsing css",e))}return new n({transforms:t,opacity:r})},t.prototype.getOpacity=function(){return a.isSome(this.opacity)?this.opacity.amount:1},t.prototype.getColorMatrix=function(){var e=this;return(this.transforms||[]).map((function(e){return r.__assign({},e)})).reverse().reduce((function(t,r){return u.mat4.multiply(t,t,e._getFactory(r)(r))}),l.mat4f32.create())},t.prototype.clone=function(){return new n({transforms:this.transforms&&this.transforms.map((function(e){return r.__assign({},e)})),customTransforms:this.customTransforms&&this.customTransforms.map((function(e){return r.__assign({},e)}))})},t.prototype._getFactory=function(e){var t=d[e.type];if(t)return t;if(this.customTransforms)for(var r=function(t){if(t.type===e.type){var r=l.mat4f32.fromValues.apply(l.mat4f32,t.matrix),i=u.mat4.transpose(r,r);return{value:function(){return i}}}},i=0,n=this.customTransforms;i<n.length;i++){var s=r(n[i]);if("object"==typeof s)return s.value}return p.error("invalid-type","No effect "+e.type+" exists"),function(){return l.mat4f32.create()}},r.__decorate([o.property()],t.prototype,"opacity",void 0),r.__decorate([o.property()],t.prototype,"transforms",void 0),r.__decorate([o.property()],t.prototype,"customTransforms",void 0),n=r.__decorate([o.subclass("esri.views.layers.support.ParsedFeatureEffect")],t)}(n.JSONSupport)}.apply(null,i))||(e.exports=n)},1662:function(e,t,r){var i,n,s;n=[],void 0===(s="function"==typeof(i=function(){"use strict";function e(t,r,i,n){this.message=t,this.expected=r,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}return"Expected "+function(e){var t,i,n,s=new Array(e.length);for(t=0;t<e.length;t++)s[t]=(n=e[t],r[n.type](n));if(s.sort(),s.length>0){for(t=1,i=1;t<s.length;t++)s[t-1]!==s[t]&&(s[i]=s[t],i++);s.length=i}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,n={},s={start:je},a=je,o=Oe("none"),u=Se("none",!1),l=Oe("blur()"),c=Se("blur(",!1),p=Se(")",!1),d=Oe("brightness()"),h=Se("brightness(",!1),f=Oe("contrast()"),y=Se("contrast(",!1),g=Oe("drop-shadow()"),m=Se("drop-shadow(",!1),v=Oe("grayscale()"),b=Se("grayscale(",!1),_=Oe("hue-rotate()"),F=Se("hue-rotate(",!1),x=Oe("invert()"),w=Se("invert(",!1),E=Oe("opacity()"),S=Se("opacity(",!1),C=Oe("saturate()"),O=Se("saturate(",!1),T=Oe("sepia()"),R=Se("sepia(",!1),V=Oe("<number-percentage>"),j=Oe("<integer>"),P=/^[0-9]/,I=Ce([["0","9"]],!1,!1),D=Oe("<number>"),M=Se(".",!1),A=function(){return parseFloat(Ee())},N=Oe("<signedNumber>"),U=/^[+\-]/,q=Ce(["+","-"],!1,!1),L=Se("%",!1),k=Oe("<angle>"),G=function(e,t){return e*t},Q=Se("0",!1),z=Oe("<unit>"),H=Se("deg",!1),B=Se("grad",!1),J=Se("rad",!1),Z=Se("turn",!1),X=Oe("<length>"),W=Se("px",!1),Y=Se("cm",!1),K=Se("mm",!1),$=Se("Q",!1),ee=Se("in",!1),te=Se("pc",!1),re=Se("pt",!1),ie=Se("#",!1),ne=Se("rgba(",!1),se=Se(",",!1),ae=function(e,t,r){return[255*e,255*t,255*r,1]},oe=function(e,t,r){return[e,t,r,1]},ue=Se("rgb(",!1),le=/^[0-9a-fA-F]/,ce=Ce([["0","9"],["a","f"],["A","F"]],!1,!1),pe=Oe("whitespace"),de=/^[ \t\n\r]/,he=Ce([" ","\t","\n","\r"],!1,!1),fe=Oe("<named-color>"),ye=/^[a-z]/,ge=Ce([["a","z"]],!1,!1),me=function(){var t=Ee();return Ge.has(t)||function(t,r){throw function(t,r){return new e(t,null,null,r)}(t,r=void 0!==r?r:Re(be,ve))}('unknown color "'+t+'"'),ke[t].concat(1)},ve=0,be=0,_e=[{line:1,column:1}],Fe=0,xe=[],we=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=s[r.startRule]}function Ee(){return t.substring(be,ve)}function Se(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ce(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Oe(e){return{type:"other",description:e}}function Te(e){var r,i=_e[e];if(i)return i;for(r=e-1;!_e[r];)r--;for(i={line:(i=_e[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return _e[e]=i,i}function Re(e,t){var r=Te(e),i=Te(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function Ve(e){ve<Fe||(ve>Fe&&(Fe=ve,xe=[]),xe.push(e))}function je(){var e;return(e=function(){var e,r;return we++,e=ve,Le()!==n?("none"===t.substr(ve,4)?(r="none",ve+=4):(r=n,0===we&&Ve(u)),r!==n&&Le()!==n?(be=e,e=null):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(o),e}())===n&&(e=function(){var e,t;if(e=[],(t=Pe())!==n)for(;t!==n;)e.push(t),t=Pe();else e=n;return e}()),e}function Pe(){var e;return(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("blur("===t.substr(ve,5)?(r="blur(",ve+=5):(r=n,0===we&&Ve(c)),r!==n&&Le()!==n&&(i=Ne())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"blur",radius:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(l),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("brightness("===t.substr(ve,11)?(r="brightness(",ve+=11):(r=n,0===we&&Ve(h)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"brightness",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(d),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("contrast("===t.substr(ve,9)?(r="contrast(",ve+=9):(r=n,0===we&&Ve(y)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"contrast",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(f),e}())===n&&(e=function(){var e,r,i,s,a,o,u;return we++,e=ve,Le()!==n?("drop-shadow("===t.substr(ve,12)?(r="drop-shadow(",ve+=12):(r=n,0===we&&Ve(m)),r!==n&&Le()!==n&&(i=Ne())!==n&&Le()!==n&&(s=Ne())!==n&&Le()!==n?((a=Ne())===n&&(a=null),a!==n&&Le()!==n?((o=function(){var e,r,i,s,a,o,u,l,c,d,h,f,y,g,m,v,b;return e=ve,35===t.charCodeAt(ve)?(r="#",ve++):(r=n,0===we&&Ve(ie)),r!==n?(i=ve,(s=qe())!==n&&(a=qe())!==n?i=s=[s,a]:(ve=i,i=n),i!==n?(s=ve,(a=qe())!==n&&(o=qe())!==n?s=a=[a,o]:(ve=s,s=n),s!==n?(a=ve,(o=qe())!==n&&(u=qe())!==n?a=o=[o,u]:(ve=a,a=n),a!==n?(be=e,v=s,b=a,e=r=[parseInt(i.join(""),16),parseInt(v.join(""),16),parseInt(b.join(""),16)]):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,35===t.charCodeAt(ve)?(r="#",ve++):(r=n,0===we&&Ve(ie)),r!==n&&(i=qe())!==n&&(s=qe())!==n&&(a=qe())!==n?(be=e,r=function(e,t,r){return[parseInt([e,e].join(""),16),parseInt([t,t].join(""),16),parseInt([r,r].join(""),16)]}(i,s,a),e=r):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Ve(ne)),r!==n&&(i=Le())!==n&&(s=Me())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=Me())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=Me())!==n&&(h=Le())!==n?(44===t.charCodeAt(ve)?(f=",",ve++):(f=n,0===we&&Ve(se)),f!==n&&(y=Le())!==n&&(g=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(m=")",ve++):(m=n,0===we&&Ve(p)),m!==n?(be=e,e=r=function(e,t,r,i){return[255*e,255*t,255*r,i]}(s,l,d,g)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Ve(ne)),r!==n&&(i=Le())!==n&&(s=De())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=De())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=De())!==n?(44===t.charCodeAt(ve)?(h=",",ve++):(h=n,0===we&&Ve(se)),h!==n&&(f=Le())!==n&&(y=Ie())!==n?(41===t.charCodeAt(ve)?(g=")",ve++):(g=n,0===we&&Ve(p)),g!==n?(be=e,e=r=function(e,t,r,i){return[e,t,r,i]}(s,l,d,y)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Ve(ne)),r!==n&&(i=Le())!==n&&(s=Me())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=Me())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=Me())!==n&&(h=Le())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Ve(p)),f!==n?(be=e,e=r=ae(s,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgba("===t.substr(ve,5)?(r="rgba(",ve+=5):(r=n,0===we&&Ve(ne)),r!==n&&(i=Le())!==n&&(s=De())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=De())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=De())!==n?(41===t.charCodeAt(ve)?(h=")",ve++):(h=n,0===we&&Ve(p)),h!==n?(be=e,e=r=oe(s,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgb("===t.substr(ve,4)?(r="rgb(",ve+=4):(r=n,0===we&&Ve(ue)),r!==n&&(i=Le())!==n&&(s=Me())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=Me())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=Me())!==n&&(h=Le())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Ve(p)),f!==n?(be=e,e=r=ae(s,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=ve,"rgb("===t.substr(ve,4)?(r="rgb(",ve+=4):(r=n,0===we&&Ve(ue)),r!==n&&(i=Le())!==n&&(s=De())!==n&&(a=Le())!==n?(44===t.charCodeAt(ve)?(o=",",ve++):(o=n,0===we&&Ve(se)),o!==n&&(u=Le())!==n&&(l=De())!==n&&Le()!==n?(44===t.charCodeAt(ve)?(c=",",ve++):(c=n,0===we&&Ve(se)),c!==n&&Le()!==n&&(d=De())!==n&&(h=Le())!==n?(41===t.charCodeAt(ve)?(f=")",ve++):(f=n,0===we&&Ve(p)),f!==n?(be=e,e=r=oe(s,l,d)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),e===n&&(e=function(){var e,r,i;if(we++,e=ve,r=[],ye.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(ge)),i!==n)for(;i!==n;)r.push(i),ye.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(ge));else r=n;return r!==n&&(be=e,r=me()),we--,(e=r)===n&&(r=n,0===we&&Ve(fe)),e}())))))))),e}())===n&&(o=null),o!==n&&Le()!==n?(41===t.charCodeAt(ve)?(u=")",ve++):(u=n,0===we&&Ve(p)),u!==n&&Le()!==n?(be=e,e={type:"drop-shadow",offsetX:i,offsetY:s,blurRadius:a,color:o}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(g),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("grayscale("===t.substr(ve,10)?(r="grayscale(",ve+=10):(r=n,0===we&&Ve(b)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"grayscale",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(v),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("hue-rotate("===t.substr(ve,11)?(r="hue-rotate(",ve+=11):(r=n,0===we&&Ve(F)),r!==n&&Le()!==n&&(i=function(){var e,r,i;return we++,e=ve,(r=function(){var e,r;return we++,e=ve,U.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Ve(q)),r===n&&(r=null),r!==n&&De()!==n?(be=e,e=r=A()):(ve=e,e=n),we--,e===n&&(r=n,0===we&&Ve(N)),e}())!==n&&(i=Ae())!==n?(be=e,e=r=G(r,i)):(ve=e,e=n),e===n&&(e=ve,48===t.charCodeAt(ve)?(r="0",ve++):(r=n,0===we&&Ve(Q)),r!==n?((i=Ae())===n&&(i=null),i!==n?(be=e,e=r=0):(ve=e,e=n)):(ve=e,e=n)),we--,e===n&&(r=n,0===we&&Ve(k)),e}())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"hue-rotate",angle:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(_),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("invert("===t.substr(ve,7)?(r="invert(",ve+=7):(r=n,0===we&&Ve(w)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"invert",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(x),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("opacity("===t.substr(ve,8)?(r="opacity(",ve+=8):(r=n,0===we&&Ve(S)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"opacity",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(E),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("saturate("===t.substr(ve,9)?(r="saturate(",ve+=9):(r=n,0===we&&Ve(O)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"saturate",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(C),e}())===n&&(e=function(){var e,r,i,s;return we++,e=ve,Le()!==n?("sepia("===t.substr(ve,6)?(r="sepia(",ve+=6):(r=n,0===we&&Ve(R)),r!==n&&Le()!==n&&(i=Ie())!==n&&Le()!==n?(41===t.charCodeAt(ve)?(s=")",ve++):(s=n,0===we&&Ve(p)),s!==n&&Le()!==n?(be=e,e={type:"sepia",amount:i}):(ve=e,e=n)):(ve=e,e=n)):(ve=e,e=n),we--,e===n&&0===we&&Ve(T),e}()),e}function Ie(){var e;return we++,(e=Me())===n&&(e=De()),we--,e===n&&0===we&&Ve(V),e}function De(){var e,r,i,s,a;if(we++,e=ve,r=[],P.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(I)),i!==n)for(;i!==n;)r.push(i),P.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(I));else r=n;if(r!==n)if(46===t.charCodeAt(ve)?(i=".",ve++):(i=n,0===we&&Ve(M)),i!==n){if(s=[],P.test(t.charAt(ve))?(a=t.charAt(ve),ve++):(a=n,0===we&&Ve(I)),a!==n)for(;a!==n;)s.push(a),P.test(t.charAt(ve))?(a=t.charAt(ve),ve++):(a=n,0===we&&Ve(I));else s=n;s!==n?(be=e,e=r=A()):(ve=e,e=n)}else ve=e,e=n;else ve=e,e=n;return e===n&&(e=function(){var e,r,i;if(we++,e=ve,r=[],P.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(I)),i!==n)for(;i!==n;)r.push(i),P.test(t.charAt(ve))?(i=t.charAt(ve),ve++):(i=n,0===we&&Ve(I));else r=n;return r!==n&&(be=e,r=parseInt(Ee(),10)),we--,(e=r)===n&&(r=n,0===we&&Ve(j)),e}()),we--,e===n&&(r=n,0===we&&Ve(D)),e}function Me(){var e,r,i;return e=ve,(r=De())!==n?(37===t.charCodeAt(ve)?(i="%",ve++):(i=n,0===we&&Ve(L)),i!==n?(be=e,e=r/=100):(ve=e,e=n)):(ve=e,e=n),e}function Ae(){var e,r;return we++,e=ve,"deg"===t.substr(ve,3)?(r="deg",ve+=3):(r=n,0===we&&Ve(H)),r!==n&&(be=e,r=1),(e=r)===n&&(e=ve,"grad"===t.substr(ve,4)?(r="grad",ve+=4):(r=n,0===we&&Ve(B)),r!==n&&(be=e,r=.9),(e=r)===n&&(e=ve,"rad"===t.substr(ve,3)?(r="rad",ve+=3):(r=n,0===we&&Ve(J)),r!==n&&(be=e,r=180/Math.PI),(e=r)===n&&(e=ve,"turn"===t.substr(ve,4)?(r="turn",ve+=4):(r=n,0===we&&Ve(Z)),r!==n&&(be=e,r=1/360),e=r))),we--,e===n&&(r=n,0===we&&Ve(z)),e}function Ne(){var e,r,i;return we++,e=ve,(r=De())!==n&&(i=Ue())!==n?(be=e,e=r=G(r,i)):(ve=e,e=n),e===n&&(e=ve,48===t.charCodeAt(ve)?(r="0",ve++):(r=n,0===we&&Ve(Q)),r!==n?((i=Ue())===n&&(i=null),i!==n?(be=e,e=r=0):(ve=e,e=n)):(ve=e,e=n)),we--,e===n&&(r=n,0===we&&Ve(X)),e}function Ue(){var e,r;return e=ve,"px"===t.substr(ve,2)?(r="px",ve+=2):(r=n,0===we&&Ve(W)),r!==n&&(be=e,r=1),(e=r)===n&&(e=ve,"cm"===t.substr(ve,2)?(r="cm",ve+=2):(r=n,0===we&&Ve(Y)),r!==n&&(be=e,r=96/2.54),(e=r)===n&&(e=ve,"mm"===t.substr(ve,2)?(r="mm",ve+=2):(r=n,0===we&&Ve(K)),r!==n&&(be=e,r=96/2.54/10),(e=r)===n&&(e=ve,81===t.charCodeAt(ve)?(r="Q",ve++):(r=n,0===we&&Ve($)),r!==n&&(be=e,r=96/2.54/40),(e=r)===n&&(e=ve,"in"===t.substr(ve,2)?(r="in",ve+=2):(r=n,0===we&&Ve(ee)),r!==n&&(be=e,r=96),(e=r)===n&&(e=ve,"pc"===t.substr(ve,2)?(r="pc",ve+=2):(r=n,0===we&&Ve(te)),r!==n&&(be=e,r=16),(e=r)===n&&(e=ve,"pt"===t.substr(ve,2)?(r="pt",ve+=2):(r=n,0===we&&Ve(re)),r!==n&&(be=e,r=96/73),e=r)))))),e}function qe(){var e;return le.test(t.charAt(ve))?(e=t.charAt(ve),ve++):(e=n,0===we&&Ve(ce)),e}function Le(){var e,r;for(we++,e=[],de.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Ve(he));r!==n;)e.push(r),de.test(t.charAt(ve))?(r=t.charAt(ve),ve++):(r=n,0===we&&Ve(he));return we--,e===n&&(r=n,0===we&&Ve(pe)),e}var ke={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},Ge=new Set(Object.keys(ke));if((i=a())!==n&&ve===t.length)return i;throw i!==n&&ve<t.length&&Ve({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(xe,Fe<t.length?t.charAt(Fe):null,Fe<t.length?Re(Fe,Fe+1):Re(Fe,Fe))}}})?i.apply(null,n):i)||(e.exports=s)},1663:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(1),r(21)],void 0===(n=function(e,t,r,i,n,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.from=null,t.to=null,t.duration=4e3,t.repeat=!0,t.done=!1,t}var i;return r.__extends(t,e),i=t,t.prototype.getColorMatrix=function(){if(this.done=!1,null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var e=this._lastTime,t=Date.now(),r=t-e;this._currentStep=this._currentStep+r,this._currentStep>=2147483647&&(this._currentStep=0),this._lastTime=t}var i=this._currentStep%this.duration/(this.duration/2),n=i<=1?i:2-i,a=this.from.getColorMatrix(),o=this.to.getColorMatrix();return s.mat4.multiplyScalar(a,a,1-n),s.mat4.multiplyScalar(o,o,n),!this.repeat&&this._currentStep>=this.duration&&(this.done=!0),s.mat4.add(a,a,o)},t.prototype.getOpacity=function(){throw new Error("No getOpacity definition for Transition")},t.prototype.clone=function(){var e=new i({from:this.from.clone(),to:this.to.clone(),duration:this.duration});return e._lastTime=this._lastTime,e._currentStep=this._currentStep,e},r.__decorate([n.property()],t.prototype,"from",void 0),r.__decorate([n.property()],t.prototype,"to",void 0),r.__decorate([n.property({type:Number})],t.prototype,"duration",void 0),r.__decorate([n.property({type:Boolean})],t.prototype,"repeat",void 0),i=r.__decorate([n.subclass("esri.views.layers.support.Transition")],t)}(i)}.apply(null,i))||(e.exports=n)},1676:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(106)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;s.oldVersion=i,this.feature&&(e.uid=this.feature.uid);for(var n=0,a=this.versions;n<a.length;n++){var o=a[n];if(o.resolution===t){o.refCount++;var u=this.highestResolutionVersion===o&&!r.equals(e,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=e),s.newVersion=u?e:i,s}}var l={feature:e,resolution:t,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(s.newVersion=e,this.highestResolutionVersion=l):s.newVersion=i,s},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,s.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),s.oldVersion=r.feature)),s.newVersion=this.feature,s}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var n=function(){function e(e){this._feature=e,this.refCount=1}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e){return++this.refCount,s.oldVersion=this._feature,this.feature&&(e.uid=this.feature.uid),r.equals(this._feature,e)||(this._feature=e),s.newVersion=this._feature,s},e.prototype.unref=function(){return s.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(s.newVersion=null,s):(s.newVersion=this._feature,s)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=n;var s={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=n)},1677:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(30),r(2),r(34),r(106)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var a=new Set,o=function(){function e(e){this.descriptor=e,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=u,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=a,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableFields",{get:function(){return this._availableFields},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t,r){this._availableFields=i.unwrapOr(r,a),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+s.numVertices(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures>u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===u},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=s.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=s.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),e.prototype.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0},Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(n.fromExtent(e,l),n.intersects(this.descriptor.extent,l))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(n.fromExtent(e,t),this.descriptor.extent&&n.intersection(t,this.descriptor.extent,t)):n.set(t,this.descriptor.extent),t):(n.set(t,n.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort((function(t,r){return s.getObjectId(t,e)-s.getObjectId(r,e)})),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t,r){if(e<=0)return!1;var i=!1;if(this._features){this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,i=!0)),!this._shuffled&&e<1&&this._shuffle(r);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))}else this.featureLimit=0;return i},Object.defineProperty(e.prototype,"cache",{get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},enumerable:!0,configurable:!0}),e}();t.FeatureTile=o;var u=-1;t.FAILED_FEATURE_COUNT=-2;var l=n.create()}.apply(null,i))||(e.exports=n)},1678:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(91),r(174),r(244),r(425),r(426),r(187),r(197)],void 0===(n=function(e,t,r,i,n,s,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map((function(e){return new a(new n({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new a(new n({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new n({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new n({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,n=[];e.forEach((function(e,r){var s=i.tileFetcher.test.getFeatureTileById(r);s&&t.filter(s)||(i.view.graphics.removeMany(e),n.push(r))})),n.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(n){if(t.filter(n)&&!e.has(n.id)){var a=n.descriptor.lij,u=a[0],l=a[1],c=a[2];i.tilingScheme.ensureMaxLod(u);var p=i.tilingScheme.getExtentGeometry(u,l,c),d=[new r({geometry:p,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:p.center,symbol:new s({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(n.id,d),i.view.graphics.addMany(d)}}))},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,i))||(e.exports=n)},1679:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(11),r(2),r(4),r(13),r(1),r(106),r(1588),r(441),r(304),r(1533),r(1460),r(1410),r(100)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l,c,p,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureLikeLayerView3D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controller=null,t.asyncGraphicsUpdates=!1,t.suspendResumeExtentMode="computed",t.slicePlaneEnabled=!1,t.drapeSourceType=1,t.fullExtentInLocalViewSpatialReference=null,t.suspendResumeExtent=null,t._controllerCreated=!1,t.clippingExtent=null,t.supportsHeightUnitConversion=!0,t.pendingController=null,t.queryEngine=null,t}return r.__extends(t,e),t.prototype.initialize=function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(s.reject(new i("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this._set("graphics3d",new d.default({owner:this,layer:t,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",(function(t){e.graphics3d.graphicsCore.preferredUpdatePolicy=t?1:0})),this.updatingHandles.add(this,"suspendResumeExtentMode",(function(t){e.graphics3d.suspendResumeExtentMode=t})),this.addResolvingPromise(this.graphics3d.setup().then((function(){return e.validateGeometryType()})).then((function(){return e.queryEngine=new h.default({layerView:e,task:y.Task.FEATURE_QUERY_ENGINE})})).then((function(){return f.toViewIfLocal(e)})).then((function(t){return e.fullExtentInLocalViewSpatialReference=t})).then((function(){return e.initializeController()}))),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},t.prototype.notifyGraphicUpdate=function(e,t){this.graphics3d.graphicsCore.notifyGraphicUpdate(e,t)},t.prototype.getRenderingInfo=function(e,t,r){var i=c.getRenderingInfo(e,{renderer:t,arcade:r});if(i&&i.color){var n=i.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return i},t.prototype.getRenderingInfoAsync=function(e,t,i,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(s){return[2,c.getRenderingInfoAsync(e,r.__assign({renderer:t,arcade:i},n))]}))}))},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach((function(i){i.uid===e&&(r=u.hydrateGraphic(i,t.layer))})),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.computeAttachmentOrigin=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null},t.prototype.getSymbolLayerSize=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null},t.prototype.queryFeatures=function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryObjectIds=function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryFeatureCount=function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),n.get(t,"signal"))},t.prototype.queryExtent=function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),n.get(t,"signal"))},t.prototype._ensureQuery=function(e){return n.isNone(e)?this.createQuery():p.from(e)},t.prototype.highlight=function(e){return this.graphics3d.highlight(e,this.layer.objectIdField)},t.prototype.canResume=function(){return!(!e.prototype.canResume.call(this)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.getSuspendInfo=function(){var t=e.prototype.getSuspendInfo.call(this);return this.graphics3d?r.__assign(r.__assign({},t),this.graphics3d.suspendInfo):t},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed||!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)},t.prototype.initializeController=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}}))}))},t.prototype.setControllerWhenInitialized=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,a.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}}))}))},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return s.reject(new i("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}},t.prototype._getResourceInfo=function(){var e=this.controller&&this.controller instanceof l?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return this._getResourceInfo()},enumerable:!0,configurable:!0}),r.__decorate([o.property()],t.prototype,"loadedGraphics",void 0),r.__decorate([o.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),r.__decorate([o.property({dependsOn:["graphics3d.updating","controller.updating"]})],t.prototype,"updating",void 0),r.__decorate([o.property()],t.prototype,"controller",void 0),r.__decorate([o.property()],t.prototype,"graphics3d",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r.__decorate([o.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),r.__decorate([o.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),r.__decorate([o.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],t.prototype,"suspendInfo",void 0),r.__decorate([o.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r.__decorate([o.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(e)}}.apply(null,i))||(e.exports=n)},1680:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(38),r(92)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new Set,t}return r.__extends(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._set.add(i)}this.emit("after-changes",{type:1}),this.emit("change",{added:e,removed:[]})}},t.prototype.remove=function(e){this._set.delete(e)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[e]}))},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];this._set.delete(n)&&t.push(n)}t.length>0&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:t}))},t.prototype.toArray=function(){return n.valuesOfSet(this._set)},t.prototype.find=function(e){var t;return n.someSet(this._set,(function(r){return!!e(r)&&(t=r,!0)})),t},t.prototype.forEach=function(e){this._set.forEach((function(t){return e(t)}))},t}(i);t.EventedSet=s}.apply(null,i))||(e.exports=n)},1994:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1589),r(1995)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.memoryCache=null,this._capabilities=null;var t=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=t.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM;var r=this.layerView.view.resourceController;this.query=n.createFeatureTileQuery3D(t,r.scheduler),"hasService"in t&&t.hasService&&r&&(this.memoryCache=r.memoryController.getMemCache(t.uid))}return e.prototype.destroy=function(){r.isSome(this.memoryCache)&&this.memoryCache.destroy(),this.query.destroy()},e.prototype.createQuery=function(){var e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e},Object.defineProperty(e.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scheduler",{get:function(){var e=this.layerView.view.resourceController;return e?e.scheduler:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileMaxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.maxRecordCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capabilities",{get:function(){return r.isSome(this._capabilities)||(this._capabilities=i.contextCapabilitiesFromLayer(this.layerView.layer)),this._capabilities},enumerable:!0,configurable:!0}),e.prototype.logFetchError=function(e,t){e.error("#fetchTile()",this.layerView.layer,t&&t.message?t.message:t)},e}();t.FeatureTileFetcher3DLayerViewContext=s}.apply(null,i))||(e.exports=n)},1995:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(9),r(2),r(4),r(1),r(106),r(432),r(1996)],void 0===(n=function(e,t,r,i,n,s,a,o,u,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),Object.defineProperty(t.prototype,"queryFeaturesDehydrated",{get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){n.isNone(this._decoder)&&(this._decoder=new l.PBFDecoder(this.scheduler));var i={type:"dehydrated",sourceSpatialReference:this.layer.spatialReference?this.layer.spatialReference.toJSON():null,applyTransform:!0,maxStringAttributeLength:1024};return function(t,r){return u.runQuery(e.layer.parsedUrl,t,"pbf",r).then((function(t){return s.throwIfAborted(r),n.isSome(e._decoder)?e._decoder.invoke({buffer:t.data,options:i}):s.reject(s.createAbortError())}))}}return function(t,r){return u.executeQuery(e.layer.parsedUrl,t,e.layer.spatialReference,r).then((function(e){return o.fromFeatureSetJSON(e.data)}))}},enumerable:!0,configurable:!0}),t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},t.prototype.destroy=function(){this._decoder=n.destroyMaybe(this._decoder)},r.__decorate([a.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([a.property({constructOnly:!0})],t.prototype,"scheduler",void 0),r.__decorate([a.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],t.prototype,"queryFeaturesDehydrated",null),r.__decorate([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(i),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.queryFeaturesDehydrated=function(e,t){return this.layer.queryFeatures(e,t)},r.__decorate([a.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(i),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.destroy=function(){},t.prototype.queryFeaturesDehydrated=function(e,t){var r=this;return this.source.queryFeaturesJSON(e,t).then(o.fromFeatureSetJSON,(function(i){if(i&&"query-features-json:unsupported"===i.name)return r.layer.queryFeatures(e,t);throw i}))},t.prototype.queryFeatureCount=function(e,t){return this.layer.queryFeatureCount(e,t)},r.__decorate([a.property({constructOnly:!0})],t.prototype,"layer",void 0),r.__decorate([a.aliasOf("layer.source")],t.prototype,"source",void 0),r.__decorate([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],t)}(i);t.createFeatureTileQuery3D=function(e,t){switch(e.source.type){case"feature-layer":return new c({layer:e,scheduler:t});case"memory":case"csv":case"geojson":return new d({layer:e});case"ogc-feature":return new p({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}}.apply(null,i))||(e.exports=n)},1996:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(0),r(91),r(4),r(40),r(237),r(710)],void 0===(n=function(e,t,r,i,n,s,a,o){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this._handle=new l(e)}return e.prototype.destroy=function(){this._handle.destroy()},e.prototype.invoke=function(e,t){return void 0===t&&(t=null),e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof s&&(e.options=r.__assign(r.__assign({},e.options),{sourceSpatialReference:e.options.sourceSpatialReference.toJSON()})),this._handle.invoke(e,t).then((function(e){if(e.spatialReference=s.fromJSON(e.spatialReference),e.fields)for(var t=0;t<e.fields.length;t++)e.fields[t]=a.fromJSON(e.fields[t]);for(var r=e.spatialReference,n=0,o=e.features;n<o.length;n++){var u=o[n];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=r)}return e}))):n.resolve(null)},e}();t.PBFDecoder=u;var l=function(e){function t(t){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",t,{strategy:"dedicated"})||this}return r.__extends(t,e),t.prototype.getTransferList=function(e){return[e.buffer]},t}(o.WorkerHandle)}.apply(null,i))||(e.exports=n)}}]);