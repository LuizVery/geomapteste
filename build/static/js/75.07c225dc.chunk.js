(this.webpackJsonpgeowebmap=this.webpackJsonpgeowebmap||[]).push([[75],{1378:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return R}));var r,n=i(3),a=i(4),s=i(6),u=i(7),c=i(0),o=i(20),l=i(1),h=(i(17),i(18),i(16),i(9)),d=i(14),f=(i(112),i(119)),p=i(32),y=i(185),b=i(2),v=i(202),g=i(1170),m=i(1210),O=i(986),j=i(289),x=r=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return Object(a.a)(i,[{key:"getObjectId",value:function(){return this.objectId}},{key:"clone",value:function(){return new r(Object(d.a)({objectId:this.objectId},this.cloneProperties()))}}]),i}(f.a);Object(c.a)([Object(l.b)({type:Number,json:{read:!0}})],x.prototype,"objectId",void 0),x=r=Object(c.a)([Object(h.a)("esri.layers.graphics.controllers.StreamGraphic")],x);var k=function(){function e(t){Object(n.a)(this,e),this.onUpdate=t,this._idToGraphic=new Map}return Object(a.a)(e,[{key:"destroy",value:function(){this._idToGraphic.clear()}},{key:"add",value:function(e){this._idToGraphic.set(e.objectId,e)}},{key:"get",value:function(e){return this._idToGraphic.get(e)}},{key:"forEach",value:function(e){this._idToGraphic.forEach(e)}},{key:"removeById",value:function(e){var t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}},{key:"update",value:function(e,t){this.onUpdate(e,t)}},{key:"size",get:function(){return this._idToGraphic.size}}]),e}(),F=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments))._updateInfo={websocket:0,client:0},e.graphics=new O.a,e}return Object(a.a)(i,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this.layer.when((function(){return e._startup()})))}},{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}},{key:"updating",get:function(){return!this.connection||"connected"===this.connection.connectionStatus}},{key:"_startup",value:function(){var e=this,t=this.layer,i=t.parsedUrl,r=t.spatialReference,n=t.definitionExpression,a=t.geometryDefinition,s=t.objectIdField,u=t.timeInfo,c=t.purgeOptions,o=t.maxReconnectionAttempts,l=t.maxReconnectionInterval,h=t.updateInterval,d=j.a.toJSON(this.layer.geometryType),f=r,p=this.layerView.view.spatialReference,y={geometry:a,where:n};this.clear(),this._set("connection",Object(m.a)(i,f,p,d,y,o,l)),this._outSpatialReference=p.toJSON(),this.store=new k(this._onUpdate.bind(this)),this.featuresManager=new g.a(this.store,s,u.toJSON(),c),this.handles.add([this.connection.on("feature",(function(t){return e._onFeature(t)})),this.layer.watch("definitionExpression",(function(){return e._startup()})),this.layer.watch("geometryDefinition",(function(){return e._startup()})),this.layer.watch("purgeOptions",(function(){return e._startup()}))]);var b=performance.now();this._updateIntervalId=setInterval((function(){var t=performance.now(),i=t-b;if(i>2500){b=t;var r=Math.round(e._updateInfo.client/(i/1e3)),n=Math.round(e._updateInfo.websocket/(i/1e3));e._updateInfo.client=0,e._updateInfo.websocket=0,e.layerView.emit("update-rate",{client:r,websocket:n})}e.featuresManager.checkForUpdates()}),h)}},{key:"_onFeature",value:function(e){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{Object(b.k)(e.geometry)&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);var t=x.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch(i){}}},{key:"_onUpdate",value:function(e,t){Object(b.k)(t)&&this.graphics.removeMany(t),Object(b.k)(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}}]),i}(Object(y.b)(Object(v.b)(p.a)));Object(c.a)([Object(l.b)()],F.prototype,"connection",void 0),Object(c.a)([Object(l.b)()],F.prototype,"layer",void 0),Object(c.a)([Object(l.b)()],F.prototype,"layerView",void 0),Object(c.a)([Object(l.b)({readOnly:!0})],F.prototype,"updating",null);var w=F=Object(c.a)([Object(h.a)("esri.layers.graphics.controllers.StreamController")],F),_=i(163),E=i(985),S=i(693),C=i(686),T=i(925),I=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).type="stream-3d",e.updatePolicy=0,e.hasZ=!0,e.hasM=!1,e}return Object(a.a)(i,[{key:"connectionError",get:function(){var e=this.get("controller.connection.errorString");if(e)return new o.a("stream-controller",e)}},{key:"createQuery",value:function(){return new _.a({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}},{key:"queryLatestObservations",value:function(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),null==t?void 0:t.signal)}},{key:"createController",value:function(){return new w({layer:this.layer,layerView:this})}},{key:"beforeSetController",value:function(){}}]),i}(function(e){var t=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){var e;Object(n.a)(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).connectionError=null,e.connectionStatus="disconnected",e.filter=null,e}return i}(e);return Object(c.a)([Object(l.b)({readOnly:!0})],t.prototype,"connectionError",void 0),Object(c.a)([Object(l.b)({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),Object(c.a)([Object(l.b)({type:T.a})],t.prototype,"filter",void 0),t=Object(c.a)([Object(h.a)("esri.layers.mixins.StreamLayerView")],t)}(Object(E.a)(Object(S.a)(C.a))));Object(c.a)([Object(l.b)({readOnly:!0})],I.prototype,"updatePolicy",void 0),Object(c.a)([Object(l.b)({readOnly:!0})],I.prototype,"connectionError",null),Object(c.a)([Object(l.b)()],I.prototype,"controller",void 0),Object(c.a)([Object(l.b)({readOnly:!0})],I.prototype,"hasZ",void 0),Object(c.a)([Object(l.b)({readOnly:!0})],I.prototype,"hasM",void 0);var R=I=Object(c.a)([Object(h.a)("esri.views.3d.layers.StreamLayerView3D")],I)},925:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var r,n=i(14),a=i(3),s=i(4),u=i(6),c=i(7),o=i(0),l=i(112),h=i(164),d=i(57),f=i(25),p=i(26),y=i(1),b=(i(18),i(17),i(16),i(9)),v=i(43),g=i(77),m=i(163),O=new d.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),j=new d.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),x=r=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){var r;return Object(a.a)(this,i),(r=t.call(this,e)).where=null,r.geometry=null,r.spatialRelationship="intersects",r.hiddenIds=new Set,r.distance=void 0,r.objectIds=null,r.units=null,r.timeExtent=null,r.enabled=!1,r}return Object(s.a)(i,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,i=this.geometry,r=this.spatialRelationship,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance;return new m.a(Object(n.a)({geometry:Object(p.a)(i),objectIds:Object(p.a)(s),spatialRelationship:r,timeExtent:Object(p.a)(a),where:t,units:u,distance:c},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,i=this.spatialRelationship,n=this.hiddenIds,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance,o=new Set;return n.forEach((function(e){return o.add(e)})),new r({geometry:Object(p.a)(t),hiddenIds:o,objectIds:Object(p.a)(s),spatialRelationship:i,timeExtent:Object(p.a)(a),where:e,units:u,distance:c})}}]),i}(f.a);Object(o.a)([Object(y.b)({type:String})],x.prototype,"where",void 0),Object(o.a)([Object(v.a)("where")],x.prototype,"writeWhere",null),Object(o.a)([Object(y.b)({types:l.a,json:{read:g.a,write:!0}})],x.prototype,"geometry",void 0),Object(o.a)([Object(y.b)({type:String,json:{read:{source:"spatialRel",reader:O.read},write:{target:"spatialRel",writer:O.write}}})],x.prototype,"spatialRelationship",void 0),Object(o.a)([Object(y.b)({json:{write:function(e,t,i){return t[i]=Array.from(e)},read:function(e){return new Set(e)}}})],x.prototype,"hiddenIds",void 0),Object(o.a)([Object(y.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],x.prototype,"distance",void 0),Object(o.a)([Object(y.b)({type:[Number],json:{write:!0}})],x.prototype,"objectIds",void 0),Object(o.a)([Object(y.b)({type:String,json:{read:j.read,write:{writer:j.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],x.prototype,"units",void 0),Object(o.a)([Object(y.b)({type:h.a,json:{write:!0}})],x.prototype,"timeExtent",void 0),Object(o.a)([Object(y.b)({readOnly:!0})],x.prototype,"enabled",void 0);var k=x=r=Object(o.a)([Object(b.a)("esri.views.layers.support.FeatureFilter")],x)},934:function(e,t,i){"use strict";function r(e,t,i){if(!i||null==t)return null;if(!e)return function(e,t){var i=t.toLowerCase();for(var r in e)if(r.toLowerCase()===i)return e[r];return null}(t,i);var r=e.get(i);return r?t[r.name]:null}i.d(t,"a",(function(){return r}))},937:function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var r=i(8),n=i.n(r),a=i(15),s=i(3),u=i(4),c=i(6),o=i(7),l=i(0),h=(i(112),i(32)),d=i(2),f=i(1),p=(i(17),i(18),i(16),i(9)),y=i(61),b=i(966),v=i(209),g=i(163),m=i(289),O=b.a,j=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this,e))._dataQueryEngineInstance=null,r}return Object(u.a)(i,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}},{key:"defaultQueryJSON",get:function(){return new g.a({outSpatialReference:this.spatialReference}).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}},{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}},{key:"executeQueryForIdSet",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){var r,a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=r.count,s=r.extent,e.abrupt("return",{count:a,extent:y.a.fromJSON(s)});case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){var r,a,s=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=v.default.fromJSON(r),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQuery",value:function(){var e=Object(a.a)(n.a.mark((function e(t,i){var r,a,s=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=v.default.fromJSON(r),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_ensureQueryJSON",value:function(e){return Object(d.j)(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}},{key:"ensureDataQueryEngine",value:function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=m.a.toJSON(this.queryGeometryType),r=this.layer.fields.map((function(e){return e.toJSON()})),n=this.layerView.view.resourceController.scheduler,a=this.priority,s=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,c=this.layerView,o=c.hasZ,l=c.hasM;return this._dataQueryEngineInstance=new O({hasZ:o,hasM:l,geometryType:i,fields:r,timeInfo:e,spatialReference:s,objectIdField:t,featureStore:u,scheduler:n,priority:a}),this._dataQueryEngineInstance}}]),i}(h.a);Object(l.a)([Object(f.b)({constructOnly:!0})],j.prototype,"layerView",void 0),Object(l.a)([Object(f.b)({constructOnly:!0})],j.prototype,"priority",void 0),Object(l.a)([Object(f.b)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],j.prototype,"spatialReference",void 0),Object(l.a)([Object(f.b)({readOnly:!0,aliasOf:"layerView.layer"})],j.prototype,"layer",void 0),Object(l.a)([Object(f.b)({readOnly:!0})],j.prototype,"queryGeometryType",null),Object(l.a)([Object(f.b)({readOnly:!0})],j.prototype,"defaultQueryJSON",null);var x=j=Object(l.a)([Object(p.a)("esri.views.3d.layers.graphics.QueryEngine")],j)},959:function(e,t,i){"use strict";i.d(t,"a",(function(){return G})),i.d(t,"b",(function(){return N}));var r=i(12),n=i(8),a=i.n(n),s=i(15),u=i(3),c=i(4),o=i(6),l=i(7),h=i(0),d=i(32),f=i(55),p=i(16),y=i(123),b=i(2),v=i(23),g=i(141),m=i(27),O=i(1),j=(i(17),i(18),i(9)),x=i(45),k=i(208),F=i(447),w=i(163),_=i(711),E=function(){function e(t,i){Object(u.a)(this,e),this.highestResolutionVersion=null,this.versions=[],this.ref(t,i)}return Object(c.a)(e,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"ref",value:function(e,t){var i=this.feature;C.oldVersion=i,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});var n,a=Object(r.a)(this.versions);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s.resolution===t){s.refCount++;var u=this.highestResolutionVersion===s&&!Object(_.a)(e,s.feature);return(u||this.highestResolutionVersion!==s)&&(s.feature=e),C.newVersion=u?e:i,C}}}catch(o){a.e(o)}finally{a.f()}var c={feature:e,resolution:t,refCount:1};return this.versions.push(c),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(C.newVersion=e,this.highestResolutionVersion=c):C.newVersion=i,C}},{key:"unref",value:function(e){for(var t=0;t<this.versions.length;t++){var i=this.versions[t];if(i.resolution===e)return i.refCount--,C.oldVersion=this.feature,0===i.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===i&&(this.recalculateHighestResolutionVersion(),C.oldVersion=i.feature)),C.newVersion=this.feature,C}return null}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}},{key:"recalculateHighestResolutionVersion",value:function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var i=this.versions[t];i.resolution<e.resolution&&(e=i)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null}}]),e}(),S=function(){function e(t){Object(u.a)(this,e),this._feature=t,this.refCount=1}return Object(c.a)(e,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"ref",value:function(e){return++this.refCount,C.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),Object(_.a)(this._feature,e)||(this._feature=e),C.newVersion=this._feature,C}},{key:"unref",value:function(){return C.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(C.newVersion=null,C):(C.newVersion=this._feature,C)}},{key:"feature",get:function(){return this._feature}}]),e}(),C={oldVersion:null,newVersion:null},T=i(102),I=new Set,R=function(){function e(t){Object(u.a)(this,e),this.descriptor=t,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=V,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=I,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object(c.a)(e,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e,this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"setFeatures",value:function(e,t,i){this._availableFields=Object(b.u)(i,I),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+Object(k.k)(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return this._numFeatures>V}},{key:"needsFeatureCount",get:function(){return this._numFeatures===V}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){return this.updateMemoryEstimates(),this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"updateMemoryEstimates",value:function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=Object(k.e)(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(var i=this.featureLimit;i<this._features.length;++i)this._estimatedUnusedSize+=Object(k.e)(this._features[i]);return!0}return!1}},{key:"isFetching",get:function(){return 2===this.fetchStatus||3===this.fetchStatus}},{key:"isRefetching",get:function(){return 3===this.fetchStatus}},{key:"needsFetching",get:function(){return 0===this.fetchStatus||1===this.fetchStatus}},{key:"needsRefetching",get:function(){return 1===this.fetchStatus}},{key:"isFetched",get:function(){return 4===this.fetchStatus||5===this.fetchStatus}},{key:"resetFetching",value:function(){this.fetchStatus=3===this.fetchStatus?1:0}},{key:"needsDisplayUpdate",get:function(){return!!this._features&&!function(e,t,i){if(Object(b.j)(t)||Object(b.j)(e)||i!==t.length||i>e.length)return!1;for(var r=0;r<i;++r)if(e[r]!==t[r])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)}},{key:"intersects",value:function(e){return!e||!this.descriptor.extent||(Object(x.s)(e,D),Object(x.w)(this.descriptor.extent,D))}},{key:"intersectionIncludingBorrowed",value:function(e,t){var i=Object(b.k)(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return e||i?(e?(Object(x.s)(e,t),Object(x.v)(t,i,t)):Object(x.k)(t,i),t):(Object(x.k)(t,x.b),t)}},{key:"_shuffle",value:function(e){this._features.sort((function(t,i){return Object(k.g)(t,e)-Object(k.g)(i,e)})),Object(T.o)(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}},{key:"reduceFeatures",value:function(e,t,i){if(e<=0)return!1;if(!this._features)return this.featureLimit=0,!1;var r=!1;this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,r=!0)),!this._shuffled&&e<1&&this._shuffle(i);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));return this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4)),r}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}]),e}(),V=-1;var D=Object(x.l)(),U=i(159),M=i(104),P=p.a.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),G=function(e){Object(o.a)(i,e);var t=Object(l.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e))._useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r.handles=new f.a,r._frameTask=M.a,r._dirty=!1,r.featureTiles=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return Object(c.a)(i,[{key:"maximumNumberOfFeatures",set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))}},{key:"memoryFactor",set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this.setDirty())}},{key:"lodFactor",set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&Object(b.k)(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e}},{key:"totalVertices",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e}},{key:"totalFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e}},{key:"filterExtent",set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))P.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("filterExtent",i),this.reclip(i,t)}}}},{key:"initialize",value:function(){var e=this;this.handles.add(Object(m.b)(this,"tileDescriptors","change",(function(){return e.setDirty()}),(function(){return e.setDirty()}))),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?E:S;var t=this.context.scheduler;Object(b.k)(t)&&(this._frameTask=t.registerTask(M.b.FEATURE_TILE_FETCHER,this)),this.setDirty()}},{key:"destroy",value:function(){var e=this;this._frameTask.remove(),this.handles=Object(b.e)(this.handles),this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"restart",value:function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.clearTile(t),e.resetFetchTile(t)})),Object(b.k)(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()}},{key:"refetch",value:function(){var e=this;this.featureTiles.forEach((function(t){e.cancelFetchTile(t),e.resetFetchTile(t)})),Object(b.k)(this.context.memoryCache)&&this.context.memoryCache.clear(),this.setDirty()}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,this.unpause())}},{key:"pause",value:function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e.cancelFetchTile(t)})),this.updated())}},{key:"unpause",value:function(){this.paused||(this.setDirty(),this.updated())}},{key:"availableFields",get:function(){var e=null;return this.featureTiles.forEach((function(t){Object(b.j)(t.displayingFeatures)||0===t.displayingFeatures.length||(Object(b.j)(e)?e=new Set(t.availableFields):e.forEach((function(i){t.availableFields.has(i)||Object(b.t)(e).delete(i)})))})),Object(b.k)(e)?e:new Set}},{key:"applyEdits",value:function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:Object(v.e)()},this.pause());var i=this.pendingEdits;i.count++;var r=i.edits.then((function(){return e.result.catch((function(e){if(Object(v.n)(e))throw e;return null})).then((function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,i.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--i.count&&(t.pendingEdits===i&&(t.pendingEdits=null),Object(b.k)(t.context.memoryCache)&&t.context.memoryCache.clear(),t.unpause(),t.updated()),e}))}));return i.edits=r,this.updated(),r}},{key:"applyEditsDeleteFeatures",value:function(e){var t=this;if(0!==e.length){var i=this.context.globalIdField,r=i&&this.availableFields.has(i),n=new Set,a=this.objectIdField;e.forEach((function(e){var s=e.objectId,u=e.globalId;if((!s||s<0)&&i){r||P.errorOncePerTick("Editing the specified service requires the layer's globalIdField, ".concat(i," to be included the layer's outFields for updates to be reflected in the view"));var c=t.features.find((function(e){return e.attributes&&e.attributes[i]===u}));c&&n.add(Object(k.g)(c,a))}else n.add(s)})),this.featureTiles.forEach((function(e){if(e.features){var i=e.features.filter((function(e){return!n.has(Object(k.g)(e,t.objectIdField))}));i.length!==e.features.length&&(e.setFeatures(i,0,e.availableFields),t.invalidateCounts())}}))}}},{key:"applyEditsAddUpdateFeatures",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i,r){var n,s,u,c=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],s=new Set,t.forEach((function(e){return n.push(e.objectId)})),i.forEach((function(e){n.push(e.objectId),s.add(e.objectId)})),0!==n.length){e.next=3;break}return e.abrupt("return");case 3:return u=[],this.featureTiles.forEach((function(e){var t=c.applyEditsAddUpdateTile(e,n,s,r);t&&u.push(t)})),e.next=7,Object(v.k)(u);case 7:case"end":return e.stop()}}),e,this)})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"applyEditsAddUpdateTile",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i,n,s){var u,c,o,l,h,d,f,p=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:return(u=this.createQuery(t)).resultType=void 0,u.cacheHint=!1,u.objectIds=i,e.next=6,this.queryFeatures(u,s);case 6:if(c=e.sent,o=null,n.size>0&&(l=t.features.filter((function(e){return!n.has(Object(k.g)(e,p.objectIdField))}))).length!==t.features.length&&(o=l),c.features.length>0){o||(o=t.features.slice()),h=Object(r.a)(c.features);try{for(h.s();!(d=h.n()).done;)f=d.value,o.push(f)}catch(a){h.e(a)}finally{h.f()}}o&&(t.hasPreciseFeatureCount&&(t.numFeatures=Math.max(t.numFeatures,o.length)),t.setFeatures(o,0,z(t.availableFields,c.fields)),this.invalidateCounts());case 11:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:X})}},{key:"setDirty",value:function(){this._dirty=!0,this.updated()}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=this;if(this._frameTask.processQueue(e),this._dirty&&this.constructed){this._dirty=!1;var i=this.getListOfTiles();if(this.markTilesNotAlive(i),e.run((function(){return t.addTiles(i,e)}))&&e.run((function(){return t.filterExtentTiles(i,e)}))&&e.run((function(){return t.removeTiles(i,e)}))&&!e.done){var r=this.sortTiles(i);e.run((function(){return t.displayTiles(r,e)}))&&e.run((function(){return t.fetchTiles(r,e)}))&&e.run((function(){return t.updateMemoryEstimates(r,e)}))||this.setDirty(),this.updated(),this.updating||this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}}},{key:"markTilesNotAlive",value:function(e){var t,i=Object(r.a)(e);try{for(i.s();!(t=i.n()).done;){t.value.alive=!1}}catch(n){i.e(n)}finally{i.f()}}},{key:"addTiles",value:function(e,t){var i=this;return!this.suspended&&(this.tileDescriptors.forEach((function(r){var n=i.featureTiles.get(r.id);n?n.alive=!0:t.done||(e.push(i.addTile(r)),t.madeProgress())})),t.hasProgressed)}},{key:"filterExtentTiles",value:function(e,t){var i,n=Object(r.a)(e);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(t.done)break;a.alive&&(a.filtered=!a.intersects(this.filterExtent),a.filtered&&(this.clearTile(a),t.madeProgress()))}}catch(s){n.e(s)}finally{n.f()}return t.hasProgressed}},{key:"removeTiles",value:function(e,t){for(var i=e.length-1;i>=0&&!t.done;i--){var r=e[i];r.alive||(this.removeTile(r),i!==e.length-1&&(e[i]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}},{key:"sortTiles",value:function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e}},{key:"displayTiles",value:function(e,t){var i,n=this,a=this.updateRatio(e),s=Object(r.a)(e);try{var u=function(){var e=i.value;if(!t.run((function(){return function(e){var t=n._fullRatio<1?a(e)*n._farRatio:1;return e.reduceFeatures(t,n.memoryFactor,n.objectIdField)&&n.setDirty(),n.showTile(e)}(e)})))return n.setDirty(),"break"};for(s.s();!(i=s.n()).done;){if("break"===u())break}}catch(c){s.e(c)}finally{s.f()}return t.hasProgressed}},{key:"fetchTiles",value:function(e,t){var i=this;if(this.paused)return!1;var n,a=!1,s=Object(r.a)(e);try{var u=function(){var e=n.value;if(!e.needsFetching)return"continue";var r=Object(b.k)(i.context.memoryCache)?i.context.memoryCache.pop(e.id):null;if(Object(b.k)(r))e.cache=r,i.setDirty(),i.scheduleUpdated(),t.madeProgress();else{if(i.needsNumFeatures(e)){var s=Object(v.e)(),u=i.fetchTileCount(e,s.signal);i._handleRequest(e,u,s,(function(){return e.numFeatures=-2})),a=!0,t.madeProgress()}if(t.done)return{v:!0}}};for(s.s();!(n=s.n()).done;){var c=u();if("continue"!==c&&"object"===typeof c)return c.v}}catch(f){s.e(f)}finally{s.f()}if(a)return t.hasProgressed;var o,l=Object(r.a)(e);try{var h=function(){var e=o.value;if(e.needsFetching){var r=Object(v.e)(),n=i.fetchTile(e,r.signal);if(i._handleRequest(e,n,r,(function(t){e.setFeatures([],0,null),i.invalidateCounts(),e.featuresMissing=!1,i.context.logFetchError(P,t)})),t.madeProgress(),t.done)return{v:!0}}};for(l.s();!(o=l.n()).done;){var d=h();if("object"===typeof d)return d.v}}catch(f){l.e(f)}finally{l.f()}return t.hasProgressed}},{key:"updateMemoryEstimates",value:function(e,t){var i=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(i.setDirty(),!0)})),t.hasProgressed}},{key:"reclip",value:function(e,t){if(this.constructed){var i=new Array;this.featureTiles.forEach((function(r){Object(b.j)(r.displayingFeatures)||0===r.displayingFeatures.length||(r.intersectionIncludingBorrowed(t,H),r.intersectionIncludingBorrowed(e,J),Object(x.o)(H,J)||i.push(r))})),this.refreshDisplayingFeatures(i),this.updated()}}},{key:"refreshDisplayingFeatures",value:function(e){var t,i=new Set,n=this.changes.updates,a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(!Object(b.j)(s.displayingFeatures)){var u,c=Object(r.a)(s.displayingFeatures);try{for(c.s();!(u=c.n()).done;){var o=u.value,l=Object(k.g)(o,this.objectIdField);if(!i.has(l)){i.add(l);var h=this.displayingFeatureReferences.get(l).feature;n.removes.push(h),n.adds.push(h)}}}catch(d){c.e(d)}finally{c.f()}}}}catch(d){a.e(d)}finally{a.f()}this.applyChanges()}},{key:"updated",value:function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var i=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",i),i){var r=0,n=0,a=0,s=0,u=0,c=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++n,t.isFetching&&t.hasPreciseFeatureCount){var i=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),o=Object(b.k)(t.displayingFeatures)?t.displayingFeatures.length*c:0;u+=i-o}t.needsFetching?++s:t.numFeatures>0&&(++a,r+=t.numFeatures)})),s+=t;var o=0,l=0;r?(l=r,o=Math.min(s*r/a,r)):(l=n,o=s),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",l),this._set("updatingRemaining",o),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}},{key:"updateMaximumNumberOfFeaturesExceeded",value:function(){var e=Object(y.c)(this.featureTiles,(function(e){return e.perTileMaximumNumberOfFeaturesExceeded}));this._set("maximumNumberOfFeaturesExceeded",e)}},{key:"updateRatio",value:function(e){var t,i=function(e){var t,i=0,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.features&&a.features.length>0&&a.alive&&(i=Math.max(i,a.descriptor.lij[0]))}}catch(s){n.e(s)}finally{n.f()}return i}(e),n=function(e){return 1/(1<<Math.max(0,i-e.descriptor.lij[0]))},a=0,s=0,u=Object(r.a)(e);try{for(u.s();!(t=u.n()).done;){var c=t.value,o=c.numFeatures;a+=o,s+=o*n(c)}}catch(l){u.e(l)}finally{u.f()}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/a),this._farRatio=this.maximumNumberOfFeatures/s,this.scheduleUpdated(),n}},{key:"maximumFeaturesUpdated",value:function(e,t){var i=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=i.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(i.cancelFetchTile(e),i.resetFetchTile(e))}})),this.setDirty())}},{key:"addTile",value:function(e){var t=new R(e);return this.featureTiles.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t}},{key:"referenceDisplayingFeaturesFromRelatedTiles",value:function(e){var t=this,i=e.descriptor.resolution;this.featureTiles.forEach((function(n){if(!(Object(b.j)(n.displayingFeatures)||e===n||e.descriptor.lij&&n.descriptor.lij&&!Object(U.j)(e.descriptor.lij,n.descriptor.lij))){Object(b.j)(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&n.descriptor.extent&&(Object(b.j)(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=Object(x.f)(e.descriptor.extent)),Object(x.p)(e.extentIncludingBorrowedFeatures,n.descriptor.extent,e.extentIncludingBorrowedFeatures));var a,s=Object(r.a)(n.displayingFeatures);try{for(s.s();!(a=s.n()).done;){var u=a.value;e.displayingFeatures.push(u);var c=t.displayingFeatureReferences.get(Object(k.g)(u,t.objectIdField));c.ref(c.feature,i),t.numDisplayingFeatureReferences++}}catch(o){s.e(o)}finally{s.f()}}})),e.featureLimit=Object(b.k)(e.displayingFeatures)?e.displayingFeatures.length:0}},{key:"removeTile",value:function(e){this.clearTile(e),this.featureTiles.delete(e.id)}},{key:"resetFetchTile",value:function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=4):e.fetchStatus=0}},{key:"cancelFetchTile",value:function(e){var t=e.requestController;Object(b.k)(t)&&(e.requestController=null,e.resetFetching(),t.abort())}},{key:"fetchTileCount",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchCount(t,i);case 2:return t.numFeatures=e.sent,this.updateRatio(this.getListOfTiles()),e.abrupt("return",3===t.fetchStatus?1:0);case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTile",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i){var r,n,s,u,c,o,l,h,d,f,p=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=this.maximumFeaturesForTile(t))<=0)){e.next=3;break}return e.abrupt("return",q(t));case 3:if(n=this.getMaxRecordCount(t),s=Math.ceil(r/n),!(A(t)||!this.context.capabilities.supportsMaxRecordCountFactor||t.numFeatures<=r&&s>w.a.MAX_MAX_RECORD_COUNT_FACTOR)){e.next=6;break}return e.abrupt("return",this.fetchPagedTile(t,i));case 6:return(u=this.createQuery(t)).maxRecordCountFactor=Math.ceil(r/n),t.isRefetching&&t.features&&t.features.length>0&&(c=Math.ceil(t.features.length/(1-t.emptyFeatureRatio)/n),u.maxRecordCountFactor=Math.max(c+1,u.maxRecordCountFactor)),e.next=10,this.queryFeatures(u,i);case 10:return o=e.sent,l=o.features,h=o.exceededTransferLimit,d=o.fields,f=h?u.maxRecordCountFactor>=w.a.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.next=17,this._frameTask.schedule((function(){t.featuresMissing=l.length<t.numFeatures||h;var e=p._removeEmptyFeatures(l);t.setFeatures(l,e,Q(d))}),i);case 17:return this.invalidateCounts(),e.abrupt("return",f);case 19:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchCount",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context.query.queryFeatureCount(this.createFeatureCountQuery(t),{signal:i}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchPagedTile",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i){var r,n,s,u,c,o,l,h,d,f=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,s=0,u=0,c=this.maximumFeaturesForTile(t)-u,o=this.getMaxRecordCount(t),l=null,h=a.a.mark((function e(){var h,d,p,y,v,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=f.createQuery(t),d=f.setPagingParameters(h,n,c,o),e.next=4,f.queryFeatures(h,i);case 4:return p=e.sent,y=p.features,v=p.exceededTransferLimit,g=p.fields,e.next=10,f._frameTask.schedule((function(){d&&(n+=Object(b.t)(h.num)),u+=y.length,s+=f._removeEmptyFeatures(y),t.featuresMissing=n<t.numFeatures||v,r=r?r.concat(y):y,l=z(l,g),t.setFeatures(r,s,l)}),i);case 10:if(f.invalidateCounts(),f.setDirty(),c=f.maximumFeaturesForTile(t)-u,d&&v&&!(c<=0)){e.next=15;break}return e.abrupt("return",{v:v?4:5});case 15:case"end":return e.stop()}}),e)}));case 4:return e.delegateYield(h(),"t0",5);case 5:if("object"!==typeof(d=e.t0)){e.next=8;break}return e.abrupt("return",d.v);case 8:e.next=4;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"createFeatureCountQuery",value:function(e){var t=this.createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}},{key:"createQuery",value:function(e){var t=this.context.createQuery(),i=e.descriptor.extent;if(i){var r=this.context.tilingScheme.spatialReference;t.geometry=Object(x.z)(i,r)}return this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"setPagingParameters",value:function(e,t,i,r){return!!this.context.capabilities.supportsPagination&&(e.start=t,i>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(i/r),e.num=Math.min(e.maxRecordCountFactor*r,i)):e.num=Math.min(r),!0)}},{key:"getEffectiveTileResolution",value:function(e){if(null==e.descriptor.resolution)return null;var t=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"setResolutionParams",value:function(e,t){if(this.supportsResolution){var i=this.getEffectiveTileResolution(t);null!=i&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new F.a({mode:"view",originPosition:"upper-left",tolerance:i,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=i))}}},{key:"_removeEmptyFeatures",value:function(e){for(var t=e.length,i=0;i<e.length;){var r=e[i];Object(k.i)(r.geometry)?++i:(e[i]=e[e.length-1],--e.length)}return t-e.length}},{key:"needsNumFeatures",value:function(e){return this.useTileCount&&e.needsFeatureCount&&!A(e)}},{key:"getMaxRecordCount",value:function(e){var t=this.context,i=t.tileMaxRecordCount,r=t.maxRecordCount;return this.useTileQuery(e)&&Object(b.k)(i)&&i>0&&this.context.capabilities.supportsResultType?i:Object(b.k)(r)&&r>0?r:B}},{key:"useTileQuery",value:function(e){return(!A(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}},{key:"_handleRequest",value:function(e,t,i,r){var n=this;e.fetchStatus=e.needsRefetching?3:2,e.requestController=i;var a=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===i&&(e.requestController=null,e.fetchStatus=4),Object(v.n)(t)?a=!0:r(t)})).then((function(){a||n.setDirty(),n.scheduleUpdated()}))}},{key:"scheduleUpdated",value:function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(Object(g.b)((function(){e.handles.remove("scheduleUpdated"),e.updated()})),"scheduleUpdated")}},{key:"showTile",value:function(e){if(Object(b.k)(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var i=Object(b.k)(e.displayingFeatures)&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],i}var r=e.descriptor.resolution,n=this.changes.updates,a=this.changes.adds,s=Math.min(e.featureLimit,t.length);e.featureLimit=s;for(var u=0;u<s;++u){var c=t[u],o=Object(k.g)(c,this.objectIdField),l=this.displayingFeatureReferences.get(o);if(l){var h=l.ref(c,r);h.oldVersion!==h.newVersion&&(n.removes.push(h.oldVersion),n.adds.push(h.newVersion))}else this.displayingFeatureReferences.set(o,new this.FeatureReferenceClass(c,r)),a.push(c);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=t.slice(0,s),!0}},{key:"hideTile",value:function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)}},{key:"hideTileFeatures",value:function(e){if(!Object(b.j)(e.displayingFeatures)){var t,i=this.changes.updates,n=this.changes.removes,a=Object(r.a)(e.displayingFeatures);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=Object(k.g)(s,this.objectIdField),c=this.displayingFeatureReferences.get(u);if(c){var o=c.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,o?o.oldVersion!==o.newVersion&&(null==o.newVersion?(this.displayingFeatureReferences.delete(u),n.push(o.oldVersion)):(i.adds.push(o.newVersion),i.removes.push(o.oldVersion))):console.error("Hiding unreferenced feature")}}}catch(l){a.e(l)}finally{a.f()}this.applyChanges(),e.displayingFeatures=null}}},{key:"applyChanges",value:function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,i=this.changes.removes,r=Math.min(t.length,i.length),n=0;n<r;){var a=Math.min(n+Y,r);this.features.addMany(t.slice(n,a)),this.features.removeMany(i.slice(n,a)),n=a}t.length>r&&this.features.addMany(0===n?t:t.slice(n)),i.length>r&&this.features.removeMany(0===n?i:i.slice(n)),t.length=0,i.length=0}},{key:"clearTile",value:function(e){if(this.hideTile(e),e.features&&Object(b.k)(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this.invalidateCounts()}},{key:"invalidateCounts",value:function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}},{key:"getListOfTiles",value:function(){return Array.from(this.featureTiles.values())}},{key:"storedFeatures",get:function(){return this.getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)}},{key:"maximumFeaturesForTile",value:function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,i=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,r=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(i*r/(1-e.emptyFeatureRatio)),t)}},{key:"test",get:function(){var e=this;return{process:function(t){return e.runTask(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}}}]),i}(d.a);function A(e){return"dummy-tile-full-extent"===e.id}function N(e){var t=e.capabilities.query;return{supportsMultipleResolutions:L(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function L(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function q(e){return e.setFeatures([],0,null),e.featuresMissing=!1,4}function Q(e){return Object(b.j)(e)?new Set:new Set(e.map((function(e){return e.name})))}function z(e,t){if(Object(b.j)(e)||Object(b.j)(t))return Q(t);var i,n=new Set,a=Object(r.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value.name;e.has(s)&&n.add(s)}}catch(u){a.e(u)}finally{a.f()}return n}Object(h.a)([Object(O.b)({constructOnly:!0})],G.prototype,"features",void 0),Object(h.a)([Object(O.b)()],G.prototype,"tileDescriptors",void 0),Object(h.a)([Object(O.b)({value:1/0})],G.prototype,"maximumNumberOfFeatures",null),Object(h.a)([Object(O.b)({value:1})],G.prototype,"memoryFactor",null),Object(h.a)([Object(O.b)({value:1})],G.prototype,"lodFactor",null),Object(h.a)([Object(O.b)()],G.prototype,"useTileCount",null),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"updating",void 0),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"updatingTotal",void 0),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"updatingRemaining",void 0),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"expectedFeatureDiff",void 0),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"memoryForUnusedFeatures",null),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"maximumNumberOfFeaturesExceeded",void 0),Object(h.a)([Object(O.b)({constructOnly:!0})],G.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"totalVertices",null),Object(h.a)([Object(O.b)({readOnly:!0})],G.prototype,"totalFeatures",null),Object(h.a)([Object(O.b)()],G.prototype,"filterExtent",null),Object(h.a)([Object(O.b)({constructOnly:!0})],G.prototype,"context",void 0),G=Object(h.a)([Object(j.a)("esri.views.3d.layers.support.FeatureTileFetcher3D")],G);var B=2e3,H=Object(x.l)(),J=Object(x.l)(),X=6e5,Y=200},960:function(e,t,i){"use strict";i.d(t,"a",(function(){return q}));var r=i(12),n=i(8),a=i.n(n),s=i(15),u=i(3),c=i(4),o=i(6),l=i(7),h=i(0),d=i(32),f=i(134),p=i(49),y=(i(17),i(20)),b=i(55),v=i(26),g=i(16),m=i(2),O=i(202),j=i(23),x=i(27),k=i(1),F=(i(18),i(9)),w=i(204),_=i(699),E=i(306),S=i(959),C=i(31),T=i(119),I=i(147),R=i(290),V=i(231),D=i(271),U=i(233),M=i(211),P=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],G=function(){function e(t,i,r){Object(u.a)(this,e),this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=t,this.view=r,this.tilingScheme=new M.a(i),this.loadedSymbols=P.map((function(e){return new D.a(new R.a({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new D.a(new R.a({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new D.a(new R.a({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new D.a(new R.a({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return Object(c.a)(e,[{key:"destroy",value:function(){this.enabled=!1}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"update",value:function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))}},{key:"showDataExtent",value:function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=I.a.fromExtent(e);this.dataExtentGraphic=new T.a({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}}},{key:"synchronizeMaps",value:function(e,t){var i=this,r=[];e.forEach((function(e,n){var a=i.tileFetcher.test.getFeatureTileById(n);a&&t.filter(a)||(i.view.graphics.removeMany(e),r.push(n))})),r.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(r){if(t.filter(r)&&!e.has(r.id)){var n=Object(C.a)(r.descriptor.lij,3),a=n[0],s=n[1],u=n[2];i.tilingScheme.ensureMaxLod(a);var c=i.tilingScheme.getExtentGeometry(a,s,u),o=[new T.a({geometry:c,symbol:t.symbols[a%t.symbols.length]}),new T.a({geometry:c.center,symbol:new V.a({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new U.a({text:"".concat(a,"/").concat(s,"/").concat(u),halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(r.id,o),i.view.graphics.addMany(o)}}))}}]),e}(),A=i(93),N=i(287),L=g.a.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),q=function(e){Object(o.a)(i,e);var t=Object(l.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).type="feature-tile-3d",r.watchUpdatingTracking=new N.a,r.serviceDataExtent=null,r.serviceDataCount=Q.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.tileFetcher=null,r.handles=new b.a,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=Object(j.e)(),r}return Object(c.a)(i,[{key:"extent",set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var i=e?e.clone():null;this._set("extent",i)}}else L.error("#extent=","extent needs to be in the same spatial reference as the view")}},{key:"updating",get:function(){return!!(Object(m.k)(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&Object(m.k)(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&Object(m.k)(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&Object(m.k)(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return Object(m.k)(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!Object(m.k)(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return Object(m.k)(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var e=this.layerView.layer;if("feature"===e.type&&Object(m.k)(e.infoFor3D))return"snapshot";if(this.serviceDataCount===Q.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var t=this.layerView.view,i=t&&t.featureTiles,r=i&&i.tilingScheme;if(e&&e.minScale&&this.serviceDataExtent&&r){var n=this.approximateExtentSizeAtScale(e.minScale,r);if((this.serviceDataExtent.width/n+this.serviceDataExtent.height/n)/2>Q.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&Object(m.k)(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(e,t)}},{key:"approximateExtentSizeAtScale",value:function(e,t){var i=this.layerView.view,r=Math.ceil((i.width/t.pixelSize+i.height/t.pixelSize)/2),n=t.levels[0];return r*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new p.a([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new p.a}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"initialize",value:function(){var e=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add(this,"mode",(function(){return e.modeChanged()}),2),this.addResolvingPromise(Promise.resolve().then((function(){return e.verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e.fetchServiceDataInfo())})).then((function(){return e.initializeTileFetcher()})))}},{key:"verifyCapabilities",value:function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery")&&"ogc-feature"!==e.type)throw new y.a("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})}},{key:"destroy",value:function(){this.cancelFetchServiceDataInfo(),this.tileFetcher=Object(m.e)(this.tileFetcher),this.handles=Object(m.e)(this.handles),this.tilesHandle=Object(m.s)(this.tilesHandle),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,Object(m.k)(this.tileFetcher)&&this.tileFetcher.suspend())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,Object(m.k)(this.tileFetcher)&&this.tileFetcher.resume())}},{key:"restart",value:function(){var e=this,t=function(){Object(m.k)(e.tileFetcher)&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))}},{key:"refetch",value:function(){var e=this,t=function(){Object(m.k)(e.tileFetcher)&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(t,t))}},{key:"initializeTileFetcher",value:function(){var e=this,t=this.layerView.view;if(t){var i=Object(x.k)(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(i),i.then((function(){var i=e.layerView,r=e.tileDescriptors,n=i.layer,a=new S.a({context:e.context,filterExtent:e.extent,tileDescriptors:r,features:e.graphics});e.tileFetcher=a,e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var s=e.layerView.view.resourceController;s&&(e.handles.add(s.memoryController.events.on("quality-changed",(function(e){a.memoryFactor=e}))),e.tileFetcher.memoryFactor=s.memoryController.memoryFactor);var u="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;u&&e.handles.add(Object(x.a)(e.layerView.view,"qualitySettings.graphics3D."+u,(function(e){a.lodFactor=e||1})));e.watchUpdatingTracking.add(n,"createQueryVersion",(function(){return e.dataFilterChanged()})),e.watchUpdatingTracking.add(i,"availableFields",(function(t,i){return e.availableFieldsChanged(i,t)})),e.watchUpdatingTracking.add(i,"requiredFields",(function(t,i){return e.requiredFieldsChanged(i,t)})),e.handles.add([n.on("apply-edits",(function(t){return e.applyEdits(t)})),e.watch("extent",(function(e){return a.filterExtent=e}),!0),e.watch("tileDescriptors",(function(e){return a.tileDescriptors=e}),!0),Object(x.a)(e,"maximumNumberOfFeatures",(function(t){a.maximumNumberOfFeatures=t,a.useTileCount=e.serviceDataCount>t}),!0),Object(x.a)(e,"serviceDataCount",(function(t){return a.useTileCount=t>e.maximumNumberOfFeatures}),!0),Object(x.a)(A.a,"FEATURE_TILE_FETCH_SHOW_TILES",(function(i){i&&a&&!a.debugger?(a.debugger=new G(a,t.featureTiles.tilingScheme.toTileInfo(),t),a.debugger.update()):!i&&e.tileFetcher&&a.debugger&&(a.debugger.destroy(),a.debugger=null)}))]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add(e,"maxTotalSnapshotVertices",(function(){return e.watchUpdatingTracking.addPromise(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))}}},{key:"modeChanged",value:function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:L.warn("Unhandled feature layer mode "+this.mode);case"snapshot":Object(m.k)(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}}},{key:"dataFilterChanged",value:function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()}},{key:"applyEdits",value:function(e){var t=this;Object(m.j)(this.tileFetcher)||this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))})).catch((function(e){if(!Object(j.n)(e))throw e}))}},{key:"availableFieldsChanged",value:function(e,t){Object(m.k)(this.tileFetcher)&&H(this.tileFetcher.availableFields,t)&&this.refetch()}},{key:"requiredFieldsChanged",value:function(e,t){Object(m.k)(this.tileFetcher)&&H(this.tileFetcher.availableFields,t)&&this.restart()}},{key:"createVertexLimitExceededQuery",value:function(e){var t=this.layerView.layer,i=t.createQuery();return i.outStatistics=[new E.a({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(i.cacheHint=!0),i}},{key:"createDataInfoQuery",value:function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"fullExtentIsAccurate",value:function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return Object(w.c)(e.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}},{key:"updateServiceDataExtent",value:function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.tryUpdateServiceDataExtent(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),Object(j.n)(e.t0)||this._set("serviceDataExtent",Object(v.a)(this.layerView.fullExtentInLocalViewSpatialReference));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"tryUpdateServiceDataExtent",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var i,r,n,s,u,c,o,l,h,d,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layerView,r=i.layer,n=r.capabilities.query.supportsExtent,s=Object(v.a)(i.fullExtentInLocalViewSpatialReference),u=r.fullExtent,c=this.fullExtentIsAccurate(),o=this.serviceDataCount,!(n&&o<=Q.MAX_FEATURE_COUNT_FOR_EXTENT)||s&&c||!("queryExtent"in r)){e.next=9;break}return l=this.createDataInfoQuery(),e.next=5,r.queryExtent(l,{timeout:Q.QUERY_EXTENT_TIMEOUT,signal:t});case 5:h=e.sent,this._set("serviceDataExtent",h.extent),e.next=22;break;case 9:if(!s){e.next=13;break}this._set("serviceDataExtent",s),e.next=22;break;case 13:if(!u){e.next=21;break}return d="portalItem"in r?r.portalItem:null,e.next=17,Object(_.projectGeometry)(u,i.view.spatialReference,d,t);case 17:f=e.sent,this._set("serviceDataExtent",f),e.next=22;break;case 21:this._set("serviceDataExtent",null);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateServiceDataCount",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var i,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("queryFeatureCount"in(i=this.layerView.layer)){e.next=3;break}return e.abrupt("return",void this._set("serviceDataCount",Q.NO_SERVICE_DATA_COUNT));case 3:return e.next=5,Object(f.d)(i.queryFeatureCount(this.createDataInfoQuery(),{timeout:Q.QUERY_STATISTICS_TIMEOUT,signal:t}));case 5:if(!0!==(r=e.sent).ok){e.next=10;break}this._set("serviceDataCount",r.value),e.next=13;break;case 10:if(!Object(j.n)(r.error)){e.next=12;break}throw r.error;case 12:this._set("serviceDataCount",Q.NO_SERVICE_DATA_COUNT);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"vertexLimitInfo",get:function(){if(Object(m.j)(this.displayFeatureLimit)||Object(m.j)(this.displayFeatureLimit.averageSymbolComplexity))return null;var e=this.displayFeatureLimit,t=e.averageSymbolComplexity,i=e.maximumTotalNumberOfPrimitives,r=t.primitivesPerCoordinate,n=t.primitivesPerFeature,a=this._get("vertexLimitInfo");return Object(m.j)(a)||a.maximumTotalNumberOfPrimitives!==i||a.primitivesPerCoordinate!==r||a.primitivesPerFeature!==n?{primitivesPerCoordinate:r,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:i}:a}},{key:"supportsExceedsLimitQuery",get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}},{key:"updateVertexLimitExceeded",value:function(){var e=Object(s.a)(a.a.mark((function e(t,i){var r,n,s,u,c,o,l,h,d,p,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.vertexLimitInfo,!Object(m.j)(r)){e.next=3;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 3:if(n=r.primitivesPerFeature<=0,s=this.minimumNumberOfVerticesForGeometry>1,n||s){e.next=6;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 6:if(u=r.primitivesPerFeature,c=r.primitivesPerCoordinate,o=r.maximumTotalNumberOfPrimitives,e.t0=0!==u&&Object(m.k)(t),!e.t0){e.next=11;break}return e.next=11,t;case 11:if(h=this.serviceDataCount,d=h!==Q.NO_SERVICE_DATA_COUNT,l=d?Math.ceil((o-h*u)/(c||1)):Math.ceil(o/(c||1)),s&&(l=Math.min(l,B)),!(d&&this.minimumNumberOfVerticesForGeometry*h>l)){e.next=14;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!0));case 14:if(this.supportsExceedsLimitQuery){e.next=16;break}return e.abrupt("return",void this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>l));case 16:return e.next=18,Object(f.d)(this.layerView.layer.queryFeatures(this.createVertexLimitExceededQuery(l),{timeout:Q.QUERY_STATISTICS_TIMEOUT,signal:i}));case 18:if(!1!==(p=e.sent).ok){e.next=23;break}if(!Object(j.n)(p.error)){e.next=22;break}throw p.error;case 22:return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 23:(y=p.value.features[0])&&y.attributes?this._set("vertexLimitExceeded",!!y.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);case 25:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchServiceDataInfo",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,i,r,n,s,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cancelFetchServiceDataInfo(),t=Object(j.e)(),i=t.signal,r=this.updateServiceDataCount(i),n=Object(j.k)([r,this.updateVertexLimitExceeded(r,i)]),s=n.then((function(){return u.updateServiceDataExtent(i)})).catch((function(e){Object(j.n)(e)||L.error("#fetchServiceDataInfo()",e)})).then((function(){s===u.fetchDataInfoPromise&&(u.fetchDataInfoPromise=null,u.fetchDataInfoAbortController=null),t=null})),e.abrupt("return",(t&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=t,n.then((function(){}),(function(){}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelFetchServiceDataInfo",value:function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())}},{key:"debug",get:function(){return{storedFeatures:Object(m.k)(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:Object(m.k)(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:Object(m.k)(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]),i}(Object(O.b)(d.a));Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"type",void 0),Object(h.a)([Object(k.b)({constructOnly:!0})],q.prototype,"graphics",void 0),Object(h.a)([Object(k.b)({constructOnly:!0})],q.prototype,"layerView",void 0),Object(h.a)([Object(k.b)({constructOnly:!0})],q.prototype,"context",void 0),Object(h.a)([Object(k.b)()],q.prototype,"extent",null),Object(h.a)([Object(k.b)()],q.prototype,"updating",null),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"watchUpdatingTracking",void 0),Object(h.a)([Object(k.b)()],q.prototype,"updatingTotal",null),Object(h.a)([Object(k.b)()],q.prototype,"updatingRemaining",null),Object(h.a)([Object(k.b)()],q.prototype,"expectedFeatureDiff",null),Object(h.a)([Object(k.b)()],q.prototype,"memoryForUnusedFeatures",null),Object(h.a)([Object(k.b)()],q.prototype,"maximumNumberOfFeaturesExceeded",null),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"serviceDataExtent",void 0),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"serviceDataCount",void 0),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"vertexLimitExceeded",void 0),Object(h.a)([Object(k.b)()],q.prototype,"displayFeatureLimit",void 0),Object(h.a)([Object(k.b)({type:Number})],q.prototype,"maximumNumberOfFeatures",null),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"mode",null),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"maxTotalSnapshotVertices",null),Object(h.a)([Object(k.b)({readOnly:!0,dependsOn:["mode"]})],q.prototype,"tileDescriptors",null),Object(h.a)([Object(k.b)()],q.prototype,"tileFetcher",void 0),Object(h.a)([Object(k.b)()],q.prototype,"fetchDataInfoPromise",void 0),Object(h.a)([Object(k.b)({readOnly:!0})],q.prototype,"vertexLimitInfo",null),q=Object(h.a)([Object(F.a)("esri.layers.graphics.controllers.FeatureTileController3D")],q);var Q,z,B=5e6;function H(e,t){if(!t)return!1;var i,n=Object(r.a)(t);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(!e.has(a))return!0}}catch(s){n.e(s)}finally{n.f()}return!1}(z=Q||(Q={})).NO_SERVICE_DATA_COUNT=1/0,z.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,z.reset=function(){z.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,z.QUERY_STATISTICS_TIMEOUT=12e3,z.QUERY_EXTENT_TIMEOUT=1e4},Q.reset()},964:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(2),n=i(68),a=i(699);function s(e){var t=e.view.spatialReference,i=e.layer.fullExtent,s=i&&i.spatialReference;if(!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(i.clone());var u=Object(n.d)(i,t);return Object(r.k)(u)?Promise.resolve(u):e.view.state.isLocal?Object(a.projectGeometry)(i,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):Promise.resolve(null)}},965:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i(3),n=i(4),a=i(6),s=i(7),u=i(0),c=i(32),o=i(55),l=i(27),h=i(1),d=(i(17),i(18),i(16),i(9)),f=i(72),p=i(708),y=i(104),b=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).suspended=!1,e.extent=null,e.extentIntersectionDirty=!0,e._isVisibleBelowSurface=!1,e.handles=new o.a,e.layerView=null,e.updating=!0,e}return Object(n.a)(i,[{key:"setup",value:function(e){var t=this;this.layerView=e,this.extentIntersection=new p.a({renderCoordsHelper:e.view.renderCoordsHelper});var i=e.view,r=i.basemapTerrain,n=i.resourceController.scheduler;this.handles.add([i.on("resize",(function(){return t.viewChange()})),i.state.watch("camera",(function(){return t.viewChange()}),!0),n.registerTask(y.b.FRUSTUM_VISIBILITY,this),r.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(l.a)(r,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),Object(l.a)(i,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])}},{key:"destroy",value:function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}},{key:"viewChange",value:function(){this._setDirty()}},{key:"elevationBoundsChange",value:function(){this._setDirty(),this.extentIntersectionDirty=!0}},{key:"isVisibleBelowSurface",set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}},{key:"updateIsVisibleBelowSurface",value:function(){var e=this.layerView.view,t=e.basemapTerrain,i="local"===e.viewingMode,r=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!t.opaque||r}},{key:"updateExtentIntersection",value:function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=-.3*Object(f.e)(t.spatialReference).radius;else{var i=t.basemapTerrain.elevationBounds,r=i.min,n=i.max;e=r-Math.max(1,(n-r)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum,t=Object(f.e)(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}else this._set("suspended",!1)}}]),i}(c.a);Object(u.a)([Object(h.b)({readOnly:!0})],b.prototype,"suspended",void 0),Object(u.a)([Object(h.b)({readOnly:!0})],b.prototype,"updating",void 0);var v=b=Object(u.a)([Object(d.a)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],b)},967:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(3),n=i(4),a=i(203),s=function(){function e(){Object(r.a)(this,e),this.items=[]}return Object(n.a)(e,[{key:"addObject",value:function(e,t){this.items.push({type:0,objectStateId:t,object:e})}},{key:"addRenderGeometry",value:function(e,t,i){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:i})}},{key:"addExternal",value:function(e,t){this.items.push({type:2,objectStateId:t,remove:e})}},{key:"remove",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];i.objectStateId===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeObject",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];0===i.type&&i.object===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeRenderGeometry",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];1===i.type&&i.renderGeometry===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeAll",value:function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]}},{key:"_removeObjectStateItem",value:function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}]),e}(),u=function(){function e(t,i){Object(r.a)(this,e),this.stateType=t,this.objectIdField=i,this.objectStateSet=new s,this.ids=new Set,this.paused=!1}return Object(n.a)(e,[{key:"hasGraphic",value:function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}]),e}(),c=function(){function e(t){Object(r.a)(this,e),this._graphicsCore=t,this._stateSets=new Array}return Object(n.a)(e,[{key:"destroy",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null}},{key:"acquireSet",value:function(e,t){var i=this,r=new u(e,t);this._stateSets.push(r);var n=Object(a.b)((function(){return i.releaseSet(r)}));return{set:r,handle:n}}},{key:"releaseSet",value:function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}},{key:"_addObjectStateSet",value:function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}},{key:"_removeObjectStateSet",value:function(e,t){e.removeObjectState(t.objectStateSet)}},{key:"setUid",value:function(e,t){e.ids.add(t);var i=this._graphicsCore.graphics3DGraphics.get(t);i&&this._addObjectStateSet(i,e)}},{key:"setUids",value:function(e,t){var i=this;t.forEach((function(t){return i.setUid(e,t)}))}},{key:"setObjectIds",value:function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)}},{key:"addGraphic",value:function(e){var t=this;this._stateSets.forEach((function(i){!i.paused&&i.hasGraphic(e)&&t._addObjectStateSet(e,i)}))}},{key:"removeGraphic",value:function(e){var t=this;this._stateSets.forEach((function(i){i.hasGraphic(e)&&t._removeObjectStateSet(e,i)}))}},{key:"allGraphicsDeleted",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))}},{key:"initializeSet",value:function(e){var t=this,i=this._graphicsCore.graphics3DGraphics;e.objectIdField?i.forEach((function(i){i&&e.hasGraphic(i)&&t._addObjectStateSet(i,e)})):e.ids.forEach((function(r){var n=i.get(r);n&&t._addObjectStateSet(n,e)}))}},{key:"test",get:function(){return{states:this._stateSets}}}]),e}()},968:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r=i(12),n=i(3),a=i(4),s=i(6),u=i(7),c=i(0),o=i(32),l=i(80),h=i(55),d=i(2),f=i(1),p=(i(17),i(18),i(16),i(9)),y=i(75),b=i(45),v=i(104),g=function(){function e(){Object(n.a)(this,e),this._extents=new y.a({allocator:function(e){return e||Object(b.l)()}}),this._tmpExtent=Object(b.l)(),this._dirty=!1}return Object(a.a)(e,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"clear",value:function(){this._extents.clear()}},{key:"add",value:function(e){this.contains(e)||(this.removeContained(e),Object(b.k)(this._extents.pushNew(),e),this._dirty=!0)}},{key:"pop",value:function(){return this._dirty&&this.mergeTight(),this._extents.pop()}},{key:"merge",value:function(e){return this.mergeTight(e),e.hasProgressed}},{key:"mergeTight",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.d,i=this._extents,r=new Set,n=0;n!==i.length;){i.sort((function(e,t){return e[0]-t[0]})),n=i.length,r.clear();for(var a=function(n){if(t.done)return{v:void 0};for(var a=i.getItemAt(n),s=n+1;s<i.length;++s){var u=i.getItemAt(s);if(u[0]>=a[2])break;r.add(u)}r.forEach((function(n){if(a!==n)if(n[2]<=a[0])r.delete(n);else{var s=Object(b.d)(a),u=Object(b.d)(n),c=e._tmpExtent;Object(b.p)(a,n,c);var o=s+u;(Object(b.d)(c)-o)/o<.05&&(Object(b.k)(a,c),r.delete(n),i.remove(n),t.madeProgress())}})),r.add(a)},s=0;s<i.length;++s){var u=a(s);if("object"===typeof u)return u.v}}this._dirty=!1}},{key:"contains",value:function(e){return this._extents.some((function(t){return Object(b.g)(t,e)}))}},{key:"removeContained",value:function(e){this._extents.filterInPlace((function(t){return!Object(b.g)(e,t)}))}},{key:"test",get:function(){var e=this;return{containsPoint:function(t){return e._extents.some((function(e){return Object(b.h)(e,t)}))}}}}]),e}(),m=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).dirtyExtents=new g,e.globalDirty=!1,e.averageExtentUpdateSize=0,e.dirtyGraphicsSet=new Set,e.handles=new h.a,e.updateElevation=!1,e.layerView=null,e.graphicsCore=null,e.events=new l.a,e}return Object(a.a)(i,[{key:"setup",value:function(e,t,i,r){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=r;var a=this.layerView.view.resourceController.scheduler;this.handles.add([r.on("elevation-change",(function(e){return n._elevationChanged(e)})),this.layerView.watch("suspended",(function(){return n.suspendedChange()})),a.registerTask(v.b.ELEVATION_ALIGNMENT,this)])}},{key:"destroy",value:function(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}},{key:"clear",value:function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}},{key:"suspendedChange",value:function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}},{key:"elevationInfoChange",value:function(){this.globalDirty=!0,this.notifyChange("updating")}},{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}},{key:"runTask",value:function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}},{key:"_updateDirtyGraphics",value:function(e){var t,i=this.layerView.view.renderCoordsHelper,n=0===this.graphicsCore.effectiveUpdatePolicy,a=Object(r.a)(this.dirtyGraphicsSet.keys());try{for(a.s();!(t=a.n()).done;){var s=t.value,u=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),Object(d.k)(u)&&(u.alignWithElevation(this.elevationProvider,i,n),e.madeProgress()),e.done)return}}catch(c){a.e(c)}finally{a.f()}}},{key:"_updateDirtyExtents",value:function(e){for(var t=this;!this.dirtyExtents.empty&&!e.done;){var i=this.dirtyExtents.pop(),r=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:i,spatialReference:r});var n=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(i,r,(function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);Object(d.k)(i)&&i.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-n)+.9*this.averageExtentUpdateSize,e.madeProgress()}}},{key:"markAllGraphicsElevationDirty",value:function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,i){return e.dirtyGraphicsSet.add(i)}))}},{key:"_elevationChanged",value:function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent,i=e.spatialReference;if(this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}}}]),i}(o.a);Object(c.a)([Object(f.b)({readOnly:!0})],m.prototype,"updating",null),Object(c.a)([Object(f.b)({readOnly:!0})],m.prototype,"updatingRemaining",null);var O=m=Object(c.a)([Object(p.a)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],m)},976:function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var r=i(8),n=i.n(r),a=i(15),s=i(3),u=i(4),c=i(6),o=i(7),l=i(0),h=i(119),d=i(32),f=i(162),p=i(55),y=i(23),b=i(27),v=i(1),g=(i(17),i(18),i(16)),m=i(9),O=i(687),j=i(68),x=i(163),k=i(548),F=i(988),w=i(968),_=i(2),E=i(937),S=i(925),C=i(545),T=i(104),I=g.a.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),R=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(s.a)(this,i);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).filter=null,e._dirty=!1,e._querying=!1,e._handles=new p.a,e}return Object(u.a)(i,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"setup",value:function(e,t){var i=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new E.a({layerView:this._layerView,priority:T.b.FILTER_VISIBILITY});var r=this._layerView.view.resourceController.scheduler;this._handles.add(r.registerTask(T.b.FILTER_VISIBILITY,this)),this._handles.add(Object(b.b)(t.owner,"loadedGraphics","after-changes",(function(e){return i._graphicsChanged(e)}),(function(){return i.dirty=!0}))),this.filterChanged()}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}},{key:"clear",value:function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")}},{key:"_graphicsChanged",value:function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}},{key:"updateVisibility",value:function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}},{key:"filterChanged",value:function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}},{key:"active",get:function(){return this.filter&&this._core.graphics3DGraphics.size>0}},{key:"recomputeFilter",value:function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null,i=Object(C.b)(this._layerView);if(Object(_.j)(t)&&Object(_.j)(i))return e;var r=Object(_.k)(e)?e.clone():new S.a;if(Object(_.k)(t)&&(r.timeExtent=Object(_.k)(r.timeExtent)?r.timeExtent.intersection(t):t),Object(_.k)(i)){var n=null==r.where||""===r.where;r.where=n?i:"(".concat(r.where,") AND (").concat(i,")")}return r}},{key:"running",get:function(){return this._dirty&&!this._querying||null!=this._queryResult}},{key:"runTask",value:function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){Object(y.n)(e)||(I.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(i){if(e.done)return!1;var r=t._queryResult.has(t._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,r,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()}},{key:"_getFeatureId",value:function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}},{key:"dirty",set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))}}]),i}(d.a);Object(l.a)([Object(v.b)({readOnly:!0})],R.prototype,"updating",null),R=Object(l.a)([Object(m.a)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],R);var V=i(965),D=i(967),U=i(984),M=i(117),P=i(934),G=i(287),A=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this,e))._handles=new p.a,r.watchUpdatingTracking=new G.a,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return Object(u.a)(i,[{key:"suspended",get:function(){var e;return null==(e=this.scaleVisibility)?void 0:e.suspended}},{key:"suspendInfo",get:function(){var e,t,i={};return null!=(e=this.scaleVisibility)&&e.suspended&&(i.outsideScaleRange=!0),null!=(t=this.frustumVisibility)&&t.suspended&&(i.outsideOfView=!0),i}},{key:"updating",get:function(){var e,t,i;return!!(null!=(e=this.graphicsCore)&&e.updating||null!=(t=this.frustumVisibility)&&t.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}},{key:"normalizeCtorArgs",value:function(e){var t=e.frustumVisibilityEnabled?new V.a:null,i=e.scaleVisibilityEnabled?new U.a:null,r=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new R:null,n=e.elevationAlignmentEnabled?new w.a:null;return{graphicsCore:new F.a({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:i,filterVisibility:r,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}}},{key:"initialize",value:function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,i){Object(O.a)(t,i)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,i){Object(O.a)(t,i)&&e.graphicsCore.updateLabelingInfo()}))}},{key:"setup",value:function(){var e=Object(a.a)(n.a.mark((function e(){var t,i,r,a,s=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),t=this.owner,i=this.owner.view.basemapTerrain,r=function(e,t,i){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,r,this.graphicsCore,i),this.filterVisibility&&("filter"in t||"timeExtent"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment&&(a=t.view.elevationProvider,this.elevationAlignment.setup(t,r,this.graphicsCore,a)),this._set("objectStates",new D.a(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),e.next=8,Object(y.r)(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));case 8:if(this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return s.watchUpdatingTracking.addPromise(s.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(t,"fullOpacity",(function(){return s.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,"clippingArea",(function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),e.t0=this.graphicsCore.labelsEnabled,!e.t0){e.next=17;break}return e.next=17,Object(y.r)(this.graphicsCore.updateLabelingInfo());case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var i=t[e],r=this[i];r&&(r.destroy(),this._set(i,null))}this._set("layer",null),this._set("owner",null)}},{key:"maskOccludee",value:function(e){var t=this.objectStates.acquireSet(1,null),i=t.set,r=t.handle;return this.objectStates.setUid(i,e.uid),r}},{key:"highlight",value:function(e,t){var i=this;if(e instanceof x.a){var r=this.objectStates.acquireSet(0,t),n=r.set,a=r.handle;return this.owner.queryObjectIds(e).then((function(e){return i.objectStates.setObjectIds(n,e)})),a}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof h.a)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof h.a){var s=e;if(null==Object(P.a)(this.layer.fieldsIndex,s[0].attributes,t)){var u=s.map((function(e){return e.uid})),c=this.objectStates.acquireSet(0,null),o=c.set,l=c.handle;return this.objectStates.setUids(o,u),l}e=s.map((function(e){return Object(P.a)(i.layer.fieldsIndex,e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var d=e,f=this.objectStates.acquireSet(0,t),p=f.set,y=f.handle;return this.objectStates.setObjectIds(p,d),y}}return q}},{key:"_updateClippingExtent",value:function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}},{key:"setupSuspendResumeExtent",value:function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(Object(b.a)(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(L),e.suspendResumeExtentMode){case"computed":e._handles.add([Object(b.a)(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),e.graphicsCore.watch("extentPadding",(function(){return e.updateSuspendResumeExtent(e.graphicsCore.computedExtent)}))],L);break;case"data":e._handles.add([Object(b.a)(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),e.graphicsCore.watch("extentPadding",(function(){return e.updateSuspendResumeExtent(e.dataExtent)}))],L);break;default:Object(f.a)(e.suspendResumeExtentMode)}})))}},{key:"updateSuspendResumeExtent",value:function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}},{key:"extentToSuspendResumeRect",value:function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!Object(j.a)(e,i))return;e=Object(j.d)(e,i)}return Object(M.e)(e,t,k.a,this.graphicsCore.extentPadding)}},{key:"suspendResumeExtentChanged",value:function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)}}]),i}(d.a);Object(l.a)([Object(v.b)({aliasOf:"graphicsCore.layer"})],A.prototype,"layer",void 0),Object(l.a)([Object(v.b)({aliasOf:"graphicsCore.owner"})],A.prototype,"owner",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"updateClippingExtent",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"graphicsCore",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"scaleVisibility",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"filterVisibility",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"elevationAlignment",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"frustumVisibility",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"deconfliction",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"labeling",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"objectStates",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"watchUpdatingTracking",void 0),Object(l.a)([Object(v.b)()],A.prototype,"suspendResumeExtentMode",void 0),Object(l.a)([Object(v.b)()],A.prototype,"dataExtent",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"suspended",null),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"suspendInfo",null),Object(l.a)([Object(v.b)({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],A.prototype,"updating",null);var N=A=Object(l.a)([Object(m.a)("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],A),L="suspendResumeExtentMode",q={remove:function(){},pause:function(){},resume:function(){}}},985:function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var r=i(8),n=i.n(r),a=i(14),s=i(15),u=i(3),c=i(4),o=i(47),l=i(44),h=i(6),d=i(7),f=i(0),p=i(20),y=i(2),b=i(27),v=i(1),g=(i(17),i(18),i(16),i(9)),m=i(412),O=i(960),j=i(550),x=i(163),k=i(976),F=i(937),w=i(964),_=i(104),E=function(e){var t=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(){var e;return Object(u.a)(this,i),(e=t.apply(this,arguments)).controller=null,e.updatePolicy=1,e.suspendResumeExtentMode="computed",e.slicePlaneEnabled=!1,e.drapeSourceType=1,e.fullExtentInLocalViewSpatialReference=null,e.suspendResumeExtent=null,e._controllerCreated=!1,e.clippingExtent=null,e.supportsHeightUnitConversion=!0,e.pendingController=null,e.queryEngine=null,e}return Object(c.a)(i,[{key:"initialize",value:function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(Promise.reject(new p.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this._set("graphics3d",new k.a({owner:this,layer:t,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.updatingHandles.add(this,"updatePolicy",(function(t){return e.graphics3d.graphicsCore.preferredUpdatePolicy=t})),this.updatingHandles.add(this,"suspendResumeExtentMode",(function(t){e.graphics3d.suspendResumeExtentMode=t})),this.addResolvingPromise(this.graphics3d.setup().then((function(){return e.validateGeometryType()})).then((function(){return e.queryEngine=new F.a({layerView:e,priority:_.b.FEATURE_QUERY_ENGINE})})).then((function(){return Object(w.a)(e)})).then((function(t){return e.fullExtentInLocalViewSpatialReference=t})).then((function(){return e.initializeController()}))),this.notifyChange("updating"))}},{key:"destroy",value:function(){this.destroyPendingController(),this.controller=Object(y.e)(this.controller),this._set("graphics3d",Object(y.e)(this.graphics3d)),this.queryEngine=Object(y.e)(this.queryEngine),this.loadedGraphics=null}},{key:"destroyPendingController",value:function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)}},{key:"legendEnabled",get:function(){var e,t;return this.canResume()&&!(null!=(e=this.graphics3d)&&null!=(t=e.frustumVisibility)&&t.suspended)}},{key:"notifyGraphicGeometryChanged",value:function(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}},{key:"notifyGraphicVisibilityChanged",value:function(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}},{key:"getRenderingInfo",value:function(e,t,i){var r=Object(j.c)(e,{renderer:t,arcade:i});if(Object(y.k)(r)&&r.color){var n=r.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return r}},{key:"getRenderingInfoAsync",value:function(){var e=Object(s.a)(n.a.mark((function e(t,i,r,s){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(j.d)(t,Object(a.a)({renderer:i,arcade:r},s)));case 1:case"end":return e.stop()}}),e)})));return function(t,i,r,n){return e.apply(this,arguments)}}()},{key:"getGraphicFromGraphicUid",value:function(e){var t,i=this,r=null;return null==(t=this.loadedGraphics)||t.forEach((function(t){t.uid===e&&(r=Object(m.c)(t,i.layer))})),r}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}},{key:"whenGraphicBounds",value:function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null}},{key:"computeAttachmentOrigin",value:function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null}},{key:"getSymbolLayerSize",value:function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(e,t):null}},{key:"queryFeatures",value:function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),Object(y.i)(t,"signal"))}},{key:"queryObjectIds",value:function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),Object(y.i)(t,"signal"))}},{key:"queryFeatureCount",value:function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),Object(y.i)(t,"signal"))}},{key:"queryExtent",value:function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),Object(y.i)(t,"signal"))}},{key:"_ensureQuery",value:function(e){return Object(y.j)(e)?this.createQuery():x.a.from(e)}},{key:"highlight",value:function(e){return this.graphics3d.highlight(e,this.layer.objectIdField)}},{key:"maskOccludee",value:function(e){return this.graphics3d.maskOccludee(e)}},{key:"canResume",value:function(){return Object(o.a)(Object(l.a)(i.prototype),"canResume",this).call(this)&&(!this.graphics3d||!this.graphics3d.suspended)}},{key:"getSuspendInfo",value:function(){var e=Object(o.a)(Object(l.a)(i.prototype),"getSuspendInfo",this).call(this);return this.graphics3d?Object(a.a)(Object(a.a)({},e),this.graphics3d.suspendInfo):e}},{key:"isUpdating",value:function(){var e,t;return!(!this.graphics3d||this.graphics3d.destroyed)&&!(this._controllerCreated&&(null==(e=this.controller)||!e.updating)&&null!=(t=this.view.basemapTerrain)&&t.ready&&!this.graphics3d.updating)}},{key:"initializeController",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createController(),this.pendingController=t,e.next=4,t.when();case 4:this.setControllerWhenInitialized(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setControllerWhenInitialized",value:function(){var e=Object(s.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.when();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:if(this._controllerCreated=!0,this.notifyChange("updating"),!this.isResolved()||this.destroyed){e.next=19;break}return e.next=12,Object(b.m)(this.view,"basemapTerrain.ready");case 12:this.beforeSetController(t),this.pendingController=null,this.controller=t,this.loadedGraphics=t.graphics,this.notifyChange("updating"),e.next=20;break;case 19:this.destroyPendingController();case 20:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateClippingExtent",value:function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}}},{key:"validateGeometryType",value:function(){switch(this.layer.geometryType){case"multipatch":case"multipoint":return Promise.reject(new p.a("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}}},{key:"_getResourceInfo",value:function(){var e=this.controller&&this.controller instanceof O.a?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:e?e.maximumNumberOfFeatures:-1,totalNumberOfFeatures:e?e.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]),i}(e);return Object(f.a)([Object(v.b)()],t.prototype,"loadedGraphics",void 0),Object(f.a)([Object(v.b)()],t.prototype,"suspended",void 0),Object(f.a)([Object(v.b)({readOnly:!0})],t.prototype,"legendEnabled",null),Object(f.a)([Object(v.b)()],t.prototype,"updating",void 0),Object(f.a)([Object(v.b)()],t.prototype,"controller",void 0),Object(f.a)([Object(v.b)()],t.prototype,"graphics3d",void 0),Object(f.a)([Object(v.b)({readOnly:!0})],t.prototype,"updatePolicy",void 0),Object(f.a)([Object(v.b)({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),Object(f.a)([Object(v.b)({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),Object(f.a)([Object(v.b)({readOnly:!0})],t.prototype,"suspendInfo",void 0),t=Object(f.a)([Object(g.a)("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}},986:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(35),n=i(12),a=i(3),s=i(4),u=i(6),c=i(7),o=i(80),l=i(551),h=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments))._set=new Set,e}return Object(s.a)(i,[{key:"clear",value:function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e})}}},{key:"length",get:function(){return this._set.size}},{key:"addMany",value:function(e){if(0!==e.length){var t,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._set.add(r)}}catch(a){i.e(a)}finally{i.f()}this.emit("after-changes",{type:1}),this.emit("change",{added:e,removed:[]})}}},{key:"remove",value:function(e){this._set.delete(e)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[e]}))}},{key:"removeMany",value:function(e){var t,i=[],r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this._set.delete(a)&&i.push(a)}}catch(s){r.e(s)}finally{r.f()}i.length>0&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:i}))}},{key:"toArray",value:function(){return Object(r.a)(this._set)}},{key:"find",value:function(e){var t;return Object(l.a)(this._set,(function(i){return!!e(i)&&(t=i,!0)})),t}},{key:"forEach",value:function(e){this._set.forEach((function(t){return e(t)}))}}]),i}(o.a)}}]);
//# sourceMappingURL=75.07c225dc.chunk.js.map