"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[2173],{79874:(e,t,i)=>{i.d(t,{Z:()=>b});var s=i(27366),r=i(85015),n=i(91505),a=i(100),o=i(92026),h=i(49861),l=(i(63780),i(93169),i(25243),i(69912)),d=i(10199),u=i(65156),c=i(6403);class p{constructor(){this._extents=new d.Z({allocator:e=>e||(0,u.Ue)()}),this._tmpExtent=(0,u.Ue)(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),(0,u.JG)(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(e){return this._mergeTight(e),e.hasProgressed}_mergeTight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.G5;const t=this._extents,i=new Set;let s=0;for(;s!==t.length;){t.sort(((e,t)=>e[0]-t[0])),s=t.length,i.clear();for(let s=0;s<t.length;++s){if(e.done)return;const r=t.getItemAt(s);for(let e=s+1;e<t.length;++e){const s=t.getItemAt(e);if(s[0]>=r[2])break;i.add(s)}i.forEach((s=>{if(r===s)return;if(s[2]<=r[0])return void i.delete(s);const n=(0,u.SO)(r),a=(0,u.SO)(s),o=this._tmpExtent;(0,u.jn)(r,s,o);const h=n+a;((0,u.SO)(o)-h)/h<.05&&((0,u.JG)(r,o),i.delete(s),t.remove(s),e.madeProgress())})),i.add(r)}}this._dirty=!1}_contains(e){return this._extents.some((t=>(0,u.r3)(t,e)))}_removeContained(e){this._extents.filterInPlace((t=>!(0,u.r3)(e,t)))}get test(){const e=this;return{containsPoint:t=>e._extents.some((e=>(0,u.BD)(e,t)))}}}var y=i(68401);let g=class extends r.Z{constructor(){super(...arguments),this.dirtyExtents=new p,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new a.Z,this.updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new n.Z}setup(e,t,i,s){this.graphicsCoreOwner=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.graphicsCoreOwner.view.resourceController.scheduler;this.handles.add([s.on("elevation-change",(e=>this._elevationChanged(e))),this.graphicsCoreOwner.watch("suspended",(()=>this._suspendedChange())),r.registerTask(c.T8.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.graphicsCoreOwner.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=this.graphicsCore.effectiveUpdatePolicy===y.jq.ASYNC;for(const s of this.dirtyGraphicsSet.keys()){const r=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),(0,o.pC)(r)&&(r.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);(0,o.pC)(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.graphicsCoreOwner.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}};(0,s._)([(0,h.Cb)({readOnly:!0})],g.prototype,"updating",null),(0,s._)([(0,h.Cb)({readOnly:!0})],g.prototype,"updatingRemaining",null),g=(0,s._)([(0,l.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],g);const b=g},12173:(e,t,i)=>{i.d(t,{Z:()=>q});var s=i(27366),r=i(52639),n=i(41644),a=i(41691),o=i(92026),h=i(66978),l=i(94172),d=i(49861),u=(i(63780),i(93169),i(25243),i(69912)),c=i(48732),p=i(81753),y=i(34610),g=i(21149),b=i(61310),m=i(86792),_=i(79874),f=i(85015),C=i(100),v=i(32718),S=i(62314),w=i(8537),E=i(18661),x=i(70446),I=i(82607),O=i(10141),V=i(6403);const G=v.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");let j=class extends f.Z{constructor(){super(...arguments),this._dirty=!1,this._querying=!1,this._handles=new C.Z}get updating(){return this._dirty||this._querying||(0,o.pC)(this._queryResult)}setup(e,t){this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new I.Z({layerView:this._layerView,priority:V.T8.FILTER_VISIBILITY});const i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(V.T8.FILTER_VISIBILITY,this)),this._handles.add((0,w.on)(t.owner,"loadedGraphics","after-changes",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(x.P.FILTER))),this._queryResult=null,this._querying=!1),this.dirty=!1}_graphicsChanged(e){this._queryEngine&&0==(e.type&S.y.ADD)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(x.P.FILTER,x.E.GRAPHIC)||e.setVisibilityFlag(x.P.FILTER,!1,x.E.GRAPHIC),this.dirty=!0)}filterChanged(){const e=this._recomputeFilter();e!==this._filter&&(this._filter=e,this.dirty=!0)}get active(){return this._filter&&this._core.graphics3DGraphics.size>0}_recomputeFilter(){const e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null,i=(0,O.cx)(this._layerView);if((0,o.Wi)(t)&&(0,o.Wi)(i))return e;const s=(0,o.pC)(e)?e.clone():new E.Z;if((0,o.pC)(t)&&(s.timeExtent=(0,o.pC)(s.timeExtent)?s.timeExtent.intersection(t):t),(0,o.pC)(i)){const e=null==s.where||""===s.where;s.where=e?i:`(${s.where}) AND (${i})`}return s}get running(){return this._dirty&&!this._querying||(0,o.pC)(this._queryResult)}runTask(e){if(!this.active)return void this.clear();!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{if(!(0,h.D_)(e)){G.warn("FeatureFilter query failed: "+e,{error:e});const t=new Set;this._core.graphics3DGraphics.forEach((e=>t.add(this._getFeatureId(e.graphic)))),this._queryResult=t,this._querying=!1}})),e.madeProgress());const t=this._queryResult;(0,o.pC)(t)&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((i=>{if(e.done)return!1;const s=t.has(this._getFeatureId(i.graphic));return!!i.setVisibilityFlag(x.P.FILTER,s,x.E.GRAPHIC)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null))}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty=e}};(0,s._)([(0,d.Cb)({readOnly:!0})],j.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],j.prototype,"running",null),(0,s._)([(0,d.Cb)()],j.prototype,"_dirty",void 0),(0,s._)([(0,d.Cb)()],j.prototype,"_querying",void 0),(0,s._)([(0,d.Cb)()],j.prototype,"_queryResult",void 0),j=(0,s._)([(0,u.j)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],j);var R=i(24202),F=i(46568),D=i(59453),T=i(96387),P=i(99879),A=i(68401);let Q=class extends a.r{constructor(e){super(e),this.type="graphics-3d",this.elevationFeatureExpressionEnabled=!1,this.dataExtent=null,this.preferredUpdatePolicy=A.jq.ASYNC,this.suspendResumeExtent=null}normalizeCtorArgs(e){const t=e.frustumVisibilityEnabled?new R.Z:null,i=e.scaleVisibilityEnabled?new D.Z:null,s=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.owner.layer.geometryType?new j:null,r=e.elevationAlignmentEnabled?new _.Z:null,{owner:n,updateClippingExtent:a,dataExtent:o,elevationFeatureExpressionEnabled:h,preferredUpdatePolicy:l}=e;return{owner:n,updateClippingExtent:a,dataExtent:o,frustumVisibility:t,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,elevationFeatureExpressionEnabled:h,preferredUpdatePolicy:l}}get featureSpatialReference(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:void 0}initialize(){const e=new m.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:this.owner.hasZ,hasM:this.owner.hasM});this._set("graphicsCore",e),this.scaleVisibility&&this.updatingHandles.add((()=>this.layer.effectiveScaleRange),(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.updatingHandles.add((()=>"filter"in this.owner&&this.owner.filter),(()=>this.filterVisibility.filterChanged())),this.updatingHandles.add((()=>"timeExtent"in this.owner&&this.owner.timeExtent),(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.updatingHandles.add((()=>this.layer.elevationInfo),((e,t)=>{(0,c.Hg)(e,t)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})),this.updatingHandles.add((()=>this.layer.labelsVisible),(()=>this.graphicsCore.updateVisibilityInfo())),this.updatingHandles.add((()=>this.layer.labelingInfo),((e,t)=>{(0,c.Hg)(e,t)&&this.graphicsCore.updateLabelingInfo()})),this.updatingHandles.add((()=>this.preferredUpdatePolicy),(e=>this.graphicsCore.preferredUpdatePolicy=e)),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",(()=>this.notifyChange("displayFeatureLimit"))))}destroy(){this.handles.removeAll(),this.updatingHandles.removeAll(),this._set("frustumVisibility",(0,o.SC)(this.frustumVisibility)),this._set("scaleVisibility",(0,o.SC)(this.scaleVisibility)),this._set("filterVisibility",(0,o.SC)(this.filterVisibility)),this._set("elevationAlignment",(0,o.SC)(this.elevationAlignment)),this._set("objectStates",(0,o.SC)(this.objectStates)),this._set("graphicsCore",(0,o.SC)(this.graphicsCore)),this._set("owner",null)}get layer(){return this.owner.layer}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){var e;return null==(e=this.scaleVisibility)?void 0:e.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return!this.frustumVisibility.suspended}get suspendInfo(){var e,t;const i={};return null!=(e=this.scaleVisibility)&&e.suspended&&(i.outsideScaleRange=!0),null!=(t=this.frustumVisibility)&&t.suspended&&(i.outsideOfView=!0),i}get updating(){var e,t,i;return!!(null!=(e=this.graphicsCore)&&e.updating||null!=(t=this.frustumVisibility)&&t.updating||null!=(i=this.updatingHandles)&&i.updating)}get updatingRemaining(){var e,t;return null!=(e=null==(t=this.graphicsCore)?void 0:t.updatingRemaining)?e:0}get featureStore(){var e;return null==(e=this.graphicsCore)?void 0:e.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get drapeSourceType(){return this.owner.drapeSourceType}get updatePolicy(){return this.owner.updatePolicy}get graphics3DGraphics(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var e;return null==(e=this.graphicsCore)?void 0:e.graphics3DGraphicsByObjectID}get symbolUpdateType(){var e;return null==(e=this.graphicsCore)?void 0:e.symbolUpdateType}get displayFeatureLimit(){var e;const t=this.view.resourceController.memoryController.memoryFactor,i=null==(e=this.graphicsCore)?void 0:e.displayFeatureLimit;if(1===t)return i;const s=Math.ceil(i.maximumNumberOfFeatures*t),r=Math.ceil(i.maximumTotalNumberOfFeatures*t),n=Math.ceil(i.minimumTotalNumberOfFeatures*t);return{...i,maximumNumberOfFeatures:s,maximumTotalNumberOfFeatures:r,minimumTotalNumberOfFeatures:n}}get usedMemory(){var e,t;return null!=(e=null==(t=this.graphicsCore)?void 0:t.usedMemory)?e:0}get usedMemoryPerFeature(){var e,t;return null!=(e=null==(t=this.graphicsCore)?void 0:t.usedMemoryPerGraphic)?e:0}get unprocessedMemoryEstimate(){var e,t;return null!=(e=null==(t=this.graphicsCore)?void 0:t.unprocessedMemoryEstimate)?e:0}get performanceInfo(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibility.suspended}}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this);const e=this.owner,t=this.owner.view.basemapTerrain,i=(e,t,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i);if(this.scaleVisibility&&this.scaleVisibility.setup(this,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment){const t=e.view.elevationProvider;this.elevationAlignment.setup(this,i,this.graphicsCore,t)}this._set("objectStates",new F.d(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await(0,h.U3)(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.updatingHandles.add((()=>this.layer.renderer),(e=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(e)))),this.updatingHandles.add((()=>e.fullOpacity),(()=>this.graphicsCore.opacityChange())),this._setupSuspendResumeExtent(),this.updateClippingExtent&&(this.updatingHandles.add((()=>e.view.clippingArea),(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await(0,h.U3)(this.graphicsCore.updateLabelingInfo())}maskOccludee(e){const{set:t,handle:i}=this.objectStates.acquireSet(A.V_.MaskOccludee,null);return this.objectStates.setUid(t,e.uid),i}highlight(e,t){if(e instanceof g.Z){const{set:i,handle:s}=this.objectStates.acquireSet(A.V_.Highlight,t);return this.owner.queryObjectIds(e).then((e=>this.objectStates.setObjectIds(i,e))),s}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof r.Z)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof r.Z){const i=e;if(null==(0,P.g)(this.layer.fieldsIndex,i[0].attributes,t)){const e=i.map((e=>e.uid)),{set:t,handle:s}=this.objectStates.acquireSet(A.V_.Highlight,null);return this.objectStates.setUids(t,e),s}e=i.map((e=>(0,P.g)(this.layer.fieldsIndex,e.attributes,t)))}if("number"==typeof e[0]||"string"==typeof e[0]){const i=e,{set:s,handle:r}=this.objectStates.acquireSet(A.V_.Highlight,t);return this.objectStates.setObjectIds(s,i),r}}return U}whenGraphicBounds(e,t){var i;return null==(i=this.graphicsCore)?void 0:i.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){var i;return null==(i=this.graphicsCore)?void 0:i.computeAttachmentOrigin(e,t)}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}getRenderingInfo(e,t,i){const s=(0,y.Kb)(e,{renderer:t,arcade:i});if((0,o.pC)(s)&&s.color){const e=s.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return s}getRenderingInfoAsync(e,t,i,s){return(0,y.xn)(e,{renderer:t,arcade:i,...s})}getSymbolLayerSize(e,t){var i;return null==(i=this.graphicsCore)?void 0:i.getSymbolLayerSize(e,t)}setObjectIdVisibility(e,t){var i;null==(i=this.graphicsCore)||i.setObjectIdVisibility(e,t)}_updateClippingExtent(){const e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add((0,l.YP)((()=>this.suspendResumeExtentMode),(()=>{switch(this.handles.remove(N),this.suspendResumeExtentMode){case"computed":this.handles.add([(0,l.YP)((()=>this.graphicsCore.computedExtent),(e=>this._updateSuspendResumeExtent(e)),l.nn),(0,l.YP)((()=>this.graphicsCore.extentPadding),(()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],N);break;case"data":this.handles.add([(0,l.gx)((()=>this.dataExtent),(e=>this._updateSuspendResumeExtent(e)),l.nn),(0,l.YP)((()=>this.graphicsCore.extentPadding),(()=>this._updateSuspendResumeExtent((0,o.Wg)(this.dataExtent))))],N);break;default:(0,n.Bg)(this.suspendResumeExtentMode)}}),l.nn))}_updateSuspendResumeExtent(e){e?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(e,this.suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(e,t){const i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!(0,p.Q8)(e,i))return;e=(0,p.iV)(e,i)}return(0,T.Go)(e,t,b.ZF,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)}};(0,s._)([(0,d.Cb)()],Q.prototype,"type",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"owner",void 0),(0,s._)([(0,d.Cb)()],Q.prototype,"layer",null),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"updateClippingExtent",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"elevationFeatureExpressionEnabled",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"graphicsCore",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"scaleVisibility",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"filterVisibility",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"elevationAlignment",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Q.prototype,"frustumVisibility",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"deconfliction",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"labeling",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Q.prototype,"objectStates",void 0),(0,s._)([(0,d.Cb)()],Q.prototype,"suspendResumeExtentMode",null),(0,s._)([(0,d.Cb)()],Q.prototype,"dataExtent",void 0),(0,s._)([(0,d.Cb)()],Q.prototype,"scaleVisibilitySuspended",null),(0,s._)([(0,d.Cb)()],Q.prototype,"suspended",null),(0,s._)([(0,d.Cb)()],Q.prototype,"legendEnabled",null),(0,s._)([(0,d.Cb)()],Q.prototype,"suspendInfo",null),(0,s._)([(0,d.Cb)()],Q.prototype,"updating",null),(0,s._)([(0,d.Cb)()],Q.prototype,"updatingRemaining",null),(0,s._)([(0,d.Cb)()],Q.prototype,"featureStore",null),(0,s._)([(0,d.Cb)()],Q.prototype,"view",null),(0,s._)([(0,d.Cb)()],Q.prototype,"loadedGraphics",null),(0,s._)([(0,d.Cb)()],Q.prototype,"fullOpacity",null),(0,s._)([(0,d.Cb)()],Q.prototype,"filter",null),(0,s._)([(0,d.Cb)()],Q.prototype,"slicePlaneEnabled",null),(0,s._)([(0,d.Cb)()],Q.prototype,"drapeSourceType",null),(0,s._)([(0,d.Cb)()],Q.prototype,"updatePolicy",null),(0,s._)([(0,d.Cb)()],Q.prototype,"preferredUpdatePolicy",void 0),(0,s._)([(0,d.Cb)()],Q.prototype,"displayFeatureLimit",null),Q=(0,s._)([(0,u.j)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],Q);const q=Q,N="suspendResumeExtentMode",U={remove(){},pause(){},resume(){}}},24202:(e,t,i)=>{i.d(t,{Z:()=>p});var s=i(27366),r=i(85015),n=i(100),a=i(8537),o=i(49861),h=(i(63780),i(93169),i(25243),i(69912)),l=i(92183),d=i(57557),u=i(6403);let c=class extends r.Z{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new n.Z,this.graphicsCoreOwner=null,this.updating=!0}setup(e){this.graphicsCoreOwner=e,this.extentIntersection=new d.q({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,s=t.resourceController.scheduler;this.handles.add([t.on("resize",(()=>this._viewChange())),t.state.watch("camera",(()=>this._viewChange()),!0),s.registerTask(u.T8.FRUSTUM_VISIBILITY,this),i.on("elevation-bounds-change",(()=>this._elevationBoundsChange()))]),"local"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([(0,a.S1)(i,["opacity","wireframe"],(()=>this._updateIsVisibleBelowSurface())),(0,a.S1)(t,"map.ground.navigationConstraint.type",(()=>this._updateIsVisibleBelowSurface()))])}destroy(){this.graphicsCoreOwner=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const e=this.graphicsCoreOwner.view,t=e.basemapTerrain,i="local"===e.viewingMode,s=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!t.opaque||s}_updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurface)t=-.3*(0,l.Iu)(e.spatialReference).radius;else{const{min:i,max:s}=e.basemapTerrain.elevationBounds;t=i-Math.max(1,(s-i)*(1.2-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this._updateExtentIntersection();const e=this.graphicsCoreOwner.view.frustum,t=(0,l.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}};(0,s._)([(0,o.Cb)({readOnly:!0})],c.prototype,"suspended",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],c.prototype,"updating",void 0),c=(0,s._)([(0,h.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c);const p=c},46568:(e,t,i)=>{i.d(t,{d:()=>h});var s,r=i(42537),n=i(68401);!function(e){e[e.Object=0]="Object",e[e.RenderGeometry=1]="RenderGeometry",e[e.External=2]="External",e[e.COUNT=3]="COUNT"}(s||(s={}));class a{constructor(){this.items=[]}addObject(e,t){this.items.push({type:s.Object,objectStateId:t,object:e})}addRenderGeometry(e,t,i){this.items.push({type:s.RenderGeometry,objectStateId:t,renderGeometry:e,owner:i})}addExternal(e,t){this.items.push({type:s.External,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.objectStateId===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.type===s.Object&&i.object===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const i=this.items[t];i.type===s.RenderGeometry&&i.renderGeometry===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case s.Object:e.objectStateId.channel===n.V_.Highlight?e.object.removeHighlight(e.objectStateId):e.objectStateId.channel===n.V_.MaskOccludee&&e.object.removeOcclude(e.objectStateId);break;case s.RenderGeometry:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case s.External:e.remove(e.objectStateId)}}}class o{constructor(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new a,this.ids=new Set,this.paused=!1}hasGraphic(e){if(this.objectIdField){const t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}class h{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll())),this._stateSets=null}acquireSet(e,t){const i=new o(e,t);this._stateSets.push(i);const s=(0,r.kB)((()=>this.releaseSet(i)));return{set:i,handle:s}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}_addObjectStateSet(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}_removeObjectStateSet(e,t){e.removeObjectState(t.objectStateSet)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&this._addObjectStateSet(i,e)}setUids(e,t){t.forEach((t=>this.setUid(e,t)))}setObjectIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach((t=>{!t.paused&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)}))}removeGraphic(e){this._stateSets.forEach((t=>{t.hasGraphic(e)&&this._removeObjectStateSet(e,t)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((e=>e.objectStateSet.removeAll()))}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((t=>{t&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)})):e.ids.forEach((i=>{const s=t.get(i);s&&this._addObjectStateSet(s,e)}))}get test(){return{states:this._stateSets}}}},82607:(e,t,i)=>{i.d(t,{Z:()=>g});var s=i(27366),r=(i(59486),i(85015)),n=i(92026),a=i(49861),o=(i(63780),i(93169),i(25243),i(69912)),h=i(53866),l=i(83706),d=i(49818),u=i(21149),c=i(27823);const p=l.Z;let y=class extends r.Z{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}get defaultQueryJSON(){return new u.Z({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this._ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,t){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)}async executeQueryForCount(e,t){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:i,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:i,extent:h.Z.fromJSON(s)}}async executeQueryForIds(e,t){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQueryForLatestObservations(e,t){const i=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),t),s=d.default.fromJSON(i);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,t){const i=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t),s=d.default.fromJSON(i);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return(0,n.Wi)(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=c.Mk.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),r=this.layerView.view.resourceController.scheduler,n=this.priority,a=this.spatialReference.toJSON(),o=this.layerView.processor.featureStore,{hasZ:h,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new p({hasZ:h,hasM:l,geometryType:i,fields:s,timeInfo:e,spatialReference:a,objectIdField:t,featureStore:o,scheduler:r,priority:n}),this._dataQueryEngineInstance}};(0,s._)([(0,a.Cb)({constructOnly:!0})],y.prototype,"layerView",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0})],y.prototype,"priority",void 0),(0,s._)([(0,a.Cb)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],y.prototype,"spatialReference",void 0),(0,s._)([(0,a.Cb)({readOnly:!0,aliasOf:"layerView.layer"})],y.prototype,"layer",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"queryGeometryType",null),(0,s._)([(0,a.Cb)({readOnly:!0})],y.prototype,"defaultQueryJSON",null),y=(0,s._)([(0,o.j)("esri.views.3d.layers.graphics.QueryEngine")],y);const g=y},99879:(e,t,i)=>{function s(e,t,i){if(!i||null==t)return null;if(!e)return function(e,t){const i=t.toLowerCase();for(const s in e)if(s.toLowerCase()===i)return e[s];return null}(t,i);const s=e.get(i);return s?t[s.name]:null}i.d(t,{g:()=>s})}}]);
//# sourceMappingURL=2173.607ab48c.chunk.js.map