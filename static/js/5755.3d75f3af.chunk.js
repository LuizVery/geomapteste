"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[5755],{98074:(t,e,i)=>{i.d(e,{p:()=>l});var s=i(27366),o=i(92026),n=i(67426),r=i(49861),a=(i(63780),i(93169),i(25243),i(69912));const l=t=>{let e=class extends((0,n.v)(t)){constructor(){super(...arguments),this.parent=null}get updating(){return!1}get visible(){const t=!(0,o.pC)(this.parent)||this.parent.visible&&!this.parent.suspended;return this.analysis.visible&&t}};return(0,s._)([(0,r.Cb)({readOnly:!0})],e.prototype,"type",void 0),(0,s._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"analysis",void 0),(0,s._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"parent",void 0),(0,s._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"view",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],e.prototype,"updating",null),(0,s._)([(0,r.Cb)({readOnly:!0})],e.prototype,"visible",null),e=(0,s._)([(0,a.j)("esri.views.3d.analysis.AnalysisView3D")],e),e}},85755:(t,e,i)=>{i.r(e),i.d(e,{default:()=>dt});var s=i(27366),o=i(85015),n=i(40110),r=i(91505),a=i(41691),l=i(92026),c=i(49861),h=i(63780),u=(i(93169),i(25243),i(69912)),d=i(71353),p=i(98074),_=i(51995);let g=class extends o.Z{constructor(t){super(t),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new _.Z([3,252,111,1]),this.visibleOuterColor=new _.Z([3,252,111,.15]),this.occludedInnerColor=new _.Z([252,3,69,1]),this.occludedOuterColor=new _.Z([252,3,69,.1]),this.undefinedInnerColor=new _.Z([255,255,255,1]),this.undefinedOuterColor=new _.Z([127,127,127,.2])}};(0,s._)([(0,c.Cb)({type:Number})],g.prototype,"innerWidth",void 0),(0,s._)([(0,c.Cb)({type:Number})],g.prototype,"outerWidth",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"visibleInnerColor",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"visibleOuterColor",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"occludedInnerColor",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"occludedOuterColor",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"undefinedInnerColor",void 0),(0,s._)([(0,c.Cb)({type:_.Z})],g.prototype,"undefinedOuterColor",void 0),g=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],g);i(59486);var C=i(100),y=i(42537),v=i(32718),m=i(66978),f=i(94172),b=i(11186),w=i(79803),O=i(65156),P=i(40885);let T=class extends o.Z{constructor(t){super(t),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null}};(0,s._)([(0,c.Cb)()],T.prototype,"target",void 0),(0,s._)([(0,c.Cb)()],T.prototype,"intersectedGraphic",void 0),(0,s._)([(0,c.Cb)()],T.prototype,"intersectedLocation",void 0),(0,s._)([(0,c.Cb)()],T.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,c.Cb)()],T.prototype,"visible",void 0),T=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],T);let R=class extends o.Z{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:(0,d.c)(),observerSurfaceNormal:null,target:(0,d.c)(),targetSurfaceNormal:null,observerAdjusted:(0,d.c)(),targetAdjusted:(0,d.c)()},this.computationResult={start:(0,d.c)(),end:(0,d.c)(),intersection:(0,d.c)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};(0,s._)([(0,c.Cb)()],R.prototype,"target",void 0),(0,s._)([(0,c.Cb)()],R.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,c.Cb)()],R.prototype,"inputPoints",void 0),(0,s._)([(0,c.Cb)()],R.prototype,"computationResult",void 0),(0,s._)([(0,c.Cb)()],R.prototype,"result",void 0),R=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],R);var E,S=i(17842),I=i(51378),L=i(65618),V=i(84652);let A=E=class extends o.Z{constructor(t){super(t)}clone(){return new E({type:this.type,id:(0,V.d9)(this.id),point:(0,V.d9)(this.point),normal:(0,V.d9)(this.normal),ray:(0,V.d9)(this.ray)})}equals(t){return this.type===t.type&&this.id===t.id&&(0,l._W)(this.point,t.point)&&(0,h.fS)(this.normal,t.normal)&&(0,P.fS)(this.ray,t.ray)}};(0,s._)([(0,c.Cb)()],A.prototype,"type",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"id",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"point",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"normal",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"ray",void 0),A=E=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],A);var j=i(85312),W=i(81703),Z=i(43449),D=i(36734),H=i(88153),G=i(54463),x=i(43431);let z=class extends o.Z{constructor(t){super(t)}initialize(){this.intersector=(0,H.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=G.eC.MIN}getScreenPointIntersection(t){const e=(0,S.md)(t,I.qW.get()),i=(0,W.u4)(this.view.state.camera,e,N);return this._getRayIntersection(i)}_getRayIntersection(t){if((0,l.Wi)(t))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(t,this.intersector);const e=this.intersector.results.min;if(!e.getIntersectionPoint(M))return null;const i=this.view.renderCoordsHelper.fromRenderCoords(M,this.view.spatialReference),s=(0,d.d)(e.normal),o=(0,b.d)(s,t.direction)>0?-1:1;if((0,b.a)(s,s,o),(0,j.G)(e))return new A({type:G.q7.OBJECT,id:`${e.target.layerUid}/${e.target.nodeIndex}/${e.target.componentIndex}`,point:i,normal:s,ray:(0,P.JG)(t)});if((0,Z.T)(e))return new A({type:G.q7.TERRAIN,id:e.target.lij.slice(),point:i,normal:s,ray:(0,P.JG)(t)});const n=(0,x.t)(e,this.view);if((0,l.pC)(n)){const e=n.layer,o=n.sourceLayer;let r;return r=o&&"scene"===o.type?(0,L.MS)(n,o.objectIdField):n.uid,new A({type:G.q7.OBJECT,id:`${e.uid}/${r}`,point:i,normal:s,ray:(0,P.JG)(t)})}return null}_canUpdateFromIntersectionResult(t,e){if((0,l.Wi)(t)||!e||t.type!==e.type)return!1;switch(t.type){case G.q7.TERRAIN:{const i=t.id,s=e.id;return i[0]===s[0]&&i[1]===s[1]&&i[2]===s[2]||(0,D.E9)(i,s)}case G.q7.OBJECT:case G.q7.I3S:return t.id===e.id}}updateFromIntersectionResult(t){let e;if(t.type===G.q7.TERRAIN&&(0,l.pC)(t.point)){const i=M,s=k,o=F;this.view.renderCoordsHelper.toRenderCoords(t.point,s),this.view.renderCoordsHelper.worldUpAtPosition(s,o);const n=this.view.basemapTerrain.elevationBounds,r=this.view.renderCoordsHelper.getAltitude(s),a=n?Math.abs(n.max-n.min)/Math.abs(r):100,l=r>0?1:-1;(0,b.n)(o,o),(0,b.a)(o,o,l*a),(0,b.b)(i,s,o),(0,P.zk)(i,s,N),e=this._getRayIntersection(N)}else e=this._getRayIntersection(t.ray);return this._canUpdateFromIntersectionResult(e,t)?e.point:null}};(0,s._)([(0,c.Cb)()],z.prototype,"view",void 0),(0,s._)([(0,c.Cb)()],z.prototype,"intersector",void 0),z=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],z);const M=(0,d.c)(),k=(0,d.c)(),F=(0,d.c)(),N=(0,P.Ue)();var B=i(33906),U=i(6403),Y=i(94854),q=i(7882);const X=v.Z.getLogger("esri.views.3d.analysis.LineOfSight.LineOfSightController");let J=class extends(r.Z.EventedMixin(o.Z)){constructor(t){super(t),this.updateOnCameraChange=!0,this._updatingHandles=new Y.t,this._frameTask=U.sq,this._handles=new C.Z,this._computationHandles=new C.Z,this._externalObserverUpdate=!0}initialize(){var t;const e=null==(t=this.view.resourceController)?void 0:t.scheduler;this._frameTask=e?e.registerTask(U.T8.LINE_OF_SIGHT_TOOL):U.sq,this._intersector=new z({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(t){this._frameTask.priority=t}get _computations(){return this.analysisViewData.computations}get _observerEngineLocation(){return this.analysisViewData.observerEngineLocation}set _observerEngineLocation(t){this.analysisViewData.observerEngineLocation=t}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._observerEngineLocation)}getLineOfSightComputationDependencies(t){const{inputPoints:e}=t;return{inputPoints:e}}_computeResult(t){const e=t.computation,{inputPoints:i,computationResult:s}=e,{observerAdjusted:o,targetAdjusted:n}=i,{start:r,end:a}=s;(0,b.g)(r,o),(0,b.g)(a,n),this._canCompute(e)?this._computeIntersection(t):this._interpolateIntersection(t),e.notifyResultChanged(),this.emit("result-changed",{target:t.computation.target,result:e.result})}_adjustStartEndPositions(t){const e=this._screenPixelSize,i=this.view,{inputPoints:s}=t,{observer:o,observerSurfaceNormal:n,target:r,targetSurfaceNormal:a,observerAdjusted:c,targetAdjusted:h}=s,u=Q;(0,l.pC)(n)?(0,b.g)(u,n):(0,b.f)(u,r,o);const d=e;(0,b.n)(u,u),(0,b.a)(u,u,Math.min(d,1)),(0,b.b)(c,o,u),(0,l.pC)(a)?(0,b.g)(u,a):(0,b.f)(u,o,r);const p=i.state.camera.computeScreenPixelSizeAt(r);(0,b.n)(u,u),(0,b.a)(u,u,Math.min(p,1)),(0,b.b)(h,r,u)}_computeIntersection(t){let{computation:e,interpolationInfo:i}=t;const{view:s}=this,{sceneIntersectionHelper:o,renderCoordsHelper:n}=s;if((0,l.Wi)(o))return;const r=this._intersector.intersector,{computationResult:a,inputPoints:c}=e,{observer:h,target:u}=c,{start:d,end:p}=a,_=(0,P.zk)(d,p,tt);o.intersectToolIntersectorRay(_,r);const g=a.intersection,C=Q;let y=!0;if(r.results.min.getIntersectionPoint(g)){(0,b.g)(i.originalIntersection,g),(0,b.g)(i.originalObserver,d),(0,b.g)(i.originalTarget,p),n.fromRenderCoords(g,C,s.spatialReference);const t=1-(0,b.j)(p,u)/(0,b.j)(d,u);y=(0,b.j)(h,g)>=t*(0,b.j)(h,u)}const v=new q.Z(C,s.spatialReference);{const{result:t,target:i}=e;(0,l.pC)(t)?(t.target=i,t.intersectedGraphic=y?null:(0,x.t)(r.results.min,s),t.intersectedLocation=y?null:v,t.visible=y):e.result=new T({target:i,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:y?null:(0,x.t)(r.results.min,s),intersectedLocation:y?null:v,visible:y})}a.isValid=c.isValid=!0,a.isTargetVisible=y}_interpolateIntersection(t){let{computation:e,interpolationInfo:i}=t;const{computationResult:s,inputPoints:o}=e,{start:n,end:r,intersection:a}=s,{originalIntersection:l,originalObserver:c,originalTarget:h}=i;if((0,b.g)(a,l),o.isValid){const t=Q,e=(0,b.j)(c,l)/(0,b.j)(c,h);(0,b.v)(t,n,c),(0,b.a)(t,t,1-e),(0,b.b)(a,a,t),(0,b.v)(t,r,h),(0,b.a)(t,t,e),(0,b.b)(a,a,t),s.isValid=!0}else e.result=null,s.isValid=!1,s.isTargetVisible=!1}_canCompute(t){const e=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if((0,l.Wi)(e)||(0,l.Wi)(t.elevationAlignedTargetLocation)||(0,l.Wi)(i))return!1;const{observerAdjusted:s,targetAdjusted:o}=t.inputPoints,n=i.intersectsPoint(s),r=i.intersectsPoint(o);return n&&r}_onObserverPositionChange(t,e,i){if(this._externalObserverUpdate=i,(0,l.Wi)(t))return void(this.analysisViewData.elevationAlignedObserver=null);const s=this._applyProjectionAndElevationAlignment(t,e);if((0,l.Wi)(s))return(0,B.e)(this.analysis,t.spatialReference,X),void(this.analysisViewData.elevationAlignedObserver=null);const o=(0,d.c)();this.analysisViewData.elevationAlignedObserver=s,this.view.renderCoordsHelper.toRenderCoords(this.analysisViewData.elevationAlignedObserver,o),this._observerEngineLocation=o,this.priority=U.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_applyProjectionAndElevationAlignment(t,e){const i=(0,l.pC)(e)&&e.type!==G.q7.OBJECT;return(0,B.G)(t,this.view.spatialReference,this.view.elevationProvider,i)}_onObserverRenderSpacePositionChangeForComputation(t,e,i){const{inputPoints:s}=t;if((0,b.g)(s.observer,e),(0,l.pC)(i)){const t=this._intersector.updateFromIntersectionResult(i);(0,l.pC)(t)&&this.view.renderCoordsHelper.toRenderCoords(t,s.observer),s.observerSurfaceNormal=(0,d.a)(i.normal)}else s.observerSurfaceNormal=null;this._adjustStartEndPositions(t),t.notifyInputPointsChanged(),this.priority=U.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(t,e,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=t.inputPoints;if(s&&(o.isValid=!1),t.elevationAlignedTargetLocation=this._applyProjectionAndElevationAlignment(e,i),(0,l.Wi)(t.elevationAlignedTargetLocation))(0,B.e)(this.analysis,e.spatialReference,X);else{if(this.view.renderCoordsHelper.toRenderCoords(t.elevationAlignedTargetLocation,o.target),(0,l.pC)(i)){const t=this._intersector.updateFromIntersectionResult(i);(0,l.pC)(t)&&this.view.renderCoordsHelper.toRenderCoords(t,o.target),o.targetSurfaceNormal=(0,d.a)(i.normal)}else o.targetSurfaceNormal=null;this._adjustStartEndPositions(t)}t.notifyInputPointsChanged(),this.priority=U.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(t){return(0,y.AL)([(0,f.YP)((()=>t.target.position),(e=>{$(e,t.target.intersection)||(t.target.intersection=null)}),f.nn),(0,f.YP)((()=>({computation:t,targetPosition:t.target.position,targetIntersection:t.target.intersection})),(t=>{let{computation:e,targetPosition:i,targetIntersection:s}=t;(0,l.pC)(i)&&this._onTargetPositionChange(e,i,s)}),f.tX)])}_connectComputationToObserver(t){return(0,f.YP)((()=>({computation:t,observer:this.analysisViewData.elevationAlignedObserver})),(t=>{let{computation:e}=t;this._externalObserverUpdate&&(e.inputPoints.isValid=!1,e.notifyInputPointsChanged())}),f.tX)}_connectComputationToRenderSpaceObserver(t){return(0,f.YP)((()=>({computation:t,observer:this._observerEngineLocation,observerIntersection:(0,l.pC)(this.analysis.observer)?this.analysis.observer.intersection:null})),(t=>{let{computation:e,observer:i,observerIntersection:s}=t;this._onObserverRenderSpacePositionChangeForComputation(e,i,s)}),f.tX)}_connectComputationToCamera(t){return(0,f.YP)((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(e=>{let{isDirty:i}=e;!this.updateOnCameraChange||t.inputPoints.isValid&&!i||t.notifyInputPointsChanged()}),f.Z_)}_connectComputationToSlicePlane(t){return(0,f.YP)((()=>this.view.slicePlane),(()=>t.notifyInputPointsChanged()))}_connectComputationToElevation(t){return this.view.elevationProvider.on("elevation-change",(e=>{const i=this.analysis.observer,s=t.target;let o=null,n=null,r=null,a=null;const c=(0,l.pC)(i)&&(0,l.pC)(i.position)?i.position.spatialReference:(0,l.pC)(s.position)?s.position.spatialReference:e.spatialReference;(0,l.pC)(i)&&(0,l.pC)(i.position)&&(o=it,n=i.intersection,(0,w.nF)(i.position,o,c)),(0,l.pC)(s.position)&&(r=st,a=s.intersection,(0,w.nF)(s.position,r,c)),(0,l.Wi)(o)&&(0,l.Wi)(r)||((0,w.dH)(e.extent,e.spatialReference,et,c),(0,l.pC)(o)&&(0,O.Qn)(et,o)&&this._onObserverPositionChange(o,n,!1),(0,l.pC)(r)&&(0,O.Qn)(et,r)&&this._onTargetPositionChange(t,r,a,!1),(0,l.pC)(o)&&(0,l.pC)(r)&&(0,O.I7)(et,o,r)&&t.notifyInputPointsChanged())}))}_connectComputationToTask(t){let e=l.YP;const i={computation:t,interpolationInfo:{originalIntersection:(0,d.c)(),originalObserver:(0,d.c)(),originalTarget:(0,d.c)()}};return(0,y.AL)([(0,f.YP)((()=>this.getLineOfSightComputationDependencies(t)),(()=>{e=(0,l.IM)(e),e=(0,m.vr)((async t=>{await(0,m.R8)(this._frameTask.schedule((()=>this._computeResult(i)),t))}))}),f.tX),(0,y.kB)((()=>e=(0,l.IM)(e)))])}_connectComputation(t){const e=this._computationHandles;e.has(t)||e.add([this._connectComputationToTarget(t),this._connectComputationToObserver(t),this._connectComputationToRenderSpaceObserver(t),this._connectComputationToCamera(t),this._connectComputationToSlicePlane(t),this._connectComputationToElevation(t),this._connectComputationToTask(t)],t)}_disconnectAnalysis(t){this._computationHandles.remove(t)}_onComputationCollectionChange(t){t.added.forEach((t=>this._connectComputation(t))),t.removed.forEach((t=>this._disconnectAnalysis(t)))}_onTargetsChange(){return this._computations.removeAll(),this.analysis.targets.forEach((t=>this._addTarget(t))),this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(t=>this._onTargetCollectionChange(t)))}_onTargetCollectionChange(t){t.added.forEach((t=>this._addTarget(t))),t.removed.forEach((t=>this._removeTarget(t)))}_onCursorTargetChange(t,e){(0,l.pC)(e)&&this._removeTarget(e),(0,l.pC)(t)&&this._addTarget(t)}_addTarget(t){this._computations.some((e=>e.target===t))||this._computations.add(new R({target:t}))}_removeTarget(t){const e=this._computations.find((e=>e.target===t));this._computations.remove(e)}_connectObserver(){return(0,y.AL)([(0,f.YP)((()=>({observer:this.analysis.observer,observerPosition:(0,l.pC)(this.analysis.observer)?this.analysis.observer.position:null,observerIntersection:(0,l.pC)(this.analysis.observer)?this.analysis.observer.intersection:null})),(t=>{let{observer:e,observerPosition:i,observerIntersection:s}=t;(0,l.pC)(e)&&!$(i,s)&&(e.intersection=null)}),f.nn),(0,f.YP)((()=>({observerPosition:(0,l.pC)(this.analysis.observer)?this.analysis.observer.position:null,observerIntersection:(0,l.pC)(this.analysis.observer)?this.analysis.observer.intersection:null})),(t=>{let{observerPosition:e,observerIntersection:i}=t;return this._onObserverPositionChange(e,i,!0)}),f.tX)])}_connectComputations(){let t=null;return(0,y.AL)([(0,f.YP)((()=>this._computations),(()=>{(0,l.hw)(t),t=this._updatingHandles.addOnCollectionChange((()=>this._computations),(t=>this._onComputationCollectionChange(t))),this._computations.forEach((t=>this._connectComputation(t)))}),f.tX),(0,y.kB)((()=>t=(0,l.hw)(t)))])}_connectTargets(){let t=null;return(0,y.AL)([(0,f.YP)((()=>this.analysis.targets),(()=>{t=(0,l.hw)(t),t=this._onTargetsChange()}),f.tX),(0,f.YP)((()=>this.analysisViewData.cursorTarget),((t,e)=>{this._onCursorTargetChange(t,e)})),(0,y.kB)((()=>{t=(0,l.hw)(t)}))])}get _isCameraDirty(){const t=this.analysisViewData.elevationAlignedObserver,{view:e}=this,{renderCoordsHelper:i}=e;if((0,l.Wi)(t)||(0,l.Wi)(i))return!1;const s=Q;i.toRenderCoords(t,s);const o=e.state.camera.computeScreenPixelSizeAt(s);return Math.abs((o-this._screenPixelSize)/this._screenPixelSize)>K}};function $(t,e){return(0,l.Wi)(e)||(0,l.pC)(t)&&t.equals(e.point)}(0,s._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"analysis",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"analysisViewData",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],J.prototype,"view",void 0),(0,s._)([(0,c.Cb)()],J.prototype,"updating",null),(0,s._)([(0,c.Cb)()],J.prototype,"priority",null),(0,s._)([(0,c.Cb)()],J.prototype,"updateOnCameraChange",void 0),(0,s._)([(0,c.Cb)()],J.prototype,"_computations",null),(0,s._)([(0,c.Cb)()],J.prototype,"_observerEngineLocation",null),(0,s._)([(0,c.Cb)()],J.prototype,"_screenPixelSize",null),(0,s._)([(0,c.Cb)({readOnly:!0})],J.prototype,"_updatingHandles",void 0),(0,s._)([(0,c.Cb)()],J.prototype,"_frameTask",void 0),(0,s._)([(0,c.Cb)()],J.prototype,"_isCameraDirty",null),J=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],J);const K=.1,Q=(0,d.c)(),tt=(0,P.Ue)(),et=(0,O.cS)(),it=new q.Z,st=new q.Z;var ot=i(81949),nt=i(33837);let rt=class extends o.Z{constructor(t){super(t),this._lineOfSightVisualizations=[],this._handle=null,this._computationHandles=new C.Z}initialize(){this._handle=this._connectAnalysis()}destroy(){this._handle=(0,l.hw)(this._handle),this._computationHandles=(0,l.SC)(this._computationHandles)}get visible(){return this.analysisViewData.visible}get testInfo(){return{visualizations:this._lineOfSightVisualizations}}get _configuration(){return this.analysisViewData.configuration}createLineOfSightVisualization(){const t=this._configuration,e={view:this.view,attached:!0,width:t.outerWidth,innerWidth:t.innerWidth},i=_.Z.toUnitRGBA(t.visibleOuterColor),s=_.Z.toUnitRGBA(t.visibleInnerColor),o=_.Z.toUnitRGBA(t.occludedOuterColor),n=_.Z.toUnitRGBA(t.occludedInnerColor),r=_.Z.toUnitRGBA(t.undefinedOuterColor),a=_.Z.toUnitRGBA(t.undefinedInnerColor),l={visibleLineVisualElement:new nt.r({...e,color:i,innerColor:s}),occludedLineVisualElement:new nt.r({...e,color:o,innerColor:n}),undefinedLineVisualElement:new nt.r({...e,color:r,innerColor:a})};return this._lineOfSightVisualizations.push(l),l}destroyLineOfSightVisualization(t){t.visibleLineVisualElement=(0,l.SC)(t.visibleLineVisualElement),t.occludedLineVisualElement=(0,l.SC)(t.occludedLineVisualElement),t.undefinedLineVisualElement=(0,l.SC)(t.undefinedLineVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(t),1)}updateLineOfSightVisualization(t,e){const i=this._configuration,{computationResult:s,inputPoints:o}=t,{start:n,end:r,intersection:a,isValid:c,isTargetVisible:h}=s,{observer:u}=o,p=ht;p[12]=u[0],p[13]=u[1],p[14]=u[2];const g=(0,b.f)(at,n,u),C=(0,b.f)(lt,r,u),y=(0,b.f)(ct,a,u),{visibleLineVisualElement:v,occludedLineVisualElement:m,undefinedLineVisualElement:f}=e,w=(0,l.Wi)(this.analysisViewData.elevationAlignedObserver)||(0,l.Wi)(t.elevationAlignedTargetLocation),O=this.visible&&!w;v.visible=O,m.visible=O,f.visible=O,O&&(v.geometry=null,m.geometry=null,f.geometry=null,c?h?(v.geometry=[[(0,d.d)(g),(0,d.d)(C)]],v.transform=p,v.color=_.Z.toUnitRGBA(i.visibleOuterColor)):(v.geometry=[[(0,d.d)(g),(0,d.d)(y)]],v.transform=p,v.color=_.Z.toUnitRGBA(i.occludedOuterColor),m.geometry=[[(0,d.d)(y),(0,d.d)(C)]],m.transform=p):(f.geometry=[[(0,d.d)(g),(0,d.d)(C)]],f.transform=p))}getLineOfSightVisualizationDependencies(t){const{computationResult:e}=t,{occludedOuterColor:i,visibleOuterColor:s}=this._configuration;return{computationResult:e,occludedOuterColor:i,visibleOuterColor:s,visible:this.visible}}_connectComputation(t){const e=this._computationHandles;if(e.has(t))return;const i=this.createLineOfSightVisualization();e.add([(0,f.YP)((()=>this.getLineOfSightVisualizationDependencies(t)),(()=>this.updateLineOfSightVisualization(t,i)),f.tX),(0,y.kB)((()=>this.destroyLineOfSightVisualization(i)))],t)}_disconnectComputation(t){this._computationHandles.remove(t)}_connectAnalysis(){let t=null;return(0,y.AL)([(0,f.YP)((()=>this.analysisViewData.computations),(e=>{t=(0,l.hw)(t),t=e.on("change",(t=>this._onComputationsCollectionChange(t))),this._onComputationsCollectionChange({target:e,added:e.items,removed:[],moved:[]})}),f.tX),(0,y.kB)((()=>t=(0,l.hw)(t)))])}_onComputationsCollectionChange(t){t.added.forEach((t=>this._connectComputation(t))),t.removed.forEach((t=>this._disconnectComputation(t)))}};(0,s._)([(0,c.Cb)({constructOnly:!0})],rt.prototype,"analysis",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],rt.prototype,"analysisViewData",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],rt.prototype,"view",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],rt.prototype,"visible",null),(0,s._)([(0,c.Cb)()],rt.prototype,"testInfo",null),(0,s._)([(0,c.Cb)()],rt.prototype,"_configuration",null),rt=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],rt);const at=(0,d.c)(),lt=(0,d.c)(),ct=(0,d.c)(),ht=(0,ot.c)();let ut=class extends((0,p.p)((0,a.p)(r.Z.EventedMixin(o.Z)))){constructor(t){super(t),this.type="line-of-sight-view-3d",this.computations=new n.Z,this.elevationAlignedObserver=null,this.configuration=new g,this.observerEngineLocation=(0,d.c)(),this.cursorTarget=null}initialize(){const t=this.view,e=this.analysis;this._analysisController=new J({analysis:e,analysisViewData:this,view:t}),this._analysisVisualization=new rt({analysis:e,analysisViewData:this,view:t}),this.handles.add([this._analysisController.on("result-changed",(t=>{t.target!==this.cursorTarget&&this.emit("result-changed",t)}))])}destroy(){this._analysisController=(0,l.SC)(this._analysisController),this._analysisVisualization=(0,l.SC)(this._analysisVisualization)}get results(){return this.computations.map((t=>t.result))}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t}get updating(){return(0,l.pC)(this._analysisController)&&this._analysisController.updating}getResultForTarget(t){const e=this.computations.find((e=>e.target===t));return(0,l.yw)(e,(t=>t.result))}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};(0,s._)([(0,c.Cb)()],ut.prototype,"type",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"analysis",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],ut.prototype,"results",null),(0,s._)([(0,c.Cb)()],ut.prototype,"priority",null),(0,s._)([(0,c.Cb)()],ut.prototype,"computations",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"elevationAlignedObserver",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"configuration",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"observerEngineLocation",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"cursorTarget",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"updating",null),(0,s._)([(0,c.Cb)()],ut.prototype,"_analysisController",void 0),(0,s._)([(0,c.Cb)()],ut.prototype,"_analysisVisualization",void 0),ut=(0,s._)([(0,u.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],ut);const dt=ut},33906:(t,e,i)=>{i.d(e,{G:()=>r,e:()=>a});var s=i(92026),o=i(79803),n=i(77648);function r(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=(0,o.fM)(t,e);return(0,s.Wi)(a)?null:(a.hasZ&&!r||!(0,s.pC)(i)||(a.z=(0,s.Pt)((0,n.KO)(i,a),0)),a)}function a(t,e,i){i.warnOnce(`Failed to project analysis geometry (id: '${t.id}'), projection from spatial reference (wkid: '${e.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)}},33837:(t,e,i)=>{i.d(e,{r:()=>_});var s=i(92026),o=i(14226),n=i(81949),r=i(11186),a=i(71353),l=i(90045),c=i(151),h=i(52168),u=i(75558),d=i(56529),p=i(58901);class _ extends h._{constructor(t){super(t),this._renderOccluded=d.yD.OccludeAndTransparent,this._width=1,this._color=(0,c.f)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(t)}setGeometryFromRenderSpacePoint(t){const e=1e3,i=[];i.push([[t[0]-e,t[1]+0,t[2]+0],[t[0]+e,t[1]+0,t[2]+0]]),i.push([[t[0]-0,t[1]-e,t[2]+0],[t[0]+0,t[1]+e,t[2]+0]]),i.push([[t[0]-0,t[1]+0,t[2]-e],[t[0]+0,t[1]+0,t[2]+e]]),this.geometry=i}setGeometryFromExtent(t){const e=this.view.spatialReference,i=(0,a.c)(),s=(0,a.c)(),o=100,n=[];(0,r.s)(i,t[0],t[1],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),(0,r.s)(i,t[2],t[1],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),(0,r.s)(i,t[2],t[3],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),(0,r.s)(i,t[0],t[3],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),(0,r.s)(i,t[0],t[1],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),(0,r.s)(i,t[0],t[1],o),this.view.renderCoordsHelper.toRenderCoords(i,e,s),n.push([s[0],s[1],s[2]]),this.geometry=[n]}setGeometryFromFrustum(t){const e=[];t.lines.forEach((t=>{e.push([t.origin[0],t.origin[1],t.origin[2]]),e.push([t.endpoint[0],t.endpoint[1],t.endpoint[2]])})),this.geometry=[e]}setGeometryFromBoundedPlane(t){const e=[],i=t.origin,s=t.basis1,o=t.basis2,n=.5,r=(0,a.c)(),l=(0,a.c)(),c=(0,a.c)(),h=(0,a.c)();r[0]=i[0]-s[0]*n-o[0]*n,r[1]=i[1]-s[1]*n-o[1]*n,r[2]=i[2]-s[2]*n-o[2]*n,l[0]=i[0]-s[0]*n+o[0]*n,l[1]=i[1]-s[1]*n+o[1]*n,l[2]=i[2]-s[2]*n+o[2]*n,c[0]=i[0]+s[0]*n+o[0]*n,c[1]=i[1]+s[1]*n+o[1]*n,c[2]=i[2]+s[2]*n+o[2]*n,h[0]=i[0]+s[0]*n-o[0]*n,h[1]=i[1]+s[1]*n-o[1]*n,h[2]=i[2]+s[2]*n-o[2]*n,e.push([r[0],r[1],r[2]]),e.push([l[0],l[1],l[2]]),e.push([c[0],c[1],c[2]]),e.push([h[0],h[1],h[2]]),e.push([r[0],r[1],r[2]]),this.geometry=[e]}setGeometryFromSegment(t){const e=t.endRenderSpace;this.transform=(0,o.f)(g,e);const{points:i}=t.createRenderGeometry(e,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Z;this.transform=(0,o.f)(g,e),this.geometry=t.map((t=>t.createRenderGeometry(e,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,l.g)(t,this._color)||((0,l.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,s.pC)(t)?!(0,s.Wi)(this._innerColor)&&(0,l.g)(t,this._innerColor)||(this._innerColor=(0,l.c)((0,c.c)(),t),this._updateMaterial()):(0,s.pC)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const e=(0,s.pC)(t)!==(0,s.pC)(this._stipplePattern);this._stipplePattern=t,e?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){((0,s.Wi)(t)||(0,s.Wi)(this._stippleOffColor)||!(0,l.g)(t,this._stippleOffColor))&&(this._stippleOffColor=(0,s.pC)(t)?(0,c.a)(t):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(t){this._stipplePreferContinuous!==t&&(this._stipplePreferContinuous=t,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(t){this._writeDepthEnabled!==t&&(this._writeDepthEnabled=t,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){t!==this._polygonOffset&&(this._polygonOffset=t,this._updateMaterial())}createExternalResources(){this._material=new p.U(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(t){const e=this._createLineGeometries();if(0!==e.length)for(let i=0;i<e.length;++i){const s=(0,u.YU)(e[i]);t.addGeometry(s,this._material)}}forEachExternalMaterial(t){t(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const t=this.geometry;if((0,s.Wi)(t)||0===t.length)return[];const e=[];return t.forEach((t=>{const i=t.length,s=new Float64Array(3*i);t.forEach(((t,e)=>{s[3*e+0]=t[0],s[3*e+1]=t[1],s[3*e+2]=t[2]}));const o={overlayInfo:null,attributeData:{position:s},removeDuplicateStartEnd:u.NW.KEEP};e.push(o)})),e}}const g=(0,n.c)()},52168:(t,e,i)=>{i.d(e,{_:()=>h});var s=i(92026),o=i(14226),n=i(81949),r=i(86244),a=i(68401),l=i(66327),c=i(97882);class h extends r.l{constructor(t){super(t.view),this._resources=null,this._transform=(0,n.c)()}get object(){return(0,s.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(t){(0,o.c)(this._transform,t),(0,s.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,s.Wi)(this._resources))return;const t=this._resources.object,e=this.view._stage;e.removeMany(t.geometries),t.removeAllGeometries(),this.createGeometries(t),this.visible||t.setVisible(this.visible),e.addMany(t.geometries)}createResources(){this.destroyResources();const t=this.view._stage;if(!t)return;const e=new c.F({isPickable:!1,updatePolicy:a.jq.SYNC});t.add(e);const i=new l.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),t.addMany(i.geometries),this.forEachExternalMaterial((e=>t.add(e))),t.add(i),e.add(i),this.visible||i.setVisible(!1),this._resources={layer:e,object:i}}destroyResources(){const t=this.view._stage;!(0,s.Wi)(this._resources)&&t&&(t.remove(this._resources.object),t.remove(this._resources.layer),this.forEachExternalMaterial((e=>{t.remove(e),e.dispose()})),t.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(t){(0,s.Wi)(this._resources)||this._resources.object.setVisible(t)}}},86244:(t,e,i)=>{i.d(e,{l:()=>s});class s{constructor(t){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())}))}applyProps(t){let e=!1;for(const i in t)i in this?"attached"===i?e=t[i]:this[i]=t[i]:console.error("Cannot set unknown property",i);this.attached=e}destroy(){this.attached=!1}get attached(){return this._attached}set attached(t){t!==this._attached&&this.view._stage&&(this._attached=t,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.attached&&this.updateVisibility(t))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}}}]);
//# sourceMappingURL=5755.3d75f3af.chunk.js.map