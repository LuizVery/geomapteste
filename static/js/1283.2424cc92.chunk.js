"use strict";(globalThis.webpackChunkgeowebmap=globalThis.webpackChunkgeowebmap||[]).push([[1283],{11283:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var i=a(27366),s=a(92026),r=a(66978),n=a(8537),l=(a(32718),a(25243),a(63780),a(93169),a(75366),a(69912)),p=a(69229),o=a(1424);let d=class extends((0,o.r)(p.Z)){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=(0,r.Ds)((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([(0,n.N1)(this.view.basemapTerrain,"ready",(()=>this._initializeMaximumDataResolution())),this.layer.on("redraw",(()=>this.updatingHandles.addPromise(this.redrawDebounced())))]),this.updatingHandles.add((()=>{var e,t;return null==(e=this.layer)||null==(t=e.exportImageServiceParameters)?void 0:t.version}),(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add((()=>this.timeExtent),(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}_initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;!t||e.equals(t.spatialReference),this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY}}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement("canvas"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement)||(0,s.Wi)(e.pixelData))return Promise.reject();const a=e.image,i=a.getContext("2d"),r=await this.layer.applyRenderer(e.pixelData,{signal:t}),n=this.layer.applyFilter(r).pixelBlock;if((0,s.Wi)(n))return Promise.reject();a.width=n.width,a.height=n.height;const l=i.createImageData(n.width,n.height);l.data.set(n.getAsRGBA()),i.putImageData(l,0,0)}};d=(0,i._)([(0,l.j)("esri.views.3d.layers.ImageryLayerView3D")],d);const u=d},1424:(e,t,a)=>{a.d(t,{r:()=>h});var i=a(27366),s=a(10064),r=a(92026),n=a(49861),l=(a(63780),a(93169),a(25243),a(69912)),p=a(7882),o=a(45948),d=a(21149),u=a(24405);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,t){const{layer:a}=this;if(!e)throw new s.Z("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:i}=a,n=(0,u.V)(a,t);if(!i||!(0,r.pC)(n))throw new s.Z("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:i,popupTemplate:n});const l=await n.getRequiredFields(),o=new d.Z;o.timeExtent=this.timeExtent,o.geometry=e,o.outFields=l,o.outSpatialReference=e.spatialReference;const h=this.view.resolution,m="2d"===this.view.type?new p.Z(h,h,this.view.spatialReference):new p.Z(.5*h,.5*h,this.view.spatialReference),{returnTopmostRaster:c,showNoDataRecords:w}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},g={returnDomainValues:!0,returnTopmostRaster:c,pixelSize:m,showNoDataRecords:w,signal:(0,r.pC)(t)?t.signal:null};return a.queryVisibleRasters(o,g).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return(0,i._)([(0,n.Cb)()],t.prototype,"layer",void 0),(0,i._)([(0,n.Cb)()],t.prototype,"suspended",void 0),(0,i._)([(0,n.Cb)(o.qG)],t.prototype,"timeExtent",void 0),(0,i._)([(0,n.Cb)()],t.prototype,"view",void 0),t=(0,i._)([(0,l.j)("esri.views.layers.ImageryLayerView")],t),t}},24405:(e,t,a)=>{a.d(t,{V:()=>n,e:()=>r});var i=a(92026),s=a(80031);async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.popupTemplate;if(!(0,i.pC)(t))return[];const a=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:n,typeIdField:l,globalIdField:p,relationships:o}=e;if(a.includes("*"))return["*"];const d=r?await(0,s.CH)(e):[],u=(0,s.Q0)(e.fieldsIndex,[...a,...d]);return l&&u.push(l),u&&n&&e.fieldsIndex.has(n)&&-1===u.indexOf(n)&&u.push(n),u&&p&&e.fieldsIndex.has(p)&&-1===u.indexOf(p)&&u.push(p),o&&o.forEach((t=>{const{keyField:a}=t;u&&a&&e.fieldsIndex.has(a)&&-1===u.indexOf(a)&&u.push(a)})),u}function n(e,t){return e.popupTemplate?e.popupTemplate:(0,i.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,i.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=1283.2424cc92.chunk.js.map